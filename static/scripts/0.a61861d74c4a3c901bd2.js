(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"+dGn":function(t,e,n){var i=function(t){"use strict";var e,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(t,e,n,i){var r=e&&e.prototype instanceof g?e:g,a=Object.create(r.prototype),o=new C(i||[]);return a._invoke=function(t,e,n){var i=c;return function(r,a){if(i===f)throw new Error("Generator is already running");if(i===d){if("throw"===r)throw a;return M()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=j(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===c)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=h(t,e,n);if("normal"===u.type){if(i=n.done?d:l,u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=d,n.method="throw",n.arg=u.arg)}}}(t,n,o),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c="suspendedStart",l="suspendedYield",f="executing",d="completed",p={};function g(){}function v(){}function m(){}var y={};y[a]=function(){return this};var _=Object.getPrototypeOf,b=_&&_(_(T([])));b&&b!==n&&i.call(b,a)&&(y=b);var w=m.prototype=g.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function O(t){var e;this._invoke=function(n,r){function a(){return new Promise((function(e,a){!function e(n,r,a,o){var s=h(t[n],t,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(c).then((function(t){u.value=t,a(u)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(n,r,e,a)}))}return e=e?e.then(a,a):a()}}function j(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=h(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function T(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:M}}function M(){return{value:e,done:!0}}return v.prototype=w.constructor=m,m.constructor=v,m[s]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},x(O.prototype),O.prototype[o]=function(){return this},t.AsyncIterator=O,t.async=function(e,n,i,r){var a=new O(u(e,n,i,r));return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(w),w[s]="Generator",w[a]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=T,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),h=i.call(o,"finallyLoc");if(u&&h){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;P(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:T(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),p}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},"+hU6":function(t,e,n){"use strict";var i=n("o0o1"),r=n.n(i),a=n("HaE+"),o=n("eqkD"),s=n("ODXe"),u=!1,h=new Map([["image/png",{test:function(t){return t.byteLength>=24&&2303741511===t.getUint32(0,u)},getSize:function(t){return{width:t.getUint32(16,u),height:t.getUint32(20,u)}}}],["image/jpeg",{test:function(t){return t.byteLength>=3&&65496===t.getUint16(0,u)&&255===t.getUint8(2,u)},getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,u))return null;for(var e=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=e.tableMarkers,i=e.sofMarkers,r=2;r<t.byteLength;){var a=t.getUint16(r,u);if(i.has(a))return{height:t.getUint16(r+5,u),width:t.getUint16(r+7,u)};if(!n.has(a))return null;r+=2,r+=t.getUint16(r,u)}return null}}],["image/gif",{test:function(t){return t.byteLength>=10&&1195984440===t.getUint32(0,u)},getSize:function(t){return{width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}}],["image/bmp",{test:function(t){return t.byteLength>=2&&16973===t.getUint16(0,u)},getSize:function(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}}]]),c="Invalid MIME type. Supported MIME types are: ".concat(Array.from(h.keys()).join(", "));function l(t){var e=d(t),n=!0,i=!1,r=void 0;try{for(var a,o=h.entries()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=Object(s.a)(a.value,2),c=u[0];if((0,u[1].test)(e))return c}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}function f(t){var e=h.get(t);if(!e)throw new Error(c);return e}function d(t){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return new DataView(t.buffer||t);throw new Error("toDataView")}n.d(e,"a",(function(){return p})),n.d(e,"d",(function(){return g})),n.d(e,"b",(function(){return v})),n.d(e,"e",(function(){return y})),n.d(e,"c",(function(){return _}));var p=o.a._parseImageNode||"undefined"!=typeof ImageBitmap;function g(t,e){if(o.a._parseImageNode){var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,f(e=e||l(t)).getSize)(d(t));if(!n)throw new Error("invalid image data for type: ".concat(e));return n}(t,e=e||l(t));return n.mimeType=e,n}(t).mimeType;return o.a._parseImageNode(t,n,e)}return y(t,e)}function v(t){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(r.a.mark((function t(e){var n,i,a,o=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},"undefined"!=typeof Image){t.next=9;break}return t.next=4,fetch(e,n);case 4:return i=t.sent,t.next=7,i.arrayBuffer();case 7:return a=t.sent,t.abrupt("return",g(a,n));case 9:return t.next=11,_(e,n);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t,e){if("undefined"==typeof createImageBitmap)throw new Error("parseImage");var n=new Blob([new Uint8Array(t)]);return createImageBitmap(n)}function _(t,e){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(r.a.mark((function t(e,n){var i,a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!/\.svg((\?|#).*)?$/.test(e)){t.next=10;break}return t.next=3,fetch(e,n);case 3:return a=t.sent,t.next=6,a.text();case 6:o=t.sent,i="data:image/svg+xml;base64,".concat(btoa(o)),t.next=13;break;case 10:return t.next=12,e;case 12:i=t.sent;case 13:return t.next=15,new Promise((function(t,r){try{var a=new Image;a.onload=function(){return t(a)},a.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))},a.crossOrigin=n&&n.crossOrigin||"anonymous",a.src=i}catch(t){r(t)}}));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},"+yMZ":function(t,e,n){"use strict";var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("1zMu"),s=n("HLba"),u=n("nwRP");function h(t){return c.apply(this,arguments)}function c(){return(c=Object(a.a)(r.a.mark((function t(e){var n,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=12;break}return n="fetch failed ".concat(e.status," "),t.prev=2,t.next=5,e.text();case 5:i=t.sent,n+=i,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(2);case 11:throw new Error(n);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))).apply(this,arguments)}n.d(e,"d",(function(){return f})),n.d(e,"b",(function(){return d})),n.d(e,"a",(function(){return p})),n.d(e,"c",(function(){return v}));var l="Cannot convert supplied data type";function f(t,e){return Object(o.b)(t)?e=e||t.url:Object(o.c)(e)&&(e=e.name),"string"==typeof e?e.replace(/\?.*/,""):e}function d(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var n=t.buffer||t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}throw new Error(l)}function p(t,e){return g.apply(this,arguments)}function g(){return(g=Object(a.a)(r.a.mark((function t(e,n){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:if(e=t.sent,i=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!i){t.next=6;break}return t.abrupt("return",d(e,n));case 6:if(!Object(o.c)(e)){t.next=10;break}return t.next=9,Object(u.a)(e);case 9:e=t.sent;case 10:if(!Object(o.b)(e)){t.next=23;break}return t.next=13,h(e);case 13:if(!n.binary){t.next=19;break}return t.next=16,e.arrayBuffer();case 16:t.t0=t.sent,t.next=22;break;case 19:return t.next=21,e.text();case 21:t.t0=t.sent;case 22:return t.abrupt("return",t.t0);case 23:throw new Error(l);case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return Object(o.e)(t)?t:Object(o.b)(t)&&t.body?(function(t){if(!t.ok)throw new Error("fetch failed ".concat(t.status))}(t),Object(s.a)(t.body)):Object(o.f)(t)?Object(s.a)(t):Object(o.a)(t)?t[Symbol.asyncIterator]():function(t){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.buffer||t;case 2:case"end":return e.stop()}}),e)}))();if(Object(o.e)(t))return t;if(Object(o.d)(t))return t[Symbol.iterator]();throw new Error(l)}(t)}},"/gfa":function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("qjXE"),s=n("vqa/"),u=n("n+fv"),h=6371e3,c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.phi,i=e.theta,a=e.radius,o=e.bearing,s=e.pitch,u=(e.altitude,e.radiusScale),c=void 0===u?h:u;Object(r.a)(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(n)||Number.isFinite(i)?(this.phi=n||0,this.theta=i||0):(Number.isFinite(o)||Number.isFinite(s))&&(this.bearing=o||0,this.pitch=s||0),this.radius=a||1,this.radiusScale=c||1,this.check()}return Object(a.a)(t,[{key:"toString",value:function(){return this.formatString(o.b)}},{key:"formatString",value:function(t){var e=t.printTypes,n=(t.printDegrees,o.e);return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}},{key:"equals",value:function(t){return Object(o.d)(this.radius,t.radius)&&Object(o.d)(this.theta,t.theta)&&Object(o.d)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],a=e[2];this.radius=1+a/this.radiusScale,this.phi=Object(o.h)(r),this.theta=Object(o.h)(n)}},{key:"fromVector3",value:function(t){return this.radius=u.g(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(o.a)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new s.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(o.c)(this.phi)},set:function(t){this.phi=Math.PI-Object(o.h)(t)}},{key:"pitch",get:function(){return Object(o.c)(this.theta)},set:function(t){this.theta=Object(o.h)(t)}},{key:"longitude",get:function(){return Object(o.c)(this.phi)}},{key:"latitude",get:function(){return Object(o.c)(this.theta)}},{key:"lng",get:function(){return Object(o.c)(this.phi)}},{key:"lat",get:function(){return Object(o.c)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}()},"08OO":function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("nICr"),h=n("zGfa"),c=n("BENj"),l=function(t){function e(t){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).call(this,Object.assign({},t,{type:h.a})))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:c.a})}}]),e}(u.a);l.displayName="MapView"},"11Ib":function(t,e,n){"use strict";n.d(e,"a",(function(){return x}));var i=n("rePB"),r=n("ODXe"),a=n("1OyB"),o=n("md7G"),s=n("JX7q"),u=n("foSv"),h=n("ReuC"),c=n("vuIU"),l=n("Ji7U"),f=n("L8KH"),d=n("f5Sf"),p=n("n4Ve"),g=n("pRFE"),v=n("p7wt"),m=n("d3kR"),y=n("SUVH"),_=n("rnmN"),b=n("CxzY"),w=n("5+o2"),x=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(a.a)(this,e),(n=Object(o.a)(this,Object(u.a)(e).call(this,t,i))).width=null,n.height=null,n.attachments={},n.readBuffer=36064,n.drawBuffers=[36064],n.ownResources=[],n.initialize(i),Object.seal(Object(s.a)(n)),n}return Object(l.a)(e,t),Object(c.a)(e,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.colorBufferFloat,i=e.colorBufferHalfFloat,r=!0;return n&&(r=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),r}},{key:"getDefaultFramebuffer",value:function(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new e(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}}]),Object(c.a)(e,[{key:"initialize",value:function(t){var e=t.width,n=void 0===e?1:e,i=t.height,r=void 0===i?1:i,a=t.attachments,o=void 0===a?null:a,s=t.color,u=void 0===s||s,h=t.depth,c=void 0===h||h,l=t.stencil,f=void 0!==l&&l,d=t.check,p=void 0===d||d,g=t.readBuffer,v=t.drawBuffers;if(Object(b.a)(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,o)for(var m in o){var y=o[m];(Array.isArray(y)?y[0]:y).resize({width:n,height:r})}else o=this._createDefaultAttachments(u,c,f,n,r);this.update({clearAttachments:!0,attachments:o,readBuffer:g,drawBuffers:v}),o&&p&&this.checkStatus()}},{key:"delete",value:function(){var t=!0,n=!1,i=void 0;try{for(var r,a=this.ownResources[Symbol.iterator]();!(t=(r=a.next()).done);t=!0)r.value.delete()}catch(t){n=!0,i=t}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}Object(h.a)(Object(u.a)(e.prototype),"delete",this).call(this)}},{key:"update",value:function(t){var e=t.attachments,n=void 0===e?{}:e,i=t.readBuffer,r=t.drawBuffers,a=t.clearAttachments,o=void 0!==a&&a,s=t.resizeAttachments,u=void 0===s||s;this.attach(n,{clearAttachments:o,resizeAttachments:u});var h=this.gl,c=h.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),h.bindFramebuffer(36160,c||null),this}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,n=t.height;if(null===this.handle)return Object(b.a)(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var i in void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&w.a.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))(),this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}},{key:"attach",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.clearAttachments,a=void 0!==i&&i,o=n.resizeAttachments,s=void 0===o||o,u={};a&&Object.keys(this.attachments).forEach((function(t){u[t]=null})),Object.assign(u,t);var h=this.gl.bindFramebuffer(36160,this.handle);for(var c in u){Object(b.a)(void 0!==c,"Misspelled framebuffer binding point?");var l=Number(c),f=u[l],d=f;if(d)if(d instanceof p.a)this._attachRenderbuffer({attachment:l,renderbuffer:d});else if(Array.isArray(f)){var g=Object(r.a)(f,3),v=g[0],m=g[1],y=void 0===m?0:m,_=g[2],w=void 0===_?0:_;d=v,this._attachTexture({attachment:l,texture:v,layer:y,level:w})}else this._attachTexture({attachment:l,texture:d,layer:0,level:0});else this._unattach(l);s&&d&&d.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,h||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((function(t){return!e.attachments[t]})).forEach((function(t){delete e.attachments[t]}))}},{key:"checkStatus",value:function(){this.gl;var t=this.getStatus();if(36053!==t)throw new Error(function(t){return(x.STATUS||{})[t]||"Framebuffer error ".concat(t)}(t));return this}},{key:"getStatus",value:function(){var t=this.gl,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,n=t.depth,i=t.stencil,r=t.drawBuffers,a=void 0===r?[]:r,o=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Object(g.a)(this.gl,{color:e,depth:n,stencil:i}),a.forEach((function(t,e){Object(g.b)({drawBuffer:e,value:t})})),this.gl.bindFramebuffer(36160,o||null),this}},{key:"readPixels",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],w.a.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(t){var e=t.attachments,n=void 0===e?[]:e,i=t.x,r=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.width,u=t.height,h=this.gl;Object(y.a)(h);var c=h.bindFramebuffer(36008,this.handle);return 0===r&&0===o&&void 0===s&&void 0===u?h.invalidateFramebuffer(36008,n):h.invalidateFramebuffer(36008,n,r,o,s,u),h.bindFramebuffer(36008,c),this}},{key:"getAttachmentParameter",value:function(t,e,n){var i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Object(_.a)(this.gl,i)),i}},{key:"getAttachmentParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],i={},r=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;i[e?Object(_.a)(this.gl,h):h]=this.getAttachmentParameter(t,h,e)}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return i}},{key:"getParameters",value:function(){for(var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},n=0,i=Object.keys(this.attachments);n<i.length;n++){var r=i[n],a=Number(r);e[t?Object(_.a)(this.gl,a):a]=this.getAttachmentParameters(a,t)}return e}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(Object(v.a)(this),"luma-debug-texture"),this}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>w.a.priority||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);var n=Object(v.a)(this,{maxHeight:100});return w.a.image({priority:t,message:e,image:n},e)(),this}},{key:"bind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,this.handle),this}},{key:"unbind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,null),this}},{key:"_createDefaultAttachments",value:function(t,e,n,r,a){var o,s=null;return t&&((s=s||{})[36064]=new d.a(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:a,mipmaps:!1,parameters:(o={},Object(i.a)(o,10241,9729),Object(i.a)(o,10240,9729),Object(i.a)(o,10242,33071),Object(i.a)(o,10243,33071),o)}),this.ownResources.push(s[36064])),e&&n?((s=s||{})[33306]=new p.a(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(s[33306])):e?((s=s||{})[36096]=new p.a(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:a}),this.ownResources.push(s[36096])):n&&Object(b.a)(!1),s}},{key:"_unattach",value:function(t){var e=this.attachments[t];e&&(e instanceof p.a?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}},{key:"_attachRenderbuffer",value:function(t){var e=t.attachment,n=void 0===e?36064:e,i=t.renderbuffer;this.gl.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}},{key:"_attachTexture",value:function(t){var e=t.attachment,n=void 0===e?36064:e,i=t.texture,r=t.layer,a=t.level,o=this.gl;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,i.target,a,r);break;case 34067:var s=function(t){return t<34069?t+34069:t}(r);o.framebufferTexture2D(36160,n,s,i.handle,a);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,a);break;default:Object(b.a)(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}},{key:"_setReadBuffer",value:function(t){var e=this.gl;Object(y.d)(e)?e.readBuffer(t):Object(b.a)(36064===t||1029===t,"Multiple render targets not supported"),this.readBuffer=t}},{key:"_setDrawBuffers",value:function(t){var e=this.gl;if(Object(y.d)(e))e.drawBuffers(t);else{var n=e.getExtension("WEBGL.draw_buffers");n?n.drawBuffersWEBGL(t):Object(b.a)(1===t.length&&(36064===t[0]||1029===t[0]),"Multiple render targets not supported")}this.drawBuffers=t}},{key:"_getAttachmentParameterFallback",value:function(t){var e=Object(m.a)(this.gl);switch(t){case 36052:return e.webgl2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.webgl2?null:8;case 33297:return e.webgl2?null:5125;case 33296:return e.webgl2||e.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(t){return this.gl.bindFramebuffer(36160,t)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]),e}(f.a);x.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303]},"1A8y":function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("JX7q"),h=n("ODXe"),c=n("VKpO"),l=n("B7nP"),f=n("ZaHm"),d=Object(c.a)(),p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,a=e.viewMatrix,o=void 0===a?d:a,s=e.projectionMatrix,u=void 0===s?d:s;Object(i.a)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var h=Object(c.a)();f.h(h,h,this.projectionMatrix),f.h(h,h,this.viewMatrix),this.viewProjectionMatrix=h;var l=Object(c.a)();f.o(l,l,[this.width/2,-this.height/2,1]),f.p(l,l,[1,-1,0]),f.h(l,l,this.viewProjectionMatrix);var p=f.f(Object(c.a)(),l);if(!p)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=p,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(r.a)(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&f.b(e.projectionMatrix,this.projectionMatrix)&&f.b(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===e||e,i=this.projectPosition(t),r=Object(l.k)(i,this.pixelProjectionMatrix),a=Object(h.a)(r,2),o=a[0],s=a[1],u=n?s:this.height-s;return 2===t.length?[o,u]:[o,u,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,i=void 0===n||n,r=e.targetZ,a=Object(h.a)(t,3),o=a[0],s=a[1],u=a[2],c=i?s:this.height-s,f=r&&r*this.pixelsPerMeter,d=Object(l.h)([o,c,u],this.pixelUnprojectionMatrix,f),p=this.unprojectPosition(d),g=Object(h.a)(p,3),v=g[0],m=g[1],y=g[2];return Number.isFinite(u)?[v,m,y]:Number.isFinite(r)?[v,m,r]:[v,m]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(h.a)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(h.a)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}}]),t}(),g=n("w+ko"),v=n("ZxFD");n.d(e,"a",(function(){return m}));var m=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,s=n.height,h=n.latitude,c=void 0===h?0:h,f=n.longitude,d=void 0===f?0:f,p=n.zoom,g=void 0===p?0:p,v=n.pitch,m=void 0===v?0:v,y=n.bearing,_=void 0===y?0:y,b=n.altitude,w=void 0===b?1.5:b,x=n.nearZMultiplier,O=n.farZMultiplier;Object(i.a)(this,e),r=r||1,s=s||1;var j=Object(l.l)(g);w=Math.max(.75,w);var k=Object(l.g)([d,c],j);k[2]=0;var P=Object(l.d)({width:r,height:s,pitch:m,bearing:_,altitude:w,nearZMultiplier:x||1/s,farZMultiplier:O||1.01}),C=Object(l.f)({height:s,center:k,pitch:m,bearing:_,altitude:w,flipY:!0});return(t=Object(a.a)(this,Object(o.a)(e).call(this,{width:r,height:s,viewMatrix:C,projectionMatrix:P}))).latitude=c,t.longitude=d,t.zoom=g,t.pitch=m,t.bearing=_,t.altitude=w,t.scale=j,t.center=k,t.pixelsPerMeter=Object(l.b)(Object(u.a)(Object(u.a)(t))).pixelsPerMeter[2],Object.freeze(Object(u.a)(Object(u.a)(t))),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(l.g)(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(l.j)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,i=Object(l.h)(n,this.pixelUnprojectionMatrix),r=Object(l.g)(e,this.scale),a=v.a([],r,v.d([],i)),o=v.a([],this.center,a);return Object(l.j)(o,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,a=Object(g.a)(Object.assign({width:i,height:r,bounds:t},n));return new e({width:i,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(p)},"1OyB":function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return i}))},"1eIE":function(t,e,n){"use strict";function i(t,e){if(t===e)return!0;var n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}n.d(e,"a",(function(){return i}))},"1kz3":function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("lQOs"),s=n("OklE"),u=function(){function t(e){Object(r.a)(this,t),this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._moduleInjections={vs:{},fs:{}},this._hookFunctions={vs:{},fs:{}},this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return Object(a.a)(t,null,[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),Object(a.a)(t,[{key:"addDefaultModule",value:function(t){this._defaultModules.find((function(e){return e.name===t.name}))||this._defaultModules.push(t),this.stateHash++}},{key:"removeDefaultModule",value:function(t){var e="string"==typeof t?t:t.name;this._defaultModules=this._defaultModules.filter((function(t){return t.name!==e})),this.stateHash++}},{key:"addModuleInjection",value:function(t,e){var n="string"==typeof t?t:t.name,i=e.hook,r=e.injection,a=e.order,o=void 0===a?0:a,s=i.slice(0,2),u=this._moduleInjections[s];u[n]=u[n]||{},u[n][i]={injection:r,order:o},this.stateHash++}},{key:"addShaderHook",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t=t.trim()).split(":"),r=Object(i.a)(n,2),a=r[0],o=r[1],s=t.replace(/\(.+/,"");this._hookFunctions[a][s]=Object.assign(e,{signature:o}),this.stateHash++}},{key:"get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.vs,i=void 0===n?"":n,r=e.fs,a=void 0===r?"":r,u=e.defines,h=void 0===u?{}:u,c=e.inject,l=void 0===c?{}:c,f=e.varyings,d=void 0===f?[]:f,p=e.bufferMode,g=void 0===p?35981:p,v=this._getModuleList(e.modules),m=this._getHash(i),y=this._getHash(a),_=v.map((function(e){return t._getHash("string"==typeof e?e:e.name)})).sort(),b=d.map((function(e){return t._getHash(e)})),w=Object.keys(h).sort(),x=Object.keys(l).sort(),O=[],j=[],k=!0,P=!1,C=void 0;try{for(var T,M=w[Symbol.iterator]();!(k=(T=M.next()).done);k=!0){var E=T.value;O.push(this._getHash(E)),O.push(this._getHash(h[E]))}}catch(t){P=!0,C=t}finally{try{k||null==M.return||M.return()}finally{if(P)throw C}}var S=!0,A=!1,L=void 0;try{for(var R,I=x[Symbol.iterator]();!(S=(R=I.next()).done);S=!0){var D=R.value;j.push(this._getHash(D)),j.push(this._getHash(l[D]))}}catch(t){A=!0,L=t}finally{try{S||null==I.return||I.return()}finally{if(A)throw L}}var F="".concat(m,"/").concat(y,"D").concat(O.join("/"),"M").concat(_.join("/"),"I").concat(j.join("/"),"V").concat(b.join("/"),"H").concat(this.stateHash,"B").concat(g);if(!this._programCache[F]){var z=Object(o.a)(this.gl,{vs:i,fs:a,modules:v,inject:l,defines:h,hookFunctions:this._hookFunctions,moduleInjections:this._moduleInjections});this._programCache[F]=new s.a(this.gl,{hash:F,vs:z.vs,fs:z.fs,varyings:d,bufferMode:g}),this._getUniforms[F]=z.getUniforms||function(t){},this._useCounts[F]=0}return this._useCounts[F]++,this._programCache[F]}},{key:"getUniforms",value:function(t){return this._getUniforms[t.hash]||null}},{key:"release",value:function(t){var e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}},{key:"_getHash",value:function(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}},{key:"_getModuleList",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=new Array(this._defaultModules.length+t.length),n={},i=0,r=0,a=this._defaultModules.length;r<a;++r){var o=this._defaultModules[r],s="string"==typeof o?o:o.name;e[i++]=o,n[s]=!0}for(var u=0,h=t.length;u<h;++u){var c=t[u],l="string"==typeof c?c:c.name;n[l]||(e[i++]=c,n[l]=!0)}return e.length=i,e}}]),t}()},"1zMu":function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return c})),n.d(e,"f",(function(){return l}));var i=n("XM/H"),r=function(t){return"function"==typeof t},a=function(t){return null!==t&&"object"===Object(i.a)(t)},o=function(t){return t&&"function"==typeof t[Symbol.iterator]},s=function(t){return t&&"function"==typeof t[Symbol.asyncIterator]},u=function(t){return t&&r(t.next)},h=function(t){return"undefined"!=typeof Response&&t instanceof Response||t.arrayBuffer&&t.text&&t.json},c=function(t){return function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)},l=function(t){return function(t){return a(t)&&r(t.tee)&&r(t.cancel)&&r(t.pipeTo)&&r(t.getReader)}(t)||function(t){return a(t)&&r(t.read)&&r(t.pipe)&&function(t){return"boolean"==typeof t}(t.readable)}(t)}},"23rh":function(t,e,n){"use strict";(function(t,i){n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return h}));var r=n("XM/H"),a="object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||t.browser,o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==i&&i,document:"undefined"!=typeof document&&document},s=o.global||o.self||o.window,u=void 0!==t&&t.version&&t.version.match(/v([0-9]*)/),h=u&&parseFloat(u[1])||0}).call(this,n("8oxB"),n("yLpj"))},"2WEh":function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));var i=n("XM/H"),r=n("5a1V");function a(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t)if(t instanceof ArrayBuffer)n.push(t);else if(t.buffer&&t.buffer instanceof ArrayBuffer)n.push(t.buffer);else if(e&&"object"===Object(i.a)(t))for(var r in t)a(t[r],e,n);return n}var o=new Map;function s(t){if(Object(r.a)("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")"))return t.match(/^url\((.*)\)$/)[1];var e=o.get(t);if(!e){var n=new Blob([t],{type:"application/javascript"});e=URL.createObjectURL(n),o.set(t,e)}return e}},"3UD+":function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},"3jj3":function(t,e,n){"use strict";function i(t,e,n){var i=e[0],r=e[1],a=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/a,t[1]=(n[1]*i+n[5]*r)/a,t}function r(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a||1;return t[0]=(n[0]*i+n[4]*r+n[8]*a)/o,t[1]=(n[1]*i+n[5]*r+n[9]*a)/o,t[2]=(n[2]*i+n[6]*r+n[10]*a)/o,t}function a(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function o(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function s(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*a,t[1]=n[1]*i+n[4]*r+n[7]*a,t[2]=n[2]*i+n[5]*r+n[8]*a,t[3]=e[3],t}n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return o})),n.d(e,"e",(function(){return s}))},"4TbO":function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return i}))},"4oKg":function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.d(e,"a",(function(){return r}))},"5+o2":function(t,e,n){"use strict";var i=n("d3wX");e.a=new i.a({id:"luma"}).enable()},"54ZI":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}n.d(e,"a",(function(){return i}))},"5JRv":function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("edxD"),h=n("nzaO"),c=n("vu3J"),l=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var i=this[n]-t[n];e+=i*i}return Object(h.a)(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Object(h.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var a=r[i],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var a=r[i],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Object(c.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(h.a)(this[t])}},{key:"setComponent",value:function(t,e){return Object(c.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Object(h.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Object(h.a)(t)}}]),e}(u.a)},"5a1V":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"loader assertion failed.")}n.d(e,"a",(function(){return i}))},"5cL1":function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l}));var i=n("ODXe"),r=n("V3d6"),a=n("V8ep"),o=n("bl9R"),s=n("n+fv"),u=n("B7nP");function h(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(i.a)(t,3),a=r[0],o=r[1],s=r[2],h=void 0===s?0:s,c=e.projectFlat(t),l=Object(i.a)(c,2);return[l[0],l[1],h*(n?Object(u.b)({longitude:a,latitude:o,scale:e.scale}):e.getDistanceScales()).pixelsPerMeter[2]]}function c(t,e){var n=e.viewport,a=e.modelMatrix,s=e.coordinateSystem,c=e.coordinateOrigin,l=e.offsetMode,f=Object(i.a)(t,3),d=f[0],p=f[1],g=f[2];if(a){var v=o.n([],[d,p,g,1],a),m=Object(i.a)(v,3);d=m[0],p=m[1],g=m[2]}switch(s){case r.a.LNGLAT:case r.a.LNGLAT_DEPRECATED:return h([d,p,g],n,l);case r.a.LNGLAT_OFFSETS:return h([d+c[0],p+c[1],g+(c[2]||0)],n,l);case r.a.METER_OFFSETS:return h(Object(u.a)(c,[d,p,g]),n,l);case r.a.IDENTITY:default:return n.projectPosition([d,p,g])}}function l(t,e){var n=function(t){var e=Object.assign({},t),n=t.viewport,i=t.coordinateSystem,o=t.coordinateOrigin,s=t.fromCoordinateSystem,u=t.fromCoordinateOrigin;return void 0===s&&(e.fromCoordinateSystem=i),void 0===u&&(e.fromCoordinateOrigin=o),i===r.a.LNGLAT&&n.zoom>=a.a&&(e.coordinateSystem=r.a.LNGLAT_OFFSETS,e.coordinateOrigin=[Math.fround(n.longitude),Math.fround(n.latitude)]),e}(e),i=n.viewport,o=n.coordinateSystem,u=n.coordinateOrigin,l=n.modelMatrix,f=n.fromCoordinateSystem,d=n.fromCoordinateOrigin;switch(o){case r.a.LNGLAT_OFFSETS:case r.a.METER_OFFSETS:var p=c(t,{viewport:i,modelMatrix:l,coordinateSystem:f,coordinateOrigin:d,offsetMode:!0}),g=h(u,i,!0);return s.m(p,p,g),p;case r.a.LNGLAT:case r.a.LNGLAT_DEPRECATED:case r.a.IDENTITY:default:return c(t,{viewport:i,modelMatrix:l,coordinateSystem:f,coordinateOrigin:d,offsetMode:!1})}}},"5ku3":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n("U8pU"),r=n("I0ug");function a(){return!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(r.a)()}}).call(this,n("8oxB"))},"7+mA":function(t,e,n){"use strict";var i=n("rePB");e.a={enable:function(t,e){return t(Object(i.a)({},e,!0))},disable:function(t,e){return t(Object(i.a)({},e,!1))},pixelStorei:function(t,e,n){return t(Object(i.a)({},e,n))},hint:function(t,e,n){return t(Object(i.a)({},e,n))},bindFramebuffer:function(t,e,n){var r;switch(e){case 36160:return t((r={},Object(i.a)(r,36006,n),Object(i.a)(r,36010,n),r));case 36009:return t(Object(i.a)({},36006,n));case 36008:return t(Object(i.a)({},36010,n));default:return null}},blendColor:function(t,e,n,r,a){return t(Object(i.a)({},32773,new Float32Array([e,n,r,a])))},blendEquation:function(t,e){var n;return t((n={},Object(i.a)(n,32777,e),Object(i.a)(n,34877,e),n))},blendEquationSeparate:function(t,e,n){var r;return t((r={},Object(i.a)(r,32777,e),Object(i.a)(r,34877,n),r))},blendFunc:function(t,e,n){var r;return t((r={},Object(i.a)(r,32969,e),Object(i.a)(r,32968,n),Object(i.a)(r,32971,e),Object(i.a)(r,32970,n),r))},blendFuncSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,32969,e),Object(i.a)(o,32968,n),Object(i.a)(o,32971,r),Object(i.a)(o,32970,a),o))},clearColor:function(t,e,n,r,a){return t(Object(i.a)({},3106,new Float32Array([e,n,r,a])))},clearDepth:function(t,e){return t(Object(i.a)({},2931,e))},clearStencil:function(t,e){return t(Object(i.a)({},2961,e))},colorMask:function(t,e,n,r,a){return t(Object(i.a)({},3107,[e,n,r,a]))},cullFace:function(t,e){return t(Object(i.a)({},2885,e))},depthFunc:function(t,e){return t(Object(i.a)({},2932,e))},depthRange:function(t,e,n){return t(Object(i.a)({},2928,new Float32Array([e,n])))},depthMask:function(t,e){return t(Object(i.a)({},2930,e))},frontFace:function(t,e){return t(Object(i.a)({},2886,e))},lineWidth:function(t,e){return t(Object(i.a)({},2849,e))},polygonOffset:function(t,e,n){var r;return t((r={},Object(i.a)(r,32824,e),Object(i.a)(r,10752,n),r))},sampleCoverage:function(t,e,n){var r;return t((r={},Object(i.a)(r,32938,e),Object(i.a)(r,32939,n),r))},scissor:function(t,e,n,r,a){return t(Object(i.a)({},3088,new Int32Array([e,n,r,a])))},stencilMask:function(t,e){var n;return t((n={},Object(i.a)(n,2968,e),Object(i.a)(n,36005,e),n))},stencilMaskSeparate:function(t,e,n){return t(Object(i.a)({},1028===e?2968:36005,n))},stencilFunc:function(t,e,n,r){var a;return t((a={},Object(i.a)(a,2962,e),Object(i.a)(a,2967,n),Object(i.a)(a,2963,r),Object(i.a)(a,34816,e),Object(i.a)(a,36003,n),Object(i.a)(a,36004,r),a))},stencilFuncSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,1028===e?2962:34816,n),Object(i.a)(o,1028===e?2967:36003,r),Object(i.a)(o,1028===e?2963:36004,a),o))},stencilOp:function(t,e,n,r){var a;return t((a={},Object(i.a)(a,2964,e),Object(i.a)(a,2965,n),Object(i.a)(a,2966,r),Object(i.a)(a,34817,e),Object(i.a)(a,34818,n),Object(i.a)(a,34819,r),a))},stencilOpSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,1028===e?2964:34817,n),Object(i.a)(o,1028===e?2965:34818,r),Object(i.a)(o,1028===e?2966:34819,a),o))},viewport:function(t,e,n,r,a){return t(Object(i.a)({},2978,new Int32Array([e,n,r,a])))}}},"7GCR":function(t,e,n){"use strict";n.r(e),function(t,i){n.d(e,"Util",(function(){return Dt})),n.d(e,"DomUtil",(function(){return rn})),n.d(e,"StringUtil",(function(){return Te})),n.d(e,"MapboxUtil",(function(){return Pt})),n.d(e,"Map",(function(){return yi})),n.d(e,"ui",(function(){return Aa})),n.d(e,"control",(function(){return Va})),n.d(e,"renderer",(function(){return Wo})),n.d(e,"symbolizer",(function(){return Zi})),n.d(e,"animation",(function(){return gr})),n.d(e,"Browser",(function(){return oe})),n.d(e,"Ajax",(function(){return an})),n.d(e,"Canvas",(function(){return un})),n.d(e,"Promise",(function(){return mn})),n.d(e,"Class",(function(){return wn})),n.d(e,"Eventable",(function(){return yn})),n.d(e,"JSONAble",(function(){return On})),n.d(e,"Handlerable",(function(){return jn})),n.d(e,"Handler",(function(){return bn})),n.d(e,"DragHandler",(function(){return Cn})),n.d(e,"MapTool",(function(){return ta})),n.d(e,"DrawTool",(function(){return na})),n.d(e,"AreaTool",(function(){return wa})),n.d(e,"DistanceTool",(function(){return ba})),n.d(e,"SpatialReference",(function(){return vi})),n.d(e,"INTERNAL_LAYER_PREFIX",(function(){return r})),n.d(e,"GEOMETRY_COLLECTION_TYPES",(function(){return a})),n.d(e,"GEOJSON_TYPES",(function(){return o})),n.d(e,"RESOURCE_PROPERTIES",(function(){return s})),n.d(e,"RESOURCE_SIZE_PROPERTIES",(function(){return u})),n.d(e,"NUMERICAL_PROPERTIES",(function(){return h})),n.d(e,"COLOR_PROPERTIES",(function(){return c})),n.d(e,"projection",(function(){return hi})),n.d(e,"measurer",(function(){return ni})),n.d(e,"Coordinate",(function(){return Tn})),n.d(e,"CRS",(function(){return Mn})),n.d(e,"Extent",(function(){return Vn})),n.d(e,"Point",(function(){return ce})),n.d(e,"PointExtent",(function(){return Gn})),n.d(e,"Size",(function(){return le})),n.d(e,"Transformation",(function(){return Hn})),n.d(e,"Layer",(function(){return di})),n.d(e,"TileLayer",(function(){return to})),n.d(e,"GroupTileLayer",(function(){return eo})),n.d(e,"WMSTileLayer",(function(){return ro})),n.d(e,"CanvasTileLayer",(function(){return ao})),n.d(e,"ImageLayer",(function(){return fo})),n.d(e,"OverlayLayer",(function(){return Jr})),n.d(e,"VectorLayer",(function(){return Qr})),n.d(e,"CanvasLayer",(function(){return _o})),n.d(e,"ParticleLayer",(function(){return wo})),n.d(e,"TileSystem",(function(){return Ga})),n.d(e,"TileConfig",(function(){return Za})),n.d(e,"ArcCurve",(function(){return Fr})),n.d(e,"Circle",(function(){return Ar})),n.d(e,"ConnectorLine",(function(){return Xr})),n.d(e,"ArcConnectorLine",(function(){return qr})),n.d(e,"CubicBezierCurve",(function(){return zr})),n.d(e,"Curve",(function(){return Dr})),n.d(e,"Ellipse",(function(){return Lr})),n.d(e,"GeoJSON",(function(){return Sr})),n.d(e,"Geometry",(function(){return rr})),n.d(e,"GeometryCollection",(function(){return Or})),n.d(e,"Label",(function(){return Hr})),n.d(e,"LineString",(function(){return xr})),n.d(e,"Marker",(function(){return br})),n.d(e,"MultiLineString",(function(){return Tr})),n.d(e,"MultiPoint",(function(){return Pr})),n.d(e,"MultiPolygon",(function(){return Mr})),n.d(e,"Polygon",(function(){return yr})),n.d(e,"QuadBezierCurve",(function(){return Br})),n.d(e,"Rectangle",(function(){return Rr})),n.d(e,"Sector",(function(){return Ir})),n.d(e,"TextBox",(function(){return Gr})),n.d(e,"TextMarker",(function(){return Vr}));var r="_maptalks__internal_layer_",a=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],o=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(a),s=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],u=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],h={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},c=["lineColor","polygonFill","markerFill","markerLineColor","textFill"];function l(){return Date.now()}function f(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function d(t){return null==t}function p(t){return"number"==typeof t&&!isNaN(t)}function g(t){return(0|t)===t}function v(t){return"object"==typeof t&&!!t}function m(t){return!d(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function y(t){return!d(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var _=Object.prototype.hasOwnProperty;function b(t,e){return _.call(t,e)}var w=Math.PI/180;function x(t){return t*w}function O(t){return t/w}var j,k,P="[object process]"===Object.prototype.toString.call(void 0!==t?t:0)&&!t.versions.electron&&!t.versions.nw&&!t.versions["node-webkit"];function C(t){return t.length>4&&".svg"===t.slice(-4)?1:"data:image/svg+xml"===t.slice(0,"data:image/svg+xml".length)?2:0}function T(t,e){P&&T.node?T.node(t,e):t.src=e[0]}!function(){if(P)return j=function(t){return setTimeout(t,16)},void(k=clearTimeout);var t,e,n=1e3/30;function i(t){return setTimeout(t,n)}function r(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||r("RequestAnimationFrame")||i,e=window.cancelAnimationFrame||r("CancelAnimationFrame")||r("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=i,e=clearTimeout),j=function(e){return t(e)},k=function(t){t&&e(t)}}();var M=0;function E(){return M++}var S=E;function A(t){return t&&m(t)?JSON.parse(t):t}function L(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var i=0,r=n.length;i<r;i++)t.push(n[i])}return t.length}function R(t,e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function I(t,e,n){if(!Array.isArray(t))return n?e.call(n,t):e(t);for(var i,r,a=[],o=0,s=t.length;o<s;o++)d(i=t[o])?a.push(null):Array.isArray(i)?a.push(I(i,e,n)):(r=n?e.call(n,i):e(i),a.push(r));return a}function D(t,e){return void 0===t?e:t}function F(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function z(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,n=Math.round(e);return Math.abs(n-e)<1e-14?n:e}function B(t,e,n){return t*(1-n)+e*n}function N(t,e,n){if(t===n||t===e)return t;var i=n-e;return((t-e)%i+i)%i+e}function U(t,e,n){return Math.min(n,Math.max(e,t))}function V(t){return Array.isArray(t)&&t.length>0}function G(t){if(!t)return!1;var e=t.slice(0,6);return"http:/"===e||"https:"===e||"file:/"===e}var H=/^url\((['"])(.+)\1\)$/i,Z=/^url\(([^'"].*[^'"])\)$/i;function W(t){if(!m(t))return 0;var e=t.slice(0,6);return"http:/"===e||"https:"===e?3:Z.test(t)?1:H.test(t)?2:0}function X(t){var e=W(t);return 3===e?t:1===e?Z.exec(t)[1]:2===e?H.exec(t)[2]:t}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Y(t){if("undefined"!=typeof window&&window.btoa)return window.btoa(t);for(var e,n,i=String(t),r="",a=0,o=q;i.charAt(0|a)||(o="=",a%1);r+=o.charAt(63&e>>8-a%1*8)){if((n=i.charCodeAt(a+=.75))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|n}return r}function J(t,e){for(var n=atob(t),i=new ArrayBuffer(n.length),r=new Uint8Array(i),a=0;a<n.length;a++)r[a]=255&n.charCodeAt(a);return new Blob([i],{type:e})}function K(t,e,n,i){var r=n-t,a=i-e;return Math.atan2(a,r)}var Q="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function $(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var n in t)if("center"===n){if(!e[n]||!tt(t[n][0],e[n][0])||!tt(t[n][1],e[n][1]))return!1}else if(t[n]!==e[n])return!1;return!0}function tt(t,e,n){return null==n&&(n=1e-6),t>=e-n&&t<=e+n}function et(t,e,n,i){t||(t=100),e||(e=4);var r=this;return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function a(){if(0===e)return r.show(),void(n&&(i?n.call(i):n()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(a,t)}),t),this}var nt=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function it(t){return new Function("f","var p = (f && f.properties || {}); return "+rt(t))}function rt(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?ot(t[1],t[2],"===",!1):"!="===e?ot(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?ot(t[1],t[2],e,!0):"any"===e?st(t.slice(1),"||"):"all"===e?st(t.slice(1),"&&"):"none"===e?ct(st(t.slice(1),"||")):"in"===e?ut(t[1],t.slice(2)):"!in"===e?ct(ut(t[1],t.slice(2))):"has"===e?ht(t[1]):"!has"===e?ct(ht(t[1])):"true")+")"}function at(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function ot(t,e,n,i){var r=at(t),a="$type"===t?nt.indexOf(e):JSON.stringify(e);return(i?"typeof "+r+"=== typeof "+a+"&&":"")+r+n+a}function st(t,e){return t.map(rt).join(e)}function ut(t,e){"$type"===t&&(e=e.map((function(t){return nt.indexOf(t)})));var n=JSON.stringify(e.sort(lt)),i=at(t);return e.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+i+", "+n+",0,"+(e.length-1)+")"}function ht(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function ct(t){return"!("+t+")"}function lt(t,e){return t<e?-1:t>e?1:0}function ft(t){var e=t._toJSON(),n=e.feature;return n.type=nt.indexOf(n.geometry.type),n.subType=e.subType,n}function dt(t){if(!Array.isArray(t))return dt([t]);for(var e=[],n=0;n<t.length;n++){var i;i=!0===t[n].filter?function(){return!0}:it(t[n].filter),e.push(pt({},t[n],{filter:i}))}return e}function pt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function gt(t,e){for(var n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function vt(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function mt(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:function t(e,n,i,r,a,o){return"function"==typeof a?function(){var s=a.apply(void 0,arguments),u=o.apply(void 0,arguments);return t(e,n,i,r,s,u)}:a.length?function(t,e,n,i,r,a){for(var o=[],s=0;s<r.length;s++)o[s]=_t(t,e,n,i,r[s],a[s]);return o}(e,n,i,r,a,o):_t(e,n,i,r,a,o)}(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}function yt(t,e){return function(t,e,n){return void 0!==t?t:void 0!==e?e:null}(e,t.default)}function _t(t,e,n,i,r,a){var o,s=i-n,u=t-n;return r*(1-(o=1===e?u/s:(Math.pow(e,u)-1)/(Math.pow(e,s)-1)))+a*o}function bt(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function wt(t){for(var e in t)if(bt(t[e]))return!0;return!1}function xt(t){return kt(t,"exponential")}function Ot(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){for(var i,r=[],a=0;a<t.length;a++)(i=Ot(t[a],e))?(r.push(i),n=!0):r.push(t[a]);return n?r:t}var o,s={__fn_types_loaded:!0},u=[];for(o in t)t.hasOwnProperty(o)&&u.push(o);for(var h=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=xt(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},c=0,l=u.length;c<l;c++)bt(t[o=u[c]])?(n=!0,s["_"+o]=t[o],h(o)):s[o]=t[o];return n?s:t}function jt(t){if(!t||!t.stops)return[];for(var e=[],n=0,i=t.stops.length;n<i;n++)e.push(t.stops[n][1]);return e}function kt(t,e){if(!bt(t))return function(){return t};var n=!0,i=!0,r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(var a=0;a<r.length;a++)if(bt(r[a][1])){var o=kt(r[a][1],e);n=n&&o.isZoomConstant,i=i&&o.isFeatureConstant,r[a]=[r[a][0],o]}var s=function t(e,n){var i,r,a;if(bt(e)){var o,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,h=s||!u,c=e.type||n||"exponential";if("exponential"===c)o=mt;else if("interval"===c)o=vt;else if("categorical"===c)o=gt;else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');o=yt}if(s){for(var l={},f=[],d=0;d<e.stops.length;d++){var p=e.stops[d];void 0===l[p[0].zoom]&&(l[p[0].zoom]={zoom:p[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),l[p[0].zoom].stops.push([p[0].value,p[1]])}for(var g in l)f.push([l[g].zoom,t(l[g])]);i=function(t,n){var i=mt({stops:f,base:e.base},t)(t,n);return"function"==typeof i?i(t,n):i},r=!1,a=!1}else h?(i=function(t){var n=o(e,t);return"function"==typeof n?n(t):n},r=!0,a=!1):(i=function(t,n){var i=o(e,n?n[e.property]:null);return"function"==typeof i?i(t,n):i},r=!1,a=!0)}else i=function(){return e},r=!0,a=!0;return i.isZoomConstant=a,i.isFeatureConstant=r,i}(t,e);return s.isZoomConstant=n&&s.isZoomConstant,s.isFeatureConstant=i&&s.isFeatureConstant,s}var Pt=Object.freeze({createFilter:it,getFilterFeature:ft,compileStyle:dt,isFunctionDefinition:bt,hasFunctionDefinition:wt,interpolated:xt,piecewiseConstant:function(t){return kt(t,"interval")},loadFunctionTypes:Ot,getFunctionTypeResources:jt});function Ct(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function Tt(t,e,n){if(!t.markerPath)return null;var i=1,r=Ct(t);p(t.markerOpacity)&&(i=t.markerOpacity),p(t.opacity)&&(i*=t.opacity);var a={};if(r){for(var o in r.stroke)r.stroke.hasOwnProperty(o)&&(d(r.stroke[o])||(a[o]=r.stroke[o]));for(var s in r.fill)r.fill.hasOwnProperty(s)&&(d(r.fill[s])||(a[s]=r.fill[s]))}for(var u,h=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],c=[],l=0;l<h.length;l++)(u=f({},u=m(h[l])?{path:h[l]}:h[l],a)).d=u.path,delete u.path,c.push(u);var g=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];i<1&&g.push('opacity="'+i+'"'),t.markerPathWidth&&t.markerPathHeight&&g.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),g.push('preserveAspectRatio="none"'),e&&g.push('width="'+e+'"'),n&&g.push('height="'+n+'"'),g.push("><defs></defs>");for(var v=0;v<c.length;v++){var y="<path ";for(var _ in c[v])c[v].hasOwnProperty(_)&&(y+=" "+_+'="'+c[v][_]+'"');y+="></path>",g.push(y)}return g.push("</svg>"),"data:image/svg+xml;base64,"+Y(g.join(" "))}function Mt(t,e){if(!t)return[];var n=t;Array.isArray(t)||(n=[t]);for(var i,r,a,o,h=[],c=s,l=n.length-1;l>=0;l--)if(t=n[l]){e&&(t=Et(t));for(var f=0;f<c.length;f++)if(bt(i=t[c[f]])&&(i=jt(i)),i){Array.isArray(i)||(i=[i]);for(var d=0;d<i.length;d++)"url("===i[d].slice(0,4)&&(i[d]=X(i[d])),r=u[f],h.push([i[d],t[r[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(a=bt(t.markerWidth)?200:t.markerWidth,o=bt(t.markerHeight)?200:t.markerHeight,bt(t.markerPath)){i=jt(t.markerPath);for(var p=t.markerPath,g=0;g<i.length;g++)t.markerPath=i[g],h.push([Tt(t),a,o]);t.markerPath=p}else h.push([Tt(t),a,o])}return h}function Et(t){if(!t)return null;var e=t;if(P)return e;for(var n,i=s,r=0,a=i.length;r<a;r++)(n=e[i[r]])&&(e[i[r]]=St(n));return e}function St(t){if(bt(t)){for(var e=t.stops,n=0;n<e.length;n++)e[n][1]=St(e[n][1]);return t}return"url("===t.slice(0,4)&&(t=X(t)),!G(t)&&(t.length<="data:".length||"data:"!==t.substring(0,"data:".length))&&(t=function(t,e){var n=t.split("/"),i=e.split("/");if(0===e.slice(0,1))return n.slice(0,3).join("/")+e;n.pop();for(var r=0;r<i.length;r++)"."!==i[r]&&(".."===i[r]?n.pop():n.push(i[r]));return n.join("/")}(location.href,t)),t}function At(t){return t&&t.colorStops}function Lt(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var n=[],i=t.colorStops.length-1;i>=0;i--)n.push(t.colorStops[i].join());e.push(n.join(","))}return e.join("_")}function Rt(t,e){function n(t,e){d(t.opacity)?t.opacity=e:t.opacity*=e}var i;if(Array.isArray(t)){i=[];for(var r=0;r<t.length;r++){var a=f({},t[r]);n(a,e),i.push(a)}}else n(i=f({},t),e);return i}function It(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var n,i,r=[],a=0,o=t.length;a<o;a++){n=t[a],i={};for(var s=0,u=e.length;s<u;s++)Array.isArray(e[s])?d(e[s][a])?f(i,n||{}):f(i,n,e[s][a]):f(i,n,e[s]?e[s]:{});r.push(i)}return r}var h=[{},t];return h.push.apply(h,e),f.apply(this,h)}var Dt=Object.freeze({now:l,extend:f,isNil:d,isNumber:p,isInteger:g,isObject:v,isString:m,isFunction:y,hasOwn:b,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},toRadian:x,toDegree:O,IS_NODE:P,get requestAnimFrame(){return j},get cancelAnimFrame(){return k},isSVG:C,loadImage:T,UID:E,GUID:S,parseJSON:A,pushIn:L,removeFromArray:R,forEachCoord:I,getValueOrDefault:D,sign:F,log2:z,interpolate:B,wrap:N,clamp:U,isArrayHasData:V,isURL:G,isCssUrl:W,extractCssUrl:X,btoa:Y,b64toBlob:J,computeDegree:K,emptyImageUrl:Q,equalMapView:$,flash:et,_defaults:function(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i],a=Object.getOwnPropertyDescriptor(e,r);a&&a.configurable&&void 0===t[r]&&Object.defineProperty(t,r,a)}return t},translateToSVGStyles:Ct,getMarkerPathBase64:Tt,getExternalResources:Mt,convertResourceUrl:Et,isGradient:At,getGradientStamp:Lt,getSymbolStamp:function t(e){var n=[];if(Array.isArray(e)){for(var i=0;i<e.length;i++)n.push(t(e[i]));return"[ "+n.join(" , ")+" ]"}for(var r in e)b(e,r)&&(y(e[r])||(At(e[r])?n.push(r+"="+Lt(e[r])):n.push(r+"="+e[r])));return n.join(";")},lowerSymbolOpacity:Rt,extendSymbol:It}),Ft={};if(!P){var zt=navigator.userAgent.toLowerCase(),Bt=document.documentElement,Nt="ActiveXObject"in window,Ut=-1!==zt.indexOf("webkit"),Vt=-1!==zt.indexOf("phantom"),Gt=-1!==zt.search("android [23]"),Ht=-1!==zt.indexOf("chrome"),Zt=-1!==zt.indexOf("gecko")&&!Ut&&!window.opera&&!Nt,Wt="undefined"!=typeof orientation||-1!==zt.indexOf("mobile"),Xt=!window.PointerEvent&&window.MSPointerEvent,qt=window.PointerEvent&&navigator.pointerEnabled||Xt,Yt=Nt&&"transition"in Bt.style,Jt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Gt,Kt="MozPerspective"in Bt.style,Qt="OTransition"in Bt.style,$t=(Yt||Jt||Kt)&&!Qt&&!Vt,te=0;Ht&&(te=zt.match(/chrome\/([\d.]+)/)[1]);var ee,ne=!Vt&&(qt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);try{var ie=document.createElement("canvas"),re=ie.getContext("webgl")||ie.getContext("experimental-webgl");ee=re&&re instanceof WebGLRenderingContext}catch(t){ee=!1}var ae=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;Ft={ie:Nt,ielt9:Nt&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:Ut,gecko:Zt,android:-1!==zt.indexOf("android"),android23:Gt,chrome:Ht,chromeVersion:te,safari:!Ht&&-1!==zt.indexOf("safari"),phantomjs:Vt,ie3d:Yt,webkit3d:Jt,gecko3d:Kt,opera12:Qt,any3d:$t,mobile:Wt,mobileWebkit:Wt&&Ut,mobileWebkit3d:Wt&&Jt,mobileOpera:Wt&&window.opera,mobileGecko:Wt&&Zt,touch:!!ne,msPointer:!!Xt,pointer:!!qt,retina:ae>1,devicePixelRatio:ae,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Nt&&9===document.documentMode,ie10:Nt&&10===document.documentMode,webgl:ee}}var oe=Ft;function se(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function ue(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var he=function(){function t(t,e){if(d(t)||d(e)?d(t.x)||d(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1]):(this.x=+t.x,this.y=+t.y):(this.x=+t,this.y=+e),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},e.copy=function(){return new this.constructor(this.x,this.y)},e._add=function(t,e){return d(t.x)?d(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.add=function(t,e){var n,i;return d(t.x)?d(t[0])?(n=this.x+t,i=this.y+e):(n=this.x+t[0],i=this.y+t[1]):(n=this.x+t.x,i=this.y+t.y),new this.constructor(n,i)},e._sub=function(t,e){return d(t.x)?d(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(t,e){var n,i;return d(t.x)?d(t[0])?(n=this.x-t,i=this.y-e):(n=this.x-t[0],i=this.y-t[1]):(n=this.x-t.x,i=this.y-t.y),new this.constructor(n,i)},e.substract=function(){return this.sub.apply(this,arguments)},e.multi=function(t){return new this.constructor(this.x*t,this.y*t)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return[this.x,this.y]},e.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},e.toJSON=function(){return{x:this.x,y:this.y}},t}(),ce=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},n.distanceTo=function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},n.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.unit=function(){return this.copy()._unit()},n._unit=function(){return this._div(this.mag()),this},n.perp=function(){return this.copy()._perp()},n._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},n.angleWith=function(t){return this.angleWithSep(t.x,t.y)},n.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},n._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},n.rotate=function(t){return this.copy()._rotate(t)},e}(he),le=function(){function t(t,e){p(t)&&p(e)?(this.width=t,this.height=e):p(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,n){var i,r;return e instanceof t?(i=this.width+e.width,r=this.height+e.height):(i=this.width+e,r=this.height+n),new t(i,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new ce(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}();function fe(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var de=/[\b\t\r\v\f]/gim;function pe(t){return m(t)?t.replace(de,""):t}function ge(t){return fe(t).split(/\s+/)}var ve="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function me(t,e){return me.node?me.node(t,e):(ve.font=e,ve.measureText(t).width)}var ye={};function _e(t,e){if(_e.node)return _e.node(t,e);var n=me(t,e);return e||(e="_default_"),ye[e]||(ye[e]=be(e)),new le(n,ye[e])}function be(t){var e=tn();"_default_"!==t&&(e.style.font=t),e.innerHTML="秦";var n=e.clientHeight;return De(e),n}function we(t,e,n,i){if(!t||0===t.length)return[{text:"",width:0}];var r=d(i)?me(t,e):i,a=r/t.length,o=Math.floor(n/a/2);if(a>=n||o<=0)return[{text:"",width:n}];if(r<=n)return[{text:t,width:r}];for(var s=[],u=t.substring(0,o),h=a*o,c=o,l=t.length;c<l;c++){var f=t[c],p=me(u+f);p>=n?(s.push({text:u,width:h}),u=t.substring(c,o+c),c+=o-1,h=a*o):(u+=f,h=p),c>=l-1&&(h=me(u),s.push({text:u,width:h}))}return s}var xe=/\{([\w_]+)\}/g;function Oe(t,e){return m(t)?t.replace(xe,(function(t,n){if(!e)return"";var i=e[n];return d(i)?"":Array.isArray(i)?i.join():i})):t}function je(t,e,n){var i=t.width,r=t.height;return new ce("left"===e?-i:"right"===e?0:-i/2,"top"===n?-r:"bottom"===n?0:-r/2)}var ke="monospace";function Pe(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+(t.textFaceName?'"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"':ke)}function Ce(t,e){var n=Pe(e),i=e.textLineSpacing||0,r=_e(t,n),a=r.width,o=r.height,s=e.textWrapCharacter,u=[],h=e.textWrapWidth;(!h||h>a)&&(h=a),m(t)||(t+="");var c=0;if(s&&t.indexOf(s)>=0)for(var l=t.split(s),f=0,d=l.length;f<d;f++){var p=l[f],g=me(p,n);if(g>h)for(var v=we(p,n,h,g),y=0,_=v.length;y<_;y++){var b=v[y].width;b>c&&(c=b),u.push({text:v[y].text,size:new le(b,o)})}else g>c&&(c=g),u.push({text:p,size:new le(g,o)})}else if(a>h)for(var w=we(t,n,h,a),x=0;x<w.length;x++){var O=w[x].width;O>c&&(c=O),u.push({text:w[x].text,size:new le(O,o)})}else a>c&&(c=a),u.push({text:t,size:r});var j=u.length;return{total:j,size:new le(c,o*j+i*(j-1)),rows:u,rawSize:r}}var Te=Object.freeze({trim:fe,escapeSpecialChars:pe,splitWords:ge,stringWidth:me,stringLength:_e,getFontHeight:be,splitContent:we,replaceVariable:Oe,getAlignPoint:je,getFont:Pe,splitTextToRow:Ce}),Me=P?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},Ee=Me(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Se=Me(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Ae=Me(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),Le=Me(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function Re(t,e){var n=document.createElement(t);return e&&Ye(n,e),n}function Ie(t,e,n){var i=Re(t);return e&&We(i,e),n&&n.appendChild(i),i}function De(t){if(!t)return this;if(oe.ielt9||oe.ie9){var e=Re("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Fe(t,e,n,i){if(!(t&&t.addEventListener&&e&&n))return this;for(var r=function(e){e||(e=window.event),n.call(i||t,e)},a=e.split(" "),o=a.length-1;o>=0;o--){var s=a[o];s&&(t["Z__"+s]||(t["Z__"+s]=[]),Be(t,s,n)>=0&&ze(t,s,n),t["Z__"+s].push({callback:r,src:n}),"mousewheel"===s&&oe.gecko&&(s="DOMMouseScroll"),t.addEventListener(s,r,!1))}return this}function ze(t,e,n){function i(e,n){"mousewheel"===e&&oe.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,n,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),a=r.length-1;a>=0;a--){var o=r[a];if(o){if(!n&&t["Z__"+o]){for(var s=t["Z__"+o],u=0,h=s.length;u<h;u++)i(s[u].callback);return delete t["Z__"+o],this}var c=Be(t,o,n);if(c<0)return this;i(o,t["Z__"+o][c].callback),t["Z__"+o].splice(c,1)}}return this}function Be(t,e,n){if(!t||!t["Z__"+e]||!n)return-1;for(var i=t["Z__"+e],r=0,a=i.length;r<a;r++)if(i[r].src===n)return r;return-1}function Ne(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ue(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Ve(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function Ge(t,e){return t?(oe.any3d?Ke(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function He(t){var e=window.getComputedStyle(t),n=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],i=t.getBoundingClientRect(),r=t.offsetWidth,a=t.offsetHeight,o=r?i.width/r:1,s=a?i.height/a:1;return t.__position=[i.left+n[0],i.top+n[1],o,s],t.__position}function Ze(t,e){t||(t=window.event);var n=e.__position;return n||(n=He(e)),new ce((t.clientX-n[0]-e.clientLeft)/n[2],(t.clientY-n[1]-e.clientTop)/n[3])}function We(t,e){var n=t.style.cssText;return function(t,e){var n=t.length-";".length;return n>=0&&t.indexOf(";",n)===n}(n)||(n+=";"),t.style.cssText=n+e,this}function Xe(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Je(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function qe(t,e){if(void 0===t.classList||Xe(t,e)){var n=Je(t);Ye(t,(n?n+" ":"")+e)}else for(var i=ge(e),r=0,a=i.length;r<a;r++)t.classList.add(i[r]);return this}function Ye(t,e){return d(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function Je(t){return d(t.className.baseVal)?t.className:t.className.baseVal}function Ke(t,e){var n=e||new ce(0,0);return t.style[Ee]=oe.any3d?"translate3d("+n.x+"px,"+n.y+"px,0px)":"translate("+n.x+"px,"+n.y+"px)",this}function Qe(t){return/<[a-z\][\s\S]*>/i.test(t)}function $e(t,e){var n=tn(t);m(e)?n.innerHTML=e:n.appendChild(e);var i=new le(n.clientWidth,n.clientHeight);return De(n),i}function tn(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}var en=Fe,nn=ze,rn=Object.freeze({TRANSFORM:Ee,TRANSFORMORIGIN:Se,TRANSITION:Ae,CSSFILTER:Le,createEl:Re,createElOn:Ie,removeDomNode:De,addDomEvent:Fe,removeDomEvent:ze,listensDomEvent:Be,preventDefault:Ne,stopPropagation:Ue,preventSelection:Ve,offsetDom:Ge,computeDomPosition:He,getEventContainerPoint:Ze,setStyle:We,hasClass:Xe,addClass:qe,setClass:Ye,getClass:Je,setOpacity:function(t,e){return t.style.opacity=e,this},setTransform:Ke,setTransformMatrix:function(t,e){var n="matrix("+(m(e)?e:e.join())+")";return t.style[Ee]!==n&&(t.style[Ee]=n),this},removeTransform:function(t){return t.style[Ee]&&(t.style[Ee]=""),this},isHTML:Qe,measureDom:$e,getDomRuler:tn,on:en,off:nn}),an={jsonp:function(t,e){var n="_maptalks_jsonp_"+E();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;var i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(y(e)){var i=n;n=e,e=i}if(P&&an.get.node)return an.get.node(t,n,e);var r=an._getClient(n);if(r.open("GET",t,!0),e){for(var a in e.headers)r.setRequestHeader(a,e.headers[a]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,n){var i;if(m(t)){if(y(e)){var r=n;n=e,e=r}i=(e=e||{}).postData}else{var a=n;i=e,t=(e=t).url,n=a}if(P&&an.post.node)return e.url=t,an.post.node(e,i,n);var o=an._getClient(n);if(o.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in o)for(var s in e.headers)e.headers.hasOwnProperty(s)&&o.setRequestHeader(s,e.headers[s]);return m(i)||(i=JSON.stringify(i)),o.send(i),o},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=an._wrapCallback(e,t),e},getArrayBuffer:function(t,e,n){if(y(e)){var i=n;n=e,e=i}return e||(e={}),e.responseType="arraybuffer",an.get(t,e,n)},getImage:function(t,e,n){return an.getArrayBuffer(e,n,(function(e,n){if(e)t.onerror&&t.onerror(e);else if(n){var i=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),i.revokeObjectURL(t.src)};var a=new Blob([new Uint8Array(n.data)],{type:n.contentType});t.cacheControl=n.cacheControl,t.expires=n.expires,t.src=n.data.byteLength?i.createObjectURL(a):Q}}))},getJSON:function(t,e,n){if(y(e)){var i=n;n=e,e=i}var r=function(t,e){var i=e?A(e):null;n(t,i)};return e&&e.jsonp?an.jsonp(t,r):an.get(t,e,r)}},on=!1,sn=null,un={setHitTesting:function(t){on=t},createCanvas:function(t,e,n){var i;return P?i=new n(t,e):((i=Re("canvas")).width=t,i.height=e),i},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=Pe(e);var n=e.textFill;n||(n="#000"),t.fillStyle=un.getRgba(n,e.textOpacity)},prepareCanvas:function(t,e,n,i){if(e){var r=e.lineWidth;d(r)||t.lineWidth===r||(t.lineWidth=r);var a=e.linePatternFile||e.lineColor||"#000";if(i)t.strokeStyle="#000";else if(ln(a)&&n){var o;(e.linePatternDx||e.linePatternDy)&&(o=[e.linePatternDx,e.linePatternDy]),un._setStrokePattern(t,a,r,o,n),e.lineDasharray=[]}else At(a)?e.lineGradientExtent?t.strokeStyle=un._createGradient(t,a,e.lineGradientExtent):t.strokeStyle="#000":t.strokeStyle=a;e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&V(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var s=e.polygonPatternFile||e.polygonFill||"rgba(255,255,255,0)";if(i)t.fillStyle="#000";else if(ln(s)&&n){var u=fn(s),h=n.getImage([u,null,null]);if(h||(h=n.getImage([u+"-texture",null,r])),C(u)&&h instanceof Image&&(oe.edge||oe.ie)){var c=h.width||20,l=h.height||20,f=un.createCanvas(c,l);un.image(f.getContext("2d"),h,0,0,c,l),h=f}h&&(t.fillStyle=t.createPattern(h,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy]))}else At(s)?e.polygonGradientExtent?t.fillStyle=un._createGradient(t,s,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":t.fillStyle=s}},_createGradient:function(t,e,n){var i=null,r=e.places,a=n.getMin(),o=n.getMax(),s=n.getWidth(),u=n.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[a.x+r[0]*s,a.y+r[1]*u,s*r[2],a.x+r[3]*s,a.y+r[4]*u,s*r[5]]}else{var h=n.getCenter()._round();r=[h.x,h.y,Math.abs(h.x-a.x),h.x,h.y,0]}i=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[a.x+r[0]*s,a.y+r[1]*u,a.x+r[2]*s,a.y+r[3]*u]}else r=[a.x,a.y,o.x,a.y];i=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach((function(t){i.addColorStop.apply(i,t)})),i},_setStrokePattern:function(t,e,n,i,r){var a,o=fn(e);if(P)a=r.getImage([o,null,n]);else{var s=o+"-texture-"+n;if(!(a=r.getImage(s))){var u=r.getImage([o,null,null]);if(u){var h;h=u.width&&u.height?Math.round(u.width*n/u.height):n;var c=un.createCanvas(h,n,t.canvas.constructor);un.image(c.getContext("2d"),u,0,0,h,n),r.addResource([s,null,n],c),a=c}}}a&&(t.strokeStyle=t.createPattern(a,"repeat"),t.strokeStyle.linePatternOffset=i)},clearRect:function(t,e,n,i,r){t.canvas._drawn=!1,t.clearRect(e,n,i,r)},fillCanvas:function(t,e,n,i){if(on&&(e=1),t.canvas._drawn=!0,0!==e){var r,a=un._isPattern(t.fillStyle),o=t.fillStyle&&t.fillStyle.polygonPatternOffset,s=o?o[0]:0,u=o?o[1]:0;d(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),a&&(n=n||0,i=i||0,t.translate(n+s,i+u)),t.fill(),a&&t.translate(-n-s,-i-u),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return d(e)&&(e=1),"#"!==t[0]?t:(7===t.length?(n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(n=17*parseInt(t.substring(1,2),16),i=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+n+","+i+","+r+","+e+")");var n,i,r},image:function(t,e,n,i,r,a){t.canvas._drawn=!0;try{p(r)&&p(a)?t.drawImage(e,n,i,r,a):t.drawImage(e,n,i)}catch(t){console}},text:function(t,e,n,i,r){un._textOnMultiRow(t,r.rows,i,n,r.size,r.rawSize)},_textOnMultiRow:function(t,e,n,i,r,a){for(var o,s,u=je(r,n.textHorizontalAlignment,n.textVerticalAlignment),h=a.height+n.textLineSpacing,c=i.add(0,u.y),l=n.textMaxHeight,f=0,d=0,p=e.length;d<p&&(o=e[d].text,s=je(e[d].size,n.textHorizontalAlignment,n.textVerticalAlignment),un._textOnLine(t,o,c.add(s.x,d*h),n.textHaloRadius,n.textHaloFill,n.textHaloOpacity),!(l>0&&(f+=h)+a.height>=l));d++);},_textOnLine:function(t,e,n,i,r,a){on&&(a=1);var o,s,u=0!==a&&0!==i;t.textBaseline="top";var h=t.shadowBlur,c=t.shadowOffsetX,l=t.shadowOffsetY;if(u){var f=t.globalAlpha;t.globalAlpha*=a,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*i,t.strokeStyle=r,t.strokeText(e,Math.round(n.x),Math.round(n.y)),t.miterLimit=10,t.globalAlpha=f,o=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",s=t.fillStyle,t.fillStyle="#000"}h&&u&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),un.fillText(t,e,n),o&&(t.globalCompositeOperation=o,un.fillText(t,e,n,s),h&&(t.shadowBlur=h,t.shadowOffsetX=c,t.shadowOffsetY=l))},fillText:function(t,e,n,i){t.canvas._drawn=!0,i&&(t.fillStyle=i),t.fillText(e,Math.round(n.x),Math.round(n.y))},_stroke:function(t,e,n,i){if(on&&(e=1),t.canvas._drawn=!0,0!==e){var r,a=t.strokeStyle&&t.strokeStyle.linePatternOffset,o=a?a[0]:0,s=a?a[1]:0,u=un._isPattern(t.strokeStyle)&&(!d(n)&&!d(i)||!d(o)&&!d(s));d(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),u&&(n=n||0,i=i||0,t.translate(n+o,i+s)),t.stroke(),u&&t.translate(-n-o,-i-s),e<1&&(t.globalAlpha=r)}},_path:function(t,e,n,i,r){if(V(e))for(var a,o,s=V(n),u=!0!==r&&un._isPattern(t.strokeStyle),h=0,c=e.length;h<c;h++)if(a=e[h],!s||t.setLineDash)t.lineTo(a.x,a.y),u&&h>0&&(l(e[h-1],a),t.beginPath(),t.moveTo(a.x,a.y));else if(s){if(h===c-1)break;o=e[h+1],hn(t,a,o,n)}function l(e,n){var r=K(e.x,e.y,n.x,n.y);t.save();var a=Math.cos(r);Math.abs(a)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/a),t.rotate(r),un._stroke(t,i),t.restore()}},path:function(t,e,n,i,r){V(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),un._path(t,e,r,n),un._stroke(t,n))},_multiClip:function(t,e){if(e&&0!==e.length)for(var n=0,i=(e=e[0]).length;n<i;n++){var r=e[n],a=r.x,o=r.y;0===n?t.moveTo(a,o):t.lineTo(a,o),n===i-1&&(a=e[0].x,o=e[0].y,t.lineTo(a,o))}},polygon:function(t,e,n,i,r,a){if(t.isMultiClip)un._multiClip(t,e);else if(V(e)){var o=un._isPattern(t.strokeStyle),s=V(r)&&!t.setLineDash||o&&!a;V(e[0])||(e=[e]);var u,h,c,l=t;if(e.length>1&&!P&&(sn||(sn=un.createCanvas(1,1)),t.canvas._drawn=!1,sn.width=t.canvas.width,sn.height=t.canvas.height,dn(t=sn.getContext("2d"),l)),s){for(t.save(),h=0,c=e.length;h<c;h++)V(e[h])&&(un._ring(t,e[h],null,0,!0),u=i,h>0&&(t.globalCompositeOperation="destination-out",u=1),un.fillCanvas(t,u,e[h][0].x,e[h][0].y),h>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff"),un._stroke(t,0));t.restore()}for(h=0,c=e.length;h<c;h++)V(e[h])&&(a?(un.paintSmoothLine(t,e[h],n,a,!0),t.closePath()):un._ring(t,e[h],r,n),s||(u=i,h>0&&(t.globalCompositeOperation="destination-out",u=1),un.fillCanvas(t,u,e[h][0].x,e[h][0].y),h>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff")),un._stroke(t,n));e.length>1&&!P&&(l.drawImage(sn,0,0),l.canvas._drawn=t.canvas._drawn,dn(l,t))}},_ring:function(t,e,n,i,r){var a=un._isPattern(t.strokeStyle);r||!a||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),un._path(t,e,n,i,r),a||t.closePath()},paintSmoothLine:function(t,e,n,i,r,a,o){if(e)if(e.length<=2||!i)un.path(t,e,n);else{var s,u=e.length,h=r?u:u-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==o&&(h-=Math.max(h-a-1,0));for(var c=0;c<h;c++){var l=e[c].x,f=e[c].y,d=void 0,p=void 0,g=void 0,v=void 0,m=void 0,y=void 0;c-1<0?r?(d=e[h-1].x,p=e[h-1].y):(d=e[c+1].x,p=e[c+1].y):(d=e[c-1].x,p=e[c-1].y),c+1<u?(g=e[c+1].x,v=e[c+1].y):(g=e[c+1-u].x,v=e[c+1-u].y),c+2<u?(m=e[c+2].x,y=e[c+2].y):r?(m=e[c+2-u].x,y=e[c+2-u].y):(m=e[c].x,y=e[c].y);var _=w(d,p,l,f,g,v,m,y,i,c===h-1?o:1);if(c===h-1&&o>=0&&o<1){t.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]),e.splice(h-1,u-(h-1)-1);var b=new ce(_[4],_[5]);b.prevCtrlPoint=new ce(_[2],_[3]),e.push(b),u=e.length}else t.bezierCurveTo(_[0],_[1],_[2],_[3],g,v);e[c].nextCtrlPoint=_.slice(0,2),e[c].prevCtrlPoint=s?s.slice(2):null,s=_}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[u-1].prevCtrlPoint||(e[u-1].prevCtrlPoint=e[u-2].nextCtrlPoint),un._stroke(t,n)}function w(t,e,n,i,r,a,o,s,u,h){var c=(t+n)/2,l=(e+i)/2,f=(n+r)/2,d=(i+a)/2,p=(r+o)/2,g=(a+s)/2,v=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)),m=Math.sqrt((r-n)*(r-n)+(a-i)*(a-i)),y=v/(v+m),_=m/(m+Math.sqrt((o-r)*(o-r)+(s-a)*(s-a))),b=c+(f-c)*y,w=l+(d-l)*y,x=f+(p-f)*_,O=d+(g-d)*_,j=b+(f-b)*u+n-b,k=w+(d-w)*u+i-w,P=x+(f-x)*u+r-x,C=O+(d-O)*u+a-O,T=[j,k,P,C];return h<1?function(t,e,n,i,r,a,o,s,u,h){var c=1-e,l=n*c*c+2*r*e*c+o*e*e,f=r*c*c+2*o*e*c+u*e*e,d=i*c*c+2*a*e*c+s*e*e,p=a*c*c+2*s*e*c+h*e*e;return[(1*n*1+2*r*0*1+0*o*0)*c+(1*r*1+2*o*0*1+0*u*0)*e,(1*i*1+2*a*0*1+0*s*0)*c+(1*a*1+2*s*0*1+0*h*0)*e,1*l+0*f,1*d+0*p,l*c+f*e,d*c+p*e]}(0,h,n,i,j,k,P,C,r,a):T}},_arcBetween:function(t,e,n,i){var r=i,a=e.distanceTo(n),o=a/2/Math.sin(r/2),s=Math.asin((n.y-e.y)/a);e.x>n.x&&(s=Math.PI-s);var u=s-(90*Math.PI/180-r/2),h=Math.cos(u)*o,c=Math.sin(u)*o,l=e.x+h,f=e.y+c,d=Math.asin((n.y-f)/o);l>n.x&&(d=Math.PI-d);var p=d+r;return t.beginPath(),t.arc(l,f,o,d,p),[l,f]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,n,i){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var a=[t];a.push.apply(a,e.splice(1)),un._bezierCurveTo.apply(un,a),un.fillCanvas(t,i),un._stroke(t,n)},_bezierCurveTo:function(t,e,n,i){t.bezierCurveTo(e.x,e.y,n.x,n.y,i.x,i.y)},ellipse:function(t,e,n,i,r,a){t.beginPath(),n===i?t.arc(e.x,e.y,n,0,2*Math.PI):t.ellipse?t.ellipse(e.x,e.y,n,i,0,0,Math.PI/180*360):function(e,n,i,r){var a=.5522848,o=i*a,s=r*a;t.moveTo(e-i,n),t.bezierCurveTo(e-i,n-s,e-o,n-r,e,n-r),t.bezierCurveTo(e+o,n-r,e+i,n-s,e+i,n),t.bezierCurveTo(e+i,n+s,e+o,n+r,e,n+r),t.bezierCurveTo(e-o,n+r,e-i,n+s,e-i,n),t.closePath()}(e.x,e.y,n,i),un.fillCanvas(t,a,e.x-n,e.y-i),un._stroke(t,r,e.x-n,e.y-i)},rectangle:function(t,e,n,i,r){var a=e.x,o=e.y;t.beginPath(),t.rect(a,o,n.width,n.height),un.fillCanvas(t,r,a,o),un._stroke(t,i,a,o)},sector:function(t,e,n,i,r,a){var o=Math.PI/180,s=i[0],u=i[1];!function(t,e,n,i,s,u){var h=o*-u,c=o*-s;t.beginPath(),t.moveTo(e,n),t.arc(e,n,i,h,c),t.lineTo(e,n),un.fillCanvas(t,a,e-i,n-i),un._stroke(t,r,e-i,n-i)}(t,e.x,e.y,n,s,u)},_isPattern:function(t){return!(m(t)||"addColorStop"in t)},drawCross:function(t,e,n,i,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=i,t.beginPath(),t.moveTo(e-5,n),t.lineTo(e+5,n),t.moveTo(e,n-5),t.lineTo(e,n+5),t.stroke()},copy:function(t,e){var n=e||Re("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n}};function hn(t,e,n,i){var r=e.x,a=e.y,o=n.x,s=n.y,u=i,h=function(t,e){return t<=e},c=function(t,e){return t>=e},l=function(t,e){return Math.min(t,e)},f=function(t,e){return Math.max(t,e)},d={thereYet:c,cap:l},p={thereYet:c,cap:l};a-s>0&&(p.thereYet=h,p.cap=f),r-o>0&&(d.thereYet=h,d.cap=f),t.moveTo(r,a);for(var g,v,m=r,y=a,_=0,b=!0;!d.thereYet(m,o)||!p.thereYet(y,s);)g=Math.atan2(s-a,o-r),v=u[_],m=d.cap(o,m+Math.cos(g)*v),y=p.cap(s,y+Math.sin(g)*v),b?t.lineTo(m,y):t.moveTo(m,y),_=(_+1)%u.length,b=!b}var cn="data:image/";function ln(t){return t.length>cn.length&&t.substring(0,cn.length)===cn||W(t)}function fn(t){return t.substring(0,cn.length)===cn?t:X(t)}function dn(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}var pn="undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:{};function gn(t,e){return t(e={exports:{}},e.exports),e.exports}var vn=gn((function(t){!function(e){function n(t){if(t){var e=this;t((function(t){e.resolve(t)}),(function(t){e.reject(t)}))}}function i(t,e){if("function"==typeof t.y)try{var n=t.y.call(o,e);t.p.resolve(n)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function r(t,e){if("function"==typeof t.n)try{var n=t.n.call(o,e);t.p.resolve(n)}catch(e){t.p.reject(e)}else t.p.reject(e)}var a,o,s="fulfilled",u="undefined",h=function(){function t(){for(;n.length-i;){try{n[i]()}catch(t){e.console&&e.console.error(t)}n[i++]=o,i==r&&(n.splice(0,r),i=0)}}var n=[],i=0,r=1024,a=function(){if(typeof MutationObserver!==u){var e=document.createElement("div");return new MutationObserver(t).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return typeof setImmediate!==u?function(){setImmediate(t)}:function(){setTimeout(t,0)}}();return function(t){n.push(t),n.length-i==1&&a()}}();n.prototype={resolve:function(t){if(this.state===a){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var n=!0,r=t.then;if("function"==typeof r)return void r.call(t,(function(t){n&&(n=!1,e.resolve(t))}),(function(t){n&&(n=!1,e.reject(t))}))}catch(t){return void(n&&this.reject(t))}this.state=s,this.v=t,e.c&&h((function(){for(var n=0,r=e.c.length;r>n;n++)i(e.c[n],t)}))}},reject:function(t){if(this.state===a){this.state="rejected",this.v=t;var i=this.c;i?h((function(){for(var e=0,n=i.length;n>e;e++)r(i[e],t)})):!n.suppressUncaughtRejectionError&&e.console&&e.console.log("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)}},then:function(t,e){var o=new n,u={y:t,n:e,p:o};if(this.state===a)this.c?this.c.push(u):this.c=[u];else{var c=this.state,l=this.v;h((function(){c===s?i(u,l):r(u,l)}))}return o},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var i=this;return new n((function(n,r){setTimeout((function(){r(Error(e))}),t),i.then((function(t){n(t)}),(function(t){r(t)}))}))}},n.resolve=function(t){var e=new n;return e.resolve(t),e},n.reject=function(t){var e=new n;return e.reject(t),e},n.all=function(t){function e(e,o){e&&"function"==typeof e.then||(e=n.resolve(e)),e.then((function(e){i[o]=e,++r==t.length&&a.resolve(i)}),(function(t){a.reject(t)}))}for(var i=[],r=0,a=new n,o=0;o<t.length;o++)e(t[o],o);return t.length||a.resolve(i),a},t.exports&&(t.exports=n),e.define&&e.define.amd&&e.define([],(function(){return n})),e.Zousan=n,n.soon=h}(pn)})),mn="undefined"!=typeof Promise?Promise:vn,yn=function(t){return function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.on=function(t,e,n){if(!t)return this;if(!m(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var i,r,a=t.toLowerCase().split(" ");n||(n=this);for(var o=0,s=a.length;o<s;o++){i=a[o],(r=this._eventMap[i])||(r=[],this._eventMap[i]=r);var u=r.length;if(u>0)for(var h=0;h<u;h++)if(e===r[h].handler&&r[h].context===n)return this;r.push({handler:e,context:n})}return this},n.addEventListener=function(){return this.on.apply(this,arguments)},n.once=function(t,e,n){if(!m(t)){var i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=this._wrapOnceHandler(r,t[r],n));return this._switch("on",i)}for(var a=t.split(" "),o=0,s=a.length;o<s;o++)this.on(a[o],this._wrapOnceHandler(a[o],e,n));return this},n.off=function(t,e,n){if(!this._eventMap||!t)return this;if(!m(t))return this._switch("off",t,e);if(!e)return this;var i,r,a,o=t.split(" ");n||(n=this);for(var s=0,u=o.length;s<u;s++){if(a="Z__"+(i=o[s].toLowerCase()),!(r=this._eventMap[i]))return this;for(var h=r.length-1;h>=0;h--){var c=r[h];e!==c.handler&&e!==c.handler[a]||c.context!==n||(delete c.handler[a],r.splice(h,1))}r.length||delete this._eventMap[i]}return this},n.removeEventListener=function(){return this.off.apply(this,arguments)},n.listens=function(t,e,n){if(!this._eventMap||!m(t))return 0;var i=this._eventMap[t.toLowerCase()];if(!i||!i.length)return 0;if(!e)return i.length;for(var r=0,a=i.length;r<a;r++)if(e===i[r].handler&&(d(n)||i[r].context===n))return 1;return 0},n.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},n.copyEventListeners=function(t){var e,n=t._eventMap;if(!n)return this;for(var i in n)for(var r=0,a=(e=n[i]).length;r<a;r++)this.on(i,e[r].handler,e[r].context);return this},n.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},n._wrapOnceHandler=function(t,e,n){var i=this,r="Z__"+t,a=!1,o=function s(){a||(delete o[r],a=!0,n?e.apply(n,arguments):e.apply(this,arguments),i.off(t,s,this))};return o[r]=e,o},n._switch=function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&this[t](i,e[i],n);return this},n._clearListeners=function(t){this._eventMap&&m(t)&&this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null)},n._clearAllListeners=function(){this._eventMap=null},n._setEventParent=function(t){return this._eventParent=t,this},n._fire=function(t,e){if(!this._eventMap)return this;var n=this._eventMap[t.toLowerCase()];if(!n)return this;e||(e={}),e.type=t,e.target=this;for(var i,r,a=n.slice(0),o=0,s=a.length;o<s;o++)a[o]&&(i=a[o].context,r=f({},e),!1===(i?a[o].handler.call(i,r):a[o].handler(r))&&e.domEvent&&Ue(e.domEvent));return this},e}(t)},_n=function(){function t(t){this.target=t}var e=t.prototype;return e.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},e.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.enabled=function(){return!!this._enabled},e.remove=function(){this.disable(),delete this.target,delete this.dom},t}(),bn=yn(_n),wn=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks()}var e=t.prototype;return e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t){if(!t){var e={};for(var n in this.options)this.options.hasOwnProperty(n)&&(e[n]=this.options[n]);return e}if(2===arguments.length){var i={};i[t]=arguments[1],t=i}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof bn&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this},e.onConfig=function(){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var n=t._initHooks;if(n&&n!==e._initHooks)for(var i=0;i<n.length;i++)n[i].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r="function"==typeof t?t:function(){this[t].apply(this,n)},a=this.prototype,o=Object.getPrototypeOf(a);return a._initHooks&&a._initHooks!==o._initHooks||(a._initHooks=[]),a._initHooks.push(r),this},t.include=function(){for(var t=0;t<arguments.length;t++)f(this.prototype,t<0||arguments.length<=t?void 0:arguments[t]);return this},t.mergeOptions=function(t){var e=this.prototype,n=Object.getPrototypeOf(e);return e.options&&e.options!==n.options||(e.options=e.options?Object.create(e.options):{}),f(e.options,t),this},t}(),xn={},On=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.registerJSONType=function(t){return t?(xn[t]=this,this):this},e.getJSONClass=function(t){return t?xn[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in xn)if(xn[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)};function jn(t){return function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},n.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var n=this._handlers.indexOf(e);n>=0&&this._handlers.splice(n,1),this[t].remove(),delete this[t]}return this},n._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var kn={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Pn={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Cn=function(t){function e(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,null)||this).dom=e,i.options=n,i}se(e,t);var n=e.prototype;return n.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},en(this.dom,"touchstart mousedown",this._onMouseDown,this),this):this},n.disable=function(){return this.dom?(this._offEvents(),nn(this.dom,"touchstart mousedown",this._onMouseDown),delete this._onMouseDown,this):this},n.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&t.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var n=t.touches?t.touches[0]:t;this.startPos=new ce(n.clientX,n.clientY),en(document,kn[t.type],this.onMouseMove,this),en(document,Pn[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||en(this.dom,"mouseleave",this.onMouseUp,this),this.fire("mousedown",{domEvent:t,mousePos:new ce(n.clientX,n.clientY)})}},n.onMouseMove=function(t){if(t.touches&&t.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,n=new ce(e.clientX,e.clientY).sub(this.startPos);(n.x||n.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new ce(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},n.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};p(e.clientX)&&(n.mousePos=new ce(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},n._offEvents=function(){var t=this.dom;if(nn(t,"mouseleave",this.onMouseUp,this),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in kn)nn(document,kn[e],this.onMouseMove,this),nn(document,Pn[e],this.onMouseUp,this);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},e}(bn),Tn=function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?I(t,(function(t){return[t.x,t.y]})):[t.x,t.y]},e.toCoordinates=function(t){if(p(t[0])&&p(t[1]))return new e(t);for(var n=[],i=0,r=t.length;i<r;i++){var a=t[i];Array.isArray(a)?p(a[0])?n.push(new e(a)):n.push(e.toCoordinates(a)):n.push(new e(a))}return n},e}(he),Mn=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();Mn.WGS84=Mn.createProj4("+proj=longlat +datum=WGS84 +no_defs"),Mn.EPSG4326=Mn.WGS84,Mn.EPSG3857=Mn.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),Mn.IDENTITY=Mn.createProj4("+proj=identity +no_defs"),Mn.CGCS2000=Mn.createProj4("+proj=longlat +datum=CGCS2000"),Mn.EPSG4490=Mn.CGCS2000,Mn.BD09LL=Mn.createProj4("+proj=longlat +datum=BD09"),Mn.GCJ02=Mn.createProj4("+proj=longlat +datum=GCJ02");var En,Sn=new ce(0,0),An=new Tn(0,0),Ln=new Tn(0,0),Rn=new Tn(0,0),In=new Tn(0,0),Dn=new Tn(0,0),Fn=new Tn(0,0),zn=new Tn(0,0),Bn=new Tn(0,0),Nn=[],Un=[],Vn=function(){function t(t,e,n,i){this._clazz=Tn;var r=arguments.length,a=r>0?arguments[r-1]:null;a&&a.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,n,i)}var e=t.prototype;return e._initialize=function(t,e,n,i){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!d(t)){var r=this.projection;p(t)&&p(e)&&p(n)&&p(i)?r?this.set(t,e,n,i):this.set(Math.min(t,n),Math.min(e,i),Math.max(t,n),Math.max(e,i)):Array.isArray(t)?r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3])):p(t.x)&&p(e.x)&&p(t.y)&&p(e.y)?r?this.set(t.x,t.y,e.x,e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):p(t.xmin)&&p(t.xmax)&&p(t.ymin)&&p(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,d(t.x)?d(t.xmin)?d(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,d(t.x)?d(t.xmin)?d(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},e.substract=function(){return this.sub.apply(this,arguments)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,n=(this.ymin+this.ymax)/2;return t?(t.set(e,n),t):new this._clazz(e,n)},e.isValid=function(){return!(d(this.xmin)||d(this.ymin)||d(this.xmax)||d(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),n=Math.max(this.pymin,t.pymin),i=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax);return!(e>i||n>r)},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e)if(void 0!==t.x){var n=An;Array.isArray(t)?(n.x=t[0],n.y=t[1]):(n.x=t.x,n.y=t.y),t=e.project(n,n)}else void 0!==t.xmin&&this._project(t);return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new le(this.getWidth(),this.getHeight())},e.set=function(t,e,n,i){return this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i,this},e.__combine=function(t){var e,n,i,r;void 0!==t.x&&(En.xmin=En.xmax=t.x,En.ymin=En.ymax=t.y,t=En),this._project(t),this._project(this),p(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),n=Math.min(this.pymin,t.pymin),i=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,n=t.pymin,i=t.pxmax,r=t.pymax);var a=this.projection;if(a){Ln.set(e,n),Rn.set(i,r);var o=a.unproject(Ln,Ln),s=a.unproject(Rn,Rn);e=o.x,n=o.y,i=s.x,r=s.y}return Un[0]=e,Un[1]=n,Un[2]=i,Un[3]=r,Un},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;In.x=Math.max(this.pxmin,t.pxmin),In.y=Math.max(this.pymin,t.pymin),Dn.x=Math.min(this.pxmax,t.pxmax),Dn.y=Math.min(this.pymax,t.pymax);var e=In,n=Dn,i=this.projection;return i&&(e=i.unproject(e,e),n=i.unproject(n,n)),new this.constructor(e,n,i)},e.expand=function(t){var e,n;return p(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-n,this.xmax+e,this.ymax+n,this.projection)},e._expand=function(t){var e,n;return p(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=n,this.xmax+=e,this.ymax+=n,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(){var t=this.xmin,e=this.ymin,n=this.xmax,i=this.ymax;return[new this._clazz([t,i]),new this._clazz([n,i]),new this._clazz([n,e]),new this._clazz([t,e]),new this._clazz([t,i])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var n,i=e||new this.constructor;return e&&(i.xmin=i.ymin=i.xmax=i.ymax=0),this._clazz===Tn?n=Fn:this._clazz===ce&&(n=Sn),n.x=this.xmin,n.y=this.ymax,i._combine(t(n)),n.x=this.xmax,i._combine(t(n)),n.y=this.ymin,i._combine(t(n)),n.x=this.xmin,i._combine(t(n)),i},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){zn.set(t.xmax,t.ymin),Bn.set(t.xmin,t.ymax),Nn[0]=zn,Nn[1]=Bn;var n=e.projectCoords(Nn),i=n[0],r=n[1];t.pxmin=Math.min(i.x,r.x),t.pymin=Math.min(i.y,r.y),t.pxmax=Math.max(i.x,r.x),t.pymax=Math.max(i.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}},t}();En=new Vn(0,0,0,0);var Gn=function(t){function e(e,n,i,r){var a;return(a=t.call(this,e,n,i,r)||this)._clazz=ce,a}return se(e,t),e}(Vn),Hn=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,n){var i=this.matrix[0]*(t.x-this.matrix[2])/e,r=this.matrix[1]*(t.y-this.matrix[3])/e;return n?(n.x=i,n.y=r,n):new ce(i,r)},e.untransform=function(t,e,n){var i=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/this.matrix[1]+this.matrix[3];return n?(n.x=i,n.y=r,n):new Tn(i,r)},t}(),Zn={project:function(){},unproject:function(){},projectCoords:function(t){var e=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return I(t,this.project,this);if(Array.isArray(t[0]))return t.map((function(t){return e.projectCoords(t)}));for(var n,i,r,a,o,s,u=this.getCircum(),h=this.getSphereExtent(),c=h.sx,l=h.sy,f=t[0],d=[this.project(f)],p=1,g=t.length;p<g;p++)a=(r=t[p]).x-f.x,o=r.y-f.y,s=this.project(r),Math.abs(a)>180&&(void 0===n&&(n=r.x>f.x),n&&(s._add(-u.x*F(a)*c,0),r._add(-360*F(a),0))),Math.abs(o)>90&&(void 0===i&&(i=r.y<f.y),i&&(s._add(0,-u.y*F(o)*l),r._add(0,-180*F(o)))),f=r,d.push(s);return d},unprojectCoords:function(t){return t?Array.isArray(t)?I(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),n=new Tn(t);return e.contains(n)||(n.x=N(t.x,e.xmin,e.xmax),n.y=N(t.y,e.ymin,e.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new Tn(180,90)),e=this.project(new Tn(-180,-90));this.extent=new Vn(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},Wn={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var n=0,i=0,r=t.length;i<r-1;i++)n+=this.measureLenBetween(t[i],t[i+1]);return n}},Xn=f({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,n=0,i=t.length;n<i;n++){var r,a=t[n];r=n===i-1?t[0]:t[n+1],e+=a.x*r.y-a.y*r.x}return Math.abs(e/2)},locate:function(t,e,n){return t=new Tn(t.x,t.y),this._locate(t,e,n)},_locate:function(t,e,n){return t?(e||(e=0),n||(n=0),e||n?(t.x=t.x+e,t.y=t.y+n,t):t):null},rotate:function(t,e,n){return t=new Tn(t.x,t.y),this._rotate(t,e,n)},_rotate:function(){var t=new ce(0,0);return function(e,n,i){return t.x=e.x-n.x,t.y=e.y-n.y,t._rotate(i*Math.PI/180),e.x=n.x+t.x,e.y=n.y+t.y,e}}()},Wn),qn=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e){if(!t||!e)return 0;var n=x(t.y),i=x(e.y),r=n-i,a=x(t.x)-x(e.x);return n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(n)*Math.cos(i)*Math.pow(Math.sin(a/2),2))),n*=this.radius,Math.round(1e5*n)/1e5},e.measureArea=function(t){var e,n=x(this.radius),i=0,r=t,a=r.length;if(a<3)return 0;for(e=0;e<a-1;e++){var o=r[e],s=r[e+1];i+=o.x*n*Math.cos(x(o.y))*s.y*n-s.x*n*Math.cos(x(s.y))*o.y*n}return a=r[e],r=r[0],i+=a.x*n*Math.cos(x(a.y))*r.y*n-r.x*n*Math.cos(x(r.y))*a.y*n,.5*Math.abs(i)},e.locate=function(t,e,n){return t=new Tn(t.x,t.y),this._locate(t,e,n)},e._locate=function(t,e,n){if(!t)return null;if(e||(e=0),n||(n=0),!e&&!n)return t;var i,r,a=x(t.y);if(0!==n){var o=Math.abs(n);r=N(180*(a+=2*Math.sin(o/(2*this.radius))*(n>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var s=Math.abs(e),u=x(t.x);i=N(180*(u+=2*Math.sqrt(Math.pow(Math.sin(s/(2*this.radius)),2)/Math.pow(Math.cos(a),2))*(e>0?1:-1))/Math.PI,-180,180)}else i=t.x;return t.x=i,t.y=r,t},e.rotate=function(t,e,n){return t=new Tn(t),this._rotate(t,e,n)},e._rotate=function(t,e,n){var i=function(t,e,n){var i;return void 0===n&&(n={}),(i=n.final?Yn(e,t):Yn(t,e))>180?-(360-i):i}(e,t)-n,r=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,n,i){var r=e/i,a=t.x*Math.PI/180,o=x(t.y),s=x(n),u=r*Math.cos(s),h=o+u;Math.abs(h)>Math.PI/2&&(h=h>0?Math.PI-h:-Math.PI-h);var c=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),l=Math.abs(c)>1e-11?u/c:Math.cos(o),f=a+r*Math.sin(s)/l;return t.x=(180*f/Math.PI+540)%360-180,t.y=180*h/Math.PI,t}(t,r,i,this.radius)},t}();function Yn(t,e){var n=x(t.y),i=x(e.y),r=x(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var a=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(O(Math.atan2(r,a))+360)%360}var Jn=f({measure:"EPSG:4326",sphere:new qn(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Wn),Kn=f({measure:"BAIDU",sphere:new qn(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Wn),Qn=Jn,$n={};function ti(t){$n[t.measure]=t}ti(Xn),ti(Jn),ti(Kn);var ei={getInstance:function(t){if(!t)return Qn;for(var e in $n)if(b($n,e)){var n=$n[e].measure;if(!n)continue;if(t.toLowerCase()===n.toLowerCase())return $n[e]}return null}},ni=Object.freeze({Identity:Xn,DEFAULT:Qn,Measurer:ei,WGS84Sphere:Jn,BaiduSphere:Kn}),ii=f({},Zn,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var n=this.rad,i=this.metersPerDegree,r=this.maxLatitude,a=t.x,o=Math.max(Math.min(r,t.y),-r),s=a*i,u=(0===o?0:Math.log(Math.tan((90+o)*n/2))/n)*i;return e?(e.x=s,e.y=u,e):new Tn(s,u)},unproject:function(t,e){var n,i=this.rad,r=this.metersPerDegree,a=t.x/r,o=t.y;0===o?n=0:(n=o/r,n=(2*Math.atan(Math.exp(n*i))-Math.PI/2)/i),Math.abs(Math.abs(a)-180)<1e-7&&(a=180*F(a)),Math.abs(Math.abs(n)-this.maxLatitude)<1e-7&&(n=F(n)*this.maxLatitude);var s=N(a,-180,180),u=N(n,-this.maxLatitude,this.maxLatitude);return e?(e.x=s,e.y=u,e):new Tn(s,u)}},Jn),ri=f({},Zn,{code:"EPSG:4326",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Tn(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Tn(t)}},Jn),ai=f({},ri,{code:"EPSG:4490"}),oi=f({},Zn,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},Kn,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var n,i=0,r=this.MCBAND.length;i<r;i++)if(Math.abs(t.y)>=this.MCBAND[i]){n=this.MC2LL[i];break}return this.convertor(t,n,e)},convertLL2MC:function(t,e){var n,i,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var a=new Tn(t.x,t.y);for(i=0,r=this.LLBAND.length;i<r;i++)if(a.y>=this.LLBAND[i]){n=this.LL2MC[i];break}if(!n)for(i=this.LLBAND.length-1;i>=0;i--)if(a.y<=-this.LLBAND[i]){n=this.LL2MC[i];break}return this.convertor(t,n,e)},convertor:function(t,e,n){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],a=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return i*=t.x<0?-1:1,a*=t.y<0?-1:1,n?(n.x=i,n.y=a,n):new Tn(i,a)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,n){return null!=e&&(t=Math.max(t,e)),null!=n&&(t=Math.min(t,n)),t},getLoop:function(t,e,n){if(t===1/0)return n;if(t===-1/0)return e;for(;t>n;)t-=n-e;for(;t<e;)t+=n-e;return t}}),si=f({},Zn,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},Xn),ui=ii,hi=Object.freeze({EPSG3857:ii,DEFAULT:ui,EPSG4326:ri,EPSG4490:ai,BAIDU:oi,IDENTITY:si,Common:Zn}),ci=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.registerRenderer=function(t,e){var n=this.prototype,i=Object.getPrototypeOf(n);return n._rendererClasses&&n._rendererClasses!==i._rendererClasses||(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},li=function(t){function e(e){var n;return(n=t.call(this)||this).layer=e,n._painted=!1,n._drawTime=0,n.setToRedraw(),n}se(e,t);var n=e.prototype;return n.render=function(t){var e=this;if(this.prepareRender(),this.getMap()&&this.layer.isVisible())if(this.resources||(this.resources=new fi),this.checkResources){var n=this.checkResources();n.length>0?(this._loadingResource=!0,this.loadResources(n).then((function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())}))):this._tryToDraw(t)}else this._tryToDraw(t)},n.testIfNeedRedraw=function(){var t=this.getMap();return!(this._loadingResource||!this._toRedraw&&(t.isInteracting()&&!this.drawOnInteracting||!this.needToRedraw()))},n.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()||!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},n.onSkipDrawOnInteracting=function(){},n.isLoadingResource=function(){return this._loadingResource},n.isRenderComplete=function(){return!!this._renderComplete},n.mustRenderOnInteracting=function(){return!this._painted||this.checkResources&&this.checkResources().length>0},n.setToRedraw=function(){return this._toRedraw=!0,this},n.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},n.isCanvasUpdated=function(){return!!this._canvasUpdated},n.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,delete this.resources,delete this.layer},n.onRemove=function(){},n.onAdd=function(){},n.getMap=function(){return this.layer?this.layer.getMap():null},n.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},n.clear=function(){this.clearCanvas()},n.isBlank=function(){return!this._painted},n.show=function(){this.setToRedraw()},n.hide=function(){this.clear(),this.setToRedraw()},n.setZIndex=function(){this.setToRedraw()},n.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),i=e.getSize();if(t.x<0||t.x>i.width*n||t.y<0||t.y>i.height*n)return!1;try{if(this.context.getImageData(n*t.x,n*t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console,this._errorThrown=!0),!1}return!1},n.loadResources=function(t){this.resources||(this.resources=new fi);var e=this.resources,n=[];if(V(t))for(var i={},r=t.length-1;r>=0;r--){var a=t[r];a&&a.length&&!i[a.join("-")]&&(i[a.join("-")]=1,e.isResourceLoaded(a,!0)||n.push(new mn(this._promiseResource(a))))}return mn.all(n)},n.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new ce(0,t.height))},n.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),i=n*e.width,r=n*e.height;if(this.layer._canvas){var a=this.layer._canvas;a.width=i,a.height=r,a.style&&(a.style.width=e.width+"px",a.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=un.createCanvas(i,r,t.CanvasClass);this.onCanvasCreate()}},n.onCanvasCreate=function(){},n.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this.context.scale(t,t)}},n.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},n.resizeCanvas=function(t){var e=this.canvas;if(e){var n=t||this.getMap().getSize(),i=this.getMap().getDevicePixelRatio();e.width===i*n.width&&e.height===i*n.height||(e.height=i*n.height,e.width=i*n.width,1!==i&&this.context&&this.context.scale(i,i),this.layer._canvas&&e.style&&(e.style.width=n.width+"px",e.style.height=n.height+"px"))}},n.clearCanvas=function(){this.context&&un.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},n.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var n=this.southWest,i=this.getMap();this.southWest=i._containerPointToPoint(new ce(0,i.height)),t.save();var r=i.getDevicePixelRatio();if(1!==r&&(t.save(),t.scale(r,r)),e.getGeometries){t.isMultiClip=!0;var a=e.getGeometries()||[];t.beginPath(),a.forEach((function(e){e._getPainter().paint(null,t)})),t.stroke(),delete t.isMultiClip}else e._getPainter().paint(null,t);return 1!==r&&t.restore(),t.clip(),this.southWest=n,!0},n.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},n.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},n.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},n.onZoomStart=function(){},n.onZoomEnd=function(){this.setToRedraw()},n.onZooming=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){this.setToRedraw()},n.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},n.onDragRotateStart=function(){},n.onDragRotating=function(){},n.onDragRotateEnd=function(){this.setToRedraw()},n.onSpatialReferenceChange=function(){},n.getDrawTime=function(){return this._drawTime},n._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},n._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var n=l();this.draw(t),n=l()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime}},n._promiseResource=function(t){var e=this,n=this.resources,i=this.layer.options.crossOrigin;return function(r){if(n.isResourceLoaded(t,!0))r(t);else{var a=new Image;d(i)||(a.crossOrigin=i),C(t[0])&&!P&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),a.onload=function(){e._cacheResource(t,a),r(t)},a.onabort=function(e){console,e&&console,r(t)},a.onerror=function(e){n.markErrorResource(t),r(t)},T(a,t)}}},n._cacheResource=function(t,e){if(this.layer&&this.resources){var n=t[1],i=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===C(t[0])&&(oe.edge||oe.ie)){d(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),d(i)&&(i=e.height||this.layer.options.defaultIconSize[1]);var r=un.createCanvas(n,i);un.image(r.getContext("2d"),e,0,0,n,i),e=r}this.resources.addResource(t,e)}},e}(wn),fi=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){this.resources[t[0]]={image:e,width:+t[1],height:+t[2]}},e.isResourceLoaded=function(t,e){if(!t)return!1;var n=this._getImgUrl(t);if(this._errors[n])return!0;var i=this.resources[n];return!(!i||e&&C(t[0])&&(+t[1]>i.width||+t[2]>i.height))},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var n=t.resources[e];this.addResource([e,n.width,n.height],n.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)b(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t}(),di=function(t){function e(e,n){var i,r;return n&&(r=n.canvas,delete n.canvas),(i=t.call(this,n)||this)._canvas=r,i.setId(e),n&&i.setZIndex(n.zIndex),i}se(e,t);var n=e.prototype;return n.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();d(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},n.getId=function(){return this._id},n.setId=function(t){var e=this._id;return d(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},n.addTo=function(t){return t.addLayer(this),this},n.setZIndex=function(t){return this._zIndex=t,d(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},n.getZIndex=function(){return this._zIndex||0},n.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},n.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),d(e)?1/0:e):e},n.getOpacity=function(){return this.options.opacity},n.setOpacity=function(t){return this.config("opacity",t),this},n.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof li},n.getMap=function(){return this.map?this.map:null},n.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},n.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},n.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("show")})):this.fire("show")}return this},n.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("hide")})):this.fire("hide")}return this},n.isVisible=function(){if(p(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!d(this.options.maxZoom)&&this.options.maxZoom<e||!d(this.options.minZoom)&&this.options.minZoom>e)return!1}return d(this.options.visible)&&(this.options.visible=!0),this.options.visible},n.remove=function(){return this.map&&this.map.removeLayer(this),this},n.getMask=function(){return this._mask},n.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if("Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),t._bindLayer(this),this._mask=t,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},n.removeMask=function(){if(delete this._mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},n.onLoad=function(){return!0},n.onLoadEnd=function(){},n.isLoaded=function(){return!!this._loaded},n.getRenderer=function(){return this._getRenderer()},n.onConfig=function(t){if(p(t.opacity)||t.cssFilter){var e=this.getRenderer();e&&e.setToRedraw()}},n.onAdd=function(){},n.onRendererCreate=function(){},n.onCanvasCreate=function(){},n.onRemove=function(){},n._bindMap=function(t,e){t&&(this.map=t,d(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},n._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},n._doRemove=function(){this._loaded=!1,this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map},n._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},n._getRenderer=function(){return this._renderer},n._getLayerList=function(){return this.map?this.map._layers:[]},n._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getPainter();return t?t.get2DExtent():null},e}(On(yn(ci(wn))));di.mergeOptions({attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1});var pi=di.prototype.fire;di.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),pi.apply(this,arguments)};var gi={"EPSG:3857":{resolutions:function(){for(var t=[],e=12756274*Math.PI,n=0;n<21;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<20;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{resolutions:function(){for(var t=Math.pow(2,18),e=[],n=0;n<20;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{resolutions:function(){for(var t=Math.pow(2,8),e=[],n=0;n<18;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}}};gi["EPSG:4490"]=gi["EPSG:4326"];var vi=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}t.getProjectionInstance=function(t){if(!t)return null;if(v(t))return t;for(var e in t=(t+"").toLowerCase(),hi)if(b(hi,e)){var n=hi[e].code;if(n&&n.toLowerCase()===t)return hi[e]}return null},t.equals=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var n=t.fullExtent,i=e.fullExtent;if(n&&!i||!n&&i)return!1;if(n&&i&&(n.top!==i.top||n.bottom!==i.bottom||n.left!==i.left||n.right!==i.right))return!1;var r=t.resolutions,a=e.resolutions;if(r&&a){if(r.length!==a.length)return!1;for(var o=0;o<r.length;o++)if(r[o]!==a[o])return!1}return!0};var e=t.prototype;return e._initSpatialRef=function(){var e=this.options.projection;if(!(e=e?t.getProjectionInstance(e):ui))throw new Error("must provide a valid projection in map's spatial reference.");(e=f({},Zn,e)).measureLength||f(e,ei.DEFAULT),this._projection=e;var n,i=this.options.resolutions;if(!i&&(e.code&&(n=gi[e.code])&&(i=n.resolutions,this.isEPSG="IDENTITY"!==e.code),!i))throw new Error("must provide valid resolutions in map's spatial reference.");this._resolutions=i;var r=this.options.fullExtent;if(!r&&(e.code&&(n=gi[e.code])&&(r=n.fullExtent),!r))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(d(r.left)?(this._fullExtent=new Vn(r),r.left=r.xmin,r.right=r.xmax,r.top=r.ymax,r.bottom=r.ymin):this._fullExtent=new Vn(new Tn(r.left,r.top),new Tn(r.right,r.bottom)),d(r.top)||d(r.bottom)||d(r.left)||d(r.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");f(this._fullExtent,r),this._projection.fullExtent=r;var a=r.right>=r.left?1:-1,o=r.top>=r.bottom?-1:1;this._transformation=new Hn([a,o,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var n=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?n+(this._resolutions[e+1]-n)*(t-e):n},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!d(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!d(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return F(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},t}(),mi={maxVisualPitch:60,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!P,zoomAnimationDuration:330,panAnimation:!P,panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:!oe.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!1,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas"},yi=function(t){function e(n,i){var r;if(!i)throw new Error("Invalid options when creating map.");if(!i.center)throw new Error("Invalid center when creating map.");var a=f({},i),o=a.zoom;delete a.zoom;var s=new Tn(a.center);delete a.center;var u=a.baseLayer;delete a.baseLayer;var h=a.layers;return delete a.layers,(r=t.call(this,a)||this).VERSION=e.VERSION,Object.defineProperty(ue(ue(r)),"id",{value:E(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=o,r._center=s,r.setSpatialReference(a.spatialReference||a.view),r._mapViewPoint=new ce(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),u&&r.setBaseLayer(u),h&&r.addLayer(h),r._Load(),r}se(e,t),e.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var n=e.prototype;return n.isLoaded=function(){return!!this._loaded},n.getContainer=function(){return this._containerDOM},n.getSpatialReference=function(){return this._spatialReference},n.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&vi.equals(e,t)?this:(this._updateSpatialReference(t,e),this)},n._updateSpatialReference=function(t,e){if(t=f({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new vi(t),this.options.spatialReference&&y(this.options.spatialReference.projection)){var n=this._spatialReference.getProjection();this.options.spatialReference.projection=n.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:f({},this.options.spatialReference)}),this},n.onConfig=function(t){var e=t.spatialReference||t.view;return d(e)||this._updateSpatialReference(e,null),this},n.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},n.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},n.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},n.resetCursor=function(){return this.setCursor(null)},n.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},n.setCenter=function(t){if(!t)return this;t=new Tn(t);var e=this.getProjection().project(t);return this._verifyExtent(e)?this._loaded?(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},n.getSize=function(){return d(this.width)||d(this.height)?this._getContainerDomSize():new le(this.width,this.height)},n.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new Gn(0,this.height-t,this.width,this.height)},n._getVisualHeight=function(t){var e=this.getPitch(),n=this.height/2*Math.tan(t*Math.PI/180);return this.height/2+n*Math.tan((90-e)*Math.PI/180)},n.getExtent=function(){return this._pointToExtent(this._get2DExtent())},n.getProjExtent=function(){var t=this._get2DExtent();return new Vn(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},n.getPrjExtent=function(){return this.getProjExtent()},n.getMaxExtent=function(){return this.options.maxExtent?new Vn(this.options.maxExtent,this.getProjection()):null},n.setMaxExtent=function(t){if(t){var e=new Vn(t,this.getProjection());this.options.maxExtent=e,this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent().getCenter());var n=this.getProjection();this._prjMaxExtent=e.convertTo((function(t){return n.project(t)}))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},n.getZoom=function(){return this._zoomLevel},n.getZoomForScale=function(t,e,n){var i=this.getZoom();if(d(e)&&(e=i),1===t&&e===i)return i;var r=this._getResolution(e)/t,a=this.getZoomFromRes(r);return n?a:this.getSpatialReference().getZoomDirection()<0?Math.ceil(a-1e-6):Math.floor(a+1e-6)},n.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),i=this._getResolution(this.getMaxZoom());if(n<=i){if(t<=n)return this.getMinZoom();if(t>=i)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=i)return this.getMaxZoom()}for(var r=e.length,a=0;a<r-1;a++)if(e[a]){var o=e[a+1]-e[a],s=t-e[a];if(F(o)===F(s)&&Math.abs(o)>=Math.abs(s))return a+s/o}return r-1},n.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||d(t)?this:(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t),this)},n.getMaxZoom=function(){return d(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},n.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},n.getMinZoom=function(){return d(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},n.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},n.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},n.getGLZoom=function(){return this.getMaxNativeZoom()/2},n.getGLScale=function(t){return d(t)&&(t=this.getZoom()),this._getResolution(t)/this._getResolution(this.getGLZoom())},n.zoomIn=function(){return this.setZoom(this.getZoom()+1)},n.zoomOut=function(){return this.setZoom(this.getZoom()-1)},n.isZooming=function(){return!!this._zooming},n.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},n.setCenterAndZoom=function(t,e){return d(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},n.getFitZoom=function(t){var e=this;if(!(t&&t instanceof Vn))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var n=this.getSize(),i=t.convertTo((function(t){return e.coordToContainerPoint(t)})),r=i.getWidth(),a=i.getHeight(),o=n.width/r,s=n.height/a,u=this.getSpatialReference().getZoomDirection()<0?Math.max(o,s):Math.min(o,s);return this.getZoomForScale(u)},n.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},n.setView=function(t){return t?(t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.pitch||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},n.getResolution=function(t){return this._getResolution(t)},n.getScale=function(t){var e=d(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/n},n.fitExtent=function(t,e,n,i){if(void 0===n&&(n={}),!t)return this;t=new Vn(t,this.getProjection());var r=this.getFitZoom(t)+(e||0),a=t.getCenter();return void 0===n.animation||n.animation?this._animateTo({center:a,zoom:r},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},i):this.setCenterAndZoom(a,r)},n.getBaseLayer=function(){return this._baseLayer},n.setBaseLayer=function(t){var e=!1;return this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),t?(this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this):(delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this)},n.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},n.getLayers=function(t){return this._getLayers((function(e){return!(e===this._baseLayer||e.getId().indexOf(r)>=0)&&(!t||t(e))}))},n.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},n.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,n=0,i=t.length;n<i;n++){var r=t[n],a=r.getId();if(d(a))throw new Error("Invalid id for the layer: "+a);if(r.getMap()!==this){if(this._layerCache[a])throw new Error("Duplicate layer id in the map: "+a);this._layerCache[a]=r,r._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},n.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];if(r instanceof di||(r=this.getLayer(r)),r){var a=r.getMap();if(a&&a===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var o=r.getId();this._layerCache&&delete this._layerCache[o]}}}if(e.length>0){var s=this.getRenderer();s&&s.setLayerCanvasUpdated(),this.once("frameend",(function(){e.forEach((function(t){t.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:t}),this},n.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,i=0,r=t.length;i<r;i++){var a=t[i];if(m(t[i])&&(a=this.getLayer(a)),!(a instanceof di&&a.getMap()&&a.getMap()===this))throw new Error("It must be a layer added to this map to order.");a.getZIndex()<n&&(n=a.getZIndex()),e.push(a)}for(var o=0,s=e.length;o<s;o++)e[o].setZIndex(n+o);return this},n.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,i=this._getRenderer();if(i&&i.toDataURL){var r=t.fileName;r||(r="export");var a=i.toDataURL(e);if(n&&a){var o;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var s=J(a.replace(/^data:image\/(png|jpeg|jpg);base64,/,""),e);o=URL.createObjectURL(s)}else o=a;var u=document.createElement("a");u.download=r,u.href=o,document.body.appendChild(u),u.click(),document.body.removeChild(u)}return a}return null},n.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},n.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},n.coordToViewPoint=function(t,e){return this.coordinateToViewPoint(t,e)},n.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},n.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},n.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},n.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},n.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},n.checkSize=function(){var t=l()-this._initTime<1500&&0===this.width||0===this.height,e=this._getContainerDomSize(),n=this.height,i=this.width;if(e.width===i&&e.height===n)return this;var r=this.getCenter();if(this._updateMapSize(e),!this.options.fixCenterOnResize){var a=new ce((i-e.width)/2,(n-e.height)/2);this._offsetCenterByPixel(a),this._mapViewCoord=this._getPrjCenter()}var o=0===e.width||0===e.height||0===i||0===n;return(t||o)&&(this._noEvent=!0,this.setCenter(r),delete this._noEvent),this._fireEvent("resize"),this},n.locate=function(t,e,n){return this.getProjection()._locate(new Tn(t),e,n)},n.getMainPanel=function(){return this._getRenderer().getMainPanel()},n.getPanels=function(){return this._panels},n.remove=function(){if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var t=this.getLayers(),e=0;e<t.length;e++)t[e].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.innerHTML&&(this._containerDOM.innerHTML=""),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},n.isRemoved=function(){return!this._containerDOM},n.isMoving=function(){return!!this._moving},n.onMoveStart=function(t){this._originCenter=this._getPrjCenter(),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},n.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},n.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())){var e=this._originCenter;this._verifyExtent(e)||(e=this.getMaxExtent().getCenter()),this._panTo(e)}},n.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},n.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},n.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},n.isDragRotating=function(){return!!this._dragRotating},n.getRenderer=function(){return this._getRenderer()},n.getDevicePixelRatio=function(){return this.options.devicePixelRatio||Math.ceil(oe.devicePixelRatio)||1},n._initContainer=function(t){if(m(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,P&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},n._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},n._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},n._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},n._removeLayer=function(t,e){if(t&&e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},n._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t;this._layers.sort((function(t,e){var n=t.getZIndex()-e.getZIndex();return 0===n?t._order-e._order:n}))}},n._fireEvent=function(t,e){this._noEvent||(this.fire("_"+t,e),this.fire(t,e))},n._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=l()},n._initRenderer=function(){var t=this.options.renderer,n=e.getRendererClass(t);this._renderer=new n(this),this._renderer.load()},n._getRenderer=function(){return this._renderer},n._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(t){t&&t.load()}),this.getLayers())},n._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],i=0;i<e.length;i++)t&&!t.call(this,e[i])||n.push(e[i]);return n},n._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var n=[],i=0,r=e.length;i<r;i++)n=n.concat(e[i]);for(var a=0,o=n.length;a<o;a++)t.call(t,n[a])}},n._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},n._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),i=this._spatialReference.getMinZoom();(d(t)||-1===t||t>n)&&this.setMaxZoom(n),(d(e)||-1===e||e<i)&&this.setMinZoom(i),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(d(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var a=this._getRenderer();a&&a.resetContainer()},n._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,n=this._containerDOM;if(d(n.width)||d(n.height)){if(d(n.clientWidth)||d(n.clientHeight))throw new Error("can not get size of container");t=parseInt(n.clientWidth,0),e=parseInt(n.clientHeight,0)}else{t=n.width,e=n.height;var i=this.getDevicePixelRatio();1!==i&&n.layer&&(t/=i,e/=i)}return new le(t,e)},n._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},n._getPrjCenter=function(){return this._prjCenter},n._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},n._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),i=this._pointToPrj(this._prjToPoint(t).sub(n));return this._setPrjCenter(i),this},n._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},n._offsetCenterByPixel=function(t){var e=new ce(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e);return this._setPrjCenter(n),n},n.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},n.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},n._resetMapViewPoint=function(){this._mapViewPoint=new ce(0,0),this._mapViewCoord=this._getPrjCenter()},n._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?t===this.getGLZoom()&&void 0!==this._mapGlRes?this._mapGlRes:(d(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},n._getResolutions=function(){return this._spatialReference.getResolutions()},n._prjToPoint=function(t,e,n){return e=d(e)?this.getZoom():e,this._spatialReference.getTransformation().transform(t,this._getResolution(e),n)},n._pointToPrj=function(t,e,n){return e=d(e)?this.getZoom():e,this._spatialReference.getTransformation().untransform(t,this._getResolution(e),n)},n._pointToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),d(e)?n:n._multi(this._getResolution(e)/this._getResolution())},n._pointToPointAtZoom=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),d(e)?n:n._multi(this._getResolution()/this._getResolution(e))},n._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},n._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var n=0,i=t._onLoadHooks.length;n<i;n++)t._onLoadHooks[n].call(this)},e}(jn(yn(ci(wn))));yi.include({coordinateToPoint:function(){var t=new Tn(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToPoint(r,n,i)}}(),pointToCoordinate:function(){var t=new Tn(0,0);return function(e,n,i){var r=this._pointToPrj(e,n,t);return this.getProjection().unproject(r,i)}}(),coordinateToViewPoint:function(){var t=new Tn(0,0);return function(e,n){return this._prjToViewPoint(this.getProjection().project(e,t),n)}}(),viewPointToCoordinate:function(){var t=new Tn(0,0);return function(e,n){return this.getProjection().unproject(this._viewPointToPrj(e,t),n)}}(),coordinateToContainerPoint:function(){var t=new Tn(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToContainerPoint(r,n,i)}}(),containerPointToCoordinate:function(){var t=new Tn(0,0);return function(e,n){var i=this._containerPointToPrj(e,t);return this.getProjection().unproject(i,n)}}(),containerToExtent:function(){var t=new ce(0,0),e=new ce(0,0);return function(n){var i=new Gn(this._containerPointToPoint(n.getMin(t),void 0,t),this._containerPointToPoint(n.getMax(e),void 0,e));return this._pointToExtent(i)}}(),distanceToPixel:function(){var t=new ce(0,0),e=new ce(0,0);return function(n,i,r){var a=this.getProjection();if(!a)return null;var o=this.getScale()/this.getScale(r),s=this.getCenter(),u=a.locate(s,n,i),h=this.coordToContainerPoint(s,void 0,t),c=this.coordToContainerPoint(u,void 0,e);return c._sub(h)._multi(o)._abs(),new le(c.x,c.y)}}(),distanceToPoint:function(){var t=new ce(0,0);return function(e,n,i){var r=this.getProjection();if(!r)return null;var a=this.getCenter(),o=r.locate(a,e,n),s=this.coordToPoint(a,i,t),u=this.coordToPoint(o,i);return u._sub(s)._abs(),u}}(),pixelToDistance:function(){var t=new Tn(0,0),e=new Tn(0,0);return function(n,i){var r=this.getProjection();if(!r)return null;var a=this.getFullExtent(),o=a.top>a.bottom?-1:1,s=t.set(this.width/2+n,this.height/2+o*i),u=this.containerPointToCoord(s,e);return r.measureLength(this.getCenter(),u)}}(),pointToDistance:function(){var t=new ce(0,0),e=new Tn(0,0);return function(n,i,r){var a=this.getProjection();if(!a)return null;var o=this._prjToPoint(this._getPrjCenter(),r,t);o._add(n,i);var s=this.pointToCoord(o,r,e);return a.measureLength(this.getCenter(),s)}}(),locateByPoint:function(){var t=new ce(0,0);return function(e,n,i){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(n,i))}}(),_get2DExtent:function(){var t=new ce(0,0);return function(e,n){var i,r=this;return void 0!==e&&e!==this._zoomLevel||!this._mapExtent2D?e===this.getGLZoom()&&this._mapGlExtent2D&&(i=this._mapGlExtent2D):i=this._mapExtent2D,i?n?(n.set(i.xmin,i.ymin,i.xmax,i.ymax),n):i.copy():this.getContainerExtent().convertTo((function(n){return r._containerPointToPoint(n,e,t)}),n)}}(),_pointToExtent:function(){var t=new Tn(0,0),e=new Tn(0,0);return function(n){var i=n.getMin(),r=n.getMax(),a=this.getFullExtent(),o=!a||a.left<=a.right?[i.x,r.x]:[r.x,i.x],s=o[0],u=o[1],h=!a||a.top>a.bottom?[r.y,i.y]:[i.y,r.y],c=h[0],l=h[1],f=i.set(s,c),d=r.set(u,l);return new Vn(this.pointToCoord(f,void 0,t),this.pointToCoord(d,void 0,e),this.getProjection())}}(),_getViewPointFrameOffset:function(){var t=new ce(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new ce(0,0);return function(e,n){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),n)}}(),_prjToContainerPoint:function(){var t=new ce(0,0);return function(e,n,i){return this._pointToContainerPoint(this._prjToPoint(e,n,t),n,0,i)}}(),_prjToViewPoint:function(){var t=new ce(0,0);return function(e,n){var i=this._prjToContainerPoint(e,void 0,t);return this.containerPointToViewPoint(i,n)}}(),_viewPointToPoint:function(){var t=new ce(0,0);return function(e,n,i){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),n,i)}}(),_pointToViewPoint:function(){var t=new Tn(0,0);return function(e,n,i){return this._prjToViewPoint(this._pointToPrj(e,n,t),i)}}()}),yi.mergeOptions(mi);var _i=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},n.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},n._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),i=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(i,t.containerPoint)}},e}(bn);yi.mergeOptions({doubleClickZoom:!0}),yi.addOnLoadHook("addHandler","doubleClickZoom",_i);var bi,wi=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new Cn(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},n.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},n._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},n._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},n._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),Ne(t.domEvent)},n._onDragStart=function(t){this.startDragTime=l(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},n._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},n._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},n._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY},n._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var n=Ze(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(n)},n._moving=function(t){if(this.startDragTime){var e=this.target,n=Ze(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,n),e.onMoving(t)}},n._moveEnd=function(t){if(this.startDragTime){var e=this.target,n=l()-this.startDragTime,i=t.mousePos.x,r=t.mousePos.y,a=i-this.startX,o=r-this.startY;this._clear(),e.options.panAnimation&&!t.interupted&&e._verifyExtent(e._getPrjCenter())&&n<280&&Math.abs(o)+Math.abs(a)>5?(n=5*n*(Math.abs(a)+Math.abs(o))/500,e.panBy(new ce(a,o),{duration:n})):e.onMoveEnd(t)}},n._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},n._rotating=function(t){var e=this.target,n=t.mousePos.x,i=t.mousePos.y,r=e.getPitch(),a=e.getBearing(),o=Math.abs(n-this.preX),s=Math.abs(i-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=o>s?"rotate":o<s?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&s<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var u;u=e.options.dragPitch||o>s?-.6*(this.preX-n):n>e.width/2?.6*(this.preY-i):-.6*(this.preY-i);var h=e.getBearing()+u;this._db=this._db||0,this._db+=u,e.setBearing(h)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e.setPitch(e.getPitch()+.4*(this.preY-i)),this.preX=n,this.preY=i,e.getBearing()===a&&e.getPitch()===r||e.onDragRotating(t)}},n._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var i=l()-this.startDragTime;if(e.onDragRotateEnd(t),Math.abs(n-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&i<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/2},{easing:"out",duration:800})}},n._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(bn);function xi(t,e,n,i){for(var r,a=[],o=0,s=0,u=t.length;s<u-1;s++)(r=Oi(t[s],t[s+1],e,s,n,i))&&(a[o]=a[o]||[],a[o].push({point:r[0],index:s}),r[1]===t[s+1]&&s!==u-2||(a[o].push({point:r[1],index:s+1}),o++));return a}function Oi(t,e,n,i,r,a){var o,s,u,h=i?bi:Pi(t,n),c=Pi(e,n);for(bi=c;;){if(!(h|c))return[t,e];if(h&c)return!1;if(a)return[t,e];u=Pi(s=ki(t,e,o=h||c,n,r),n),o===h?(t=s,h=u):(e=s,c=u)}}function ji(t,e,n){var i,r,a,o,s,u,h,c,l,f=[1,4,2,8];for(r=0,h=t.length;r<h;r++)t[r]._code=Pi(t[r],e);for(o=0;o<4;o++){for(c=f[o],i=[],r=0,a=(h=t.length)-1;r<h;a=r++)s=t[r],u=t[a],s._code&c?u._code&c||((l=ki(u,s,c,e,n))._code=Pi(l,e),i.push(l)):(u._code&c&&((l=ki(u,s,c,e,n))._code=Pi(l,e),i.push(l)),i.push(s));t=i}return t}function ki(t,e,n,i,r){var a,o,s=e.x-t.x,u=e.y-t.y,h=i.getMin(),c=i.getMax();8&n?(a=t.x+s*(c.y-t.y)/u,o=c.y):4&n?(a=t.x+s*(h.y-t.y)/u,o=h.y):2&n?(a=c.x,o=t.y+u*(c.x-t.x)/s):1&n&&(a=h.x,o=t.y+u*(h.x-t.x)/s);var l=new ce(a,o);return r&&l._round(),l}function Pi(t,e){var n=0;return t.x<e.getMin().x?n|=1:t.x>e.getMax().x&&(n|=2),t.y<e.getMin().y?n|=4:t.y>e.getMax().y&&(n|=8),n}function Ci(t,e,n,i){t=new ce(t);var r,a,o,s=Math.abs(n.x-e.x),u=Math.abs(n.y-e.y),h=Math.sqrt(Math.abs(s*s-u*u));return s>=u?(r=new ce(e.x-h,e.y),a=new ce(e.x+h,e.y),o=2*s):(r=new ce(e.x,e.y-h),a=new ce(e.x,e.y+h),o=2*u),t.distanceTo(r)+t.distanceTo(a)<=o+2*i}yi.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),yi.addOnLoadHook("addHandler","draggable",wi);var Ti=function(){function t(){}var e=t.prototype;return e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},t.testColor=function(t){return!(!t||!m(t))&&c.indexOf(t)>=0},t}(),Mi=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n._prepareContext=function(t){p(this.symbol.opacity)?t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity):1!==t.globalAlpha&&(t.globalAlpha=1)},n.prepareCanvas=function(t,e,n){un.prepareCanvas(t,e,n,this.getPainter().isHitTesting())},n.remove=function(){},n.setZIndex=function(){},n.show=function(){},n.hide=function(){},n._defineStyle=function(t){return function(){var e=this,n=[],i={};return Ot(t,(function(){var t=e.getMap();return function(t,e,n){return t[0]=e,t[1]=n,t}(n,t.getZoom(),f({},e.geometry.getProperties(),function(t,e,n,i){return t["{bearing}"]=e,t["{pitch}"]=n,t["{zoom}"]=i,t}(i,t.getBearing(),t.getPitch(),t.getZoom())))}))}.bind(this)()},e}(Ti),Ei=new ce(0,0),Si=new ce(0,0),Ai=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,r}se(e,t);var n=e.prototype;return n.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLZoom(),n=new Gn,i=this._getRenderPoints()[0],r=i.length-1;r>=0;r--)i[r]&&n._combine(t._pointToPoint(i[r],e));return n},n._rotateExtent=function(t,e){return t.convertTo((function(t){return t._rotate(e)}))},n._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},n._getRenderContainerPoints=function(t){var e=this.getPainter(),n=this._getRenderPoints()[0];if(e.isSpriting())return n;var i=this.getDxDy(),r=this.painter._pointContainerPoints(n,i.x,i.y,t,!0,this.getPlacement());if(!r||!Array.isArray(r[0]))return r;for(var a=[],o=0,s=r.length;o<s;o++)for(var u=0,h=r[o].length;u<h;u++)a.push(r[o][u]);return a},n._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var i=this.getMap(),r=n[t][0],a=n[t][1];if(i.isTransforming()){var o=i.getGLZoom();r=i._pointToContainerPoint(n[t][0],o,0,Ei),a=i._pointToContainerPoint(n[t][1],o,0,Si)}return e+K(r.x,r.y,a.x,a.y)},n._rotate=function(t,e,n){if(n){var i=this.getDxDy(),r=e.sub(i);return t.save(),t.translate(r.x,r.y),t.rotate(n),this.getDxDy()}return null},e}(Mi),Li=function(t){function e(n,i,r){var a;(a=t.call(this,n,i,r)||this)._dynamic=wt(n),a.style=a._defineStyle(a.translate()),a.strokeAndFill=a._defineStyle(e.translateLineAndFill(a.style));var o=a.strokeAndFill.lineWidth;return a.padding=o%2==0?2:1.5,a}se(e,t),e.test=function(t){return!!t&&!(!d(t.markerFile)||d(t.markerType)||"path"===t.markerType)};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&(0!==n.polygonOpacity||0!==n.lineOpacity)){var i=this._getRenderContainerPoints();V(i)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,i,e):this._drawMarkersWithCache(t,i,e))}},n.getDxDy=function(){var t=this.style,e=t.markerDx,n=t.markerDy;return new ce(e,n)},n._drawMarkers=function(t,e,n){var i=this.strokeAndFill;At(i.lineColor)||At(i.polygonFill)||this.prepareCanvas(t,i,n);for(var r=e.length-1;r>=0;r--){var a=e[r],o=this._rotate(t,a,this._getRotationAt(r));o&&(a=o),this._drawVectorMarker(t,a,n),o&&t.restore()}},n._drawMarkersWithCache=function(t,e,n){var i=this._stampSymbol(),r=n.getImage(i);r||(r=this._createMarkerImage(t,n),n.addResource([i,r.width,r.height],r));for(var a=this._getAnchor(r.width,r.height),o=e.length-1;o>=0;o--){var s=e[o],u=this._rotate(t,s,this._getRotationAt(o));u&&(s=u),un.image(t,r,s.x+a.x,s.y+a.y),u&&t.restore()}},n._calMarkerSize=function(){if(!this._size){var t=this.strokeAndFill.lineWidth,e=2*(this.symbol.shadowBlur||0),n=Math.round(this.style.markerWidth+t+2*e+2*this.padding),i=Math.round(this.style.markerHeight+t+2*e+2*this.padding);this._size=[n,i]}return this._size},n._createMarkerImage=function(t,e){var n=t.canvas.constructor,i=this._calMarkerSize(),r=un.createCanvas(i[0],i[1],n),a=this._getCacheImageAnchor(i[0],i[1]),o=r.getContext("2d");return At(this.strokeAndFill.lineColor)||At(this.strokeAndFill.polygonFill)||this.prepareCanvas(o,this.strokeAndFill,e),this._drawVectorMarker(o,a,e),r},n._stampSymbol=function(){return this._stamp||(this._stamp=[this.style.markerType,At(this.style.markerFill)?Lt(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,At(this.style.markerLineColor)?Lt(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_")),this._stamp},n._getAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=je(new le(t,e),this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment);return i.x!==-t/2&&(i.x-=F(i.x+t/2)*n),i.y!==-e/2&&(i.y-=F(i.y+e/2)*n),i},n._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=this.style.markerType;return"bar"===i||"pie"===i||"pin"===i?new ce(t/2,e-n):"rectangle"===i?new ce(n,n):new ce(t/2,e/2)},n._getGraidentExtent=function(t){var e=new Gn,n=this.getDxDy(),i=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=i.xmin-n.x,e.ymin+=i.ymin-n.y,e.xmax+=i.xmax-n.x,e.ymax+=i.ymax-n.y,e},n._drawVectorMarker=function(t,n,i){var r,a=this.style,o=this.strokeAndFill,s=a.markerType.toLowerCase(),u=e._getVectorPoints(s,a.markerWidth,a.markerHeight),h=o.lineOpacity,c=o.polygonOpacity;(At(o.lineColor)||At(o.polygonFill))&&(At(o.lineColor)&&(r=this._getGraidentExtent(n),o.lineGradientExtent=r.expand(o.lineWidth)),At(o.polygonFill)&&(r||(r=this._getGraidentExtent(n)),o.polygonGradientExtent=r),this.prepareCanvas(t,o,i));var l=a.markerWidth,f=a.markerHeight,d=a.markerLineWidth/2;if("ellipse"===s)un.ellipse(t,n,l/2,f/2,h,c);else if("cross"===s||"x"===s){for(var p=u.length-1;p>=0;p--)u[p]._add(n);un.path(t,u.slice(0,2),h),un.path(t,u.slice(2,4),h)}else if("diamond"===s||"bar"===s||"square"===s||"rectangle"===s||"triangle"===s){"bar"===s?n=n.add(0,-d):"rectangle"===s&&(n=n.add(d,d));for(var g=u.length-1;g>=0;g--)u[g]._add(n);un.polygon(t,u,h,c)}else if("pin"===s){n=n.add(0,-d);for(var v=u.length-1;v>=0;v--)u[v]._add(n);var m=t.lineCap;t.lineCap="round",un.bezierCurveAndFill(t,u,h,c),t.lineCap=m}else{if("pie"!==s)throw new Error("unsupported markerType: "+s);n=n.add(0,d);var y=180*Math.atan(l/2/f)/Math.PI,_=t.lineCap;t.lineCap="round",un.sector(t,n,f,[90-y,90+y],h,c),t.lineCap=_}},n.getPlacement=function(){return this.symbol.markerPlacement},n.getRotation=function(){var t=this.style.markerRotation;return p(t)?-t*Math.PI/180:null},n.getFixedExtent=function(){var t=this.getDxDy(),e=2*this.padding,n=this._calMarkerSize().map((function(t){return t-e})),i=this._getAnchor(n[0],n[1]),r=new Gn(t.add(0,0),t.add(n[0],n[1]));r._add(i);var a=this.getRotation();return a&&(r=this._rotateExtent(r,a)),r},n.translate=function(){var t,e,n=this.symbol,i={markerType:D(n.markerType,"ellipse"),markerFill:D(n.markerFill,"#00f"),markerFillOpacity:D(n.markerFillOpacity,1),markerFillPatternFile:D(n.markerFillPatternFile,null),markerLineColor:D(n.markerLineColor,"#000"),markerLineWidth:D(n.markerLineWidth,1),markerLineOpacity:D(n.markerLineOpacity,1),markerLineDasharray:D(n.markerLineDasharray,[]),markerLinePatternFile:D(n.markerLinePatternFile,null),markerDx:D(n.markerDx,0),markerDy:D(n.markerDy,0),markerWidth:D(n.markerWidth,10),markerHeight:D(n.markerHeight,10),markerRotation:D(n.markerRotation,0)},r=i.markerType;return"bar"===r||"pie"===r||"pin"===r?(t="middle",e="top"):"rectangle"===r?(t="right",e="bottom"):(t="middle",e="middle"),i.markerHorizontalAlignment=D(n.markerHorizontalAlignment,t),i.markerVerticalAlignment=D(n.markerVerticalAlignment,e),p(n.markerOpacity)&&(p(n.markerFillOpacity)&&(i.markerFillOpacity*=n.markerOpacity),p(n.markerLineOpacity)&&(i.markerLineOpacity*=n.markerOpacity)),i},e.translateLineAndFill=function(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e},e._getVectorPoints=function(t,e,n){var i,r=n/2,a=e/2;if("triangle"===t)return[i=new ce(0,0-r),new ce(0-a,0+r),new ce(0+a,0+r)];if("cross"===t)return[i=new ce(0-a,0),new ce(0+a,0),new ce(0,0-r),new ce(0,0+r)];if("diamond"===t)return[i=new ce(0-a,0),new ce(0,0-r),new ce(0+a,0),new ce(0,0+r)];if("square"===t)return[i=new ce(0-a,0+r),new ce(0+a,0+r),new ce(0+a,0-r),new ce(0-a,0-r)];if("rectangle"===t)return[i=new ce(0,0),i.add(e,0),i.add(e,n),i.add(0,n)];if("x"===t)return[i=new ce(0-a,0+r),new ce(0+a,0-r),new ce(0+a,0+r),new ce(0-a,0-r)];if("bar"===t)return[i=new ce(0-a,0-n),new ce(0+a,0-n),new ce(0+a,0),new ce(0-a,0)];if("pin"===t){var o=n*Math.atan(a/r);return[i=new ce(0,0),new ce(0-o,0-n),new ce(0+o,0-n),new ce(0,0)]}return[]},e}(Ai),Ri=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getPlacement=function(){return"point"},n.getDxDy=function(){return new ce(0,0)},n.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(e.options.debug||!n||n.options.debug){var i=this.getMap();if(i&&!i.isZooming()){var r=n.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var a=this.getPainter().getContainerExtent().toArray();un.polygon(t,[a],1,0);for(var o=this._getRenderContainerPoints(),s=this.geometry.getId(),u=Li._getVectorPoints("cross",10,10),h=0;h<o.length;h++){var c=o[h];d(s)||un.fillText(t,s,c.add(8,-4),r);for(var l=[],f=0;f<u.length;f++)l.push(u[f].add(c));un.path(t,l.slice(0,2),1),un.path(t,l.slice(2,4),1)}}}},e}(Ai),Ii=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=r._defineStyle(r.translate()),r}se(e,t),e.test=function(t){return!!t&&!d(t.markerFile)};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&0!==n.markerOpacity){var i=this._getRenderContainerPoints();if(V(i)){var r=this._getImage(e);if(r){this._prepareContext(t);var a,o=n.markerWidth,s=n.markerHeight;if(!p(o)||!p(s)){o=r.width,s=r.height,n.markerWidth=o,n.markerHeight=s;var u=[n.markerFile,n.markerWidth,n.markerHeight];e.isResourceLoaded(u)||e.addResource(u,r);var h=this.getPainter();h.isSpriting()||h.removeCache()}"path"!==this.symbol.markerType&&p(n.markerOpacity)&&n.markerOpacity<1&&(a=t.globalAlpha,t.globalAlpha*=n.markerOpacity);for(var c=je(new le(o,s),n.markerHorizontalAlignment,n.markerVerticalAlignment),l=0,f=i.length;l<f;l++){var d=i[l],g=this._rotate(t,d,this._getRotationAt(l));g&&(d=g),un.image(t,r,d.x+c.x,d.y+c.y,o,s),g&&t.restore()}void 0!==a&&(t.globalAlpha=a)}}}},n._getImage=function(t){return t?t.getImage([this.style.markerFile,this.style.markerWidth,this.style.markerHeight]):null},n.getPlacement=function(){return this.symbol.markerPlacement},n.getRotation=function(){var t=this.style.markerRotation;return p(t)?-t*Math.PI/180:null},n.getDxDy=function(){var t=this.style,e=t.markerDx,n=t.markerDy;return new ce(e,n)},n.getFixedExtent=function(t){var e=this.style,n=e.markerFile,i=t?t.getImage(n):null,r=e.markerWidth||(i?i.width:0),a=e.markerHeight||(i?i.height:0),o=this.getDxDy(),s=je(new le(r,a),e.markerHorizontalAlignment,e.markerVerticalAlignment),u=new Gn(o.add(0,0),o.add(r,a));u._add(s);var h=this.getRotation();return h&&(u=this._rotateExtent(u,h)),u},n.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:D(t.markerOpacity,1),markerWidth:D(t.markerWidth,null),markerHeight:D(t.markerHeight,null),markerRotation:D(t.markerRotation,0),markerDx:D(t.markerDx,0),markerDy:D(t.markerDy,0),markerHorizontalAlignment:D(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:D(t.markerVerticalAlignment,"top")}},e}(Ai),Di=new Tn(0,0),Fi=new Tn(0,0),zi=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,"Point"===n.type?ue(r):(r.style=r._defineStyle(r.translate()),r)}se(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var n in t){var i=n.slice(0,4);if("line"===i||"poly"===i)return!0}return!1};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(0!==n.polygonOpacity||0!==n.lineOpacity||this.painter.isHitTesting()){var i=this._getPaintParams();if(i){this._prepareContext(t);var r=At(n.lineColor),a="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!n.lineColor.places&&a||(n.lineGradientExtent=this.getPainter().getContainerExtent()._expand(n.lineWidth)),At(n.polygonFill)&&(n.polygonGradientExtent=this.getPainter().getContainerExtent());var o=i[0];if("Polygon"===this.geometry.getJSONType()&&o.length>0&&Array.isArray(o[0][0])||"LineString"===this.geometry.type&&o.length>0&&Array.isArray(o[0]))for(var s=0;s<o.length;s++){this.prepareCanvas(t,n,e),r&&a&&!n.lineColor.places&&this._createGradient(t,o[s],n.lineColor);var u=[t,o[s]];i.length>1&&u.push.apply(u,i.slice(1)),u.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,u)}else{this.prepareCanvas(t,n,e),r&&a&&!n.lineColor.places&&this._createGradient(t,o,n.lineColor);var h=[t];h.push.apply(h,i),h.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])}}},n.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new Tn(0,0),this._extMax=new Tn(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,Di),i=t._prjToPoint(this._extMax,void 0,Fi);return this._pxExtent?this._pxExtent.set(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)):this._pxExtent=new Gn(n,i),this._pxExtent},n.getFixedExtent=function(){var t=this.style.lineWidth/2;return new Gn(-t,-t,t,t)},n._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},n.translate=function(){var t=this.symbol,e={lineColor:D(t.lineColor,"#000"),lineWidth:D(t.lineWidth,2),lineOpacity:D(t.lineOpacity,1),lineDasharray:D(t.lineDasharray,[]),lineCap:D(t.lineCap,"butt"),lineJoin:D(t.lineJoin,"miter"),linePatternFile:D(t.linePatternFile,null),lineDx:D(t.lineDx,0),lineDy:D(t.lineDy,0),polygonFill:D(t.polygonFill,null),polygonOpacity:D(t.polygonOpacity,1),polygonPatternFile:D(t.polygonPatternFile,null),polygonPatternDx:D(t.polygonPatternDx,0),polygonPatternDy:D(t.polygonPatternDy,0),linePatternDx:D(t.linePatternDx,0),linePatternDy:D(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},n._createGradient=function(t,e,n){if(Array.isArray(e)&&e.length){var i=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[i-1].x,e[i-1].y);n.colorStops.forEach((function(t){r.addColorStop.apply(r,t)})),t.strokeStyle=r}},e}(Mi),Bi="___text_symbol_cache",Ni=function(t){function e(e,n,i){var r;if((r=t.call(this,e,n,i)||this)._dynamic=wt(e),r.style=r._defineStyle(r.translate()),0===r.style.textWrapWidth)return ue(r);r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style));var a=Oe(r.style.textName,r.geometry.getProperties());return r._dynamic||(r._cacheKey=function(t,e){var n=[t];for(var i in e)e.hasOwnProperty(i)&&i.length>4&&"text"===i.substring(0,4)&&n.push(i+"="+e[i]);return n.join("-")}(a,r.style)),r._descText(a),r}se(e,t),e.test=function(t){return!!t&&!d(t.textName)};var n=e.prototype;return n.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var n=this._getRenderContainerPoints();if(V(n)){var i=this.style,r=this.strokeAndFill,a=Oe(this.style.textName,this.geometry.getProperties());this._descText(a),this._prepareContext(t),this.prepareCanvas(t,r,e),un.prepareCanvasFont(t,i);for(var o=0,s=n.length;o<s;o++){var u=n[o],h=this._rotate(t,u,this._getRotationAt(o));h&&(u=h),un.text(t,a,u,i,this.textDesc),h&&t.restore()}}}},n.getPlacement=function(){return this.symbol.textPlacement},n.getRotation=function(){var t=this.style.textRotation;return p(t)?-t*Math.PI/180:null},n.getDxDy=function(){var t=this.style;return new ce(t.textDx,t.textDy)},n.getFixedExtent=function(){var t=this.getDxDy(),e=this.style,n=this.textDesc.size,i=je(n,e.textHorizontalAlignment,e.textVerticalAlignment),r=i.x,a=i.y;if(e.textHaloRadius){var o=e.textHaloRadius;n=n.add(2*o,2*o)}var s=new Gn(t.add(r,a),t.add(r+n.width,a+n.height)),u=this.getRotation();return u&&(s=this._rotateExtent(s,u)),s},n.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:D(t.textFaceName,"monospace"),textWeight:D(t.textWeight,"normal"),textStyle:D(t.textStyle,"normal"),textSize:D(t.textSize,10),textFont:D(t.textFont,null),textFill:D(t.textFill,"#000"),textOpacity:D(t.textOpacity,1),textHaloFill:D(t.textHaloFill,"#ffffff"),textHaloRadius:D(t.textHaloRadius,0),textHaloOpacity:D(t.textHaloOpacity,1),textWrapWidth:D(t.textWrapWidth,null),textWrapCharacter:D(t.textWrapCharacter,"\n"),textLineSpacing:D(t.textLineSpacing,0),textDx:D(t.textDx,0),textDy:D(t.textDy,0),textHorizontalAlignment:D(t.textHorizontalAlignment,"middle"),textVerticalAlignment:D(t.textVerticalAlignment,"middle"),textAlign:D(t.textAlign,"center"),textRotation:D(t.textRotation,0),textMaxWidth:D(t.textMaxWidth,0),textMaxHeight:D(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},n.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},n._descText=function(t){this._dynamic?this.textDesc=this._measureText(t):(this.textDesc=this._loadFromCache(),this.textDesc||(this.textDesc=this._measureText(t),this._storeToCache(this.textDesc)))},n._measureText=function(t){var e=this.style.textMaxHeight,n=Ce(t,this.style);return e&&e<n.size.height&&(n.size.height=e),n},n._storeToCache=function(t){P||(this.geometry[Bi]||(this.geometry[Bi]={}),this.geometry[Bi][this._cacheKey]={desc:t,active:!0})},n._loadFromCache=function(){if(!this.geometry[Bi])return null;var t=this.geometry[Bi][this._cacheKey];return t?(t.active=!0,t.desc):null},e}(Ai);Ni.CACHE_KEY=Bi;var Ui,Vi=function(t){function e(e,n,i){var r;d(e.markerWidth)&&(e.markerWidth=80),d(e.markerHeight)&&(e.markerHeight=80),e=f(e,(r=t.call(this,e,n,i)||this).translate());var a=r.style=r._defineStyle(e);return oe.gecko?r._url=[Tt(a,a.markerWidth,a.markerHeight),a.markerWidth,a.markerHeight]:r._url=[Tt(a),a.markerWidth,a.markerHeight],r}se(e,t),e.test=function(t){return!!t&&!(!d(t.markerFile)||"path"!==t.markerType)};var n=e.prototype;return n._prepareContext=function(){},n._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,i=new Image;return i.onload=function(){var t=n.getLayer()&&n.getLayer().getRenderer();t&&t.setToRedraw()},i.onerror=function(n){t.markErrorResource(e._url)},i.src=this._url[0],t&&t.addResource(this._url,i),i},e}(Ii),Gi={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Hi=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=n.getLayer().options.drawAltitude,r.style&&v(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}se(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var n=e.getJSONType();return"Marker"===n||"LineString"===n};var n=e.prototype;return n.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude){var n=this.geometry.getProperties();if(n&&n[e.options.altitudeProperty]){var i=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var r=this._getPaintParams(i.lineDx,i.lineDy);if(!r)return;var a=this.getPainter().getPaintParams(i.lineDx,i.lineDy,!0)[0];this._drawLineAltitude(t,r[0],a)}else{var o=this._getRenderContainerPoints(),s=this._getRenderContainerPoints(!0);if(!o||0===o.length)return;this._drawMarkerAltitude(t,o[0],s[0])}}}},n.getDxDy=function(){var t=this.dxdy;return new ce(t.dx||0,t.dy||0)},n.get2DExtent=function(){return"LineString"===this.geometry.type?zi.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},n.getPlacement=function(){return"point"},n._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0)},n._drawMarkerAltitude=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i),un.path(t,[e,n],i.lineOpacity,null,i.lineDasharray)},n._drawLineAltitude=function(t,e,n){var i=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],n[r]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])},n._drawLine=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i);for(var r=0,a=e.length-1;r<a;r++)un.polygon(t,[e[r],e[r+1],n[r+1],n[r]],i.lineOpacity,i.polygonOpacity,i.lineDasharray)},n._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return v(t)||(t=Gi),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},e}(Ai),Zi=Object.freeze({Symbolizer:Ti,CanvasSymbolizer:Mi,DebugSymbolizer:Ri,ImageMarkerSymbolizer:Ii,PointSymbolizer:Ai,StrokeAndFillSymbolizer:zi,TextMarkerSymbolizer:Ni,VectorMarkerSymbolizer:Li,VectorPathMarkerSymbolizer:Vi,DrawAltitudeSymbolizer:Hi}),Wi=[Hi,zi,Ii,Vi,Li,Ni],Xi=new ce(0,0),qi=new ce(0,0),Yi=new ce(0,0),Ji=new Gn,Ki=new Gn,Qi=new Gn,$i=new Gn,tr=new Gn,er=function(t){function e(e){var n;return(n=t.call(this)||this).geometry=e,n.symbolizers=n._createSymbolizers(),n._altAtGLZoom=n._getGeometryAltitude(),n}se(e,t);var n=e.prototype;return n.getMap=function(){return this.geometry.getMap()},n.getLayer=function(){return this.geometry.getLayer()},n._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=Wi,i=t;Array.isArray(t)||(i=[t]);for(var r=i.length-1;r>=0;r--)for(var a=i[r],o=n.length-1;o>=0;o--)if(n[o].test(a,this.geometry)){var s=new n[o](a,this.geometry,this);e.push(s),s instanceof Ai&&(this._hasPoint=!0)}return!e.length&&console&&this.geometry.getId(),this._debugSymbolizer=new Ri(t,this.geometry,this),e},n.hasPoint=function(){return!!this._hasPoint},n.getRenderPoints=function(t){return this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},n.getPaintParams=function(t,e,n){var i=this.getMap(),r=this.geometry,a=i.getResolution(),o=0!==i.getPitch(),s=0!==i.getBearing(),u=this._cachedParams,h=r._paintAsPath&&r._paintAsPath();if(h&&this._unsimpledParams&&a<=this._unsimpledParams._res)u=this._unsimpledParams;else if(!u||u._res!==i.getResolution()||this._pitched!==o&&r._redrawWhenPitch()||this._rotated!==s&&r._redrawWhenRotate()){if(!(u=r._getPaintParams()))return null;u._res=a,!r._simplified&&h&&(this._unsimpledParams||(this._unsimpledParams=u),a>this._unsimpledParams._res&&(this._unsimpledParams._res=a)),this._cachedParams=u}if(!u)return null;this._pitched=o,this._rotated=s;var c=i.getGLScale(),l=[],f=u[0],d=i.getContainerExtent(),g=this._pointContainerPoints(f,t,e,n,this._hitPoint&&!d.contains(this._hitPoint));if(!g)return null;l.push(g);for(var v=1,m=u.length;v<m;v++)p(u[v])||u[v]instanceof le?p(u[v])?l.push(u[v]/c):l.push(u[v].multi(1/c)):l.push(u[v]);return l},n._pointContainerPoints=function(t,e,n,i,r,a){if(this._aboveCamera())return null;var o,s=this.getMap(),u=s.getGLZoom(),h=this.containerOffset;function c(t,i){var r=s._pointToContainerPoint(t,u,i)._sub(h);return(e||n)&&r._add(e||0,n||0),r}var l=this.getAltitude();if(Array.isArray(t)){var f,d=this.geometry,p=(f=!r&&d.options.enableClip?this._clip(t,l):{points:t,altitude:l}).points;l=f.altitude,i&&(l=0);var g=l;o=[];for(var v=0,m=p.length;v<m;v++){var y=p[v];if(Array.isArray(y)){for(var _=[],b=0,w=y.length;b<w;b++){var x=y[b];Array.isArray(l)&&(g=l[v]?l[v][b]:0),_.push(c(x,g))}o.push(_)}else Array.isArray(l)&&(g="vertex-last"===a?l[l.length-1-v]:"line"===a?(l[v]+l[v+1])/2:l[v]),o.push(c(y,g))}}else t instanceof ce&&(i&&(l=0),o=s._pointToContainerPoint(t,u,l)._sub(h),(e||n)&&o._add(e,n));return o},n._clip=function(t,e){var n=this.getMap(),i=this.geometry,r=this.getSymbol().lineWidth;p(r)||(r=4);var a=n._get2DExtent(void 0,$i)._expand(r);if(n.getPitch()>0&&e){var o=n.cameraLookAt,s=n.cameraPosition;Xi.set(s.x,s.y),a=a._combine(Xi._add(F(o[0]-s[0]),F(o[1]-s[1])))}var u=t;if(this.get2DExtent(null,tr).within(a))return{points:u,altitude:e};var h=n._get2DExtent(n.getGLZoom(),$i)._expand(r/n._glScale),c=i.options.smoothness;if(i.getShell&&this.geometry.getHoles&&!c)if(Array.isArray(t[0])){u=[];for(var l=0;l<t.length;l++){var f=ji(t[l],h);f.length&&u.push(f)}}else u=ji(t,h);else if("LineString"===i.getJSONType()){if(Array.isArray(t[0])){u=[];for(var d=0;d<t.length;d++)L(u,xi(t[d],h,!1,!!c))}else u=xi(t,h,!1,!!c);return this._interpolateSegAlt(u,t,e)}return{points:u,altitude:e}},n._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var i=function(t){return t.point};return{points:t.map((function(t){return Array.isArray(t)?t.map(i):t.point})),altitude:n}}var r=function t(e,n,i){if(!Array.isArray(i))return e;for(var r=[],a=0,o=e.length;a<o;a++)if(Array.isArray(e[a]))r.push(t(e[a],n,i));else{var s=e[a];if(s.point.equals(n[s.index]))s.altitude=i[s.index],r.push(s);else{var u=void 0,h=void 0;0===s.index?(u=s.index,h=s.index+1):(u=s.index-1,h=s.index);var c=s.point.distanceTo(n[h]),l=c/(c+n[u].distanceTo(s.point)),f=B(i[u],i[h],1-l);s.altitude=f,r.push(s)}}return r}(t,e,n);return n=[],{points:r.map((function(t){if(Array.isArray(t)){var e=[],i=t.map((function(t){return e.push(t.altitude),t.point}));return n.push(e),i}return n.push(t.altitude),t.point})),altitude:n}},n.getSymbol=function(){return this.geometry._getInternalSymbol()},n.paint=function(t,e,n){if(this.symbolizers){var i=this.getLayer()._getRenderer();if(i&&(i.context||e)&&(!t||t.intersects(this.get2DExtent(i.resources,Ji)))){var r=this.getMap(),a=this.getMinAltitude(),o=r.getFrustumAltitude();if(!(a&&o&&o<a)){this.containerOffset=n||r._pointToContainerPoint(i.southWest)._add(0,-r.height),this._beforePaint();for(var s=e||i.context,u=[s,i.resources],h=this.symbolizers.length-1;h>=0;h--)this._prepareShadow(s,this.symbolizers[h].symbol),this.symbolizers[h].symbolize.apply(this.symbolizers[h],u);this._afterPaint(),this._painted=!0,this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,u)}}}},n.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new Gn;this.symbolizers.forEach((function(e){var i=e.getFixedExtent(t);n._combine(i)}));var i,r=n.getMin().multi(-1),a=e||(this.getMap()?this.getMap().CanvasClass:null),o=un.createCanvas(n.getWidth(),n.getHeight(),a);this._renderPoints&&(i=this._renderPoints);for(var s=o.getContext("2d"),u=[s,t],h=this.symbolizers.length-1;h>=0;h--){var c=this.symbolizers[h].getDxDy();this._renderPoints={center:[[r.add(c)]]},this._prepareShadow(s,this.symbolizers[h].symbol),this.symbolizers[h].symbolize.apply(this.symbolizers[h],u)}i&&(this._renderPoints=i),this._sprite={canvas:o,offset:n.getCenter()}}return this._spriting=!1,this._sprite},n.isSpriting=function(){return!!this._spriting},n.hitTest=function(t,e){(!e||e<.5)&&(e=.5),Ui||(Ui=un.createCanvas(1,1)),un.setHitTesting(!0),Ui.width=Ui.height=2*e;var n=Ui.getContext("2d");this._hitPoint=t.sub(e,e);try{this.paint(null,n,this._hitPoint)}catch(t){throw t}finally{un.setHitTesting(!1)}delete this._hitPoint;for(var i=n.getImageData(0,0,Ui.width,Ui.height).data,r=3,a=i.length;r<a;r+=4)if(i[r]>0)return!0;return!1},n.isHitTesting=function(){return!!this._hitPoint},n._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},n._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},n.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=n.getZoom();if((!this._extent2D||this._extent2D._zoom!==i)&&(delete this._extent2D,delete this._fixedExtent,this.symbolizers)){for(var r=this._extent2D=new Gn,a=this._fixedExtent=new Gn,o=this.symbolizers.length-1;o>=0;o--){var s=this.symbolizers[o];r._combine(s.get2DExtent()),s.getFixedExtent&&a._combine(s.getFixedExtent(t))}r._zoom=i}return this._extent2D?e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(this._fixedExtent),e):this._extent2D.add(this._fixedExtent):null},n.getContainerExtent=function(t){if(this._aboveCamera())return null;this._verifyProjection();var e=this.getMap(),n=e.getZoom(),i=e._glScale;this._extent2D&&this._extent2D._zoom===n||this.get2DExtent(null,Ki);var r=this.getMinAltitude(),a=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,n,r/i,Xi)}),t),o=this.getMaxAltitude();if(o!==r){var s=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,n,o/i,Xi)}),Ki);a._combine(s)}var u=this.geometry.getLayer();if("LineString"===this.geometry.type&&o&&u.options.drawAltitude){var h=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,n,0,Xi)}),Ki);a._combine(h)}return a&&a._add(this._fixedExtent),this.geometry.options.smoothness&&a._expand(.15*a.getWidth()),a},n._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap().getFrustumAltitude();return t&&e&&e<t},n.getFixedExtent=function(){var t=this.getMap().getZoom();return this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,Qi),this._fixedExtent},n.setZIndex=function(t){this._eachSymbolizer((function(e){e.setZIndex(t)}))},n.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(t){t.show()}))):this.getLayer().isCanvasRender()||this.paint()},n.hide=function(){this._eachSymbolizer((function(t){t.hide()}))},n.repaint=function(){this._altAtGLZoom=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},n.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.remove=function(){this.removeCache(),this._removeSymbolizers()},n._removeSymbolizers=function(){this._eachSymbolizer((function(t){delete t.painter,t.remove()})),delete this.symbolizers},n.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams,this.geometry&&delete this.geometry[Ni.CACHE_KEY]},n.getAltitude=function(){return this._getAltitudeProperty()!==this._propAlt&&(this._altAtGLZoom=this._getGeometryAltitude()),this._altAtGLZoom?this._altAtGLZoom:0},n.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n._getGeometryAltitude=function(){var t=this;if(!this.getMap())return 0;var e=this._getAltitudeProperty();if(this._propAlt=e,!e)return this.minAltitude=this.maxAltitude=0,0;var n=this.geometry.getCenter();return n?Array.isArray(e)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,e.map((function(e){var i=t._meterToPoint(n,e);return i<t.minAltitude&&(t.minAltitude=i),i>t.maxAltitude&&(t.maxAltitude=i),i}))):(this.minAltitude=this.maxAltitude=this._meterToPoint(n,e),this.minAltitude):0},n._meterToPoint=function(t,e){var n=this.getMap(),i=n.getGLZoom(),r=n.locate(t,e,0),a=n.coordToPoint(t,i,qi),o=n.coordToPoint(r,i,Yi);return Math.abs(o.x-a.x)*F(e)},n._getAltitudeProperty=function(){var t=this.geometry,e=t.getLayer().options,n=t.getProperties();return e.enableAltitude&&n?n[e.altitudeProperty]:0},n._verifyProjection=function(){var t=this.geometry._getProjection();this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},n._beforePaint=function(){var t=this.geometry[Ni.CACHE_KEY];if(t)for(var e in t)b(t,e)&&(t[e].active=!1)},n._afterPaint=function(){var t=this.geometry[Ni.CACHE_KEY];if(t)for(var e in t)b(t,e)&&(t[e].active||delete t[e])},e}(wn),nr=new Gn,ir=function(t){function e(e){var n;return(n=t.call(this)||this).geometry=e,n}se(e,t);var n=e.prototype;return n._eachPainter=function(t){for(var e,n=this.geometry.getGeometries(),i=0,r=n.length;i<r&&(!(e=n[i]._getPainter())||!e||!1!==t.call(this,e));i++);},n.paint=function(t){this.geometry&&this._eachPainter((function(e){e.paint(t)}))},n.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new Gn;return this._eachPainter((function(e){n=n._combine(e.get2DExtent(t,nr))})),n},n.getContainerExtent=function(){var t=new Gn;return this._eachPainter((function(e){t=t.combine(e.getContainerExtent())})),t},n.remove=function(){var t=arguments;this._eachPainter((function(e){e.remove.apply(e,t)}))},n.setZIndex=function(){var t=arguments;this._eachPainter((function(e){e.setZIndex.apply(e,t)}))},n.show=function(){var t=arguments;this._eachPainter((function(e){e.show.apply(e,t)}))},n.hide=function(){var t=arguments;this._eachPainter((function(e){e.hide.apply(e,t)}))},n.repaint=function(){var t=arguments;this._eachPainter((function(e){e.repaint.apply(e,t)}))},n.refreshSymbol=function(){var t=arguments;this._eachPainter((function(e){e.refreshSymbol.apply(e,t)}))},n.hasPoint=function(){var t=!1;return this._eachPainter((function(e){return!e.hasPoint()||(t=!0,!1)})),t},n.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter((function(n){var i=n.getMinAltitude();(t||i<e)&&(t=!1,e=i)})),e},n.getMaxAltitude=function(){var t=0;return this._eachPainter((function(e){var n=e.getMaxAltitude();n>t&&(t=n)})),t},e}(wn),rr=function(t){function e(e){var n,i=f({},e),r=i.symbol,a=i.properties,o=i.id;return delete i.symbol,delete i.id,delete i.properties,n=t.call(this,i)||this,r&&n.setSymbol(r),a&&n.setProperties(a),d(o)||n.setId(o),n}se(e,t);var n=e.prototype;return n.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},n.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},n.addTo=function(t,e){return t.addGeometry(this,e),this},n.getLayer=function(){return this._layer?this._layer:null},n.getMap=function(){return this._layer?this._layer.getMap():null},n.getId=function(){return this._id},n.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},n.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.setProperties=function(t){var e=this.properties;return this.properties=v(t)?f({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},n.getType=function(){return this.type},n.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?It(t):f({},t):null},n.setSymbol=function(t){return this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();return e=It(e||this._getInternalSymbol(),t),this.setSymbol(e)},n.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.getExtent=function(){var t=this._getPrjExtent();if(t){var e=this._getProjection(),n=e.unproject(new Tn(t.xmin,t.ymin)),i=e.unproject(new Tn(t.xmax,t.ymax));return new Vn(n,i,this._getProjection())}return this._computeExtent(this._getMeasurer())},n.getContainerExtent=function(t){var e=this._getPainter();return e?e.getContainerExtent(t):null},n.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},n.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof Tn&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},n._containsPoint=function(t,e){var n=this._getPainter();return!!n&&(d(e)&&this._hitTestTolerance&&(e=this._hitTestTolerance()),n.hitTest(t,e))},n.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},n.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(d(t[e].opacity)||t[e].opacity>0)return!0;return!1}return d(t.opacity)||p(t.opacity)&&t.opacity>0},n.getZIndex=function(){return this.options.zIndex||0},n.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},n.setZIndexSilently=function(t){return this.options.zIndex=t,this},n.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},n.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},n.translate=function(t,e){if(d(t))return this;var n=new Tn(t,e);if(0===n.x&&0===n.y)return this;var i=this.getCoordinates();if(i)if(Array.isArray(i)){var r=I(i,(function(t){return t.add(n)}));this.setCoordinates(r)}else this.setCoordinates(i.add(n));return this},n.flash=function(t,e,n,i){return et.call(this,t,e,n,i)},n.copy=function(){var t=this.toJSON(),n=e.fromJSON(t);return n.options.visible=!0,n},n.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(d(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var i,r=this.getId();return d(r)||(e.id=r),(d(t.properties)||t.properties)&&(i=this._exportProperties()),e.properties=i,e},n.toJSON=function(t){t||(t={});var e=this._toJSON(t);return f(e,this._exportGraphicOptions(t)),e},n.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.rotate=function(t,e){if("GeometryCollection"===this.type)return this.getGeometries().forEach((function(n){return n.rotate(t,e)})),this;e=e?new Tn(e):this.getCenter();var n=this._getMeasurer(),i=this.getCoordinates();if(!Array.isArray(i)){if(e.x!==i.x||e.y!==i.y){var r=n._rotate(i,e,t);this.setCoordinates(r)}return this}return I(i,(function(i){return n._rotate(i,e,t)})),this.setCoordinates(i),this},n._getConnectPoints=function(){return[this.getCenter()]},n._initOptions=function(t){var e=f({},t),n=e.symbol,i=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),i&&this.setProperties(i),d(r)||this.setId(r)},n._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._clearProjection()},n._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(Et(this._checkAndCopySymbol(t[n])));return e}return t?Et(t=this._checkAndCopySymbol(t)):null},n._checkAndCopySymbol=function(t){var e={};for(var n in t)h[n]&&m(t[n])?e[n]=+t[n]:e[n]=t[n];return e},n._getSymbol=function(){return this._symbol},n._setExternSymbol=function(t){return this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},n._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._clearHandlers(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n._getInternalId=function(){return this._internalId},n._setInternalId=function(t){this._internalId=t},n._getMeasurer=function(){return this._getProjection()?this._getProjection():vi.getProjectionInstance(this.options.defaultProjection)},n._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n._verifyProjection=function(){var t=this._getProjection();!this._projCode||t&&this._projCode===t.code||this._clearProjection(),this._projCode=t?t.code:null},n._getExternalResources=function(){return Mt(this._getInternalSymbol())},n._getPainter=function(){return!this._painter&&this.getMap()&&(-1!==a.indexOf(this.type)?this._painter=new ir(this):this._painter=new er(this)),this._painter},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n._paint=function(t){this._painter&&this._painter.paint(t)},n._clearCache=function(){delete this._extent},n._clearProjection=function(){delete this._extent},n._repaint=function(){this._painter&&this._painter.repaint()},n.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol(),this._fireEvent("symbolchange")},n.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var i in t)if(t.hasOwnProperty(i)){var r=i.slice(0,5);if("arrow"===r||"smoot"===r){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},n._setParent=function(t){t&&(this._parent=t)},n._getParent=function(){return this._parent},n._fireEvent=function(t,e){this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e)},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},n._exportGraphicOptions=function(t){var e={};return(d(t.options)||t.options)&&(e.options=this.config()),(d(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(d(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Tn.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._exportProperties=function(){var t=null,e=this.getProperties();return d(e)||(t=v(e)?f({},e):e),t},e}(On(yn(jn(wn))));rr.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,defaultProjection:"EPSG:4326"});var ar="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",or=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;en(e,ar,this._identifyGeometryEvents,this)},n.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;nn(e,ar,this._identifyGeometryEvents,this)},n._identifyGeometryEvents=function(t,e){var n=this.target;if(!n.isInteracting()&&!n._ignoreEvent(t)){var i=n._getLayers((function(t){return!(!t.identify||!t.options.geometryEvents)}));if(i.length){var r=null,a=e||t.type;if("mousedown"===a||"touchstart"===a&&1===t.touches.length)this._mouseDownTime=l();else if(("click"===a||"touchend"===a)&&this._mouseDownTime){var o=this._mouseDownTime;if(delete this._mouseDownTime,l()-o>300){if("click"===a)return}else"touchend"===a&&(r="click")}var s=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(s){var u=Ze(s,n._containerDOM),h=n.containerPointToCoordinate(u);"touchstart"===a&&Ne(t);var c=null,f={includeInternals:!0,filter:function(e){if(!(e instanceof rr))return!1;var n=e._getEventTypeToFire(t);if("mousemove"===a){if(!c&&e.options.cursor&&(c=e.options.cursor),!e.listens("mousemove")&&!e.listens("mouseover")&&!e.listens("mouseenter"))return!1}else if(!e.listens(n)&&!e.listens(r))return!1;return!0},count:1,coordinate:h,onlyVisible:n.options.onlyVisibleGeometryEvents,layers:i},d=function(e){var i=!0;if("mousemove"===a){var o={};if(e.length>0)for(var s=e.length-1;s>=0;s--){var u=e[s];if(u instanceof rr){var h=u._getInternalId();o[h]=u,u._onEvent(t),this._prevOverGeos&&this._prevOverGeos.geomap[h]||u._onEvent(t,"mouseenter"),i=u._onEvent(t,"mouseover")}}n._setPriorityCursor(c);var l=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:e,geomap:o},l&&l.length>0)for(var f=l.length-1;f>=0;f--){var d=l[f];if(d instanceof rr)o[l[f]._getInternalId()]||(i=d._onEvent(t,"mouseout"))}}else{if(!e||!e.length)return;for(var p=e.length-1;p>=0;p--)if(e[p]instanceof rr){i=e[p]._onEvent(t),r&&e[p]._onEvent(t,r);break}}!1===i&&Ue(t)}.bind(this);"mousemove"===a||"touchmove"===a?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame((function(){n.isInteracting()||n.identify(f,d)})):n.identify(f,d)}}}},e}(bn);yi.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),yi.addOnLoadHook("addHandler","geometryEvents",or);var sr=.01,ur=1/450,hr=function(t){function e(e){var n;return(n=t.call(this,e)||this)._thisScrollZoom=n._scrollZoom.bind(ue(ue(n))),n._wheelZoomRate=ur,n._defaultZoomRate=sr,n._delta=0,n}se(e,t);var n=e.prototype;return n.addHooks=function(){Fe(this.target._containerDOM,"mousewheel",this._onWheelScroll,this)},n.removeHooks=function(){ze(this.target._containerDOM,"mousewheel",this._onWheelScroll)},n._onWheelScroll=function(t){Ne(t),Ue(t);var e=this.target;if(e._ignoreEvent(t)||!e.options.zoomable)return!1;var n=e._containerDOM,i=e._checkZoomOrigin(Ze(t,n));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,i)):this._interval(t,i)},n._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(n%4.000244140625!=0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n/=4),this._lastWheelEvent=t,this._delta-=n,!this._zooming&&this._delta){var i=this.target;this._zoomOrigin=e,i.onZoomStart(null,e)}this._start()},n._start=function(){if(this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},n._scrollZoom=function(){var t=this;if(this._active=!1,this._delta){var e=Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);var i=this.target,r=i.getZoom(),a=i.getZoomForScale(n,r,!0);this._delta=0,i.onZooming(a,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){t._zooming=!1,delete t._timeout,i.onZoomEnd(i.getZoom(),t._zoomOrigin)}),320)}},n._interval=function(t,e){var n=this,i=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var a=i.getZoom(),o=a+r;return(o=i._checkZoom(r>0?Math.ceil(o):Math.floor(o)))!==a&&(this._zooming=!0,this._delta||(i.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=i.getZoom()),i._animateTo({zoom:o-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(e){"finished"===e.state.playState&&(n._requesting<1||Math.abs(o-n._startZoom)>2||o===i.getMaxZoom()||o===i.getMinZoom()?(i._animateTo({zoom:o,around:n._origin},{continueOnViewChanged:!0,duration:100},(function(t){"finished"===t.state.playState&&setTimeout((function(){delete n._zooming,delete n._requesting}),200)})),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):d(n._requesting)||(delete n._zooming,n._onWheelScroll(t)))})),!1)},e}(bn);yi.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!1}),yi.addOnLoadHook("addHandler","scrollWheelZoom",hr);var cr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){Fe(this.target.getContainer(),"touchstart",this._onTouchStart,this)},n.removeHooks=function(){ze(this.target.getContainer(),"touchstart",this._onTouchStart)},n._onTouchStart=function(t){var e=this.target;if(t.touches&&2===t.touches.length&&!e.isInteracting()){var n=e.getContainer(),i=Ze(t.touches[0],n),r=Ze(t.touches[1],n);this.preY=i.y,this._startP1=i,this._startP2=r,this._startDist=i.distanceTo(r),this._startVector=i.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),Fe(document,"touchmove",this._onTouchMove,this),Fe(document,"touchend",this._onTouchEnd,this),Ne(t),e._fireEvent("touchactstart")}},n._onTouchMove=function(t){var e=this.target;if(t.touches&&2===t.touches.length){var n=e.getContainer(),i=Ze(t.touches[0],n),r=Ze(t.touches[1],n),a=i.sub(this._startP1),o=r.sub(this._startP2),s=i.sub(r),u=i.distanceTo(r)/this._startDist,h=180*s.angleWith(this._startVector)/Math.PI,c=.4*((this.preY||i.y)-i.y);this.preY=i.y;var l={domEvent:t,mousePos:[i,r]};if(this.mode||(e.options.touchRotate&&Math.abs(h)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&a.y*o.y>0&&Math.abs(a.y)>10&&Math.abs(o.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-u)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(l)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=u;var f=e._getResolution(this._startZoom)/u,d=e.getZoomFromRes(f);e.onZooming(d,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e.setBearing(this._startBearing+h),e.onDragRotating(l)):"pitch"===this.mode&&(e.setPitch(e.getPitch()+c),e.onDragRotating(l)),e._fireEvent("touchactinging")}},n._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var n=e.getSize();this._Origin=new ce(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},n._onTouchEnd=function(t){delete this.preY;var e=this.target;if(nn(document,"touchmove",this._onTouchMove,this),nn(document,"touchend",this._onTouchEnd,this),"zoom"===this.mode||"rotate_zoom"===this.mode){var n=this._scale,i=e._getResolution(this._startZoom)/n,r=e.getZoomFromRes(i);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(bn);yi.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),yi.addOnLoadHook("addHandler","touchGesture",cr);var lr={in:function(t){return Math.pow(t,2)},out:function(t){return 1-lr.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?lr.inAndOut(2*t):1-lr.inAndOut(2*(t-.5))}},fr=function(t,e){this.state=t,this.styles=e},dr=function(t,e,n){this._animation=t,this.options=e,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1},pr={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return pr._resolveStyles(t);for(var e=[],n=[],i=[],r=0;r<t.length;r++){var a=pr._resolveStyles(t[r]);a&&(e.push(a[0]),n.push(a[1]),i.push(a[2]))}return e.length?[e,n,i]:null}function n(t){var e,n=t;Array.isArray(t)||(n=p(t)?[0,t]:t instanceof ce||t instanceof Tn?[new(e=t.constructor)(0,0),t]:[t,t]);var i=n[0],r=n[1];return p(i)&&p(r)?i===r?null:[i,r-i,r]:Array.isArray(i)||i instanceof Tn||i instanceof ce?(Array.isArray(i)?(i=new Tn(i),r=new Tn(r)):(i=new(e=i.constructor)(i),r=new e(r)),i.equals(r)?null:[i,r.sub(i),r]):[i,0,r]}function i(t){return!Array.isArray(t)&&t.constructor===Object||!(!Array.isArray(t)||t[0].constructor!==Object)}var r={},a={},o={};for(var s in t)if(t.hasOwnProperty(s)){var u=t[s];if(!u)continue;if(Array.isArray(u)&&(d(u[0])||d(u[1])))continue;var h;(h=i(u)?e(u):n(u))&&(a[s]=h[0],r[s]=h[1],o[s]=h[2])}return[a,r,o]},framing:function(t,e){e||(e={});var n,i,r,a=e.easing?lr[e.easing]:lr.linear;return a||(a=lr.linear),(t=pr._resolveStyles(t))&&(i=t[0],n=t[1],r=t[2]),function(t,e){var o,s;if(t<0)o={playState:"idle",delta:0},s=i;else if(t<e){var u=a(t/e);o={playState:"running",delta:u},s=function t(e,n,i){if(!n||!i)return null;var a={};for(var o in i)if(i.hasOwnProperty(o)){if(n[o]===r[o]){a[o]=n[o];continue}var s=n[o],u=i[o];if(p(u))a[o]=s+e*u;else if(Array.isArray(u)){for(var h=[],c=0;c<u.length;c++)h.push(t(e,s[c],u[c]));a[o]=h}else u.constructor===Object?a[o]=t(e,s,u):(s instanceof ce||s instanceof Tn)&&(a[o]=s.add(u.multi(e)))}return a}(u,i,n)}else o={playState:"finished",delta:1},s=r;return o.startStyles=i,o.destStyles=r,o.progress=t,o.remainingMs=e-t,new fr(o,s)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=j(pr._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]();this._frameQueue.length?this._animationFrameId=j(pr._frameFn):delete this._animationFrameId}},animate:function(t,e,n){e||(e={});var i=pr.framing(t,e);return new dr(i,e,n)}};pr._frameFn=pr._run.bind(pr),f(dr.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;m(e)&&((e=pr.speed[e])||(e=+e)),e||(e=pr.speed.normal),this.duration=e,this._framer=t.framer||pr._requestAnimFrame.bind(pr)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState)return this;"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=l();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState?this:(this.playState="paused",this._run(),this)},cancel:function(){return"idle"===this.playState?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return"finished"===this.playState?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var t=this,e=this._onFrame,n=l(),i=n-this._playStartTime;if(this.options.repeat&&i>=this.duration&&(this._playStartTime=n,i=0),"running"===this.playState){var r=this._animation(i,this.duration);this.playState=r.state.playState,"idle"===this.playState?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):"running"===this.playState?this._framer((function(){"running"===t.playState&&(t.currentTime=i,e&&e(r),t._run())})):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(e){"finished"===this.playState?i=this.duration:"idle"===this.playState&&(i=0);var a=this._animation(i,this.duration);a.state.playState=this.playState,e(a)}}});var gr=Object.freeze({Animation:pr,Easing:lr,Player:dr,Frame:fr}),vr=gn((function(t){!function(){function e(t,e){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}function n(t,e,n){var i=e.x,r=e.y,a=n.x-i,o=n.y-r;if(0!==a||0!==o){var s=((t.x-i)*a+(t.y-r)*o)/(a*a+o*o);s>1?(i=n.x,r=n.y):s>0&&(i+=a*s,r+=o*s)}return(a=t.x-i)*a+(o=t.y-r)*o}function i(t,e){var i=t.length-1,r=[t[0]];return function t(e,i,r,a,o){for(var s,u=a,h=i+1;h<r;h++){var c=n(e[h],e[i],e[r]);c>u&&(s=h,u=c)}u>a&&(s-i>1&&t(e,i,s,a,o),o.push(e[s]),r-s>1&&t(e,s,r,a,o))}(t,0,i,e,r),r.push(t[i]),r}function r(t,n,r){if(t.length<=2)return t;var a=void 0!==n?n*n:1;return i(t=r?t:function(t,n){for(var i,r=t[0],a=[r],o=1,s=t.length;o<s;o++)e(i=t[o],r)>n&&(a.push(i),r=i);return r!==i&&a.push(i),a}(t,a),a)}t.exports=r,t.exports.default=r}()})),mr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getOutline=function(){var t=this._getPainter();if(!t)return null;var e=this.getMap(),n=t.getContainerExtent().convertTo((function(t){return e.containerPointToCoord(t)}));return new yr(n.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},n.animateShow=function(t,e){var n=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),y(t)&&(e=t={});var i=this.getCoordinates();if(0===i.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=this.getShell?this.getShell().concat(this.getShell()[0]):this.getCoordinates(),a=this._getProjection();this._aniShowCenter=a.unproject(this._getPrjExtent().getCenter());var o=t.duration||1e3,s=this.getLength(),u=t.easing||"out";this.setCoordinates([]);var h=this._showPlayer=pr.animate({t:o},{duration:o,easing:u},(function(t){if(n.getMap()){var a=n._drawAnimShowFrame(t.styles.t,o,s,r);"finished"===t.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,n.setCoordinates(i)),e&&e(t,a)}else if("finished"!==h.playState&&(h.finish(),e)){var u=n.getCoordinates();e(t,u[u.length-1])}}));return h.play(),h},n._drawAnimShowFrame=function(t,e,n,i){if(0===t)return i[0];var r,a,o=this.getMap(),s=t/e*n,u=0;for(r=this._animIdx,a=i.length;r<a-1&&(u=o.computeLength(i[r],i[r+1]),!(this._animLenSoFar+u>s));r++)this._animLenSoFar+=u;if(this._animIdx=r,this._animIdx>=a-1)return this.setCoordinates(i),i[i.length-1];var h=this._animIdx,c=i[h],l=i[h+1],f=(s-this._animLenSoFar)/u;this._animTailRatio=f;var d=c.x+(l.x-c.x)*f,p=c.y+(l.y-c.y)*f,g=new Tn(d,p),v=!!this.getShell;if(!v&&this.options.smoothness>0){var m=i.slice(0,this._animIdx+3);this.setCoordinates(m)}else{var y=i.slice(0,this._animIdx+1);y.push(g),v?this.setCoordinates([this._aniShowCenter].concat(y)):this.setCoordinates(y)}return g},n._getCenterInExtent=function(t,e,n){var i=this.getExtent();if(!t.intersects(i))return null;var r=n(e,t);if(0===r.length)return null;var a=0,o=0,s=0;r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){t.point&&(t=t.point),a+=t.x,o+=t.y,s++})):(t.point&&(t=t.point),a+=t.x,o+=t.y,s++)}));var u=new Tn(a,o)._multi(1/s);return u.count=s,u},n._getPath2DPoints=function(t,e,n){if(!V(t))return[];var i=this.getMap(),r=!e&&this._shouldSimplify(),a=this.options.simplifyTolerance*i._getResolution(),o=Array.isArray(t[0]);if(delete this._simplified,r&&!o){var s=t.length;t=vr(t,a,!1),this._simplified=t.length<s}return d(n)&&(n=i.getZoom()),I(t,(function(t){return i._prjToPoint(t,n)}))},n._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),n=e&&t.options.enableAltitude&&!d(e[t.options.altitudeProperty]);return t&&t.options.enableSimplify&&!n&&this.options.enableSimplify&&!this._showPlayer},n._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},n._getPrjCoordinates=function(){return this._getProjection()?(this._verifyProjection(),this._prjCoords||(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords):null},n._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},n._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},n._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},n._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},n._computeCenter=function(){var t=this._coordinates;if(!V(t))return null;for(var e=0,n=0,i=0,r=t.length,a=0;a<r;a++)t[a]&&p(t[a].x)&&p(t[a].y)&&(e+=t[a].x,n+=t[a].y,i++);return new Tn(e/i,n/i)},n._computeExtent=function(){var t=this._coordinates;if(!V(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},n._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},n._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,i=t.length;n<i;n++)e+=t[n].distanceTo(t[n-1]);return e},n._hitTestTolerance=function(){var t,e=this._getInternalSymbol();if(Array.isArray(e)){t=0;for(var n=0;n<e.length;n++)p(e[n].lineWidth)&&e[n].lineWidth>t&&(t=e[n].lineWidth)}else t=e.lineWidth;return p(t)?t/2:1.5},n._coords2Extent=function(t,e){for(var n=new Vn(e),i=0,r=t.length;i<r;i++)for(var a=0,o=t[i].length;a<o;a++)n._combine(t[i][a]);return n},e}(rr);mr.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var yr=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Polygon",e&&i.setCoordinates(e),i}se(e,t);var n=e.prototype;return n.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=Tn.toCoordinates(t),n=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),n>1){for(var i=[],r=1;r<n;r++)e[r]&&i.push(this._trimRing(e[r]));this._holes=i}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},n.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,i=t.length;n<i;n++)e.push(this._copyAndCloseRing(t[n]));return e},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),ji)},n.getShell=function(){return this._coordinates||[]},n.getHoles=function(){return this._holes||[]},n.hasHoles=function(){return this.getHoles().length>0},n._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},n._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},n._checkRing=function(t){if(this._cleanRing(t),!t||!V(t))return!1;var e=t[t.length-1],n=!0;return t[0].x===e.x&&t[0].y===e.y||(n=!1),n},n._trimRing=function(t){var e=this._checkRing(t);return V(t)&&e&&t.splice(t.length-1,1),t},n._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return V(t)&&!e?(t.push(t[0].copy()),t):t},n._getPrjShell=function(){return"Polygon"===this.getJSONType()?this._getPrjCoordinates():this._getProjection()?(this._verifyProjection(),this._prjShell||(this._prjShell=this._projectCoords(this.getShell())),this._prjShell):null},n._getPrjHoles=function(){return this._getProjection()?(this._verifyProjection(),this._prjHoles||(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles):null},n._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!V(e))return 0;for(var n=0,i=0,r=e.length;i<r;i++)n+=t.measureLength(e[i]);return n},n._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!V(e))return 0;for(var n=t.measureArea(e[0]),i=1,r=e.length;i<r;i++)n-=t.measureArea(e[i]);return n},n._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},n._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},n._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(mr);function _r(t){return function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){var e=t instanceof Tn?t:new Tn(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},n._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var n=d(t)?e.getZoom():e.getGLZoom(),i=this._getPrjCoordinates();return i?e._prjToPoint(i,n):null},n._getPrjCoordinates=function(){var t=this._getProjection();return t?(this._verifyProjection(),this._pcenter||this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter):null},n._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},n._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}yr.registerJSONType("Polygon");var br=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Point",e&&i.setCoordinates(e),i}se(e,t);var n=e.prototype;return n.getOutline=function(){var t=this._getPainter();if(!t)return null;var n=this.getCoordinates(),i=t.getContainerExtent(),r=this.getMap().coordToContainerPoint(n);return new e(n,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(r.x-i.getWidth()/2),markerDy:i.ymin-(r.y-i.getHeight()/2)}})},n._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&Li.test(t)},n._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(Li.test(t)||Vi.test(t)||Ii.test(t))},n._containsPoint=function(e,n){var i=this.getContainerExtent();return n&&(i=i.expand(n)),!!i.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,n))},n._computeExtent=function(){return wr.call(this,"getCenter")},n._computePrjExtent=function(){return wr.call(this,"_getPrjCoordinates")},n._computeGeodesicLength=function(){return 0},n._computeGeodesicArea=function(){return 0},n._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new er(this).getSprite(t,e)},e}(_r(rr));function wr(t){var e=this[t]();return e?new Vn(e,e,this._getProjection()):null}br.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),br.registerJSONType("Marker");var xr=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="LineString",e&&i.setCoordinates(e),i}se(e,t);var n=e.prototype;return n.setCoordinates=function(t){return t?(this._coordinates=Tn.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},n.getCoordinates=function(){return this._coordinates||[]},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),xi)},n._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},n._computeGeodesicArea=function(){return 0},e}(mr);xr.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),xr.registerJSONType("LineString");var Or=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="GeometryCollection",i.setGeometries(e),i}se(e,t);var n=e.prototype;return n.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),i=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(i),e[r]._setParent(this),e[r]._setEventParent(this),n&&e[r].setSymbol(n);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},n.getGeometries=function(){return this._geometries||[]},n.forEach=function(t,e){for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i]&&(e?t.call(e,n[i],i):t(n[i],i));return this},n.filter=function(t,n){if(!t)return new e;var i=[],r=y(t),a=r?t:it(t);return this.forEach((function(t){var e=r?t:ft(t);(n?a.call(n,e):a(e))&&i.push(t)}),this),new e(i)},n.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach((function(t){t&&t.translate&&t.translate.apply(t,e)})),this},n.isEmpty=function(){return!V(this.getGeometries())},n.remove=function(){return this.forEach((function(t){t._unbind()})),rr.prototype.remove.apply(this,arguments)},n.show=function(){return this.options.visible=!0,this.forEach((function(t){t.show()})),this},n.hide=function(){return this.options.visible=!1,this.forEach((function(t){t.hide()})),this},n.onConfig=function(t){this.forEach((function(e){e.config(t)}))},n.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var n=[],i=!1;this.forEach((function(t){t.getSymbol()&&!i&&(i=!0),n.push(t.getSymbol())})),i&&(e={children:n})}return e},n.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach((function(e,n){e.setSymbol(t.children[n])}));else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach((function(t){t.setSymbol(e)}))}return this.onSymbolChanged(),this},n._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach((function(e){e._setExternSymbol(t)})),this.onSymbolChanged(),this},n._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},n._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach((function(e){e._bindLayer(t)}))},n._checkGeometries=function(t){if(t&&!Array.isArray(t)){if(t instanceof rr)return[t];throw new Error("The geometry added to collection is invalid.")}for(var e=0,n=t.length;e<n;e++)if(!this._checkGeo(t[e]))throw new Error("The geometry added to collection is invalid. Index: "+e);return t},n._checkGeo=function(t){return t instanceof rr},n._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(t){t&&t._updateCache&&t._updateCache()}))},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(t){t._removePainter()}))},n._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,i=0,r=this.getGeometries(),a=0,o=r.length;a<o;a++)if(r[a]){var s=r[a]._computeCenter(t);s&&(e+=s.x,n+=s.y,i++)}return 0===i?null:new Tn(e/i,n/i)},n._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)if(n[i]._containsPoint(t,e))return!0;return!1},n._computeExtent=function(t){return jr.call(this,t,"_computeExtent")},n._computePrjExtent=function(t){return jr.call(this,t,"_computePrjExtent")},n._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicLength(t));return n},n._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicArea(t));return n},n._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},n._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e]&&t[e]._clearProjection()},n._getConnectPoints=function(){var t=this.getExtent();return[new Tn(t.xmin,t.ymax),new Tn(t.xmax,t.ymin),new Tn(t.xmin,t.ymin),new Tn(t.xmax,t.ymax)]},n._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,n=this.getGeometries(),i=[],r={},a=0,o=n.length;a<o;a++)if(n[a])for(var s=0,u=(t=Mt(n[a]._getInternalSymbol())).length;s<u;s++)r[e=t[s].join()]||(i.push(t[s]),r[e]=1);return i},n.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i].startEdit(t);return this._editing=!0,this.hide(),setTimeout((function(){e.fire("editstart")}),1),this},n.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},n.isEditing=function(){return!!this._editing},e}(rr);function jr(t,e){if(this.isEmpty())return null;for(var n=this.getGeometries(),i=null,r=0,a=n.length;r<a;r++){var o=n[r];if(o){var s=o[e](t);s&&(i=s.combine(i))}}return i}Or.registerJSONType("GeometryCollection");var kr=function(t){function e(e,n,i,r){var a;return(a=t.call(this,null,r)||this).GeometryType=e,a.type=n,a._initData(i),a}se(e,t);var n=e.prototype;return n.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},n.setCoordinates=function(t){for(var e=[],n=0,i=(t=t||[]).length;n<i;n++){var r=new this.GeometryType(t[n],this.config());e.push(r)}return this.setGeometries(e),this},n._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},n._checkGeo=function(t){return t instanceof this.GeometryType},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Tn.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e}(Or),Pr=function(t){function e(e,n){return t.call(this,br,"MultiPoint",e,n)||this}return se(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=null,n=1/0;return this.getCoordinates().forEach((function(i){var r=function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}(i,t);r<n&&(e=i,n=r)})),e},e}(kr);Pr.registerJSONType("MultiPoint");var Cr=function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.prototype.getCenterInExtent=function(t){var e=0,n=0,i=0;return this.getGeometries().forEach((function(r){var a=r.getCenterInExtent(t);a&&(e+=a.x*a.count,n+=a.y*a.count,i+=a.count)})),0===i?null:new Tn(e,n)._multi(1/i)},e}(kr),Tr=function(t){function e(e,n){return t.call(this,xr,"MultiLineString",e,n)||this}return se(e,t),e}(Cr);Tr.registerJSONType("MultiLineString");var Mr=function(t){function e(e,n){return t.call(this,yr,"MultiPolygon",e,n)||this}return se(e,t),e}(Cr);Mr.registerJSONType("MultiPolygon");var Er={Marker:br,LineString:xr,Polygon:yr,MultiPoint:Pr,MultiLineString:Tr,MultiPolygon:Mr},Sr={toGeometry:function(t,e){if(m(t)&&(t=A(t)),Array.isArray(t)){for(var n=[],i=0,r=t.length;i<r;i++){var a=Sr._convert(t[i],e);Array.isArray(a)?L(n,a):n.push(a)}return n}return Sr._convert(t,e)},_convert:function(t,e){if(!t||d(t.type))return null;var n=t.type;if("Feature"===n){var i=t.geometry,r=Sr._convert(i,e);return r?(r.setId(t.id),r.setProperties(t.properties),r):null}if("FeatureCollection"===n){var a=t.features;return a?Sr.toGeometry(a,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var o=new Er["Point"===n?"Marker":n](t.coordinates);return e&&e(o),o}if("GeometryCollection"===n){var s=t.geometries;if(!V(s)){var u=new Or;return e&&e(u),u}for(var h=[],c=s.length,l=0;l<c;l++)h.push(Sr._convert(s[l]));var f=new Or(h);return e&&e(f),f}return null}},Ar=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,e&&r.setCoordinates(e),r._radius=n,r}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getRadius=function(){return this._radius},n.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),a=this.options.numberOfShellPoints,o=this.getRadius(),s=[],u=0,h=a-1;u<h;u++){t=360*u/h*Math.PI/180,e=o*Math.cos(t),n=o*Math.sin(t);var c=i.locate(r,e,n);s.push(c)}return s.push(s[0]),s},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.getPitch())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),a=this.getSize(),o=d(n)?this._hitTestTolerance():n;return Ci(e,r,r.add(a.width/2,a.height/2),o)},n._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),i=e.map((function(e){return t.project(e)})),r=Math.min(Math.abs(i[0].x-n.x),Math.abs(i[1].x-n.x)),a=Math.min(Math.abs(i[2].y-n.y),Math.abs(i[3].y-n.y));return new Vn(n.sub(r,a),n.add(r,a))},n._computeExtent=function(t){var e=this._getMinMax(t);return e?new Vn(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},n._getMinMax=function(t){if(!t||!this._coordinates||d(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},n._computeGeodesicLength=function(){return d(this._radius)?0:2*Math.PI*this._radius},n._computeGeodesicArea=function(){return d(this._radius)?0:Math.PI*Math.pow(this._radius,2)},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Tn.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=this.getCenter(),n=f({},t);n.geometry=!1;var i=this.toGeoJSON(n);return i.geometry={type:"Polygon"},{feature:i,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(_r(yr));Ar.mergeOptions({numberOfShellPoints:60}),Ar.registerJSONType("Circle");var Lr=function(t){function e(e,n,i,r){var a;return a=t.call(this,null,r)||this,e&&a.setCoordinates(e),a.width=n,a.height=i,a}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getWidth=function(){return this.width},n.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},n.getHeight=function(){return this.height},n.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i,r=this._getMeasurer(),a=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getWidth(),u=this.getHeight(),h=[],c=Math.pow(s/2,2)*Math.pow(u/2,2),l=Math.pow(s/2,2),f=Math.pow(u/2,2),d=0;d<o;d++){e=(t=360*d/o)*Math.PI/180,n=Math.sqrt(c/(l*Math.pow(Math.tan(e),2)+f)),i=Math.sqrt(c/(f*Math.pow(1/Math.tan(e),2)+l)),t>90&&t<270&&(n*=-1),t>180&&t<360&&(i*=-1);var p=r.locate(a,n,i);h.push(p)}return h},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i.getProjection(),a=d(n)?this._hitTestTolerance():n,o=r.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)]);return Ci(e,i._prjToContainerPoint(o[0]),i._prjToContainerPoint(o[1]),a)},n._computePrjExtent=function(){return Ar.prototype._computePrjExtent.apply(this,arguments)},n._computeExtent=function(){return Ar.prototype._computeExtent.apply(this,arguments)},n._getMinMax=function(t){if(!t||!this._coordinates||d(this.width)||d(this.height))return null;var e=this.getWidth(),n=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-n/2),t.locate(this._coordinates,0,n/2)]},n._computeGeodesicLength=function(){if(d(this.width)||d(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},n._computeGeodesicArea=function(){return d(this.width)||d(this.height)?0:Math.PI*this.width*this.height/4},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Tn.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=f({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(_r(yr));Lr.mergeOptions({numberOfShellPoints:80}),Lr.registerJSONType("Ellipse");var Rr=function(t){function e(e,n,i,r){var a;return a=t.call(this,null,r)||this,e&&a.setCoordinates(e),a._width=n,a._height=i,a}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){if(this._coordinates=t instanceof Tn?t:new Tn(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},n.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),i=1,r=-1;if(n){var a=n.getFullExtent();a.left>a.right&&(i=-1),a.bottom>a.top&&(r=1)}var o=[];return o.push(e),o.push(t.locate(e,i*this._width,0)),o.push(t.locate(e,i*this._width,r*this._height)),o.push(t.locate(e,0,r*this._height)),o.push(e),o},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._getPrjCoordinates=function(){var t=this._getProjection();return t?(this._verifyProjection(),this._pnw||this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw):null},n._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},n._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),n=this._getProjection();if(!n.isSphere())return e;for(var i=n.getSphereExtent(),r=i.sx,a=i.sy,o=this._getProjection().getCircum(),s=e[0],u=1,h=e.length;u<h;u++){var c=e[u],l=0,f=0;r*(s.x-c.x)>0&&(l=o.x*r),a*(s.y-c.y)<0&&(f=o.y*a),e[u]._add(l,f)}return e},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},n._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=d(n)?this._hitTestTolerance():n,a=i._getResolution()*r,o=this._getPrjExtent().expand(a),s=i._containerPointToPrj(e);return o.contains(s)},n._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new Tn(this._coordinates.x,e.y),new Tn(e.x,this._coordinates.y)]);return new Vn(n[0],n[1])},n._computeExtent=function(t){var e=this._getSouthEast(t);return e?new Vn(this._coordinates,e,this._getProjection()):null},n._getSouthEast=function(t){if(!t||!this._coordinates||d(this._width)||d(this._height))return null;var e=this.getWidth(),n=-this.getHeight();if(t.fullExtent){var i=t.fullExtent;e*=i.right>i.left?1:-1,n*=i.top>i.bottom?1:-1}return t.locate(this._coordinates,e,n)},n._computeGeodesicLength=function(){return d(this._width)||d(this._height)?0:2*(this._width+this._height)},n._computeGeodesicArea=function(){return d(this._width)||d(this._height)?0:this._width*this._height},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Tn.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=f({},t),n=this.getCoordinates();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(yr);Rr.registerJSONType("Rectangle");var Ir=function(t){function e(e,n,i,r,a){var o;return(o=t.call(this,e,n,a)||this).startAngle=i,o.endAngle=r,o}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getStartAngle=function(){return this.startAngle},n.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},n.getEndAngle=function(){return this.endAngle},n.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),a=this.options.numberOfShellPoints-2,o=this.getRadius(),s=[r.copy()],u=this.getStartAngle(),h=this.getEndAngle()-u,c=0;c<a;c++){t=(h*c/(a-1)+u)*Math.PI/180,e=o*Math.cos(t),n=o*Math.sin(t);var l=i.locate(r,e,n);s.push(l)}return s.push(r.copy()),s},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r,a=i._pointToContainerPoint(this._getCenter2DPoint()),o=d(n)?this._hitTestTolerance():n,s=this.getSize(),u=a,h=e,c=h.x-u.x,l=u.y-h.y,f=Math.atan2(l,c),p=f<0?360*(f+2*Math.PI)/(2*Math.PI):360*f/(2*Math.PI),g=this.startAngle%360,v=this.endAngle%360;return r=g>v?!(p>v&&p<g):p>=g&&p<=v,h.distanceTo(u)<=s.width/2+o&&r},n._computeGeodesicLength=function(){return d(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},n._computeGeodesicArea=function(){return d(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},n._toJSON=function(t){var e=f({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(Ar);Ir.mergeOptions({numberOfShellPoints:60}),Ir.registerJSONType("Sector");var Dr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n._arc=function(t,e,n){for(var i=this.options.arcDegree*Math.PI/180,r=1,a=e.length;r<a;r++){var o=un._arcBetween(t,e[r-1],e[r],i),s=[e[r-1].x+e[r].x-o[0],e[r-1].y+e[r].y-o[1]];e[r-1].nextCtrlPoint=s,e[r].prevCtrlPoint=s,un._stroke(t,n)}},n._quadraticCurve=function(t,e){if(e.length<=2)un._path(t,e);else{var n,i;for(n=2,i=e.length;n<i;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if((n-=1)<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._bezierCurve=function(t,e){if(e.length<=3)un._path(t,e);else{var n,i;for(n=1,i=e.length;n+2<i;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._getCurveArrowPoints=function(t,e,n,i,r,a){var o,s=e.length;for(o=a;o<s;o+=a)t.push(this._getArrowShape(e[o-1],e[o],n,i,r));if((o-=a)<s-1)for(o+=1;o<s;o++)t.push(this._getArrowShape(e[o-1],e[o],n,i,r))},e}(xr);Dr.mergeOptions({enableSimplify:!1,enableClip:!1});var Fr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},n._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),un._stroke(t,n),this._paintArrow(t,e,n)},e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e}(Dr);Fr.registerJSONType("ArcCurve"),Fr.mergeOptions({arcDegree:90});var zr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),un._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,3)},e}(Dr);zr.registerJSONType("CubicBezierCurve");var Br=function(t){function e(){return t.apply(this,arguments)||this}se(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),un._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,2)},e}(Dr);Br.registerJSONType("QuadBezierCurve");var Nr={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Ur={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},Vr=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getContent=function(){return this._content},n.setContent=function(t){var e=this._content;return this._content=pe(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},n.onAdd=function(){this._refresh()},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},n.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var n=this._parseSymbol(e);if(this.setTextStyle){var i=this.getTextStyle()||{};i.symbol=n[0],this.setTextStyle(i)}else this.setTextSymbol&&this.setTextSymbol(n[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=n[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(n[1]);return this},n._parseSymbol=function(t){var e={},n={};for(var i in t)b(t,i)&&(0===i.indexOf("text")?e[i]=t[i]:n[i]=t[i]);return[e,n]},n._getTextSize=function(t){return Ce(this._content,t).size},n._getInternalSymbol=function(){return this._symbol},n._getDefaultTextSymbol=function(){return f({},Nr)},n._getDefaultBoxSymbol=function(){return f({},Ur)},n._getDefaultPadding=function(){return[12,8]},e}(br),Gr=function(t){function e(e,n,i,r,a){var o;return void 0===a&&(a={}),(o=t.call(this,n,a)||this)._content=pe(e),o._width=d(i)?100:i,o._height=d(r)?40:r,a.boxSymbol&&o.setBoxSymbol(a.boxSymbol),a.textStyle&&o.setTextStyle(a.textStyle),o._refresh(),o}se(e,t);var n=e.prototype;return n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this._refresh(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this._refresh(),this},n.getBoxSymbol=function(){return f({},this.options.boxSymbol)},n.setBoxSymbol=function(t){return this.options.boxSymbol=t?f({},t):t,this.getSymbol()&&this._refresh(),this},n.getTextStyle=function(){return this.options.textStyle?f({},this.options.textStyle):null},n.setTextStyle=function(t){return this.options.textStyle=t?f({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},n._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],n=this._width-2*e[0],i=this._height-2*e[1],r=f({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:n,textMaxHeight:i});t.wrap&&!r.textWrapWidth&&(r.textWrapWidth=n);var a=t.horizontalAlignment;r.textDx=r.markerDx||0;var o=r.markerWidth/2-e[0];"left"===a?(r.textHorizontalAlignment="right",r.textDx=r.textDx-o):"right"===a&&(r.textHorizontalAlignment="left",r.textDx=r.textDx+o);var s=t.verticalAlignment;r.textDy=r.markerDy||0;var u=r.markerHeight/2-e[1];"top"===s?(r.textVerticalAlignment="bottom",r.textDy-=u):"bottom"===s&&(r.textVerticalAlignment="top",r.textDy+=u),this._refreshing=!0,this.updateSymbol(r),delete this._refreshing},e}(Vr);Gr.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),Gr.registerJSONType("TextBox");var Hr=function(t){function e(e,n,i){var r;return void 0===i&&(i={}),r=t.call(this,n,i)||this,i.textSymbol&&r.setTextSymbol(i.textSymbol),i.boxStyle&&r.setBoxStyle(i.boxStyle),r._content=pe(e),r._refresh(),r}se(e,t);var n=e.prototype;return n.getBoxStyle=function(){return this.options.boxStyle?f({},this.options.boxStyle):null},n.setBoxStyle=function(t){return this.options.boxStyle=t?f({},t):t,this._refresh(),this},n.getTextSymbol=function(){return f({},this._getDefaultTextSymbol(),this.options.textSymbol)},n.setTextSymbol=function(t){return this.options.textSymbol=t?f({},t):t,this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._canEdit=function(){return!1},n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},n._refresh=function(){var t=f({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){f(t,e.symbol);var n=this._getBoxSize(t),i=n[1],r=e.padding||this._getDefaultPadding(),a=n[0];t.markerWidth=a.width,t.markerHeight=a.height;var o=t.textDx||0,s=t.textDy||0,u=je(i,t.textHorizontalAlignment,t.textVerticalAlignment)._add(o,s),h=e.horizontalAlignment||"middle";t.markerDx=u.x,"left"===h?t.markerDx+=t.markerWidth/2-r[0]:"right"===h?t.markerDx-=t.markerWidth/2-i.width-r[0]:t.markerDx+=i.width/2;var c=e.verticalAlignment||"middle";t.markerDy=u.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-i.height-r[1]:t.markerDy+=i.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},n._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,n,i=this.getBoxStyle(),r=this._getTextSize(t),a=i.padding||this._getDefaultPadding();return e=r.width+2*a[0],n=r.height+2*a[1],i.minWidth&&(!e||e<i.minWidth)&&(e=i.minWidth),i.minHeight&&(!n||n<i.minHeight)&&(n=i.minHeight),[new le(e,n),r]},e}(Vr);Hr.mergeOptions({boxStyle:null,textSymbol:null}),Hr.registerJSONType("Label");var Zr=function(t){return function(t){function e(){return t.apply(this,arguments)||this}se(e,t),e._hasConnectors=function(t){return!d(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var n=e.prototype;return n.getConnectSource=function(){return this._connSource},n.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},n.getConnectTarget=function(){return this._connTarget},n.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},n._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,n,i=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),a=0,o=this.getCoordinates(),s=0,u=i.length;s<u;s++)for(var h=i[s],c=0,l=r.length;c<l;c++){var f=r[c],d=t.computeLength(h,f);0===s&&0===c?(e=h,n=f,a=d):d<a&&(e=h,n=f)}V(o)&&o[0].equals(e)&&o[1].equals(n)||this.setCoordinates([e,n])}},n.onAdd=function(){this._registerEvents(),this._updateCoordinates()},n.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&R(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(R(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof rr&&this._connTarget instanceof rr)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},n._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},n._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof rr&&this._connTarget instanceof rr)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},Wr={showOn:"always"},Xr=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return se(e,t),e}(Zr(xr));Xr.mergeOptions(Wr),Xr.registerJSONType("ConnectorLine");var qr=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return se(e,t),e}(Zr(Fr));qr.mergeOptions(Wr),qr.registerJSONType("ArcConnectorLine");var Yr=new Gn,Jr=function(t){function e(e,n,i){var r;return n&&!(n instanceof rr)&&!Array.isArray(n)&&o.indexOf(n.type)<0&&(i=n,n=null),(r=t.call(this,e,i)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),n&&r.addGeometry(n),r}se(e,t);var n=e.prototype;return n.getGeometryById=function(t){return d(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},n.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n,i=[],r=0,a=this._geoList.length;r<a;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},n.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},n.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},n.getCount=function(){return this._geoList.length},n.getExtent=function(){if(0===this.getCount())return null;var t=new Vn(this.getProjection());return this.forEach((function(e){t._combine(e.getExtent())})),t},n.forEach=function(t,e){for(var n=this._geoList.slice(0),i=0,r=n.length;i<r;i++)e?t.call(e,n[i],i):t(n[i],i);return this},n.filter=function(t,e){var n=[],i=y(t),r=i?t:it(t);return this.forEach((function(t){var a=i?t:ft(t);(e?r.call(e,a):r(a))&&n.push(t)}),this),n},n.isEmpty=function(){return!this._geoList.length},n.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(Sr.toGeometry(t),e);if(!Array.isArray(t)){var n=arguments.length,i=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=i,v(i)&&(t.push(i),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),!0===e&&(r=new Vn),this._toSort=this._maxZIndex>0;for(var a=[],o=0,s=t.length;o<s;o++){var u=t[o];if(!u)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+o);if(!(u instanceof rr)&&(u=rr.fromJSON(u),Array.isArray(u)))for(var h=0,c=u.length;h<c;h++)this._add(u[h],r,o),a.push(u[h]);Array.isArray(u)||(this._add(u,r,o),a.push(u))}var l=this.getMap();if(l&&(this._getRenderer().onGeometryAdd(a),!0===e&&!d(r.xmin))){var f=l.getFitZoom(r);l.setCenterAndZoom(r.getCenter(),f)}return this.fire("addgeo",{geometries:t}),this},n.getGeoMinZIndex=function(){return this._minZIndex},n.getGeoMaxZIndex=function(){return this._maxZIndex},n._add=function(t,e,n){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var i=t.getId();if(!d(i)){if(!d(this._geoMap[i]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+i+", at index:"+n);this._geoMap[i]=t}var r=E();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry&&this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this})},n.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof rr||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},n.clear=function(){this._clearing=!0,this.forEach((function(t){t.remove()})),this._geoMap={};var t=this._geoList;return this._geoList=[],this._getRenderer()&&this._getRenderer().onGeometryRemove(t),this._clearing=!1,this.fire("clear"),this},n.onRemoveGeometry=function(t){if(t&&!this._clearing&&this===t.getLayer()&&!d(t._getInternalId())){var e=t.getId();d(e)||delete this._geoMap[e];var n=this._findInList(t);n>=0&&this._geoList.splice(n,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},n.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return di.prototype.hide.call(this)},n.identify=function(t,e){return void 0===e&&(e={}),this._hitGeos(this._geoList,t,e)},n._hitGeos=function(t,e,n){void 0===n&&(n={});for(var i=n.filter,r=n.tolerance,a=[],o=this.getMap(),s=o.coordToPoint(e),u=o._pointToContainerPoint(s,void 0,0,s),h=t.length-1;h>=0;h--){var c=t[h];if(c&&c.isVisible()&&c._getPainter()&&c.options.interactive){if(!(c instanceof xr&&(c._getArrowStyle()||c instanceof Dr))){var l=c.getContainerExtent(Yr);if(r&&(l=l._expand(r)),!l||!l.contains(u))continue}if(c._containsPoint(u,r)&&(!i||i(c))&&(a.push(c),n.count&&a.length>=n.count))break}}return a},n._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},n._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},n._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)})),this._toSort=!1)},n._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},n._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;for(var n,i=0,r=e-1;i<=r;){if(n=Math.floor((i+r)/2),this._geoList[n]===t)return n;this._compare(this._geoList[n],t)>0?r=n-1:i=n+1}return-1},n._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},n._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!d(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}d(t.old)||t.new===t.old||delete this._geoMap[t.old]}},n._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},n._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},n._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},n._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},n._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},n._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},n._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e}(di);Jr.mergeOptions({drawImmediate:!1});var Kr={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:oe.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1},Qr=function(t){function e(e,n,i){var r,a=(r=t.call(this,e,n,i)||this).options.style;return delete r.options.style,a&&r.setStyle(a),r}se(e,t);var n=e.prototype;return n.getStyle=function(){return this._style?this._style:null},n.setStyle=function(t){return this._style=t,this._cookedStyles=dt(t),this.forEach((function(t){this._styleGeometry(t)}),this),this.fire("setstyle",{style:t}),this},n.removeStyle=function(){return this._style?(delete this._style,delete this._cookedStyles,this.forEach((function(t){t._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},n.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},n.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var n=this.getRenderer();n&&n.setToRedraw&&n.setToRedraw()}},n._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=ft(t),n=0,i=this._cookedStyles.length;n<i;n++)if(!0===this._cookedStyles[n].filter(e))return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},n.identify=function(e,n){void 0===n&&(n={});var i=this.getRenderer();return n.onlyVisible&&i&&i.identify?i.identify(e,n):t.prototype.identify.call(this,e,n)},n.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((d(t.style)||t.style)&&this.getStyle()&&(e.style=this.getStyle()),d(t.geometries)||t.geometries){var n;if(t.clipExtent){var i=this.getMap(),r=i?i.getProjection():null;n=new Vn(t.clipExtent,r)}for(var a=[],o=this.getGeometries(),s=0,u=o.length;s<u;s++){var h=o[s],c=h.getExtent();if(c&&(!n||n.intersects(c))){var l=h.toJSON(t.geometries);a.push(l)}}e.geometries=a}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var n=new e(t.id,t.options),i=t.geometries,r=[],a=0;a<i.length;a++){var o=rr.fromJSON(i[a]);o&&r.push(o)}return n.addGeometry(r),t.style&&n.setStyle(t.style),n},e}(Jr);Qr.mergeOptions(Kr),Qr.registerJSONType("VectorLayer");var $r="_map_tool",ta=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addTo=function(t){return t?(this._map=t,t[$r]&&t[$r].disable(),this.onAdd&&this.onAdd(),this.enable(),t[$r]=this,this._fireEvent("add"),this):this},n.getMap=function(){return this._map},n.enable=function(){return!this._map||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},n.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},n.isEnabled=function(){return!!this._enabled},n.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[$r],delete this._map),this._fireEvent("remove"),this):this},n._registerEvents=function(){this._switchEvents("on")},n._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},n._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(yn(wn)),ea={},na=function(t){function e(e){var n;return(n=t.call(this,e)||this)._checkMode(),n._events={click:n._firstClickHandler,mousemove:n._mouseMoveHandler,dblclick:n._doubleClickHandler,mousedown:n._mouseDownHandler,mouseup:n._mouseUpHandler},n}se(e,t),e.registerMode=function(t,e){ea[t.toLowerCase()]=e},e.getRegisterMode=function(t){return ea[t.toLowerCase()]};var n=e.prototype;return n.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.getSymbol=function(){return It(this.options.symbol||this.options.symbol)},n.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},n.getCurrentGeometry=function(){return this._geometry},n.onAdd=function(){this._checkMode()},n.onEnable=function(){if(this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources(),this.options.autoPanAtEdge){var t=this.getMap();this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})}return this},n.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this},n.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return t.update(n,this._geometry),this},n.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||d(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return t.update(n,this._geometry),this},n._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},n._checkMode=function(){this._getRegisterMode()},n._saveMapCfg=function(){var t=this.getMap();if(this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom}),this._getRegisterMode().action.indexOf("mousedown")>-1){var e=this.getMap();this._mapDraggable=e.options.draggable,e.config({draggable:!1})}},n._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),d(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n._loadResources=function(){var t=Mt(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},n._getProjection=function(){return this._map.getProjection()},n._getRegisterMode=function(){var t=this.getMode(),n=e.getRegisterMode(t);if(!n)throw new Error(t+" is not a valid mode of DrawTool.");return n},n.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},n._mouseDownHandler=function(t){this._createGeometry(t)},n._mouseUpHandler=function(t){this.endDraw(t)},n._firstClickHandler=function(t){var e=this._getRegisterMode(),n=t.coordinate;this._geometry?(d(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(n),this._historyPointer=this._clickCoords.length,t.drawTool=this,e.clickLimit&&e.clickLimit===this._historyPointer?(e.update([n],this._geometry,t),this.endDraw(t)):e.update(this._clickCoords,this._geometry,t),this._fireEvent("drawvertex",t)):this._createGeometry(t)},n._createGeometry=function(t){var e=this.getMode(),n=this._getRegisterMode(),i=t.coordinate,r=this.getSymbol();this._geometry||(this._clickCoords=[i],t.drawTool=this,this._geometry=n.create(this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),"point"===e&&this.endDraw(t)},n._mouseMoveHandler=function(t){var e=this.getMap(),n=t.coordinate;if(this._geometry&&e&&!e.isInteracting()){var i=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(i)){t.drawTool=this;var r=this._getRegisterMode();if(this._shouldRecordHistory(r.action)){var a=this._clickCoords.slice(0,this._historyPointer);if(a&&a.length>0&&n.equals(a[a.length-1]))return;r.update(a.concat([n]),this._geometry,t)}else r.update([n],this._geometry,t);this._fireEvent("mousemove",t)}}},n._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var n=this._getRegisterMode(),i=this._clickCoords;if(!(i.length<2)){for(var r=[i[0]],a=1,o=i.length;a<o;a++)i[a].x===i[a-1].x&&i[a].y===i[a-1].y||r.push(i[a]);r.length<2||this._geometry&&this._geometry instanceof yr&&r.length<3||(t.drawTool=this,n.update(r,this._geometry,t),this.endDraw(t))}}}},n._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},n.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,this},n._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n._getMouseContainerPoint=function(t){return"mousedown"===this._getRegisterMode().action&&Ue(t.domEvent),t.containerPoint},n._isValidContainerPoint=function(t){var e=this._map.getSize(),n=e.width,i=e.height;return!(t.x<0||t.y<0||t.x>n||t.y>i)},n._getDrawLayer=function(){var t=r+"drawtool",e=this._map.getLayer(t);return e||(e=new Qr(t,{enableSimplify:!1}),this._map.addLayer(e)),e},n._fireEvent=function(t,e){e||(e={}),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}).copy()),ta.prototype._fireEvent.call(this,t,e)},e}(ta);na.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0});var ia=function(t){function e(e){var n;return(n=t.call(this,e)||this).drawTool=new na({mode:"boxZoom",ignoreMouseleave:!1}),n}se(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,i=n.getCenter(),r=n.getSymbol(),a=r.markerWidth,o=r.markerHeight,s=new Vn(i,e.locateByPoint(i,a,o),e.getProjection()),u=e.getFitZoom(s);e._animateTo({center:s.getCenter(),zoom:u})},e}(bn);yi.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),yi.addOnLoadHook("addHandler","boxZoom",ia);var ra=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},n.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},n._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var n=t.containerPoint,i=e.getContainerExtent();if(i){var r,a=n.x,o=n.y,s=i.xmax,u=i.ymax;a<30&&(r=[Math.abs(a-30),0]),o<30&&(r=[0,Math.abs(o-30)]),a+30>s&&(r=[-Math.abs(a+30-s),0]),o+30>u&&(r=[0,-Math.abs(o+30-u)]),r&&e.panBy(r,{duration:1})}}},e}(bn);yi.mergeOptions({autoPanAtEdge:!1}),yi.addOnLoadHook("addHandler","autoPanAtEdge",ra),yi.include({animateTo:function(t,e,n){var i=this;void 0===e&&(e={}),y(e)&&(n=e,e={});var r=this.getProjection(),a=this.getView(),o={},s=!0;for(var u in t)if(b(t,u)&&("prjCenter"===u||!d(a[u])))if(s=!1,"center"===u){var h=new Tn(a[u]).toFixed(7),c=new Tn(t[u]).toFixed(7);h.equals(c)||(o.center=[h,c])}else if("prjCenter"===u){var l=new Tn(this._getPrjCenter()),f=new Tn(t[u]);l.equals(f)||(o.prjCenter=[l,f])}else a[u]!==t[u]&&"around"!==u&&(o[u]=[a[u],t[u]]);if(s)return null;this._animPlayer&&(this._isInternalAnimation?(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var p=t.around||new ce(this.width/2,this.height/2),g=this._getRenderer(),v=this._animPlayer=pr.animate(o,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){g.callInNextFrame(t)}},(function(t){if(i.isRemoved())v.finish();else{if("running"===v.playState){if(t.styles.center){var a=t.styles.center;i._setPrjCenter(r.project(a)),i.onMoving(i._parseEventFromCoord(i.getCenter()))}else if(t.styles.prjCenter){var s=t.styles.prjCenter;i._setPrjCenter(s),i.onMoving(i._parseEventFromCoord(i.getCenter()))}d(t.styles.zoom)||i.onZooming(t.styles.zoom,p),d(t.styles.pitch)||i.setPitch(t.styles.pitch),d(t.styles.bearing)||i.setBearing(t.styles.bearing),i._fireEvent("animating")}else"finished"===v.playState&&(v._interupted||(o.center?i._setPrjCenter(r.project(o.center[1])):o.prjCenter&&i._setPrjCenter(o.prjCenter[1]),d(o.pitch)||i.setPitch(o.pitch[1]),d(o.bearing)||i.setBearing(o.bearing[1])),i._endAnim(v,o,p,e));n&&n(t)}}));return this._startAnim(o,p),v},_animateTo:function(t,e,n){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,n),delete this._isInternalAnimation,this._mapAnimPlayer},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,n,i){delete this._animRotating;var r,a=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var o;o=t._interupted?this._getPrjCenter():e.prjCenter[1];var s=this._parseEventFromCoord(this.getProjection().unproject(o));s.point2d=this._prjToPoint(o),this.onMoveEnd(s)}d(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),n):i.wheelZoom?this.onZooming(e.zoom[1],n):this.onZoomEnd(e.zoom[1],n)),a&&this._fireEvent(a),d(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),this._prevAnimPlayer&&(this._animPlayer=this._prevAnimPlayer,this._prevAnimPlayer.play())},_startAnim:function(t,e){this._animPlayer&&(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&("finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&this._prevAnimPlayer&&(this._animPlayer=this._prevAnimPlayer,this._prevAnimPlayer.play()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)}});var aa="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function oa(t,e,n){var i,r,a,o,s,u,h,c,l,f,d,p,g=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*g+e[4]*v+e[8]*m+e[12],t[13]=e[1]*g+e[5]*v+e[9]*m+e[13],t[14]=e[2]*g+e[6]*v+e[10]*m+e[14],t[15]=e[3]*g+e[7]*v+e[11]*m+e[15]):(i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=i*g+s*v+l*m+e[12],t[13]=r*g+u*v+f*m+e[13],t[14]=a*g+h*v+d*m+e[14],t[15]=o*g+c*v+p*m+e[15]),t}function sa(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ua(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],g=e[12],v=e[13],m=e[14],y=e[15],_=n[0],b=n[1],w=n[2],x=n[3];return t[0]=_*i+b*s+w*l+x*g,t[1]=_*r+b*u+w*f+x*v,t[2]=_*a+b*h+w*d+x*m,t[3]=_*o+b*c+w*p+x*y,_=n[4],b=n[5],w=n[6],x=n[7],t[4]=_*i+b*s+w*l+x*g,t[5]=_*r+b*u+w*f+x*v,t[6]=_*a+b*h+w*d+x*m,t[7]=_*o+b*c+w*p+x*y,_=n[8],b=n[9],w=n[10],x=n[11],t[8]=_*i+b*s+w*l+x*g,t[9]=_*r+b*u+w*f+x*v,t[10]=_*a+b*h+w*d+x*m,t[11]=_*o+b*c+w*p+x*y,_=n[12],b=n[13],w=n[14],x=n[15],t[12]=_*i+b*s+w*l+x*g,t[13]=_*r+b*u+w*f+x*v,t[14]=_*a+b*h+w*d+x*m,t[15]=_*o+b*c+w*p+x*y,t}function ha(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],v=e[14],m=e[15],y=n*s-i*o,_=n*u-r*o,b=n*h-a*o,w=i*u-r*s,x=i*h-a*s,O=r*h-a*u,j=c*g-l*p,k=c*v-f*p,P=c*m-d*p,C=l*v-f*g,T=l*m-d*g,M=f*m-d*v,E=y*M-_*T+b*C+w*P-x*k+O*j;return E?(E=1/E,t[0]=(s*M-u*T+h*C)*E,t[1]=(r*T-i*M-a*C)*E,t[2]=(g*O-v*x+m*w)*E,t[3]=(f*x-l*O-d*w)*E,t[4]=(u*P-o*M-h*k)*E,t[5]=(n*M-r*P+a*k)*E,t[6]=(v*b-p*O-m*_)*E,t[7]=(c*O-f*b+d*_)*E,t[8]=(o*T-s*P+h*j)*E,t[9]=(i*P-n*T-a*j)*E,t[10]=(p*x-g*b+m*y)*E,t[11]=(l*b-c*x-d*y)*E,t[12]=(s*k-o*C-u*j)*E,t[13]=(n*C-i*k+r*j)*E,t[14]=(g*_-p*w-v*y)*E,t[15]=(c*w-l*_+f*y)*E,t):null}function ca(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function la(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function fa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function da(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function pa(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function ga(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=r*u-a*s,t[1]=a*o-i*u,t[2]=i*s-r*o,t}function va(t,e,n){var i=e[0],r=e[1],a=e[2],o=1/(n[3]*i+n[7]*r+n[11]*a+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])*o,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])*o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])*o,t}yi.include({_registerDomEvents:function(){Fe(this._panels.mapWrapper||this._containerDOM,aa,this._handleDOMEvent,this)},_removeDomEvents:function(){ze(this._panels.mapWrapper||this._containerDOM,aa,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type;if("contextmenu"===e&&Ne(t),!this._ignoreEvent(t)){var n=!1;if("mousedown"===e||"touchstart"===e&&1===t.touches.length)this._mouseDownTime=l();else if("click"===e||"touchend"===e||"contextmenu"===e){if(!this._mouseDownTime)return;var i=this._mouseDownTime;if(delete this._mouseDownTime,l()-i>300){if("click"===e||"contextmenu"===e)return}else"touchend"===e&&(n=!0)}this._fireDOMEvent(this,t,e),n&&(this._clickTime&&l()-this._clickTime<=300?(delete this._clickTime,this._fireDOMEvent(this,t,"dblclick")):(this._clickTime=l(),this._fireDOMEvent(this,t,"click")))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e,n=t.srcElement||t.target;if(n)for(;n&&n!==this._containerDOM;){if(n.className&&n.className.indexOf&&(n.className.indexOf("maptalks-control")>=0||n.className.indexOf("maptalks-ui")>=0&&!e.eventsPropagation))return!0;e=n,n=n.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=Ze(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var n={domEvent:t};if("keypress"!==e){var i=this._getActualEvent(t);if(i){var r=Ze(i,this._containerDOM);n=f(n,{coordinate:this.containerPointToCoord(r),containerPoint:r,viewPoint:this.containerPointToViewPoint(r),point2d:this._containerPointToPoint(r)})}}return n},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,n){if(!this.isRemoved()){var i=this._parseEvent(e,n);this._fireEvent(n,i)}}}),yi.addOnLoadHook("_registerDomEvents"),yi.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullScreen)t.requestFullScreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}),yi.include({panTo:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(y(e)&&(n=e,e={}),t=new Tn(t),void 0===e.animation||e.animation){var i=this.getProjection().project(t);return this._panAnimation(i,e.duration,n)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(y(e)&&(n=e,e={}),t=new ce(t),this.onMoveStart(),void 0===e.animation||e.animation){t=t.multi(-1);var i=this._containerPointToPrj(new ce(this.width/2+t.x,this.height/2+t.y));this._panAnimation(i,e.duration,n)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,n){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},n)}}),rr.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var r=rr.fromJSON(t[n]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?Sr.toGeometry(t):(t.subType?(a=rr.getJSONClass(t.subType).fromJSON(t),d(t.feature.id)||a.setId(t.feature.id)):(a=Sr.toGeometry(t.feature),t.options&&a.config(t.options)),t.symbol&&a.setSymbol(t.symbol),t.infoWindow&&a.setInfoWindow(t.infoWindow),a);var a},di.fromJSON=function(t){if(!t)return null;var e=t.type,n=di.getJSONClass(e);if(!n||!n.fromJSON)throw new Error("unsupported layer type:"+e);return n.fromJSON(t)},yi.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom();var n=this.getBaseLayer();(d(t.baseLayer)||t.baseLayer)&&n&&(e.baseLayer=n.toJSON(t.baseLayer));var i={};t.clipExtent&&(!0===t.clipExtent?i.clipExtent=this.getExtent():i.clipExtent=t.clipExtent);var r=[];if(d(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var a=this.getLayers(),o=0,s=a.length;o<s;o++)if(a[o].toJSON){var u=f({},v(t.layers)?t.layers:{},i);r.push(a[o].toJSON(u))}e.layers=r}else if(V(t.layers)){for(var h=t.layers,c=0;c<h.length;c++){var l=h[c],p=this.getLayer(l.id);if(p.toJSON){var g=f({},l.options,i);r.push(p.toJSON(g))}}e.layers=r}else e.layers=[];return e}}),yi.fromJSON=function(t,e,n){if(!t||!e)return null;n||(n={});var i=new yi(t,e.options);if(d(n.baseLayer)||n.baseLayer){var r=di.fromJSON(e.baseLayer);r&&i.setBaseLayer(r)}if(d(n.layers)||n.layers){for(var a=[],o=e.layers,s=0;s<o.length;s++){var u=di.fromJSON(o[s]);a.push(u)}i.addLayer(a)}return i},yi.include({computeLength:function(t,e){if(!this.getProjection())return null;var n=new Tn(t),i=new Tn(e);return n.equals(i)?0:this.getProjection().measureLength(n,i)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){if(!t)return this;var n=t.layers;if(!V(n))return this;for(var i=[],a=0,o=n.length;a<o;a++)m(n[a])?i.push(this.getLayer(n[a])):i.push(n[a]);for(var s=new Tn(t.coordinate),u=f({},t),h=[],c=i.length-1;c>=0&&!(t.count&&h.length>=t.count);c--){var l=i[c];if(l&&l.getMap()&&(t.includeInvisible||l.isVisible())&&(t.includeInternals||!(l.getId().indexOf(r)>=0))){var d=l.identify(s,u);d&&(Array.isArray(d)?L(h,d):h.push(d))}}return e.call(this,h),this}}),yi.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,n){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,n)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new ce(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new ce(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,n){d(n)&&(n=1);var i=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(i-n)/Math.abs(i-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,n){if(this.options.zoomable&&this._frameZoom!==t){d(n)&&(n=1),this._zoomTo(t,e);var i=this.getResolution(t),r=this.getResolution(this._startZoomVal)/i/n,a=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),o=this.getViewPoint();if(!this.isRotating()&&!a.equals(e)&&1!==r){var s=this.getPitch(),u=a._sub(e)._multi(1/(1-r));s&&(u.y/=Math.cos(s*Math.PI/180)),e=e.add(u)}var h={view:[r,0,0,r,(e.x-o.x)*(1-r),(e.y-o.y)*(1-r)]},c=this.getDevicePixelRatio();1!==c&&(e=e.multi(c)),h.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:h}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var n=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:n,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),n=this.getMinZoom();return t<n&&(t=n),t>e&&(t=e),t}});var ma=Math.PI/180,ya=new Tn(0,0);function _a(){return ca(new Array(16))}yi.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/ma},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*ma,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/ma:0},setBearing:function(t){if(oe.ie9)throw new Error("map can't rotate in IE9.");var e=-N(t,-180,180)*ma;if(this._angle===e)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:e}),this._fireEvent("rotateend",{from:n,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){if(oe.ie9)throw new Error("map can't tilt in IE9.");var e=U(t,0,this.options.maxPitch)*ma;if(this._pitch===e)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:e}),this._fireEvent("pitchend",{from:n,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return n;e=Math.PI*e/180;var i=new ce(this.cameraPosition).distanceTo(new ce(this.cameraLookAt)),r=n*Math.tan(2*e);return n+Math.tan(e)*(i+r)},_pointToContainerPoint:function(){var t=[0,0,0];return function(e,n,i,r){if(void 0===i&&(i=0),e=this._pointToPoint(e,n,r),this.isTransforming()||i){i*=this._getResolution(n)/this._getResolution();var a=this._glScale;la(t,e.x*a,e.y*a,i*a);var o=this._projIfBehindCamera(t,this.cameraPosition,this.cameraForward);va(o,o,this.projViewMatrix);var s=this.width/2,u=this.height/2;return o[0]=o[0]*s+s,o[1]=-o[1]*u+u,r?(r.x=o[0],r.y=o[1],r):new ce(o[0],o[1])}var h=this._prjToPoint(this._getPrjCenter(),void 0,ya);return r?(r.x=e.x,r.y=e.y):r=e,r._sub(h)._add(this.width/2,this.height/2)}}(),_projIfBehindCamera:function(){var t=new Array(3),e=new Array(3),n=new Array(3);return function(i,r,a){fa(t,i,r);var o=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(a,t);return o<=0&&(function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(e,a,1.01*o),function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}(i,r,fa(n,t,e))),i}}(),_containerPointToPoint:function(){var t=[0,0,0],e=[0,0,0,1],n=[0,0,0,1];return function(i,r,a){if(this.isTransforming()){var o=this.width/2||1,s=this.height/2||1;la(t,(i.x-o)/o,(s-i.y)/s,0),la(e,t[0],t[1],0),la(n,t[0],t[1],1),e[3]=n[3]=1,va(e,e,this.projViewMatrixInverse),va(n,n,this.projViewMatrixInverse);var u=e[0],h=n[0],c=e[1],l=n[1],f=e[2],d=n[2],p=f===d?0:(0-f)/(d-f),g=B(u,h,p),v=B(c,l,p);return a?(a.x=g,a.y=v):a=new ce(g,v),a._multi(1/this._glScale),void 0===r||this.getZoom()===r?a:this._pointToPointAtZoom(a,r,a)}var m=this._prjToPoint(this._getPrjCenter(),r,a),y=void 0!==r?this._getResolution()/this._getResolution(r):1,_=y*(i.x-this.width/2),b=y*(i.y-this.height/2);return m._add(_,b)}}(),_calcMatrices:function(){var t=oe.ie9?null:_a(),e=oe.ie9?null:_a();return function(){if(!oe.ie9){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var n=this.getSize(),i=n.width||1,r=n.height||1;this._glScale=this.getGLScale();var a=this.getFov()*Math.PI/180,o=this.getScale(this.getMinZoom())/this.getScale(this.getMaxNativeZoom())*r/2/this._getFovRatio()*1.4,s=this.projMatrix||_a();!function(t,e,n,i,r){var a=1/Math.tan(e/2),o=1/(.1-r);t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+.1)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*.1*o,t[15]=0}(s,a,i/r,0,o),this.projMatrix=s;var u=this._getCameraWorldMatrix();this.viewMatrix=ha(t,u),this.projViewMatrix=ua(this.projViewMatrix||_a(),s,this.viewMatrix),this.projViewMatrixInverse=ua(this.projViewMatrixInverse||_a(),u,ha(e,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this._getResolution(this.getGLZoom()),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtent(this.getGLZoom())}}}(),_calcDomMatrix:function(){var t=oe.ie9?null:_a(),e=oe.ie9?null:_a(),n=[1,-1,1],i=[0,0,0];return function(){var r=this.width||1,a=this.height||1,o=.5/Math.tan(this._fov/2)*a;return sa(t,this.projMatrix,n),oa(t,t,la(i,0,0,-o)),this._pitch&&function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+h*i,t[5]=o*r+c*i,t[6]=s*r+l*i,t[7]=u*r+f*i,t[8]=h*r-a*i,t[9]=c*r-o*i,t[10]=l*r-s*i,t[11]=f*r-u*i}(t,t,this._pitch),this._angle&&function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+h*i,t[1]=o*r+c*i,t[2]=s*r+l*i,t[3]=u*r+f*i,t[4]=h*r-a*i,t[5]=c*r-o*i,t[6]=l*r-s*i,t[7]=f*r-u*i}(t,t,this._angle),ca(e),sa(e,e,la(i,r/2,-a/2,1)),ua(this.domCssMatrix||_a(),e,t)}}(),_getCameraWorldMatrix:function(){var t={},e=[1,-1,1];return function(){var n=this.getGLZoom(),i=this.getSize(),r=this.getGLScale(),a=this._prjToPoint(this._prjCenter,n);this.cameraLookAt=la(this.cameraLookAt||[0,0,0],a.x,a.y,0);var o=this.getPitch()*ma,s=-this.getBearing()*ma,u=this._getFovRatio(),h=r*(i.height||1)/2/u,c=h*Math.cos(o),l=Math.sin(o)*h,f=a.x+l*Math.sin(s),d=a.y+l*Math.cos(s);this.cameraPosition=la(this.cameraPosition||[0,0,0],f,d,c);var p=l||1,g=this.cameraUp=la(this.cameraUp||[0,0,0],Math.sin(s)*p,Math.cos(s)*p,0),v=this.cameraWorldMatrix=this.cameraWorldMatrix||_a();!function(t,e,n,i){var r=[0,0,0],a=[0,0,0],o=[0,0,0];fa(o,e,n),0===da(o)&&(o[2]=1),pa(o,o),ga(r,i,o),0===da(o)&&(1===Math.abs(i[2])?o[0]+=1e-4:o[2]+=1e-4,pa(o,o),ga(r,i,o)),pa(r,r),ga(a,o,r),t[0]=r[0],t[4]=a[0],t[8]=o[0],t[1]=r[1],t[5]=a[1],t[9]=o[1],t[2]=r[2],t[6]=a[2],t[10]=o[2]}(v,this.cameraPosition,this.cameraLookAt,g);var m=this.cameraForward||[0,0,0];return fa(m,this.cameraLookAt,this.cameraPosition),this.cameraForward=pa(m,m),function(t,e){var n,i=e[0],r=e[4],a=e[8],o=e[1],s=e[5],u=e[9],h=e[2],c=e[6],l=e[10],f=i+s+l;f>0?(n=.5/Math.sqrt(f+1),t.w=.25/n,t.x=(c-u)*n,t.y=(a-h)*n,t.z=(o-r)*n):i>s&&i>l?(n=2*Math.sqrt(1+i-s-l),t.w=(c-u)/n,t.x=.25*n,t.y=(r+o)/n,t.z=(a+h)/n):s>l?(n=2*Math.sqrt(1+s-i-l),t.w=(a-h)/n,t.x=(r+o)/n,t.y=.25*n,t.z=(u+c)/n):(n=2*Math.sqrt(1+l-i-s),t.w=(o-r)/n,t.x=(a+h)/n,t.y=(u+c)/n,t.z=.25*n)}(t,v),function(t,e){var n=t,i=e.x,r=e.y,a=e.z,o=e.w,s=i+i,u=r+r,h=a+a,c=i*s,l=i*u,f=i*h,d=r*u,p=r*h,g=a*h,v=o*s,m=o*u,y=o*h;n[0]=1-(d+g),n[4]=l-y,n[8]=f+m,n[1]=l+y,n[5]=1-(c+g),n[9]=p-v,n[2]=f-m,n[6]=p+v,n[10]=1-(c+d),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(v,t),function(t,e){var n=t;n[12]=e[0],n[13]=e[1],n[14]=e[2]}(v,this.cameraPosition),sa(v,v,e),v}}(),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*ma)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}}))}}),yi.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if($(t,this._viewHistory[n]))return this._viewHistoryPointer=n,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var i=this.options.viewHistoryCount;i>0&&this._viewHistory.length>i&&this._viewHistory.splice(0,this._viewHistory.length-i),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var n=this,i=this.getView();e.animation?this._animateTo(t,{duration:e.duration},(function(e){"finished"===e.state.playState&&n._fireViewChange(i,t)})):(this.setView(t),this._fireViewChange(i,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),yi.mergeOptions({viewHistory:!0,viewHistoryCount:10});var ba=function(t){function e(e){var n;return(n=t.call(this,e)||this).on("enable",n._afterEnable,ue(ue(n))).on("disable",n._afterDisable,ue(ue(n))),n._measureLayers=[],n}se(e,t);var n=e.prototype;return n.clear=function(){if(V(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},n.getMeasureLayers=function(){return this._measureLayers},n.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n._measure=function(t){var e,n,i=this.getMap();t instanceof rr?e=i.computeGeometryLength(t):Array.isArray(t)&&(e=i.getProjection().measureLength(t)),this._lastMeasure=e,n="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=e<1e3?e.toFixed(0)+n[0]:(e/1e3).toFixed(2)+n[1]),this.options.imperial&&(e*=3.2808399,r.length>0&&(r+="\n"),r+=e<5280?e.toFixed(0)+n[2]:(e/5280).toFixed(2)+n[3]),r},n._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n._afterEnable=function(){this._registerMeasureEvents()},n._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n._msOnDrawStart=function(t){var e=this.getMap(),n=E(),i="distancetool_"+n,r="distancetool_markers_"+n;e.getLayer(i)?(this._measureLineLayer=e.getLayer(i),this._measureMarkerLayer=e.getLayer(r)):(this._measureLineLayer=new Qr(i).addTo(e),this._measureMarkerLayer=new Qr(r).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),new br(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);var a="zh-CN"===this.options.language?"起点":"start",o=new Hr(a,t.coordinate,this.options.labelOptions);this._lastVertex=o,this._measureMarkerLayer.addGeometry(o)},n._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=It(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new br(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new Hr(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}this._tailMarker.setCoordinates(t.coordinate),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate)},n._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=t.geometry;new br(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);var n=this._measure(e),i=new Hr(n,t.coordinate,this.options.labelOptions);this._measureMarkerLayer.addGeometry(i),this._lastVertex=i},n._msOnDrawEnd=function(t){this._clearTailMarker();var e=this._lastVertex.getSize();e||(e=new le(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),e.width);var n=t.geometry.copy();n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},n._addClearMarker=function(t,e){var n=this.options.clearButtonSymbol,i={markerDx:(n.markerDx||0)+e,textDx:(n.textDx||0)+e};Array.isArray(n)&&(i=n.map((function(t){return t?{markerDx:(t.markerDx||0)+e,textDx:(t.textDx||0)+e}:null}))),n=It(n,i);var r=new br(t,{symbol:n}),a=this._measureLineLayer,o=this._measureMarkerLayer;r.on("click",(function(){return a.remove(),o.remove(),!1}),this),r.addTo(this._measureMarkerLayer)},n._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},e}(na);ba.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var wa=function(t){function e(e){var n;return(n=t.call(this,e)||this).on("enable",n._afterEnable,ue(ue(n))).on("disable",n._afterDisable,ue(ue(n))),n._measureLayers=[],n}se(e,t);var n=e.prototype;return n._measure=function(t){var e,n,i=this.getMap();t instanceof rr?e=i.computeGeometryArea(t):Array.isArray(t)&&(e=i.getProjection().measureArea(t)),this._lastMeasure=e,n="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";return this.options.metric&&(r+=e<1e6?e.toFixed(0)+n[0]:(e/1e6).toFixed(2)+n[1]),this.options.imperial&&(e*=3.2808399,r.length>0&&(r+="\n"),r+=e<27878400?e.toFixed(0)+n[2]:(e/27878400).toFixed(2)+n[3]),r},n._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=new br(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);this._measure(t.geometry),this._lastVertex=e},n._msOnDrawEnd=function(t){this._clearTailMarker();var e=this._measure(t.geometry),n=new Hr(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();n||(n=new le(10,10)),this._addClearMarker(t.coordinate,n.width);var i=t.geometry.copy();i.addTo(this._measureLineLayer),this._lastMeasure=i.getArea()},e}(ba);function xa(t){for(var e=t.tileInfo,n=[e.cols,e.rows],i=[],r=e.lods,a=0,o=r.length;a<o;a++)i.push(r[a].resolution);var s=t.fullExtent,u=e.origin,h=[1,-1,u.x,u.y];return delete s.spatialReference,{spatialReference:{resolutions:i,fullExtent:s},tileSystem:h,tileSize:n}}wa.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}}),na.registerMode("circle",{clickLimit:2,action:["click","mousemove","click"],create:function(t){return new Ar(t[0],0)},update:function(t,e){var n=e.getMap().computeLength(e.getCenter(),t[t.length-1]);e.setRadius(n)},generate:function(t){return t}}),na.registerMode("freeHandCircle",{action:["mousedown","mousemove","mouseup"],create:function(t){return new Ar(t[0],0)},update:function(t,e){var n=e.getMap().computeLength(e.getCenter(),t[t.length-1]);e.setRadius(n)},generate:function(t){return t}}),na.registerMode("ellipse",{clickLimit:2,action:["click","mousemove","click"],create:function(t){return new Lr(t[0],0,0)},update:function(t,e){var n=e.getMap(),i=e.getCenter(),r=n.computeLength(i,new Tn({x:t[t.length-1].x,y:i.y})),a=n.computeLength(i,new Tn({x:i.x,y:t[t.length-1].y}));e.setWidth(2*r),e.setHeight(2*a)},generate:function(t){return t}}),na.registerMode("freeHandEllipse",{action:["mousedown","mousemove","mouseup"],create:function(t){return new Lr(t[0],0,0)},update:function(t,e){var n=e.getMap(),i=e.getCenter(),r=n.computeLength(i,new Tn({x:t[t.length-1].x,y:i.y})),a=n.computeLength(i,new Tn({x:i.x,y:t[t.length-1].y}));e.setWidth(2*r),e.setHeight(2*a)},generate:function(t){return t}}),na.registerMode("rectangle",{clickLimit:2,action:["click","mousemove","click"],create:function(t){var e=new yr([]);return e._firstClick=t[0],e},update:function(t,e,n){var i=e.getMap(),r=n.containerPoint,a=i.coordToContainerPoint(e._firstClick),o=[[a.x,a.y],[r.x,a.y],[r.x,r.y],[a.x,r.y]];e.setCoordinates(o.map((function(t){return i.containerPointToCoord(new ce(t))})))},generate:function(t){return t}}),na.registerMode("freeHandRectangle",{action:["mousedown","mousemove","mouseup"],create:function(t){var e=new yr([]);return e._firstClick=t[0],e},update:function(t,e){var n=e._firstClick,i=[[n.x,n.y],[t[0].x,n.y],[t[0].x,t[0].y],[n.x,t[0].y]];e.setCoordinates(i)},generate:function(t){return t}}),na.registerMode("point",{clickLimit:1,action:["click"],create:function(t){return new br(t[0])},generate:function(t){return t}}),na.registerMode("polygon",{action:["click","mousemove","dblclick"],create:function(t){return new xr(t)},update:function(t,e){var n=e.getSymbol();e.setCoordinates(t);var i=e.getLayer();if(i){var r=i.getGeometryById("polygon");if(!r&&t.length>=3){if(r=new yr([t],{id:"polygon"}),n){var a=It(n,{lineOpacity:0});r.setSymbol(a)}r.addTo(i)}r&&r.setCoordinates(t)}},generate:function(t){return new yr(t.getCoordinates(),{symbol:t.getSymbol()})}}),na.registerMode("freeHandPolygon",{action:["mousedown","mousemove","mouseup"],create:function(t){return new xr(t)},update:function(t,e){var n=e.getCoordinates(),i=e.getSymbol();e.setCoordinates(n.concat(t));var r=e.getLayer();if(r){var a=r.getGeometryById("polygon");if(!a&&t.length>=3){if(a=new yr([t],{id:"polygon"}),i){var o=It(i,{lineOpacity:0});a.setSymbol(o)}a.addTo(r)}a&&a.setCoordinates(t)}},generate:function(t){return new yr(t.getCoordinates(),{symbol:t.getSymbol()})}}),na.registerMode("linestring",{action:["click","mousemove","dblclick"],create:function(t){return new xr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),na.registerMode("freeHandLinestring",{action:["mousedown","mousemove","mouseup"],create:function(t){return new xr(t)},update:function(t,e){var n=e.getCoordinates();e.setCoordinates(n.concat(t))},generate:function(t){return t}}),na.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t){return new Fr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),na.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t){return new Br(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),na.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t){return new zr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),na.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t){var e=new br(t[0]);return e._firstClick=t[0],e},update:function(t,e,n){var i=e.getMap(),r=i.coordToContainerPoint(e._firstClick),a=n.containerPoint,o=i.containerPointToCoordinate(new Tn(Math.min(r.x,a.x),Math.min(r.y,a.y)));e.setCoordinates(o).updateSymbol({markerWidth:Math.abs(r.x-a.x),markerHeight:Math.abs(r.y-a.y)})},generate:function(t){return t}}),vi.loadArcgis=function(t,e,n){if(void 0===n&&(n={jsonp:!0}),m(t)&&"{"!==t.substring(0,1))an.getJSON(t,(function(t,n){if(t)e(t);else{var i=xa(n);e(null,i)}}),n);else{m(t)&&(t=A(t));var i=xa(t);e(null,i)}return this};var Oa=function(t){function e(e){return t.call(this,e)||this}se(e,t);var n=e.prototype;return n.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},n.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},n.show=function(t){var e=this.getMap();if(!e)return this;this._mapEventsOn||this._switchMapEvents("on"),t=t||this._coordinate||this._owner.getCenter();var n=this.isVisible();this.fire("showstart");var i=this._getUIContainer();this._coordinate=t,this._removePrevDOM();var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,!r)return this.fire("showend"),this;this._measureSize(r),this._singleton()&&(e[this._uiDomKey()]=r),this._setPosition(),r.style[Ae]=null,i.appendChild(r);var a=this._getAnimation();if(n&&(a.ok=!1),a.ok&&(a.fade&&(r.style.opacity=0),a.scale)){if(this.getTransformOrigin){var o=this.getTransformOrigin();r.style[Se]=o}r.style[Ee]=this._toCSSTranslate(this._pos)+" scale(0)"}r.style.display="",this.options.eventsToStop&&en(r,this.options.eventsToStop,Ue),this.options.autoPan&&this._autoPan();var s=a.transition;return a.ok&&s&&(r.offsetHeight,s&&(r.style[Ae]=s),a.fade&&(r.style.opacity=1),a.scale&&(r.style[Ee]=this._toCSSTranslate(this._pos)+" scale(1)")),this.fire("showend"),this},n.hide=function(){var t=this;if(!this.getDOM()||!this.getMap())return this;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.offsetHeight,n.style[Ae]=e.transition,setTimeout((function(){n.style.display="none",t.fire("hide")}),this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity=0),e.scale&&(n.style[Ee]=this._toCSSTranslate(this._pos)+" scale(0)"),this},n.isVisible=function(){var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},n.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},n.getSize=function(){return this._size?this._size.copy():null},n.getOwner=function(){return this._owner},n.getDOM=function(){return this.__uiDOM},n.getPosition=function(){if(!this.getMap())return null;var t=this._getViewPoint()._round();if(this.getOffset){var e=this.getOffset()._round();e&&t._add(e)}return t},n._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var i=fe(e[n]);"fade"===i?t.fade=!0:"scale"===i&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=Ee+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},n._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate)._add(this.options.dx,this.options.dy)},n._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var n=this._pos,i=t.getSize(),r=i.width,a=i.height,o=t.viewPointToContainerPoint(n),s=parseInt(e.clientWidth),u=parseInt(e.clientHeight),h=0,c=0;o.x<0?h=-(o.x-s/2):o.x+s-35>r&&(h=r-(o.x+3*s/2)),o.y-u<0?c=50-(o.y-u):o.y>a&&(c=a-o.y-u-30),0===c&&0===h||t.panBy(new ce(h,c),{duration:this.options.autoPanDuration})}},n._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute",t.style.left="-99999px";var n=t.style.bottom?"bottom":"top";return t.style[n]="-99999px",t.style.display="",e.appendChild(t),this._size=new le(t.clientWidth,t.clientHeight),t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},n._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();e[n]&&(t&&nn(e[n],t,Ue),De(e[n]),delete e[n]),delete this.__uiDOM}else this.__uiDOM&&(t&&nn(this.__uiDOM,t,Ue),De(this.__uiDOM),delete this.__uiDOM)},n._uiDomKey=function(){return"__ui_"+this._getClassName()},n._singleton=function(){return this.options.single},n._getUIContainer=function(){return this.getMap()._panels.ui},n._getClassName=function(){return"UIComponent"},n._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var n=this._getDefaultEvents();if(this.getEvents&&f(n,this.getEvents()),n)for(var i in n)n.hasOwnProperty(i)&&e[t](i,n[i],this)}},n._switchEvents=function(t){this._switchMapEvents(t);var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},n._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving}},n._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof rr&&(t.positionchange=this.onGeometryPositionChange),this.getOwnerEvents&&f(t,this.getOwnerEvents()),t},n.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&this.show(t.target.getCenter())},n.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},n.onEvent=function(){this.isVisible()&&this._updatePosition()},n.onZoomEnd=function(){this.isVisible()&&this._setPosition()},n._updatePosition=function(){this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this))},n._setPosition=function(){var t=this.getDOM();if(t){t.style[Ae]=null;var e=this.getPosition();this._pos=e,t.style[Ee]=this._toCSSTranslate(e)+" scale(1)"}},n._toCSSTranslate=function(t){if(!t)return"";if(oe.any3d){var e=this.getMap(),n=e?e.getBearing():0,i=e?e.getPitch():0,r="";return this.options.pitchWithMap&&i&&(r+=" rotateX("+Math.round(i)+"deg)"),this.options.rotateWithMap&&n&&(r+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+r}return"translate("+t.x+"px,"+t.y+"px)"},e}(yn(wn));Oa.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!0,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1});var ja="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",ka=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._markerCoord=new Tn(e),i}se(e,t);var n=e.prototype;return n._getClassName=function(){return"UIMarker"},n.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},n.getCoordinates=function(){return this._markerCoord},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},n.getContent=function(){return this.options.content},n.onAdd=function(){this.show()},n.show=function(){return t.prototype.show.call(this,this._markerCoord)},n.flash=function(t,e,n,i){return et.call(this,t,e,n,i)},n.buildOn=function(){var t;return m(this.options.content)?(t=Re("div")).innerHTML=this.options.content:t=this.options.content,this._registerDOMEvents(t),t},n.getOffset=function(){var t=this.getSize();return new ce(-t.width/2,-t.height/2)},n.getTransformOrigin=function(){return"center center"},n.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},n.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},n._registerDOMEvents=function(t){en(t,ja,this._onDomEvents,this)},n._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type);this.fire(t.type,e)},n._removeDOMEvents=function(t){nn(t,ja,this._onDomEvents,this)},n._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),i=n.width,r=n.height;return[t.containerPointToCoordinate(e.add(-i/2,0)),t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},e}(jn(Oa));ka.mergeOptions({eventsPropagation:!0,draggable:!1,single:!1,content:null});var Pa=oe.touch?"touchstart mousedown":"mousedown",Ca=function(t){function e(e){return t.call(this,e)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(Pa,this._startDrag,this)},n.removeHooks=function(){this.target.off(Pa,this._startDrag,this)},n._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},n._prepareDragHandler=function(){this._dragHandler=new Cn(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onMouseDown=function(t){Ue(t.domEvent)},n._dragging=function(t){var e=this.target,n=e.getMap()._parseEvent(t.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1))if(this._isDragging){var r=n.coordinate,a=n.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=a);var o=r.sub(this._lastCoord),s=a.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=a,this.target.setCoordinates(this.target.getCoordinates().add(o)),n.coordOffset=o,n.pointOffset=s,e.fire("dragging",n)}else this._isDragging=!0},n._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,n){var i=n._parseEvent(t.domEvent);e.fire("dragend",i)}},n.isDragging=function(){return!!this._isDragging},e}(bn);ka.addInitHook("addHandler","draggable",Ca);var Ta=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n._getClassName=function(){return"InfoWindow"},n.addTo=function(e){return e instanceof rr&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getContent=function(){return this.options.content},n.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getTitle=function(){return this.options.title},n.buildOn=function(){if(this.options.custom){if(m(this.options.content)){var t=Re("div");return t.innerHTML=this.options.content,t}return this.options.content}var e=Re("div");e.className="maptalks-msgBox",e.style.width=this._getWindowWidth()+"px",e.style.bottom="0px";var n='<em class="maptalks-ico"></em>';this.options.title&&(n+="<h2>"+this.options.title+"</h2>"),n+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',e.innerHTML=n;var i=e.querySelector(".maptalks-msgContent");return m(this.options.content)?i.innerHTML=this.options.content:i.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),Fe(e.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),e},n.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},n.getOffset=function(){var t=this.getSize(),e=new ce(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof br||n instanceof Pr){var i,r;if(n instanceof br)i=n._getPainter(),r=n.getSize();else{var a=n.getGeometries();if(!a||!a.length)return e;i=a[0]._getPainter(),r=a[0].getSize()}if(i){var o=i.getFixedExtent();e._add(o.xmax-r.width/2,o.ymin)}}return e},n.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},n.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},n.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},n.onRemove=function(){this.onDomRemove()},n.onDomRemove=function(){this._onCloseBtnClick&&(ze(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},n._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout((function(){n instanceof br?e.show(n.getCoordinates()):n instanceof Pr?e.show(n.findClosest(t.coordinate)):e.show(t.coordinate)}),1)},n._getWindowWidth=function(){var t=this.options.width;return t||(t=300),t},e}(Oa);Ta.mergeOptions({autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:300,minHeight:120,custom:!1,title:null,content:null});var Ma=function(t){se(n,t);var e=n.prototype;function n(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,n)||this)._content=e,i}return e._getClassName=function(){return"ToolTip"},e.addTo=function(e){if(e instanceof rr||e instanceof ka)return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),t.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.setStyle=function(t){return this.options.cssName=t,this},e.getStyle=function(){return this.options.cssName},e.getContent=function(){return this._content},e.buildOn=function(){var t=Re("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),t.innerHTML='<div class="'+n+'">'+this._content+"</div>",t},e.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM()},e.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var i=n.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(i):this._timeout=setTimeout((function(){n&&e.show(i)}),this.options.showTimeout)}},e.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this))},n}(Oa);Ma.mergeOptions({width:0,height:0,animation:"fade",cssName:"maptalks-tooltip",showTimeout:400});var Ea=function(t){function e(e){return t.call(this,e)||this}se(e,t);var n=e.prototype;return n._getClassName=function(){return"Menu"},n.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,Oa.prototype.addTo.apply(this,arguments)},n.setItems=function(t){return this.options.items=t,this},n.getItems=function(){return this.options.items||[]},n.buildOn=function(){if(this.options.custom){if(m(this.options.items)){var t=Re("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=Re("div");qe(e,"maptalks-menu"),e.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();return e.appendChild(n),en(e,"contextmenu",Ne),e},n.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),i=0,r=0;return e.x+n.width>t.width&&(i=-n.width),e.y+n.height>t.height&&(r=-n.height),new ce(i,r)},n.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},n.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},n._createMenuItemDom=function(){var t=this,e=this.getMap(),n=Re("ul");qe(n,"maptalks-menu-items");var i,r,a=this.getItems();function o(n){return function(i){var r=e._parseEvent(i,"click");r.target=t,r.owner=t._owner,r.index=n,!1!==this._callback(r)&&t.hide()}}for(var s=0,u=a.length;s<u;s++){if("-"===(i=a[s])||"_"===i)qe(r=Re("li"),"maptalks-menu-splitter");else{r=Re("li");var h=i.item;y(h)&&(h=h({owner:this._owner,index:s})),r.innerHTML=h,r._callback=i.click,en(r,"click",o(s))}n.appendChild(r)}var c=this.options.maxHeight||0;return c>0&&We(n,"max-height: "+c+"px; overflow-y: auto;"),n},n._getMenuWidth=function(){return this.options.width||160},e}(Oa);Ea.mergeOptions({animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var Sa={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},openMenu:function(t){var e=this instanceof yi?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(this._menuOptions),this._menu.show(t)),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this},_bindMenu:function(t){return this._menu=new Ea(t),this._menu.addTo(this),this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.listens("contextmenu")>1||(this.openMenu(t.coordinate),!1)}};yi.include(Sa),rr.include(Sa);var Aa=Object.freeze({UIComponent:Oa,UIMarker:ka,InfoWindow:Ta,ToolTip:Ma,Menuable:Sa,Menu:Ea}),La=function(t){function e(e){return e&&e.position&&!m(e.position)&&(e.position=f({},e.position)),t.call(this,e)||this}se(e,t);var n=e.prototype;return n.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=Re("div"),We(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},n.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},n.getMap=function(){return this._map},n.getPosition=function(){return f({},this._parse(this.options.position))},n.setPosition=function(t){return m(t)?this.options.position=t:this.options.position=f({},t),this._updatePosition(),this},n.getContainerPoint=function(){var t,e,n=this.getPosition(),i=this.getMap().getSize();return d(n.left)?d(n.right)||(t=i.width-parseInt(n.right)):t=parseInt(n.left),d(n.top)?d(n.bottom)||(e=i.height-parseInt(n.bottom)):e=parseInt(n.top),new ce(t,e)},n.getContainer=function(){return this.__ctrlContainer},n.getDOM=function(){return this._controlDom},n.show=function(){return this.__ctrlContainer.style.display="",this},n.hide=function(){return this.__ctrlContainer.style.display="none",this},n.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},n.remove=function(){return this._map?(De(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},n._parse=function(t){var n=t;return m(t)&&(n=e.positions[n]),n},n._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:f({},t)})},e}(yn(wn));La.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},yi.mergeOptions({control:!0}),yi.include({addControl:function(t){return this._containerDOM.getContext?this:(t.addTo(this),this)},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var Ra="addlayer removelayer setbaselayer baselayerremove",Ia=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(){return this._attributionContainer=Re("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},n.onAdd=function(){this.getMap().on(Ra,this._update,this)},n.onRemove=function(){this.getMap().off(Ra,this._update,this)},n._update=function(){var t=this.getMap();if(t){var e=t._getLayers((function(t){return t.options.attribution})).reverse().map((function(t){return t.options.attribution})),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},e}(La);Ia.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),yi.mergeOptions({attribution:!0}),yi.addOnLoadHook((function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new Ia(t),this.addControl(this.attributionControl))}));var Da=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.container=Re("div",this.options.containerClass),e=this.panel=Re("div","panel"),n=this.button=Re("button");return t.appendChild(n),t.appendChild(e),t},n.onAdd=function(){en(this.button,"mouseover",this._show,this),en(this.panel,"mouseleave",this._hide,this),en(this.getMap(),"click",this._hide,this)},n.onRemove=function(){this.panel&&(nn(this.button,"mouseover",this._show,this),nn(this.panel,"mouseleave",this._hide,this),nn(this.getMap(),"click",this._hide,this),De(this.panel),De(this.button),delete this.panel,delete this.button,delete this.container)},n._show=function(){Xe(this.container,"shown")||(qe(this.container,"shown"),this._createPanel())},n._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||Ye(this.container,this.options.containerClass)},n._createPanel=function(){this.panel.innerHTML="";var t=Re("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},n._renderLayers=function(t,e){var n=t.getBaseLayer(),i=t.getLayers(),r=i.length;if(n){var a=n.layers||[n],o=Re("li","group"),s=Re("ul"),u=Re("label");u.innerHTML=this.options.baseTitle,o.appendChild(u);for(var h=0,c=a.length;h<c;h++){var l=a[h];this._isExcluded(l)&&(s.appendChild(this._renderLayer(a[h],!0)),o.appendChild(s),e.appendChild(o))}}if(r){var f=Re("li","group"),d=Re("ul"),p=Re("label");p.innerHTML=this.options.overlayTitle,f.appendChild(p);for(var g=0;g<r;g++){var v=i[g];this._isExcluded(v)&&d.appendChild(this._renderLayer(v))}f.appendChild(d),e.appendChild(f)}},n._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},n._renderLayer=function(t,e){var n=this,i=Re("li","layer"),r=Re("label"),a=Re("input"),o=this.getMap(),s=t.options.visible;t.options.visible=!0;var u=t.isVisible();return t.options.visible=s,i.className="layer",e?(a.type="radio",a.name="base"):a.type="checkbox",a.checked=s&&u,u||a.setAttribute("disabled","disabled"),a.onchange=function(e){if("radio"===e.target.type){var i=o.getBaseLayer(),r=i.layers;if(r)for(var a=0,s=r.length;a<s;a++){var u=r[a];u[u===t?"show":"hide"]()}else i.isVisible()||i.show();o._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();n.fire("layerchange",{target:t})},i.appendChild(a),r.innerHTML=t.getId(),i.appendChild(r),i},e}(La);Da.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),yi.mergeOptions({layerSwitcherControl:!1}),yi.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new Da(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var Fa=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=Re("div"),n=this.mapContainer=Re("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var i=this.button=Re("div");return i.className=this.options.buttonClass,e.appendChild(n),e.appendChild(i),e},n.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),en(this.button,"click",this._onButtonClick,this),this._updateButtonText()},n.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),nn(this.button,"click",this._onButtonClick,this)},n.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},n.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},n.getOverviewMap=function(){return this._overview},n._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},n._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},n._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();f(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new yi(e,n),this._updateBaseLayer(),this._perspective=new yr(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Qr("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},n._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),i=this.options.level;if(i>0){for(var r=i;r>0;r--)if(e-r>=n)return e-r}else for(var a=i;a<0;a++)if(e-a>=n)return e-a;return e},n._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},n._getPerspectiveCoords=function(){var t=this.getMap();return t.getContainerExtent().toArray().map((function(e){return t.containerPointToCoordinate(e)}))},n._update=function(){if(this._overview){He(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},n._updateSpatialReference=function(){if(this._overview){var t=this.getMap().options.spatialReference;this._overview.setSpatialReference(t)}},n._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,n=0;if(e)for(var i=0,r=e.length;i<r;i++)if(e[i].isVisible()){n=i;break}var a=t.toJSON(),o=null;e?(o=a.layers[n].options).visible=!0:o=a.options,this._overview.setMinZoom(o.minZoom||null).setMaxZoom(o.maxZoom||null),delete o.minZoom,delete o.maxZoom,delete a.options.canvas,a.options.visible=!0,a.options.renderer="canvas";var s=di.fromJSON(a);for(var u in t)y(t[u])&&t.hasOwnProperty(u)&&t[u]!==t.constructor.prototype[u]&&(s[u]=t[u]);this._overview.setBaseLayer(s)}else this._overview.setBaseLayer(null)}},e}(La);Fa.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),yi.mergeOptions({overviewControl:!1}),yi.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new Fa(this.options.overviewControl),this.addControl(this.overviewControl))}));var za=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(){var t;if(this.options.custom)m(this.options.content)?(t=Re("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=Re("div","maptalks-panel"),this.options.closeButton){var e=Re("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var n=Re("div","maptalks-panel-content");n.innerHTML=this.options.content,t.appendChild(n)}return this.draggable=new Cn(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},n.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),La.prototype.update.call(this)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},n.getContent=function(){return this.options.content},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=f({},this.getPosition()),this.fire("dragstart",t)},n._onDragging=function(t){var e=t.mousePos.sub(this._startPos),n=this._startPosition,i=this.getPosition();d(i.top)||(i.top=parseInt(n.top)+e.y),d(i.bottom)||(i.bottom=parseInt(n.bottom)-e.y),d(i.left)||(i.left=parseInt(n.left)+e.x),d(i.right)||(i.right=parseInt(n.right)-e.x),this.setPosition(i),this.fire("dragging",t)},n._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},n._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),i=parseInt(n.clientWidth),r=parseInt(n.clientHeight);return[t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(i,r/2)),t.containerPointToCoordinate(e.add(i/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(La);za.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var Ba=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(t){return this._map=t,this._scaleContainer=Re("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},n.onRemove=function(){this.getMap().off("zoomend",this._update,this)},n._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Ie("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=Ie("div",this.options.containerClass?null:t,this._scaleContainer))},n._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},n._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},n._updateMetric=function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},n._updateImperial=function(t){var e,n,i,r=3.2808399*t;r>5280?(e=r/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mile",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" feet",i/r))},n._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},n._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)},e}(La);Ba.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),yi.mergeOptions({scaleControl:!1}),yi.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new Ba(this.options.scaleControl),this.addControl(this.scaleControl))}));var Na=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(t){this._map=t;var e=Re("div"),n=Re("ul","maptalks-toolbar-hx");e.appendChild(n),this.options.vertical?qe(e,"maptalks-toolbar-vertical"):qe(e,"maptalks-toolbar-horizonal");var i=this;function r(t,e,n,r){var a=i._getItems()[e];return function(i){return Ue(i),t({target:a,index:e,childIndex:n,dom:r})}}var a=this.options.items;if(V(a))for(var o=0,s=a.length;o<s;o++){var u=a[o],h=Re("li");if(28!==this.options.height&&(h.style.lineHeight=this.options.height+"px"),h.style.height=this.options.height+"px",h.style.cursor="pointer",Qe(u.item)){h.style.textAlign="center";var c=$e("div",u.item);h.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+u.item+"</div>"}else h.innerHTML=u.item;if(u.click&&en(h,"click",r(u.click,o,null,h)),V(u.children)){var l=this._createDropMenu(o);h.appendChild(l),h._menu=l,en(h,"mouseover",(function(){this._menu.style.display=""})),en(h,"mouseout",(function(){this._menu.style.display="none"}))}n.appendChild(h)}return e},n._createDropMenu=function(t){var e=this;function n(t,n,i){var r=e._getItems()[n].children[i];return function(e){return Ue(e),t({target:r,index:n,childIndex:i})}}var i=Re("div","maptalks-dropMenu"),r=this._getItems(),a=r.length,o=Re("ul"),s=r[t].children;t===a-1&&s&&(i.style.cssText="right: 0px;",o.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(o.style.bottom=0)),i.appendChild(Re("em","maptalks-ico"));for(var u=0,h=0,c=s.length;h<c;h++){var l=_e(s[h].item,"12px");l.width>u&&(u=l.width)}for(var f=0,d=s.length;f<d;f++){var p=s[f],g=Re("li");g.innerHTML='<a href="javascript:;">'+p.item+"</a>",g.style.cursor="pointer",g.style.width=u+24+"px",en(g.childNodes[0],"click",n(p.click,t,f)),o.appendChild(g)}if(this.options.vertical){var v=u<95?95:u;this.options.reverseMenu?i.style.right=-(v+20)+"px":i.style.left=-(v+20)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="28px";return i.appendChild(o),i.style.display="none",i},n._getItems=function(){return this.options.items||[]},e}(La);Na.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var Ua=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.buildOn=function(t){var e=this.options,n=Re("div","maptalks-zoom");if(e.zoomLevel){var i=Re("span","maptalks-zoom-zoomlevel");n.appendChild(i),this._levelDOM=i}var r=Re("div","maptalks-zoom-slider"),a=Re("a","maptalks-zoom-zoomin");if(a.href="javascript:;",a.innerHTML="+",r.appendChild(a),this._zoomInButton=a,e.slider){var o=Re("div","maptalks-zoom-slider-box"),s=Re("div","maptalks-zoom-slider-ruler"),u=Re("span","maptalks-zoom-slider-reading"),h=Re("span","maptalks-zoom-slider-dot");s.appendChild(u),o.appendChild(s),o.appendChild(h),r.appendChild(o),this._sliderBox=o,this._sliderRuler=s,this._sliderReading=u,this._sliderDot=h}var c=Re("a","maptalks-zoom-zoomout");return c.href="javascript:;",c.innerHTML="-",r.appendChild(c),this._zoomOutButton=c,n.appendChild(r),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},n.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&nn(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&nn(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(nn(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger.disable(),delete this.dotDragger)},n._update=function(){var t=this.getMap();if(this._sliderBox){var e=10*(t.getMaxZoom()-t.getMinZoom());this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var n=10*(t.getMaxZoom()-t.getZoom());this._sliderReading.style.height=10*(t.getZoom()-t.getMinZoom()+1)+"px",this._sliderDot.style.top=n+"px"}this._updateText()},n._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();g(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t}},n._registerDomEvents=function(){this._zoomInButton&&en(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&en(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(en(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new Cn(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},n._onZoomInClick=function(t){Ne(t),this.getMap().zoomIn()},n._onZoomOutClick=function(t){Ne(t),this.getMap().zoomOut()},n._onClickRuler=function(t){Ne(t);var e=this.getMap(),n=Ze(t,this._sliderRuler).y,i=e.getMaxZoom(),r=Math.floor(i-n/10);e.setZoom(r)},n._onDotDragstart=function(t){Ne(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),n)},n._onDotDrag=function(t){Ne(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(.5),i=Ze(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),a=e.getMinZoom(),o=i.y,s=r-o/10;r<s?(s=r,o=0):a>s&&(s=a,o=10*(r-a)),"dragging"===t.type?e.onZooming(s,n,1):"dragend"===t.type&&(this.options.seamless?e.onZoomEnd(s,n):e.onZoomEnd(Math.round(s),n)),this._sliderDot.style.top=o+"px",this._sliderReading.style.height=10*(e.getZoom()-a+1)+"px",this._updateText()},e}(La);Ua.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),yi.mergeOptions({zoomControl:!1}),yi.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new Ua(this.options.zoomControl),this.addControl(this.zoomControl))}));var Va=Object.freeze({Control:La,Attribution:Ia,LayerSwitcher:Da,Overview:Fa,Panel:za,Scale:Ba,Toolbar:Na,Zoom:Ua}),Ga=function(){function t(t,e,n,i){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:n,y:i})}return t.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},t}(),Ha=6378137*Math.PI;f(Ga,{"web-mercator":new Ga([1,-1,-Ha,Ha]),"tms-global-mercator":new Ga([1,1,-Ha,-Ha]),"tms-global-geodetic":new Ga([1,1,-180,-90]),baidu:new Ga([1,1,0,0])});var Za=function(){function t(t,e,n){this.tileSize=n,this.fullExtent=e,this.prepareTileInfo(t,e),this._xScale=e.right>=e.left?1:-1,this._yScale=e.top>=e.bottom?1:-1}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(m(t)?t=Ga[t.toLowerCase()]:Array.isArray(t)&&(t=new Ga(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t;var n=e.right>e.left?1:-1,i=e.top>e.bottom?-1:1,r=t.origin.x,a=t.origin.y;this.transformation=new Hn([n,i,r,a])},e._getTileNum=function(t,e){var n=this.tileSystem,i=this.tileSize,r=Math.floor(1e-7+t.x/(i.width*e)),a=-Math.floor(1e-7+t.y/(i.height*e));return{x:n.scale.x*r,y:n.scale.y*a}},e.getTileIndex=function(t,e){var n=this.tileSystem,i=this.transformation.transform(t,1),r=this._getTileNum(i,e);return n.scale.x<0&&(r.x-=1),n.scale.y>0&&(r.y-=1),this.getNeighorTileIndex(r.x,r.y,0,0,e)},e.getNeighorTileIndex=function(t,e,n,i,r,a){var o=this.tileSystem,s=t+o.scale.x*n,u=e-o.scale.y*i,h=!1,c=s,l=u,f=this._getTileFullIndex(r);return a&&(!0!==a&&"x"!==a||(f.xmax===f.xmin?s=f.xmin:s<f.xmin?(s=f.xmax-(f.xmin-s)%(f.xmax-f.xmin))===f.xmax&&(s=f.xmin):s>=f.xmax&&(s=f.xmin+(s-f.xmin)%(f.xmax-f.xmin))),!0!==a&&"y"!==a||(f.ymax===f.ymin?u=f.ymin:u>=f.ymax?u=f.ymin+(u-f.ymin)%(f.ymax-f.ymin):u<f.ymin&&(u=f.ymax-(f.ymin-u)%(f.ymax-f.ymin))===f.ymax&&(u=f.ymin))),(s<f.xmin||s>f.xmax||u>f.ymax||u<f.ymin)&&(h=!0),{x:s,y:u,idx:c,idy:l,out:h}},e._getTileFullIndex=function(t){var e=this.fullExtent,n=this.transformation,i=this._getTileNum(n.transform(new Tn(e.left,e.top),1),t),r=this._getTileNum(n.transform(new Tn(e.right,e.bottom),1),t),a=this.tileSystem;return a.scale.x<0&&(i.x-=1,r.x-=1),a.scale.y>0&&(i.y-=1,r.y-=1),new Vn(i,r)},e.getTilePrjNW=function(t,e,n){var i=this.tileSystem,r=this.tileSize,a=i.origin.y+this._yScale*i.scale.y*(e+(1===i.scale.y?1:0))*n*r.height,o=i.origin.x+this._xScale*i.scale.x*(t+(1===i.scale.x?0:1))*n*r.width;return new Tn(o,a)},e.getTilePrjSE=function(t,e,n){var i=this.tileSystem,r=this.tileSize,a=i.origin.y+this._yScale*i.scale.y*(e+(1===i.scale.y?0:1))*n*r.height,o=i.origin.x+this._xScale*i.scale.x*(t+(1===i.scale.x?1:0))*n*r.width;return new Tn(o,a)},e.getTilePrjExtent=function(t,e,n){var i=this.getTilePrjNW(t,e,n),r=this.getTilePrjSE(t,e,n);return new Vn(i,r)},t}(),Wa={urlTemplate:null,subdomains:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!P,debug:!1,spatialReference:null,maxCacheSize:256,renderer:oe.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,minPitchToCascade:35,zoomOffset:0},Xa=/\{ *([\w_]+) *\}/g,qa=new ce(0,0),Ya=new ce(0,0),Ja=new ce(0,0),Ka=new ce(0,0),Qa=new ce(0,0),$a=new Gn,to=function(t){function e(){return t.apply(this,arguments)||this}se(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var n=e.prototype;return n.getTileSize=function(){var t=this.options.tileSize;return p(t)&&(t=[t,t]),new le(t)},n.getTiles=function(t,e){var n=this.getMap(),i=e&&e.getRenderer(),r=n.getContainerExtent(),a=[],o=0,s=this.getMinZoom(),u=this.options.minPitchToCascade,h=d(t)?this._getTileZoom(n.getZoom()):t;if(!d(t)||!this.options.cascadeTiles||n.getPitch()<=u||!d(s)&&h<=s){var c=this._getTiles(h,r,void 0,i);return c&&(o+=c.tiles.length,a.push(c)),{tileGrids:a,count:o}}var l=Math.floor(n._getVisualHeight(u)),f=new Gn(0,n.height-l,n.width,n.height),p=this._getTiles(h,f,0,i);o+=p?p.tiles.length:0;var g=new Gn(0,r.ymin,n.width,f.ymin),v=n.getSpatialReference().getZoomDirection(),m=this._getTiles(h-v,g,1,i);return o+=m?m.tiles.length:0,a.push(p,m),{tileGrids:a,count:o}},n.getTileUrl=function(t,e,n){var i=this.options.urlTemplate,r="";if(this.options.subdomains){var a=this.options.subdomains;if(V(a)){var o=(t+e)%a.length;o<0&&(o=0),r=a[o]}}if(y(i))return i(t,e,n,r);var s={x:t,y:e,z:n,s:r};return i.replace(Xa,(function(t,e){var n=s[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(s)),n}))},n.clear=function(){return this._renderer&&this._renderer.clear(),this.fire("clear"),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},n.getSpatialReference=function(){var t=this.getMap();return!t||this.options.spatialReference&&!vi.equals(this.options.spatialReference,t.options.spatialReference)?(this._sr=this._sr||new vi(this.options.spatialReference),void 0===this._srMinZoom&&(this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom()),this._sr):t.getSpatialReference()},n.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t.prototype.getMinZoom.call(this),this._srMinZoom):t.prototype.getMinZoom.call(this)},n.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},n._getTileZoom=function(t){g(t)||(t=Math.round(t));var e=this.options.maxAvailableZoom;return!d(e)&&t>e&&(t=e),t},n._getTiles=function(t,e,n,i){var r=this.getMap(),a=t+this.options.zoomOffset,o=this._getTileOffset(a),s=o[0]||o[1],u={zoom:t,extent:null,offset:o,tiles:[]};if(a<0)return u;var h=this.getMinZoom(),c=this.getMaxZoom();if(!(r&&this.isVisible()&&r.width&&r.height))return u;if(!d(h)&&t<h||!d(c)&&t>c)return u;var l=this._getTileConfig();if(!l)return u;var f=this.getSpatialReference(),p=r.getSpatialReference(),g=f.getResolution(a),v=e.convertTo((function(t){return r._containerPointToPoint(t,void 0,qa)})),m=this._getInnerExtent(t,e,v)._add(o);v._add(o);var y=v.sub(o),_=this._getMask2DExtent();if(_){var b=_.intersection(v);if(!b)return u;e=b.convertTo((function(t){return r._pointToContainerPoint(t,void 0,0,qa)}))}var w,x=r._containerPointToPrj(e.getCenter(),Ya);w=s?this._project(r._pointToPrj(r._prjToPoint(x,void 0,Ja)._add(o),void 0,Ja),Ja):this._project(x,Ja),Ka.x=v.xmin,Ka.y=v.ymin,Qa.x=v.xmax,Qa.y=v.ymax;for(var O=this._project(r._pointToPrj(Ka,void 0,Ka),Ka),j=this._project(r._pointToPrj(Qa,void 0,Qa),Qa),k=l.getTileIndex(w,g),P=l.getTileIndex(O,g),C=l.getTileIndex(j,g),T=Math.ceil(Math.abs(k.y-P.y)),M=Math.ceil(Math.abs(k.x-P.x)),E=Math.ceil(Math.abs(k.y-C.y)),S=Math.ceil(Math.abs(k.x-C.x)),A=this.getTileSize(),L=this.getId(),R=this.getRenderer()||i,I=this._getTileConfig().tileSystem.scale,D={},F=[],z=new Gn,B=-T;B<=E;B++)for(var N=-M,U=-1/0,V=!1;N>=U&&N<=S;){var G=l.getNeighorTileIndex(k.x,k.y,N,B,g,f===p&&this.options.repeatWorld);if(U===-1/0?N++:N--,!G.out){var H=!1,Z=this._getTileId(G,a),W=void 0;D[Z]||(W=R&&R.isTileCachedOrLoading(Z),D[Z]=1),W&&(W=W.info,H=!0);var X=void 0;if(W){var q=W.point0;X=W.point.set(q.x,q.y)}else{var Y=l.getTilePrjNW(G.x,G.y,g);X=r._prjToPoint(this._unproject(Y,Qa),t)}var J=void 0,K=void 0;if(f===p)J=A.width,K=A.height;else{var Q=l.getTilePrjSE(G.x,G.y,g),$=r._prjToPoint(this._unproject(Q,Qa),t,Qa);J=Math.ceil(Math.abs($.x-X.x)),K=Math.ceil(Math.abs($.y-X.y))}var tt=I.x*(G.idx-G.x)*J,et=-I.y*(G.idy-G.y)*K;if((tt||et)&&X._add(tt,et),s&&X._sub(o),!W){var nt=new Gn(X.x,X.y,X.x+J,X.y+K);W={point0:X.add(o)._sub(tt,et),point:X,z:t,x:G.x,y:G.y,extent2d:nt,mask:n}}var it=W.extent2d;(V||m.intersects(it)||!m.equals(y)&&this._isTileInExtent(W,e))&&(s&&(it.set(X.x,X.y,X.x+J,X.y+K),W.point=X._add(o),it._add(o)),H||(W.size=[J,K],W.id=Z,W.dupKey=Z,W.layer=L,W.url=this.getTileUrl(G.x,G.y,a)),F.push(W),z._combine(it),U===-1/0?(U=N,N=S):V||(V=!0))}}var rt=r._containerPointToPoint(e.getCenter(),t,qa)._add(o);return F.sort((function(t,e){return t.point.distanceTo(rt)-e.point.distanceTo(rt)})),{offset:o,zoom:t,extent:z,tiles:F}},n._getInnerExtent=function(t,e,n){var i=this.getMap(),r=i.getResolution(t),a=i.getResolution()/r,o=n.getCenter()._multi(a),s=i.getBearing()*Math.PI/180,u=e.getHeight()/2*a,h=e.getWidth()/2*a,c=Math.abs(Math.cos(s)*u)||u,l=Math.abs(Math.sin(s)*u)||h;return new Gn(o.x-l,o.y-c,o.x+l,o.y+c)},n._getTileOffset=function(t){var e=this.getMap(),n=e._getResolution()/e._getResolution(t),i=this.options.offset;return y(i)&&(i=i(this)),i[0]*=n,i[1]*=n,i},n._getTileId=function(t,e,n){return(n||this.getId())+"-"+t.idy+"-"+t.idx+"-"+e},n._project=function(t,e){var n=this.getMap(),i=this.getSpatialReference();if(i!==n.getSpatialReference()){var r=n.getProjection();return i.getProjection().project(r.unproject(t,e),e)}return t},n._unproject=function(t,e){var n=this.getMap(),i=this.getSpatialReference();if(i!==n.getSpatialReference()){var r=n.getProjection(),a=i.getProjection();return r.project(a.unproject(t,e),e)}return t},n._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),i=n.getProjection(),r=n.getFullExtent();if(this._defaultTileConfig=new Za(Ga.getDefault(i),r,e),this.options.tileSystem&&(this._tileConfig=new Za(this.options.tileSystem,r,e)),t&&!this._tileConfig&&t.getSpatialReference()===n&&t.getBaseLayer()&&t.getBaseLayer()!==this&&t.getBaseLayer()._getTileConfig){var a=t.getBaseLayer()._getTileConfig();this._tileConfig=new Za(a.tileSystem,a.fullExtent,e)}},n._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},n._bindMap=function(e){var n=e.getBaseLayer();return n===this&&(n.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),t.prototype._bindMap.apply(this,arguments)},n._isTileInExtent=function(t,e){this._convertPointCallback||(this._convertPointCallback=function(t){return this.getMap()._pointToContainerPoint(t,this._coordTileZoom,0,qa)}.bind(this));var n=t.z;this._coordTileZoom=n;var i=t.extent2d.convertTo(this._convertPointCallback,$a);return e.intersects(i)},n.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},n._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr;var t=this.getRenderer();t&&t.clear()},e}(di);to.registerJSONType("TileLayer"),to.mergeOptions(Wa);var eo=function(t){function e(e,n,i){var r;return(r=t.call(this,e,i)||this).layers=n||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}se(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var n=t.layers.map((function(t){return di.fromJSON(t)}));return new e(t.id,n,t.options)};var n=e.prototype;return n.getLayers=function(){return this.layers},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(t){return t.toJSON()})),options:this.config()}},n.getTiles=function(t){for(var e=this.layers,n=[],i=0,r=0,a=e.length;r<a;r++){var o=e[r];if(o.options.visible){var s=o.getTiles(t,this);s&&0!==s.count&&(i+=s.count,L(n,s.tileGrids))}}return{count:i,tileGrids:n}},n.onAdd=function(){var e=this,n=this.getMap();this.layers.forEach((function(t){e.layerMap[t.getId()]=t,t.getChildLayer&&e._groupChildren.push(t),t._bindMap(n),t.on("show hide",e._onLayerShowHide,e)})),t.prototype.onAdd.call(this)},n.onRemove=function(){var e=this;this.layers.forEach((function(t){t._doRemove(),t.off("show hide",e._onLayerShowHide,e)})),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},n.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var i=this._groupChildren[n].getChildLayer(t);if(i)return i}return null},n._onLayerShowHide=function(){var t=this.getRenderer();t&&t.setToRedraw()},n.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,n=0,i=e.length;n<i;n++)if(e[n].isVisible())return!0;return!1},n._checkChildren=function(){var t=this,e={};this.layers.forEach((function(n){var i=n.getId();if(e[i])throw new Error("Duplicate child layer id ("+i+") in the GroupTileLayer ("+t.getId()+")");e[i]=1}))},e}(to);eo.registerJSONType("GroupTileLayer");var no={crs:null,uppercase:!1,detectRetina:!1},io={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},ro=function(t){function e(e,n){var i;i=t.call(this,e)||this;var r=f({},io);for(var a in n)a in i.options||(r[a]=n[a]);i.setOptions(n),i.setZIndex(n.zIndex);var o=i.getTileSize();return r.width=o.width,r.height=o.height,i.wmsParams=r,i._wmsVersion=parseFloat(r.version),i}se(e,t);var n=e.prototype;return n.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),n=no.detectRetina?e:1;this.wmsParams.width*=n,this.wmsParams.height*=n;var i=this.options.crs||this.getMap().getProjection().code,r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=i,t.prototype.onAdd.call(this)},n.getTileUrl=function(e,n,i){var r=this.getSpatialReference().getResolution(i),a=this._getTileConfig().getTilePrjExtent(e,n,r),o=a.getMax(),s=a.getMin(),u=(this._wmsVersion>=1.3&&"EPSG:4326"===this.wmsParams.crs?[s.y,s.x,o.y,o.x]:[s.x,s.y,o.x,o.y]).join(","),h=t.prototype.getTileUrl.call(this,e,n,i);return h+function(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}(this.wmsParams,h,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+u},n.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(to);ro.registerJSONType("WMSTileLayer"),ro.mergeOptions(no);var ao=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}se(e,t);var n=e.prototype;return n.drawTile=function(){},n.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(to);function oo(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error("Failed to compile shader: "+r)}return i}ao.registerJSONType("CanvasTileLayer");var so=[0,0],uo=[0,0,0],ho=new Array(16),co=function(t){var e=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.drawGLImage=function(t,e,n,i,r,a){var o=this.gl;this.loadTexture(t),uo[0]=e||0,uo[1]=n||0;var s=ca(ho);oa(s,s,uo),ua(s,this.getMap().projViewMatrix,s),o.uniformMatrix4fv(this.program.u_matrix,!1,s),o.uniform1f(this.program.u_opacity,a);var u=t.glBuffer;!u||u.width===i&&u.height===r||(this.saveImageBuffer(u),delete t.glBuffer),t.glBuffer?o.bindBuffer(o.ARRAY_BUFFER,u):t.glBuffer=this.bufferTileData(0,0,i,r),so[0]="a_position",so[1]=3,this.enableVertexAttrib(so),o.drawArrays(o.TRIANGLE_STRIP,0,4)},n.bufferTileData=function(t,e,n,i,r){var a=t,o=t+n,s=e,u=e+i,h=this.loadImageBuffer(this.set12(a,s,0,a,u,0,o,s,0,o,u,0),r);return h.width=n,h.height=i,h},n.drawTinImage=function(t,e,n,i,r){var a=this.gl;this.loadTexture(t),a.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),a.uniform1f(this.program.u_opacity,r),a.bindBuffer(a.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.DYNAMIC_DRAW),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),a.DYNAMIC_DRAW),a.drawElements(a.TRIANGLES,i.length,a.UNSIGNED_SHORT,0)},n.createCanvas2=function(){this.canvas2=un.createCanvas(this.canvas.width,this.canvas.height)},n.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=function(t,e){for(var n={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},i=["webgl","experimental-webgl"],r=null,a=0;a<i.length;++a){try{r=t.getContext(i[a],e||n)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram("\n        attribute vec3 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 1.0);\n\n            v_texCoord = a_texCoord;\n        }\n    ",this.layer.options.fragmentShader||"\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n\n            gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n\n        }\n    ",["u_matrix","u_image","u_opacity"]),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.posBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),this.indicesBuffer=this.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)},n.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},n.clearGLCanvas=function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},n.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},n._createTexture=function(t){var e=this.gl,n=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),g(z(t.width))&&g(z(t.width))&&e.generateMipmap(e.TEXTURE_2D),n},n.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},n.saveTexture=function(t){this._textures.push(t)},n.loadTexture=function(t){var e=this.gl,n=t.texture;return n||(n=this._createTexture(t),t.texture=n),e.bindTexture(e.TEXTURE_2D,n),n},n.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},n.saveImageBuffer=function(t){this._imageBuffers.push(t)},n.loadImageBuffer=function(t,e){var n=this.gl,i=e||this.createImageBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),i},n.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},n.removeGLCanvas=function(){var t=this.gl;if(t){this._buffers&&(this._buffers.forEach((function(e){t.deleteBuffer(e)})),delete this._buffers),this._textures&&(this._textures.forEach((function(e){return t.deleteTexture(e)})),delete this._textures),delete this.posBuffer;var e=t.program;t.deleteShader(e.fragmentShader),t.deleteShader(e.vertexShader),t.deleteProgram(e),delete this.gl,delete this.canvas2}},n.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},n.enableVertexAttrib=function(t){!function(t,e,n){if(Array.isArray(n[0])){for(var i=Float32Array.BYTES_PER_ELEMENT,r=0,a=0;a<n.length;a++)r+=n[a][1]||0;for(var o=0,s=0;s<n.length;s++){var u=t.getAttribLocation(e,n[s][0]);if(u<0)throw new Error("Failed to get the storage location of "+n[s][0]);t.vertexAttribPointer(u,n[s][1],t[n[s][2]||"FLOAT"],!1,i*r,i*o),o+=n[s][1]||0,t.enableVertexAttribArray(u)}}else{var h=t.getAttribLocation(e,n[0]);t.vertexAttribPointer(h,n[1],t[n[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(h)}}(this.gl,this.gl.program,t)},n.createProgram=function(t,e,n){var i=function(t,e,n){var i=oo(t,t.VERTEX_SHADER,e),r=oo(t,t.FRAGMENT_SHADER,n);if(!i||!r)return null;var a=t.createProgram();return a?(t.attachShader(a,i),t.attachShader(a,r),t.linkProgram(a),{program:a,vertexShader:i,fragmentShader:r}):null}(this.gl,t,e),r=i.program,a=i.vertexShader,o=i.fragmentShader;return r.vertexShader=a,r.fragmentShader=o,this._initUniforms(r,n),r},n.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},n.enableSampler=function(t,e){var n=this.gl,i=this._getUniform(n.program,t);return e||(e=0),n.uniform1i(i,e),i},n._initUniforms=function(t,e){for(var n=0;n<e.length;n++){var i=e[n],r=e[n],a=i.indexOf("[");a>=0&&(i=i.substring(0,a),P||(r=r.substring(0,a))),t[i]=this._getUniform(t,r)}},n._getUniform=function(t,e){var n=this.gl.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+e);return n},e}(t);return f(e.prototype,{set12:function(){var t=oe.ie9?null:new Float32Array(12);return function(e,n,i,r,a,o,s,u,h,c,l,f){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=f,t}}()}),e},lo={renderer:oe.webgl?"gl":"canvas",crossOrigin:null},fo=function(t){function e(e,n,i){var r;return!n||Array.isArray(n)||n.url||(i=n,n=null),(r=t.call(this,e,i)||this)._images=n,r}se(e,t);var n=e.prototype;return n.onAdd=function(){this._prepareImages(this._images)},n.setImages=function(t){return this._images=t,this._prepareImages(t),this},n.getImages=function(){return this._images},n._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap();this._imageData=t.map((function(t){var n=new Vn(t.extent);return f({},t,{extent:n,extent2d:n.convertTo((function(t){return e.coordToPoint(t,e.getGLZoom())}))})})),this._images=t;var n=this.getRenderer();n&&n.refreshImages()},e}(di);fo.mergeOptions(lo);var po=[],go=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.isDrawable=function(){return!this.getMap().getPitch()||(console,!1)},n.checkResources=function(){var t=this;if(this._imageLoaded)return po;var e=this.layer._imageData.map((function(t){return[t.url,null,null]}));if(this.resources){var n=[],i=new fi;e.forEach((function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);i.addResource(e,r)}else n.push(e)})),this.resources.forEach((function(e,n){i.isResourceLoaded(e)||t.retireImage(n.image)})),this.resources=i,e=n}return this._imageLoaded=!0,e},n.retireImage=function(){},n.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},n.needToRedraw=function(){var e=this.getMap();return!(e.isZooming()&&!e.getPitch())&&t.prototype.needToRedraw.call(this)},n.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},n._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),n=e._get2DExtent(e.getGLZoom());if(t&&t.length)for(var i=0;i<t.length;i++){var r=t[i].extent2d,a=this.resources&&this.resources.getImage(t[i].url);a&&n.intersects(r)&&(this._painted=!0,this._drawImage(a,r,t[i].opacity||1))}},n._drawImage=function(t,e,n){var i=0,r=this.context;n<1&&(i=r.globalAlpha,r.globalAlpha=n);var a=this.getMap(),o=e.getMin(),s=e.getMax(),u=a._pointToContainerPoint(o,a.getGLZoom()),h=u.x,c=u.y,l=a.getBearing();l&&(r.save(),r.translate(h,c),l&&r.rotate(-l*Math.PI/180),h=c=0);var f=a.getGLScale();r.drawImage(t,h,c,(s.x-o.x)/f,(s.y-o.y)/f),l&&r.restore(),i&&(r.globalAlpha=i)},n.drawOnInteracting=function(){this.draw()},e}(li),vo=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.isDrawable=function(){return!0},n._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymin,e.getWidth(),e.getHeight(),n)},n.createContext=function(){this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.retireImage=function(t){this.disposeImage(t)},n.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(co(go));fo.registerRenderer("canvas",go),fo.registerRenderer("gl",vo);var mo=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getPrepareParams=function(){return[]},n.getDrawParams=function(){return[]},n.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=un.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},n.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},n.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer()},n.drawOnInteracting=function(){this._drawLayerOnInteracting()},n.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var n=e.image;this.buffer.width===n.width&&this.buffer.height===n.height||(this.buffer.width=n.width,this.buffer.height=n.height);var i=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(i,this.context);(void 0===r||r)&&(un.image(i,n,0,0),e.image=this.buffer)}return e},n.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},n.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},n.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},n.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},n.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},n.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},n.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},n.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},n.prepareDrawContext=function(){if(!this._predrawed){var t=yo(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},n._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],n=yo(this.getDrawParams());return e.push.apply(e,n),e.push.apply(e,this._drawContext),e},n._drawLayer=function(){var t=this._prepareDrawParams();t&&(this.layer.draw.apply(this.layer,t),this.completeRender())},n._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();t&&(this.layer.drawOnInteracting.apply(this.layer,t),this.completeRender())}},e}(li);function yo(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var _o=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.isCanvasRender=function(){return!0},n.prepareToDraw=function(){},n.draw=function(){},n.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},n.play=function(){return this.config("animation",!0),this},n.pause=function(){return this.config("animation",!1),this},n.isPlaying=function(){return this.options.animation},n.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},n.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},n.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},n.onCanvasCreate=function(){return this},n.onZoomStart=function(){},n.onZooming=function(){},n.onZoomEnd=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){},n.onResize=function(){},n.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(di);_o.mergeOptions({doubleBuffer:!1,animation:!1}),_o.registerRenderer("canvas",mo);var bo=new ce(0,0),wo=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.getParticles=function(){},n.draw=function(t,e){var n=this.getParticles(l());if(n&&0!==n.length){var i=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo((function(t){return i._pointToContainerPoint(t,void 0,0,bo)}));for(var a=2*Math.PI,o=0,s=n.length;o<s;o++){var u=n[o].point;if(r.contains(u)){var h=n[o].color||this.options.lineColor||"#fff",c=n[o].r;t.fillStyle!==h&&(t.fillStyle=h),c<=2?t.fillRect(u.x-c/2,u.y-c/2,c,c):(t.beginPath(),t.arc(u.x,u.y,c/2,0,a),t.fill())}}this._fillCanvas(t)}else this._getRenderer()&&(this._getRenderer()._shouldClear=!0)},n._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var n=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/n+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(_o);wo.mergeOptions({animation:!0}),wo.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},n.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},n.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(mo));var xo=r+"_edit_stage_";function Oo(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var jo={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Oo("ellipse",1),vertexHandleSymbol:Oo("square",1),newVertexHandleSymbol:Oo("square",.4)},ko=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._geometry=e,i._geometry?i:ue(i)}se(e,t);var n=e.prototype;return n.getMap=function(){return this._geometry.getMap()},n.prepare=function(){this.getMap()&&(this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},n._prepareEditStageLayer=function(){var t=this.getMap(),e=E(),n=xo+e,i=xo+e+"_shadow";this._editStageLayer=t.getLayer(n),this._shadowLayer=t.getLayer(i),this._editStageLayer||(this._editStageLayer=new Qr(n),t.addLayer(this._editStageLayer)),this._shadowLayer||(this._shadowLayer=new Qr(i),t.addLayer(this._shadowLayer))},n.start=function(){var t=this;if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){var e=this.getMap();this.editing=!0;var n=this._geometry;this._geometryDraggble=n.options.draggable,n.config("draggable",!1),this.prepare();var i=n.copy();i.setSymbol(n._getInternalSymbol()),i.copyEventListeners(n),n._getParent()&&i.copyEventListeners(n._getParent()),i.setId(null).config({draggable:!1}),this._shadow=i,this._switchGeometryEvents("on"),n.hide(),(n instanceof br||n instanceof Ar||n instanceof Rr||n instanceof Lr)&&this._createOrRefreshOutline(),this._shadowLayer.bringToFront().addGeometry(i),this._editStageLayer.bringToFront(),this._addListener([e,"zoomstart",function(){t._editStageLayer.hide()}]),this._addListener([e,"zoomend",function(){t._editStageLayer.show()}]),n instanceof br?(i.config("draggable",!0),i.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),n instanceof br?this.createMarkerEditor():n instanceof Ar?this.createCircleEditor():n instanceof Rr?this.createEllipseOrRectEditor():n instanceof Lr?this.createEllipseOrRectEditor():n instanceof Ir||(n instanceof yr||n instanceof xr)&&this.createPolygonEditor()}},n.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()&&(delete this._shadow,this._geometry.config("draggable",this._geometryDraggble),delete this._geometryDraggble,this._geometry.show(),this._editStageLayer.remove(),this._shadowLayer.remove(),this._clearAllListeners(),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1)},n.isEditing=function(){return!d(this.editing)&&this.editing},n._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,"positionchange shapechange":this._exeAndReset}},n._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},n._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},n._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray()),this._refresh()},n._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;return e?(e.remove(),this._editOutline=e=t.getOutline(),this._editStageLayer.addGeometry(e)):(e=t.getOutline(),this._editStageLayer.addGeometry(e),this._editOutline=e,this._addRefreshHook(this._createOrRefreshOutline)),e},n._createCenterHandle=function(){var t,e=this,n=this._shadow.getCenter(),i=this.options.centerHandleSymbol,r=this.createHandle(n,{symbol:i,cursor:"move",onDown:function(){var n=Rt((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(n).addTo(e._editStageLayer)},onMove:function(e,n){var i=n.coordOffset;t.translate(i)},onUp:function(){e._update("setCoordinates",Tn.toNumberArrays(t.getCoordinates())),t.remove(),e._refresh()}});this._addRefreshHook((function(){var t=e._shadow.getCenter();r.setCoordinates(t)}))},n._createHandleInstance=function(t,e){var n=e.symbol;return new br(t,{draggable:!0,dragShadow:!1,dragOnAxis:e.axis,cursor:e.cursor,symbol:n})},n.createHandle=function(t,e){e||(e={});var n=this.getMap(),i=this._createHandleInstance(t,e),r=this;function a(t){return e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(r,t.viewPoint,t)),!1}function o(t){r._hideContext();var a=n._prjToViewPoint(i._getPrjCoordinates());return e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(r,a,t)),!1}function s(t){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(r,t)),!1}return i.on("dragstart",a,this),i.on("dragging",o,this),i.on("dragend",s,this),i.on("removestart",(function t(){i.config("draggable",!1),i.off("dragstart",a,r),i.off("dragging",o,r),i.off("dragend",s,r),i.off("removestart",t,r),delete i["maptalks--editor-refresh-fn"]}),this),e.onRefresh&&(i["maptalks--editor-refresh-fn"]=e.onRefresh),this._editStageLayer.addGeometry(i),i},n._createResizeHandles=function(t,e,n){var i=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],a=[null,"y",null,"x","x",null,"y",null],o=this._geometry;t||(t=[]);var s=this,u=[],h={},c=this.getMap(),l=this.options.vertexHandleSymbol,f=function(){for(var f=function(t){return[t.getMin(),new ce((t.xmax+t.xmin)/2,t.ymin),new ce(t.xmax,t.ymin),new ce(t.xmin,(t.ymax+t.ymin)/2),new ce(t.xmax,(t.ymax+t.ymin)/2),new ce(t.xmin,t.ymax),new ce((t.xmax+t.xmin)/2,t.ymax),t.getMax()]}(o._getPainter().get2DExtent()),d=function(d){if(Array.isArray(t)&&t.some((function(t){return t===d})))return"continue";var p=f[d],g=c.pointToCoordinate(p);if(u.length<f.length-t.length){var v=i.createHandle(g,{symbol:l,cursor:r[d],axis:a[d],onMove:function(t){return function(n){s._updating=!0,e(n,t),o.fire("resizing")}}(d),onUp:function(){s._updating=!1,n(),i._refresh()}});v.setId(d),h[d]=u.length,u.push(v)}else u[h[d]].setCoordinates(g)},p=0;p<f.length;p++)d(p)};return f(),this._addRefreshHook(f),u},n.createMarkerEditor=function(){var t=this,e=this._geometry,n=this._shadow,i=this.getMap();if(n._canEdit()){this._history||this._recordHistory(l());var r=n._getInternalSymbol(),a=new ce(0,0);p(r.markerDx)&&(a.x=r.markerDx),p(r.markerDy)&&(a.y=r.markerDy);var o=null;Li.test(r)?"pin"!==r.markerType&&"pie"!==r.markerType&&"bar"!==r.markerType||(o=[5,6,7]):(Ii.test(r)||Vi.test(r))&&(o=[5,6,7]);var s,u=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var h=n.getSize();s=h.width/h.height}var c=this._createResizeHandles(null,(function(r,h){if(o&&o.indexOf(h)>=0){var l=i.viewPointToCoordinate(r.sub(a)),f=n.getCoordinates();l.x=f.x,n.setCoordinates(l),t._updateCoordFromShadow(!0);var d=c[c.length-1-h];r=i.coordToViewPoint(d.getCoordinates())}var p=i._pointToViewPoint(n._getCenter2DPoint()).add(a),g=n._getInternalSymbol(),v=r.sub(p);o&&r.y>p.y&&(v.y=0);var m=o?1:2,y=2*Math.abs(v.x),_=Math.abs(v.y)*m;s&&(_=(y=Math.max(y,_*s))/s);var b=u[h];n instanceof Gr?((s||0===b||2===b)&&(n.setWidth(y),e.setWidth(y)),(s||1===b||2===b)&&(n.setHeight(_),e.setHeight(_))):((s||0===b||2===b)&&(g.markerWidth=y),(s||1===b||2===b)&&(g.markerHeight=_),n.setSymbol(g),e.setSymbol(g))}),(function(){t._update(l())}));this._addListener([i,"zoomend",function(){this._refresh()}])}else console;function l(){var t=[["setCoordinates",n.getCoordinates().toArray()]];return n instanceof Gr?(t.push(["setWidth",n.getWidth()]),t.push(["setHeight",n.getHeight()])):t.push(["setSymbol",n.getSymbol()]),t}},n.createCircleEditor=function(){var t=this,e=this._geometry,n=this._shadow,i=this.getMap();this._history||this._recordHistory([["setCoordinates",n.getCoordinates().toArray()],["setRadius",n.getRadius()]]),this._createResizeHandles(null,(function(t){var r,a=i._pointToViewPoint(n._getCenter2DPoint()),o=t.sub(a),s=Math.abs(o.x),u=Math.abs(o.y);r=s>u?i.pixelToDistance(s,0):i.pixelToDistance(0,u),n.setRadius(r),e.setRadius(r)}),(function(){t._update("setRadius",n.getRadius())}))},n.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._geometry,i=this._shadow;this._history||this._recordHistory(u());var r,a=this.getMap(),o=this._geometry instanceof Rr;this.options.fixAspectRatio&&(r=n.getWidth()/n.getHeight());var s=this._createResizeHandles(null,(function(u,h){var c,l,f,d=o?1:2,p=u,g=e[h];if(o){var v=s[7-h],m=a.coordToViewPoint(v.getCoordinates()),y=(c=p.sub(m)).abs();l=a.pixelToDistance(y.x,0),f=a.pixelToDistance(0,y.y);var _=n.getSize();0===g?(r&&(y.y=y.x/r,_.height=Math.abs(y.y),f=l/r),p.y=m.y-_.height/2):1===g?(r&&(y.x=y.y*r,_.width=Math.abs(y.x),l=f*r),p.x=m.x-_.width/2):r&&(l>f*r?(f=l/r,p.y=m.y+y.x*F(c.y)/r):(l=f*r,p.x=m.x+y.y*F(c.x)*r));var b=a.viewPointToCoordinate(new ce(Math.min(p.x,m.x),Math.min(p.y,m.y)));i.setCoordinates(b),t._updateCoordFromShadow(!0)}else c=a.coordToViewPoint(n.getCenter()).sub(p)._abs(),l=a.pixelToDistance(c.x,0),f=a.pixelToDistance(0,c.y),r&&(f=(l=Math.max(l,f*r))/r);(r||0===g||2===g)&&(i.setWidth(l*d),n.setWidth(l*d)),(r||1===g||2===g)&&(i.setHeight(f*d),n.setHeight(f*d))}),(function(){t._update(u())}));function u(){return[["setCoordinates",i.getCoordinates().toArray()],["setWidth",i.getWidth()],["setHeight",i.getHeight()]]}},n.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow,n=this,i=t.getProjection();this._history||this._recordHistory("setCoordinates",Tn.toNumberArrays(e.getCoordinates()));var r=e instanceof yr?3:2,a="maptalks--editor-refresh-fn",o="maptalks--editor-vertex-index",s=[],u=[];function h(){if(e instanceof yr){var t=e.getCoordinates()[0];return t.slice(0,t.length-1)}return e.getCoordinates()}function c(){return e._getPrjCoordinates()}function l(){for(var t=s.length-1;t>=0;t--)s[t][o]=t;for(var e=u.length-1;e>=0;e--)u[e][o]=e;n._updateCoordFromShadow()}function f(t){var i,a=t.target[o],h=c();h.length<=r||(h.splice(a,1),e._setPrjCoordinates(h),e._updateCache(),s.splice(a,1)[0].remove(),a<u.length&&u.splice(a,1)[0].remove(),i=0===a?u.length-1:a-1,u.splice(i,1)[0].remove(),u.splice(i,0,g.call(n,i)),l(),n._refresh())}function d(i,r){var o,s=c(),h=t._viewPointToPrj(i),l=s[r];l.x=h.x,l.y=h.y,e._updateCache(),e.onShapeChanged(),n._updateCoordFromShadow(!0),o=0===r?u.length-1:r-1,u[r]&&u[r][a](),u[o]&&u[o][a]()}function p(t){var e=h()[t],i=n.createHandle(e,{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(t){d(t,i[o])},onRefresh:function(){e=h()[i[o]],i.setCoordinates(e)},onUp:function(){n._refresh(),n._updateCoordFromShadow()},onDown:function(t,e){!e||!e.domEvent||e.domEvent.button}});return i[o]=t,i.on(n.options.removeVertexOn,f),i}function g(t){var r,a=h();r=t+1>=a.length?a[0]:a[t+1];var f=a[t].add(r).multi(.5),v=n.createHandle(f,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(t,r){if(!r||!r.domEvent||2!==r.domEvent.button){var a=c(),s=v[o],h=i.project(v.getCoordinates());a.splice(s+1,0,h),e._setPrjCoordinates(a),e._updateCache();var l=v.getSymbol();delete l.opacity,v.setSymbol(l),u.splice(s,0,g.call(n,s),g.call(n,s+1))}},onMove:function(t){d(t,v[o]+1)},onUp:function(t){if(!t||!t.domEvent||2!==t.domEvent.button){var e=v[o];R(v,u),v.remove(),s.splice(e+1,0,p.call(n,e+1)),l(),n._updateCoordFromShadow(),n._refresh()}},onRefresh:function(){a=h();var t,e=v[o];t=e===a.length-1?0:e+1;var n=a[e].add(a[t]).multi(.5);v.setCoordinates(n)}});return v[o]=t,v}for(var v=h(),m=0,y=v.length;m<y;m++)s.push(p.call(this,m)),m<y-1&&u.push(g.call(this,m));e instanceof yr&&u.push(g.call(this,v.length-1)),this._addRefreshHook((function(){for(var t=u.length-1;t>=0;t--)u[t][a]();for(var e=s.length-1;e>=0;e--)s[e][a]()}))},n._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},n._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},n._addListener=function(t){this._eventListeners||(this._eventListeners=[]),this._eventListeners.push(t),t[0].on(t[1],t[2],this)},n._clearAllListeners=function(){if(this._eventListeners&&this._eventListeners.length>0){for(var t=this._eventListeners.length-1;t>=0;t--){var e=this._eventListeners[t];e[0].off(e[1],e[2],this)}this._eventListeners=[]}},n._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},n._update=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._exeHistory([t,n]),this._recordHistory.apply(this,[t].concat(n))},n._updateCoordFromShadow=function(t){if(this._shadow){var e=this._shadow.getCoordinates(),n=this._geometry,i=this._updating;this._updating=!0,n.setCoordinates(e),t||this._recordHistory("setCoordinates",Tn.toNumberArrays(n.getCoordinates())),this._updating=i}},n._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0),this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1);for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._history.push([t,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},n.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},n.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return null;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},n._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},n._exeHistory=function(t){var e=this;if(Array.isArray(t)){var n=this._updating;this._updating=!0;var i=this._geometry;Array.isArray(t[0])?t[0].forEach((function(t){var n=t[0],r=t.slice(1);e._shadow[n].apply(e._shadow,r),i[n].apply(i,r)})):(this._shadow[t[0]].apply(this._shadow,t[1]),i[t[0]].apply(i,t[1])),this._updating=n}},e}(yn(wn));ko.mergeOptions(jo);var Po={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),nn(this._textEditor,"mousedown dblclick",Ue),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new ka(this.getCoordinates(),{animation:null,content:e,dx:n.dx,dy:n.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,n=0,i=t.textHorizontalAlignment;return"middle"===i||d(i)?(e=(t.textDx||0)-2,n=(t.textDy||0)-2):(e=(t.markerDx||0)-2,n=(t.markerDy||0)-2),{dx:e,dy:n}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),n=this._getInternalSymbol()||{},i=e.width,r=n.textFill||"#000000",a=n.textSize||12,o=e.height,s=n.markerLineColor||"#000",u=n.markerFill||"#3398CC",h=n.textLineSpacing||0,c=Re("div");return c.contentEditable=!0,c.style.cssText="background:"+u+"; border:1px solid "+s+";\n            color:"+r+";font-size:"+a+"px;width:"+(i-2)+"px;height:"+(o-2)+"px;margin: auto;\n            line-height:"+(a+h)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",c.innerText=t,en(c,"mousedown dblclick",Ue),c.onkeyup=function(t){var e=c.style.height||0;13===t.keyCode&&(c.style.height=parseInt(e)+a/2+"px")},c},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}};Vr.include(Po),rr.include({animate:function(t,e,n){var i=this;this._animPlayer&&this._animPlayer.finish(),y(e)&&(n=e),e||(e={});var r,a=this.getMap(),o=this._getProjection(),s=this.getSymbol()||{},u=this._prepareAnimationStyles(t),h=e.focus;if(delete this._animationStarted,a){var c=a._getRenderer();e.framer=function(t){c.callInNextFrame(t)}}var l=pr.animate(u,e,(function(t){if(a&&a.isRemoved())l.finish();else{a&&!i._animationStarted&&h&&a.onMoveStart();var e=t.styles;for(var u in e)if("symbol"!==u&&"translate"!==u&&e.hasOwnProperty(u)){var c="set"+u[0].toUpperCase()+u.slice(1);i[c](e[u])}var f=e.translate;if(f){var d=f;r&&(d=f.sub(r)),r=f,i.translate(d)}var p=e.symbol;if(p&&i.setSymbol(It(s,p)),a&&h){var g=o.project(i.getCenter());a._setPrjCenter(g);var v=a._parseEventFromCoord(o.unproject(g));"running"!==l.playState?a.onMoveEnd(v):a.onMoving(v)}i._fireAnimateEvent(l.playState),n&&n(t)}}));return this._animPlayer=l,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if("translate"!==i&&"symbol"!==i){var a=this["get"+i[0].toUpperCase()+i.substring(1)]();n[i]=[a,r]}else if("symbol"===i){var o=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");o=[];for(var s=t.symbol,u=0;u<s.length;u++)if(s[u]){var h={};for(var c in s[u])s[u].hasOwnProperty(c)&&(h[c]=[e[u][c],s[u][c]]);o.push(h)}else o.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var l in o={},r)r.hasOwnProperty(l)&&(o[l]=[e[l],r[l]])}n.symbol=o}else"translate"===i&&(n.translate=new Tn(r))}return n},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Co=r+"_drag_stage",To=oe.touch?"touchstart mousedown":"mousedown",Mo=function(t){function e(e){return t.call(this,e)||this}se(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(To,this._startDrag,this)},n.removeHooks=function(){this._endDrag(),this.target.off(To,this._startDrag,this),delete this.container},n._prepareDragHandler=function(){this._dragHandler=new Cn(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},n._prepareShadow=function(){var t=this.target;this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var e=this._shadow=t.copy();if(this._shadow.setSymbol(t._getInternalSymbol()),t.options.dragShadow){var n=Rt(e._getInternalSymbol(),.5);e.setSymbol(n)}e.setId(null),this._prepareShadowConnectors()},n._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,i=[];if(Xr._hasConnectors(t))for(var r=Xr._getConnectors(t),a=0,o=r.length;a<o;a++){var s=r[a],u=s.config(),h=s._getInternalSymbol();u.symbol=Rt(h,.5);var c;c=s.getConnectSource()===t?new s.constructor(e,s.getConnectTarget(),u):new s.constructor(s.getConnectSource(),e,u),i.push(c),s.getLayer()&&s.getLayer()._getRenderer()&&n.merge(s.getLayer()._getRenderer().resources)}this._shadowConnectors=i,i.push(e),this._dragStageLayer.bringToFront().addGeometry(i)},n._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},n._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(Co),this._dragStageLayer||(this._dragStageLayer=new Qr(Co,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new fi;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},n._startDrag=function(t){var e=this.target.getMap();if(e&&!this.target._getParent()&&!this.isDragging()){var n=t.domEvent;n.touches&&n.touches.length>1||2===n.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),en(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},n._dragging=function(t){var e=this.target,n=e.getMap()._parseEvent(t.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",n),this.target._fireEvent("dragstart",this._startParam||n),void delete this._startParam;if(this._shadow){var r=this._shadow.options.dragOnAxis,a=this._correctCoord(n.coordinate),o=n.containerPoint;this._lastPoint=this._lastPoint||o,this._lastCoord=this._lastCoord||a;var s=o.sub(this._lastPoint),u=a.sub(this._lastCoord);"x"===r?s.y=u.y=0:"y"===r&&(s.x=u.x=0),this._lastPoint=o,this._lastCoord=a,this._shadow.translate(u),e.options.dragShadow||e.translate(u),n.coordOffset=u,n.pointOffset=s,this._shadow._fireEvent("dragging",n),e._fireEvent("dragging",n)}}},n._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&nn(this.container,"mouseleave",this._endDrag,this),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var i=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(i),this._moved&&e._fireEvent("dragend",i)}}},n.isDragging=function(){return!!this._isDragging},n._updateTargetAndRemoveShadow=function(t){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var i=this._shadow;i&&(e.options.dragShadow&&e.setCoordinates(i.getCoordinates()),i._fireEvent("dragend",t),i.remove(),delete this._shadow),this._shadowConnectors&&(n.getLayer(Co).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&this._dragStageLayer.remove()},n._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target._getPainter();if(!n.getMinAltitude())return t;var i=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-i)},e}(bn);rr.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null}),rr.addInitHook("addHandler","draggable",Mo),rr.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),rr.include({startEdit:function(t){return this.getMap()&&this.options.editable?(this.endEdit(),this._editor=new ko(this,t),this._editor.start(),this.fire("editstart"),this):this},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this.fire("undoedit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),rr.include({_onEvent:function(t,e){if(this.getMap()){var n=e||this._getEventTypeToFire(t);"contextmenu"===n&&this.listens("contextmenu")&&(Ue(t),Ne(t));var i=this._getEventParams(t);this._fireEvent(n,i)}},_getEventTypeToFire:function(t){return t.type},_getEventParams:function(t){var e=this.getMap(),n={domEvent:t},i=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(i){var r=Ze(i,e._containerDOM);n.coordinate=e.containerPointToCoordinate(r),n.containerPoint=r,n.viewPoint=e.containerPointToViewPoint(r),n.pont2d=e._containerPointToPoint(r)}return n}}),rr.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Ta?(this._infoWindow=t,this._infoWinOptions=f({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=f({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(this._infoWinOptions),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(this._infoWinOptions),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(t){return this._infoWindow=new Ta(t),this._infoWindow.addTo(this),this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var Eo=function(){function t(t,e){this.max=t,this.onRemove=e,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}(),So=new ce(0,0),Ao=new ce(0,0),Lo=new ce(0,0),Ro=function(t){function e(e){var n;return(n=t.call(this,e)||this).tilesInView={},n.tilesLoading={},n._parentTiles=[],n._childTiles=[],n.tileCache=new Eo(e.options.maxCacheSize,n.deleteTile.bind(ue(ue(n)))),n}se(e,t);var n=e.prototype;return n.getCurrentTileZoom=function(){return this._tileZoom},n.draw=function(){var t=this.getMap();if(this.isDrawable()){var e=this.prepareCanvas();if(!e||e.intersects(this.canvasExtent2D)){var n=this.layer.getTiles().tileGrids;if(n&&n.length){var i=0,r=!1,a={},o=[],s=[],u={},h=[],c={},l=[],f={},d={},p=this._markTiles(),g=this._getLoadLimit(),v=n.length;this._tileZoom=n[0].zoom,this._tileOffset=n[0].offset;for(var m=0;m<v;m++)for(var y=n[m],_=y.tiles,b=this._generatePlaceHolder(y.zoom),w=0,x=_.length;w<x;w++){var O=_[w],j=O.id,k=this._getCachedTile(j),P=!1;if(this._isLoadingTile(j)?(P=r=!0,this.tilesLoading[j].current=!0):k?(this.getTileOpacity(k.image)<1&&(P=r=!0),o.push(k)):(P=r=!0,g&&i+p[0]>g||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(i++,d[j+"@"+O.point.toArray().join()]=O)),P&&!a[j]){a[j]=1,b&&!f[j]&&(O.cache=!1,l.push({image:b,info:O}),f[j]=1);var C=this._findParentTile(O);if(C){var T=C.info.id;void 0===u[T]&&(u[T]=s.length,s.push(C))}else if(!s.length){var M=this._findChildTiles(O);M.length&&M.forEach((function(t){c[t.info.id]||(h.push(t),c[t.info.id]=1)}))}}}s.length&&(h.length=0,this._childTiles.length=0),this._drawTiles(o,s,h,l),i?this.loadTileQueue(d):r||(t.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),this._retireTiles()}else this.completeRender()}else this.completeRender()}},n.isTileCachedOrLoading=function(t){return this.tilesLoading[t]||this.tilesInView[t]||this.tileCache.get(t)},n._drawTiles=function(t,e,n,i){var r=this;e.length&&(e.sort((function(t,e){return Math.abs(e.info.z-r._tileZoom)-Math.abs(t.info.z-r._tileZoom)})),this._parentTiles=e),n.length&&(this._childTiles=n);var a={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles};this.onDrawTileStart(a),this._parentTiles.forEach((function(t){return r._drawTileAndCache(t)})),this._childTiles.forEach((function(t){return r._drawTileOffset(t.info,t.image)})),i.forEach((function(t){return r._drawTileOffset(t.info,t.image)}));var o=this.layer,s=this.getMap();if(!o.options.cascadeTiles||s.getPitch()<=o.options.minPitchToCascade)t.forEach((function(t){return r._drawTileAndCache(t)}));else{this.writeZoomStencil();for(var u=!1,h=0,c=t.length;h<c;h++)t[h].info.z!==this._tileZoom?u?this.resumeZoomStencilTest():(this.startZoomStencilTest(),u=!0):u&&this.pauseZoomStencilTest(),this._drawTileAndCache(t[h]);this.endZoomStencilTest()}this.onDrawTileEnd(a)},n.writeZoomStencil=function(){},n.startZoomStencilTest=function(){},n.endZoomStencilTest=function(){},n.pauseZoomStencilTest=function(){},n.resumeZoomStencilTest=function(){},n.onDrawTileStart=function(){},n.onDrawTileEnd=function(){},n._drawTileOffset=function(t,e){var n=this._tileOffset;if(n[0]||n[1]){var i=this.getMap(),r=i._getResolution(this._tileZoom)/i._getResolution(t.z);n[0]*=r,n[1]*=r,t.point._sub(n),t.extent2d._sub(n),this.drawTile(t,e),t.point._add(n),t.extent2d._add(n),n[0]/=r,n[1]/=r}else this.drawTile(t,e)},n._drawTileAndCache=function(t){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTileOffset(t.info,t.image),this.tileCache.add(t.info.id,t)},n.drawOnInteracting=function(){this.draw()},n.needToRedraw=function(){var e=this.getMap();return e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this))},n.hitDetect=function(){return!1},n._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},n.isDrawable=function(){return!this.getMap().getPitch()||(console,this.clear(),!1)},n.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},n._isLoadingTile=function(t){return!!this.tilesLoading[t]},n.clipCanvas=function(e){return this.layer.getMask()?t.prototype.clipCanvas.call(this,e):this._clipByPitch(e)},n._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),i=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*i,Math.ceil(n.getWidth())*i,Math.ceil(n.getHeight())*i),t.stroke(),t.clip(),!0},n.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],i=this.loadTile(n);void 0===i.loadTime&&(this.tilesLoading[n.id]={image:i,current:!0,info:n})}},n.loadTile=function(t){var e=this.layer.getTileSize(),n=new Image;return n.width=e.width,n.height=e.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url),n},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return d(n)||(t.crossOrigin=n),T(t,[e])},n.abortTileLoading=function(t){t&&(t.onload=Io,t.onerror=Io,t.src=Q)},n.onTileLoad=function(t,e){if(this.layer){var n=e.id;this.tilesInView&&(t.loadTime=l(),delete this.tilesLoading[n],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileload",{tile:e,tileImage:t}))}},n.onTileError=function(t,e){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,void(t.src=e.url);t instanceof Image&&this.abortTileLoading(t,e),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},n.drawTile=function(t,e){if(e&&this.getMap()){var n=t.point,i=t.z,r=t.id,a=this.getMap(),o=t.size,s=a.getZoom(),u=this.context,h=a._pointToContainerPoint(n,i,0,So),c=a.getBearing(),l=c||s!==i,f=this.getTileOpacity(e),d=u.globalAlpha;f<1&&(u.globalAlpha=f,this.setToRedraw()),l||h._round();var p=h.x,g=h.y,v=o[0],m=o[1];if(l){if(v+=.1,m+=.1,u.save(),u.translate(p,g),c&&u.rotate(-c*Math.PI/180),s!==i){var y=a._getResolution(i)/a._getResolution();u.scale(y,y)}p=g=0}if(un.image(u,e,p,g,v,m),this.layer.options.debug){var _=this.layer.options.debugOutline,b=r.split("-"),w=b.length;u.save(),u.strokeStyle=_,u.fillStyle=_,u.strokeWidth=10,u.font="15px monospace";var x=new ce(p,g);un.rectangle(u,x,{width:v,height:m},1,0),un.fillText(u,"x:"+b[w-3]+", y:"+b[w-2]+", z:"+b[w-1],x._add(10,20),_),un.drawCross(u,p+v/2,g+m/2,2,_),u.restore()}l&&u.restore(),u.globalAlpha!==d&&(u.globalAlpha=d),this.setCanvasUpdated()}},n._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e.options.background)return[];for(var n=this.getMap(),i=[],r=t.extent2d.getMin(),a=t.extent2d.getMax(),o=e._project(n._pointToPrj(r,t.z,Ao),Ao),s=e._project(n._pointToPrj(a,t.z,Lo),Lo),u=1;u<2;u++)this._findChildTilesAt(i,o,s,e,t.z+u);return i},n._findChildTilesAt=function(t,e,n,i,r){var a=i.options.zoomOffset,o=i.getId(),s=i.getSpatialReference().getResolution(r+a);if(s)for(var u,h,c=i._getTileConfig().getTileIndex(e,s),l=i._getTileConfig().getTileIndex(n,s),f=Math.min(c.idx,l.idx),d=Math.max(c.idx,l.idx),p=Math.min(c.idy,l.idy),g=Math.max(c.idy,l.idy),v=f;v<d;v++)for(var m=p;m<g;m++)u=i._getTileId({idx:v,idy:m},r+a,o),this.tileCache.has(u)&&(h=this.tileCache.getAndRemove(u),t.push(h),this.tileCache.add(u,h))},n._findParentTile=function(t){var e=this.getMap(),n=this._getLayerOfTile(t.layer);if(!n.options.background)return null;for(var i=n.getSpatialReference(),r=i.getZoomDirection(),a=n.options.zoomOffset,o=n.options.backgroundZoomDiff,s=t.extent2d.getCenter(),u=n._project(e._pointToPrj(s,t.z)),h=1;h<=o;h++){var c=t.z-r*h,l=i.getResolution(c+a);if(l){var f=n._getTileConfig().getTileIndex(u,l),d=n._getTileId(f,c+a,t.layer);if(this.tileCache.has(d)){var p=this.tileCache.getAndRemove(d);return this.tileCache.add(d,p),p}}}return null},n._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},n._getCachedTile=function(t){var e=this.tilesInView,n=this.tileCache.getAndRemove(t);if(n){e[t]=n;var i=this.tilesLoading;if(i&&i[t]){i[t].current=!1;var r=i[t],a=r.image,o=r.info;this.abortTileLoading(a,o),delete i[t]}}else n=e[t];return n},n._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},n.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(l()-t.loadTime)/(1e3/60*10)):1},n.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,t.prototype.onRemove.call(this)},n._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.tilesLoading[n].current=!1,t++;if(this.tilesInView)for(var i in this.tilesInView)this.tilesInView[i].current=!1,e++;return[t,e]},n._retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];!t&&n.current||(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),delete this.tilesLoading[e])}for(var i in this.tilesInView){var r=this.tilesInView[i];r.current||(delete this.tilesInView[i],this.tileCache.has(i)||this.deleteTile(r))}},n.deleteTile=function(t){t&&t.image&&(t.image.onload=null,t.image.onerror=null)},n._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var i=this.layer.getTileSize(),r=e._getResolution(t)/e._getResolution(),a=this._tilePlaceHolder=this._tilePlaceHolder||un.createCanvas(1,1);return a.width=i.width*r,a.height=i.height*r,y(n)?n(a):function(t){var e=t.getContext("2d"),n=t.width,i=t.height,r=n/16,a=i/16;e.beginPath();for(var o=0;o<16;o++)e.moveTo(0,o*a),e.lineTo(n,o*a),e.moveTo(o*r,0),e.lineTo(o*r,i);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var s=[[0,0],[n,0],[0,i],[n,i],[0,0],[0,i],[n,0],[n,i],[0,i/2],[n,i/2],[n/2,0],[n/2,i]],u=1;u<s.length;u+=2)e.moveTo(s[u-1][0],s[u-1][1]),e.lineTo(s[u][0],s[u][1]);e.lineWidth=4,e.stroke()}(a),a},e}(li);function Io(){return!1}to.registerRenderer("canvas",Ro);var Do=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.isDrawable=function(){return!0},n.needToRedraw=function(){var e=this.getMap();return!(!this._gl()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},n.drawTile=function(e,n){var i=this.getMap();if(e&&i&&n){var r=e._glScale=e._glScale||i.getGLScale(e.z),a=e.size[0]*r,o=e.size[1]*r;if(!1!==e.cache&&this._bindGLBuffer(n,a,o),this._gl()){var s=e.point,u=s.x*r,h=s.y*r,c=this.getTileOpacity(n);this.drawGLImage(n,u,h,a,o,c),c<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,n)}},n.writeZoomStencil=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE)},n.startZoomStencilTest=function(){var t=this.gl;t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,255)},n.endZoomStencilTest=function(){this.pauseZoomStencilTest()},n.pauseZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255)},n.resumeZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.EQUAL,0,255)},n._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=null!==n?n:"",t.src=e},n.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},n.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},n._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},n.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image)},n.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(co(Ro));function Fo(t){var e=this.layer.getTileSize(),n=this.canvas.constructor,i=this.getMap(),r=i.getDevicePixelRatio(),a=un.createCanvas(e.width*r,e.height*r,n);a.layer=this.layer;var o=this,s=new Vn(i.pointToCoordinate(t.point),i.pointToCoordinate(t.point.add(e.toPoint())),i.getProjection());return this.layer.drawTile(a,{url:t.url,point:t.point,center:i.pointToCoordinate(t.point.add(e.width/2,e.height/2)),extent:s,z:t.z,x:t.x,y:t.y},(function(e){e?o.onTileError(a,t):o.onTileLoad(a,t)})),a}to.registerRenderer("gl",Do);var zo=function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.prototype.loadTile=function(){return Fo.apply(this,arguments)},e}(Ro),Bo=function(t){function e(){return t.apply(this,arguments)||this}return se(e,t),e.prototype.loadTile=function(){return Fo.apply(this,arguments)},e}(Do);ao.registerRenderer("canvas",zo),ao.registerRenderer("gl",Bo);var No=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!V(t))return[];for(var e=[],n={},i=t.length-1;i>=0;i--){var r=t[i]._getExternalResources();if(r.length)if(this.resources)for(var a=0;a<r.length;a++){var o=r[a][0];this.resources.isResourceLoaded(r[a])||n[o]||(e.push(r[a]),n[o]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},n.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},n._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),L(this._geosToCheck,t))},n.onGeometryAdd=function(t){this._addGeoToCheckRes(t),Uo(this)},n.onGeometryRemove=function(){Uo(this)},n.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),Uo(this)},n.onGeometryShapeChange=function(){Uo(this)},n.onGeometryPositionChange=function(){Uo(this)},n.onGeometryZIndexChange=function(){Uo(this)},n.onGeometryShow=function(){Uo(this)},n.onGeometryHide=function(){Uo(this)},n.onGeometryPropertiesChange=function(){Uo(this)},e}(li);function Uo(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Vo=new Gn,Go=function(t){function e(){return t.apply(this,arguments)||this}se(e,t);var n=e.prototype;return n.checkResources=function(){var e=this,n=t.prototype.checkResources.apply(this,arguments),i=this.layer.getStyle();return i&&(Array.isArray(i)||(i=[i]),i.forEach((function(t){for(var i=Mt(t.symbol,!0),r=0,a=i.length;r<a;r++)e.resources.isResourceLoaded(i[r])||n.push(i[r])}))),n},n.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===Qr)&&t.prototype.needToRedraw.call(this)},n.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},n.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},n.drawOnInteracting=function(){if(this._geosToDraw){this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount();if(t.isZooming()&&t.options.seamlessZoom&&this._geosToDraw.length<e){var n=this.getMap().getResolution();void 0!==this._drawnRes&&n>1.5*this._drawnRes&&(this.prepareToDraw(),this.forEachGeo(this.checkGeo,this),this._drawnRes=n)}for(var i=0,r=this._geosToDraw.length;i<r;i++){var a=this._geosToDraw[i];a.isVisible()&&a._paint(this._displayExtent)}}},n.show=function(){this.layer.forEach((function(t){t._repaint()})),t.prototype.show.apply(this,arguments)},n.forEachGeo=function(t,e){this.layer.forEach(t,e)},n.drawGeos=function(){this._drawnRes=this.getMap().getResolution(),this._updateDisplayExtent(),this.prepareToDraw(),this.forEachGeo(this.checkGeo,this);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint()},n.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},n.checkGeo=function(t){if(t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),n=e.get2DExtent(this.resources,Vo);n&&n.intersects(this._displayExtent)&&(e.hasPoint()&&(this._hasPoint=!0),this._geosToDraw.push(t))}},n.onZoomEnd=function(){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,arguments)},n.onRemove=function(){this.forEachGeo((function(t){t.onHide()})),delete this._geosToDraw},n.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},n._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},n.identify=function(t,e){void 0===e&&(e={});var n=this._geosToDraw;return n?this.layer._hitGeos(n,t,e):[]},e}(No);Qr.registerRenderer("canvas",Go);var Ho=function(t){function e(e){var n;return(n=t.call(this)||this).map=e,n._handlerQueue={},n}se(e,t);var n=e.prototype;return n.callInNextFrame=function(t){this._handlerQueue.push(t)},n.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},n.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&0===t.x&&0===t.y)return this;var n=this.map._panels,i=this._frontCount=n.back.layerDOM.childElementCount,r=this._backCount=n.front.layerDOM.childElementCount,a=this._uiCount=n.front.uiDOM.childElementCount;if(i||r||a){var o=this.map.offsetPlatform();o=t?o.add(t)._round():o.round(),r&&Ge(n.back,o),(i||a)&&Ge(n.front,o)}return this},n.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(void 0===this._frontCount||this._frontCount!==e)return!0;var n=t.front.layerDOM.childElementCount;if(void 0===this._backCount||this._backCount!==n)return!0;var i=t.front.uiDOM.childElementCount;return void 0===this._uiCount||this._uiCount!==i},n.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new ce(0,0);Ge(this.map._panels.back,t),Ge(this.map._panels.front,t)}},n.onZoomEnd=function(){this.resetContainer()},n.onLoad=function(){this._frameLoop()},e}(wn),Zo=function(t){function e(e){var n;return(n=t.call(this,e)||this)._containerIsCanvas=!!e._containerDOM.getContext,n._registerEvents(),n._loopTime=0,n}se(e,t);var n=e.prototype;return n.load=function(){this.initContainer()},n.renderFrame=function(t){if(!this.map)return!1;var e=this.map;e._fireEvent("framestart"),this.updateMapDOM();var n=this._getAllLayerToRender();return this.drawLayers(n,t),this.drawLayerCanvas(n),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},n.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},n.drawLayers=function(t,e){for(var n=this.map,i=n.isInteracting(),r=[],a=[],o=n.options.fpsOnInteracting||0,s=0===o?0:1e3/o,u=this.map.options.layerCanvasLimitOnInteracting,h=t.length,c=n.getBaseLayer(),l=0,f=0;f<h;f++){var d=t[f];if(d.isVisible()){var p=d.isCanvasRender();p&&r.push(d.getId());var g=d._getRenderer();if(g){var v=this._checkLayerRedraw(d);p&&g.isCanvasUpdated()&&(v||a.push(d.getId()),this.setLayerCanvasUpdated());var m=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,v){if(i&&p){if(u>0&&h-1-f>u&&d!==c){d._getRenderer().clearCanvas();continue}l+=this._drawCanvasLayerOnInteracting(d,l,s,e)}else i&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.drawOnInteracting(this._eventParam,e)):(g.render(e),p&&m&&g.isLoadingResource()&&(g.__zoomTransformMatrix=m));p&&(a.push(d.getId()),this.setLayerCanvasUpdated())}else p&&i&&(n.isZooming()&&!n.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(n.getPitch()||n.isRotating())&&g.clearCanvas())}}}var y=this._canvasIds||[],_=this._updatedIds||[];this._canvasIds=r,this._updatedIds=a,this.isLayerCanvasUpdated()||y.join("---")===r.join("---")&&_.join("---")===a.join("---")||this.setLayerCanvasUpdated()},n._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return t.isCanvasRender()?n.testIfNeedRedraw():!(!n.needToRedraw||!n.needToRedraw())||e.isInteracting()||this.isViewChanged()},n._drawCanvasLayerOnInteracting=function(t,e,n,i){var r=this.map,a=t._getRenderer(),o=a.getDrawTime(),s=0===n||n>0&&e+o<=n;if(a.mustRenderOnInteracting&&a.mustRenderOnInteracting())a.render(i);else{if(a.drawOnInteracting&&(t===r.getBaseLayer()||s||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return a.prepareRender(),a.prepareCanvas(),a.drawOnInteracting(this._eventParam,i),o;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&a.clearCanvas():(a.prepareRender(),a.__zoomTransformMatrix=this._zoomMatrix)}return a.drawOnInteracting&&!s&&a.onSkipDrawOnInteracting(this._eventParam,i),0},n._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach((function(e){var n=t.getLayer(e);if(n){var i=n._getRenderer();i&&i.isRenderComplete()&&n.fire("layerload")}}))}},n.isLayerCanvasUpdated=function(){return this._canvasUpdated},n.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},n.drawLayerCanvas=function(t){var e=this.map;if(e&&(this.isLayerCanvasUpdated()||this.isViewChanged())){this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n,i=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,a=t.length,o=[],s=0;s<a;s++)if(t[s].isVisible()&&t[s].isCanvasRender()&&t[s]._getRenderer()){var u=this._getLayerImage(t[s]);u&&u.image&&(t[s]===e.getBaseLayer()?n=[t[s],u]:o.push([t[s],u]))}n&&(this._drawLayerCanvasImage(n[0],n[1]),this._drawFog()),a=o.length;for(var h=i&&r>=0&&a>r?a-r:0;h<a;h++)this._drawLayerCanvasImage(o[h][0],o[h][1]);this._drawCenterCross(),e._fireEvent("renderend",{context:this.context})}},n.setToRedraw=function(){for(var t=this._getAllLayerToRender(),e=0,n=t.length;e<n;e++){var i=t[e].getRenderer();i&&i.canvas&&i.setToRedraw&&i.setToRedraw()}},n.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",n=t.height+"px",i=this.map._panels;i.mapWrapper.style.width=e,i.mapWrapper.style.height=n,this._updateCanvasSize()}},n.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},n.toDataURL=function(t){return this.canvas?this.canvas.toDataURL(t):null},n.remove=function(){oe.webgl&&"undefined"!=typeof document&&ze(document,"visibilitychange",this._onVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},n.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var n=e._getLayers(),i="default",r=e.options.hitDetectLimit||0,a=0,o=n.length-1;o>=0;o--){var s=n[o];if(!s.isEmpty||!s.isEmpty()){var u=s._getRenderer();if(u&&u.hitDetect&&(!u.isBlank||!u.isBlank())){if("default"!==s.options.cursor&&u.hitDetect(t)){i=s.options.cursor||"pointer";break}if(r>0&&++a>r)break}}}e._trySetCursor(i)}},n._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},n.initContainer=function(){var t=this.map._panels;function e(e,n,i,r){var a=Re("div",n);return i&&(a.style.cssText=i),t[e]=a,r||Ve(a),a}var n=this.map._containerDOM;if(!this._containerIsCanvas){n.innerHTML="";var i="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),a=e("allLayers","maptalks-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),o=e("backStatic","maptalks-back-static",i+"z-index:0;",!0),s=e("back","maptalks-back",i+"z-index:1;"),u=e("backLayer","maptalks-back-layer",i),h=e("canvasContainer","maptalks-canvas-layer",i+"border:none;z-index:2;"),c=e("frontStatic","maptalks-front-static",i+"z-index:3;",!0),l=e("front","maptalks-front",i+"z-index:4;",!0),f=e("frontLayer","maptalks-front-layer",i+"z-index:0;"),d=e("ui","maptalks-ui",i+"border:none;z-index:1;",!0),p=e("control","maptalks-control","z-index:1",!0);n.appendChild(r),a.appendChild(o),s.appendChild(u),s.layerDOM=u,a.appendChild(s),a.appendChild(h),l.appendChild(f),l.layerDOM=f,l.uiDOM=d,a.appendChild(c),a.appendChild(l),l.appendChild(d),r.appendChild(a),r.appendChild(p),this.createCanvas(),this.resetContainer();var g=this.map._getContainerDomSize();this.updateMapSize(g)}},n.isViewChanged=function(){var t=this._mapview,e=this._getMapView();return!t||!$(t,e)},n._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||$(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},n.isSpatialReferenceChanged=function(){return this._spatialRefChanged},n._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},n._frameLoop=function(t){var e=this;this.map?(this.renderFrame(t),this._animationFrame=j((function(t){e._frameLoop(t)}))):this._cancelFrameLoop()},n._cancelFrameLoop=function(){this._animationFrame&&k(this._animationFrame)},n._drawLayerCanvasImage=function(t,e){var n=this.context,i=e.point.round(),r=this.map.getDevicePixelRatio();1!==r&&i._multi(r);var a=e.image,o=a.width,s=a.height;if(!(i.x+o<=0||i.y+s<=0)){var u=t.options.opacity;if(p(u)||(u=1),!(u<=0)){var h=e.opacity;if(p(h)||(h=1),!(h<=0)){var c=n.globalAlpha;u<1&&(n.globalAlpha*=u),h<1&&(n.globalAlpha*=h),t.options.cssFilter&&(n.filter=t.options.cssFilter);var l=t.getRenderer(),f=l.__zoomTransformMatrix,d=l.clipCanvas(this.context);f&&(n.save(),n.setTransform.apply(n,f)),n.drawImage(a,0,0,o,s,i.x,i.y,o,s),f&&n.restore(),d&&n.restore(),"none"!==n.filter&&(n.filter="none"),n.globalAlpha=c}}}},n._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new ce(this.canvas.width/2,this.canvas.height/2);y(t)?t(e,n):un.drawCross(this.context,n.x,n.y,2,"#f00")}},n._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),n=this.context,i=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var a=i.ymin*e,o=Math.ceil(a-r),s=t.options.fogColor.join(),u=n.createLinearGradient(0,r,0,a+30),h=1-30/(o+30);u.addColorStop(0,"rgba("+s+", 0)"),u.addColorStop(.3,"rgba("+s+", 0.3)"),u.addColorStop(h,"rgba("+s+", 1)"),u.addColorStop(1,"rgba("+s+", 0)"),n.beginPath(),n.fillStyle=u,n.fillRect(0,r,Math.ceil(i.getWidth())*e,Math.ceil(o+30))}},n._getAllLayerToRender=function(){return this.map._getLayers()},n.clearCanvas=function(){this.canvas&&un.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,i=t.getDevicePixelRatio();return(e.width*i!==n.width||e.height*i!==n.height)&&(n.height=i*e.height,n.width=i*e.width,n.style&&(n.style.width=e.width+"px",n.style.height=e.height+"px"),!0)},n.createCanvas=function(){this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Re("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},n._checkSize=function(){this.map&&!this.map.isInteracting()&&(He(this.map._containerDOM),this.map.checkSize())},n._setCheckSizeInterval=function(t){var e=this;clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval((function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()}),this._checkSizeInterval)},n._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!P&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),oe.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(e){t._eventParam=e})),e.on("_zooming",(function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n})),e.on("_zoomend",(function(e){t._eventParam=e,delete t._zoomMatrix})),e.on("_spatialreferencechange",(function(){t._spatialRefChanged=!0})),oe.webgl&&"undefined"!=typeof document&&Fe(document,"visibilitychange",this._onVisibilitychange,this)},n._onMapMouseMove=function(t){var e=this,n=this.map;!n.isInteracting()&&n.options.hitDetect&&(this._hitDetectFrame&&k(this._hitDetectFrame),this._hitDetectFrame=j((function(){e.hitDetect(t.containerPoint)})))},n._getCanvasLayers=function(){return this.map._getLayers((function(t){return t.isCanvasRender()}))},n._onVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},e}(Ho);yi.registerRenderer("canvas",Zo),yi.mergeOptions({fog:!0,fogColor:[233,233,233]});var Wo=Object.freeze({ResourceCache:fi,CanvasRenderer:li,ImageGLRenderable:co,MapRenderer:Ho,MapCanvasRenderer:Zo,Renderable:ci,ImageLayerCanvasRenderer:go,ImageLayerGLRenderer:vo,TileLayerCanvasRenderer:Ro,TileLayerGLRenderer:Do,CanvasTileLayerCanvasRenderer:zo,CanvasTileLayerGLRenderer:Bo,OverlayLayerCanvasRenderer:No,VectorLayerCanvasRenderer:Go,CanvasLayerRenderer:mo}),Xo={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLZoom())],null]}};br.include(Xo),Lr.include(Xo),Ar.include(Xo),Ir.include(Xo),Rr.include({_getRenderPoints:function(t){var e=this.getMap();if("vertex"===t){for(var n=this._trimRing(this.getShell()),i=[],r=0,a=n.length;r<a;r++)i.push(e.coordToPoint(n[r],e.getGLZoom()));return[i,null]}return[[e.coordToPoint(this.getCenter(),e.getGLZoom())],null]}});var qo={_getRenderPoints:function(t){var e,n=this.getMap(),i=n.getGLZoom(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])){for(var a=0,o=e.length;a<o;a++)for(var s=0,u=e[a].length;s<u;s++)0===s?r.push([e[a][s],e[a][s+1]]):r.push([e[a][s-1],e[a][s]]);e=e[0].concat(e[1])}else for(var h=0,c=e.length;h<c;h++)0===h?r.push([e[h],e[h+1]]):r.push([e[h-1],e[h]]);else if("line"===t){e=[],r=[];var l=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(l.length>0&&Array.isArray(l[0]))for(var f,d=1,p=l.length;d<p;d++){f=l[d],this instanceof yr&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(var g=1,v=f.length;g<v;g++)e.push(f[g].add(f[g-1])._multi(.5)),r.push([f[g-1],f[g]])}else{this instanceof yr&&l.length>0&&!l[0].equals(l[l.length-1])&&l.push(l[0]);for(var m=1,y=l.length;m<y;m++)e.push(l[m].add(l[m-1])._multi(.5)),r.push([l[m-1],l[m]])}}else if("vertex-first"===t){var _=this._getPrjCoordinates();e=_.length?[n._prjToPoint(_[0],i)]:[],r=_.length?[[n._prjToPoint(_[0],i),n._prjToPoint(_[1],i)]]:[]}else if("vertex-last"===t){var b=this._getPrjCoordinates(),w=b.length;e=w?[n._prjToPoint(b[w-1],i)]:[];var x=w-1,O=w>1?w-2:w-1;r=w?[[n._prjToPoint(b[O],i),n._prjToPoint(b[x],i)]]:[]}else{var j=this._getProjection().project(this.getCenter());e=[n._prjToPoint(j,i)]}return[e,r]}};xr.include(qo),yr.include(qo),rr.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var Yo={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof Lr||this instanceof Ir},_paintAsPath:function(){var t=this.getMap();return this._getPainter().getAltitude()>0||t.getPitch()||this instanceof Lr&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return yr.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),n=t._prjToPoint(e,t.getGLZoom()),i=this._getRenderSize();return[n,i.width,i.height]},_paintOn:function(){return this._paintAsPath()?un.polygon.apply(un,arguments):un.ellipse.apply(un,arguments)},_getRenderSize:function(){var t=this.getMap(),e=t.getGLZoom(),n=this._getPrjExtent(),i=t._prjToPoint(n.getMin(),e),r=t._prjToPoint(n.getMax(),e);return new le(Math.abs(r.x-i.x)/2,Math.abs(r.y-i.y)/2)}};Lr.include(Yo),Ar.include(Yo),Rr.include({_getPaintParams:function(){var t=this.getMap().getGLZoom(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t)]},_paintOn:un.polygon}),Ir.include(Yo,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return yr.prototype._getPaintParams.call(this,!0);var t=this.getMap();return[t._prjToPoint(this._getPrjCoordinates(),t.getGLZoom()),this._getRenderSize().width,[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return un.polygon.apply(un,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),un.sector.apply(un,e)}}),mr.include({_paintAsPath:function(){return!0}}),xr.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,n,i,r){r||(r=0);var a,o=n*i[0],s=n*i[1]+r,u=o/2+r;(a=e.nextCtrlPoint||e.prevCtrlPoint?e.prevCtrlPoint?e.sub(new ce(e.prevCtrlPoint)):e.sub(new ce(e.nextCtrlPoint)):e.sub(t))._unit();var h=e.sub(a.multi(s));a._perp();var c=h.add(a.multi(u));return a._multi(-1),[c,e,h.add(a.multi(u)),c]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLZoom())]},_paintOn:function(t,e,n,i,r){this.options.smoothness?un.paintSmoothLine(t,e,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):un.path(t,e,n,null,r),this._paintArrow(t,e,n)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,n){var i=this._getArrowStyle();if(!i||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0])?t:[t],a=this._getArrowPlacement(),o=[],s=this.getMap(),u=s.coordToContainerPoint(this.getFirstCoordinate()),h=s.coordToContainerPoint(this.getLastCoordinate()),c=r.length-1;c>=0;c--)("vertex-first"===a||"vertex-firstlast"===a&&r[c][0].closeTo(u,.01))&&o.push(this._getArrowShape(r[c][1],r[c][0],e,i,n)),"vertex-last"===a||"vertex-firstlast"===a&&r[c][r[c].length-1].closeTo(h,.01)?o.push(this._getArrowShape(r[c][r[c].length-2],r[c][r[c].length-1],e,i,n)):"point"===a&&this._getArrowPoints(o,r[c],e,i,n);return o},_getArrowPoints:function(t,e,n,i,r){for(var a=0,o=e.length-1;a<o;a++)t.push(this._getArrowShape(e[a],e[a+1],n,i,r))},_paintArrow:function(t,e,n){var i=this._getInternalSymbol().lineWidth;(!p(i)||i<3)&&(i=3);var r=this._getArrows(e,i);if(r.length){t.setLineDash&&t.setLineDash([]);for(var a=r.length-1;a>=0;a--)t.fillStyle=t.strokeStyle,un.polygon(t,r[a],n,n)}}}),yr.include({_getPaintParams:function(t){var e=this.getMap().getGLZoom(),n=this._getPrjShell(),i=this._getPath2DPoints(n,t,e),r=i.length>0&&Array.isArray(i[0]);r&&(i=[[i[0]],[i[1]]]);var a=this._getPrjHoles(),o=[];if(a&&a.length>0){for(var s=this._simplified,u=0;u<a.length;u++){var h=this._getPath2DPoints(a[u],t,e);Array.isArray(h)&&r?Array.isArray(h[0])?(i[0].push(h[0]),i[1].push(h[1])):i[0].push(h):o.push(h)}s&&(this._simplified=s)}return r||L(i=[i],o),[i]},_paintOn:function(t,e,n,i,r){un.polygon(t,e,n,i,r,this.options.smoothness)}}),yi.VERSION="0.45.1"}.call(this,n("8oxB"),n("yLpj"))},"8oxB":function(t,e){var n,i,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var u,h=[],c=!1,l=-1;function f(){c&&u&&(c=!1,u.length?h=u.concat(h):l=-1,h.length&&d())}function d(){if(!c){var t=s(f);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new p(t,e)),1!==h.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},"8rZH":function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("1kz3"),h=n("f5Sf"),c=n("Tl6c"),l=n("VBTR"),f=n("uCGa"),d=n("sY1B"),p=n("vqa/"),g=n("rePB"),v=n("ReuC"),m=n("EFXr"),y=n("n4Ve"),_=n("11Ib"),b=n("hP3k"),w=n("yDDC"),x=function(t){function e(t,n){var r,s,u;return Object(i.a)(this,e),(u=Object(a.a)(this,Object(o.a)(e).call(this,t,n))).shadowMap=new h.a(t,{width:1,height:1,parameters:(r={},Object(g.a)(r,10241,9729),Object(g.a)(r,10240,9729),Object(g.a)(r,10242,33071),Object(g.a)(r,10243,33071),r)}),u.depthBuffer=new y.a(t,{format:33189,width:1,height:1}),u.fbo=new _.a(t,{id:"shadowmap",width:1,height:1,attachments:(s={},Object(g.a)(s,36064,u.shadowMap),Object(g.a)(s,36096,u.depthBuffer),s)}),u}return Object(s.a)(e,t),Object(r.a)(e,[{key:"render",value:function(t){var n=this,i=this.fbo;Object(b.a)(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(function(){var r=t.viewports[0],a=Object(w.b)(n.gl),s=r.width*a,u=r.height*a;s===i.width&&u===i.height||i.resize({width:s,height:u}),Object(v.a)(Object(o.a)(e.prototype),"render",n).call(n,Object.assign(t,{outputBuffer:i}))}))}},{key:"getModuleParameters",value:function(t,e,n){var i=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:0,drawToShadowMap:!0,devicePixelRatio:Object(w.b)(this.gl)});return Object.assign(i,n),i}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),e}(m.a),O=n("A/wI");n.d(e,"a",(function(){return C}));var j={color:[255,255,255],intensity:1},k=[{color:[255,255,255],intensity:1,direction:[-1,-3,-1]},{color:[255,255,255],intensity:.9,direction:[1,8,-2.5]}],P=[0,0,0,200/255],C=function(t){function e(t){var n;for(var r in Object(i.a)(this,e),(n=Object(a.a)(this,Object(o.a)(e).call(this,t))).ambientLight=null,n.directionalLights=[],n.pointLights=[],n.shadowColor=P,n.shadowPasses=[],n.dummyShadowMap=null,n.shadow=!1,n.programManager=null,t){var s=t[r];switch(s.type){case"ambient":n.ambientLight=s;break;case"directional":n.directionalLights.push(s);break;case"point":n.pointLights.push(s)}}return n._applyDefaultLights(),n.shadow=n.directionalLights.some((function(t){return t.shadow})),n}return Object(s.a)(e,t),Object(r.a)(e,[{key:"prepare",value:function(t,e){var n=e.layers,i=e.viewports,r=e.onViewportActive,a=e.views;if(!this.shadow)return{};var o=this._createLightMatrix();0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=u.a.getDefaultProgramManager(t),O.a&&this.programManager.addDefaultModule(O.a)),this.dummyShadowMap||(this.dummyShadowMap=new h.a(t,{width:1,height:1}));for(var s=[],c=0;c<this.shadowPasses.length;c++){var l=this.shadowPasses[c];l.render({layers:n.filter((function(t){return!1!==t.props.shadowEnabled})),viewports:i,onViewportActive:r,views:a,effectProps:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:o}}),s.push(l.shadowMap)}return{shadowMaps:s,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:o}}},{key:"getParameters",value:function(t){var e=this.ambientLight,n=this._getProjectedPointLights(t);return{lightSources:{ambientLight:e,directionalLights:this._getProjectedDirectionalLights(t),pointLights:n}}}},{key:"cleanup",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.shadowPasses[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.delete()}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(O.a),this.programManager=null)}},{key:"_createLightMatrix",value:function(){var t=[],e=!0,n=!1,i=void 0;try{for(var r,a=this.directionalLights[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value,s=(new d.a).lookAt({eye:new p.a(o.direction).negate()});t.push(s)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"_createShadowPasses",value:function(t){for(var e=0;e<this.directionalLights.length;e++)this.shadowPasses.push(new x(t))}},{key:"_applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,n=this.directionalLights;t||0!==e.length||0!==n.length||(this.ambientLight=new c.a(j),this.directionalLights.push(new l.a(k[0])),this.directionalLights.push(new l.a(k[1])))}},{key:"_getProjectedPointLights",value:function(t){for(var e=[],n=0;n<this.pointLights.length;n++){var i=this.pointLights[n];e.push(i.getProjectedLight({layer:t}))}return e}},{key:"_getProjectedDirectionalLights",value:function(t){for(var e=[],n=0;n<this.directionalLights.length;n++){var i=this.directionalLights[n];e.push(i.getProjectedLight({layer:t}))}return e}}]),e}(f.a)},"9Hqq":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"webgl2-polyfill: assertion failed.")}n.d(e,"a",(function(){return i}))},"A/p5":function(t,e,n){"use strict";n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return h})),n.d(e,"e",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"g",(function(){return f})),n.d(e,"d",(function(){return d}));var i=n("KQm4"),r=n("kLp3"),a=n.n(r),o=new Map,s=function(t,e,n){a.a.isReady()&&(o.has(t)||o.set(t,new Map),o.get(t).set(e,n))},u=function(t){if(a.a.isReady()&&t.id){var e=o.get(t.id);e&&e.forEach((function(e,n){!function t(e,n,i){e&&(n.length>1?t(e[n[0]],n.slice(1),i):e[n[0]]=i)}(t,n,e),"data"===n[0]&&(t.data=Object(i.a)(t.data))}))}},h=function(t){a.a.isReady()&&a.a.listenFor("deck.gl",t)},c=function(t){a.a.isReady()&&a.a.listenFor("init",t)},l=function(t){if(a.a.isReady()&&t){var e=[t.constructor.layerName];a.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},f=function(t){if(a.a.isReady()&&!a.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],n=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var i=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:i})}if(t.state.model){t.state.model.setProps({timerQueryEnabled:!0});var r=t.state.model.stats.lastFrameTime;r&&n.push("".concat((1e3*r).toFixed(0),"μs"))}}return e.push({path:"badges",data:n}),e}(t);a.a.multiUpdate("deck.gl",t.id,e)}},d=function(t){a.a.isReady()&&t&&a.a.deleteItem("deck.gl",t)}},"A/wI":function(t,e,n){"use strict";var i=n("KQm4"),r=n("ODXe"),a=n("lQOs"),o=n("puIE"),s=n("sY1B"),u=n("vqa/"),h=n("OIVS"),c=n("B7nP"),l=Object(h.a)((function(t){var e=t.viewport,n=t.center;return new s.a(e.viewProjectionMatrix).invert().transform(n)})),f=Object(h.a)((function(t){var e=t.viewport,n=t.shadowMatrices,a=[],o=e.pixelUnprojectionMatrix,h=e.isGeospatial?void 0:1,l=[[0,0,h],[e.width,0,h],[0,e.height,h],[e.width,e.height,h],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((function(t){return function(t,e){var n=Object(r.a)(t,3),i=n[0],a=n[1],o=n[2],s=Object(c.h)([i,a,o],e);return Number.isFinite(o)?s:[s[0],s[1],0]}(t,o)})),f=!0,d=!1,p=void 0;try{for(var g,v=function(){var t=g.value,n=t.clone().translate(new u.a(e.center).negate()),r=l.map((function(t){return n.transform(t)})),o=(new s.a).ortho({left:Math.min.apply(Math,Object(i.a)(r.map((function(t){return t[0]})))),right:Math.max.apply(Math,Object(i.a)(r.map((function(t){return t[0]})))),bottom:Math.min.apply(Math,Object(i.a)(r.map((function(t){return t[1]})))),top:Math.max.apply(Math,Object(i.a)(r.map((function(t){return t[1]})))),near:Math.min.apply(Math,Object(i.a)(r.map((function(t){return-t[2]})))),far:Math.max.apply(Math,Object(i.a)(r.map((function(t){return-t[2]}))))});a.push(o.multiplyRight(t))},m=n[Symbol.iterator]();!(f=(g=m.next()).done);f=!0)v()}catch(t){d=!0,p=t}finally{try{f||null==m.return||m.return()}finally{if(d)throw p}}return a}));Object(a.b)("shadow",{hook:"vs:DECKGL_FILTER_GL_POSITION",injection:"\nposition = shadow_setVertexPosition(geometry.position);\n  "}),Object(a.b)("shadow",{hook:"fs:DECKGL_FILTER_COLOR",injection:"\ncolor = shadow_filterShadowColor(color);\n  "});var d=[0,0,0,1],p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];e.a={name:"shadow",dependencies:["project"],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){var n={},i=t.shadowEnabled;return(void 0===i||i)&&t.shadowMatrices&&t.shadowMatrices.length>0?Object.assign(n,function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||d,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=l({viewport:t.viewport,center:e.project_uCenter}),r=[],a=f({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),s=0;s<t.shadowMatrices.length;s++){var h=a[s],c=h.clone().translate(new u.a(t.viewport.center).negate());e.project_uCoordinateSystem===o.a.LNG_LAT?(a[s]=c,r[s]=[0,0,0,0]):(a[s]=h.clone().multiplyRight(p),r[s]=c.transform(i))}for(var g=0;g<a.length;g++)n["shadow_uViewProjectionMatrices[".concat(g,"]")]=a[g],n["shadow_uProjectCenters[".concat(g,"]")]=r[g],t.shadowMaps&&t.shadowMaps.length>0?n["shadow_uShadowMap".concat(g)]=t.shadowMaps[g]:n["shadow_uShadowMap".concat(g)]=t.dummyShadowMap;return n}(t,e)):Object.assign(n,{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}),n}return{}}}},B7nP:function(t,e,n){"use strict";n.d(e,"l",(function(){return v})),n.d(e,"i",(function(){return m})),n.d(e,"g",(function(){return y})),n.d(e,"j",(function(){return _})),n.d(e,"c",(function(){return b})),n.d(e,"b",(function(){return w})),n.d(e,"a",(function(){return x})),n.d(e,"f",(function(){return O})),n.d(e,"e",(function(){return j})),n.d(e,"d",(function(){return k})),n.d(e,"k",(function(){return P})),n.d(e,"h",(function(){return C}));var i=n("ODXe"),r=n("VKpO"),a=n("ZaHm"),o=n("ZxFD"),s=n("n+fv"),u=n("54ZI"),h=Math.PI,c=h/4,l=h/180,f=180/h,d=512,p=4003e4,g=1.5;function v(t){return Math.pow(2,t)}function m(t){return Math.log2(t)}function y(t,e){var n=Object(i.a)(t,2),r=n[0],a=n[1];Object(u.a)(Number.isFinite(r)&&Number.isFinite(e)),Object(u.a)(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude");var o=a*l;return[(e*=d)*(r*l+h)/(2*h),e*(h-Math.log(Math.tan(c+.5*o)))/(2*h)]}function _(t,e){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=r/(e*=d)*(2*h)-h,s=2*(Math.atan(Math.exp(h-a/e*(2*h)))-c);return[o*f,s*f]}function b(t){var e=t.latitude;Object(u.a)(Number.isFinite(e));var n=Math.cos(e*l);return m(p*n)-9}function w(t){var e=t.latitude,n=t.longitude,i=t.zoom,r=t.scale,a=t.highPrecision,o=void 0!==a&&a;r=void 0!==r?r:v(i),Object(u.a)(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r));var s={},h=d*r,c=Math.cos(e*l),f=h/360,g=f/c,m=h/p/c;if(s.pixelsPerMeter=[m,-m,m],s.metersPerPixel=[1/m,-1/m,1/m],s.pixelsPerDegree=[f,-g,m],s.degreesPerPixel=[1/f,-1/g,1/m],o){var y=l*Math.tan(e*l)/c,_=f*y/2,b=h/p*y,w=b/g*m;s.pixelsPerDegree2=[0,-_,b],s.pixelsPerMeter2=[w,0,w]}return s}function x(t,e){var n=Object(i.a)(t,3),r=n[0],a=n[1],o=n[2],s=Object(i.a)(e,3),u=s[0],h=s[1],c=s[2],l=w({longitude:r,latitude:a,scale:1,highPrecision:!0}),f=l.pixelsPerMeter,d=l.pixelsPerMeter2,p=y(t,1);p[0]+=u*(f[0]+d[0]*h),p[1]+=h*(f[1]+d[1]*h);var g=_(p,1),v=(o||0)+(c||0);return Number.isFinite(o)||Number.isFinite(c)?[g[0],g[1],v]:g}function O(t){var e=t.height,n=t.pitch,i=t.bearing,o=t.altitude,u=t.center,h=void 0===u?null:u,c=t.flipY,f=void 0!==c&&c,d=Object(r.a)();return a.p(d,d,[0,0,-o]),a.o(d,d,[1,1,1/e]),a.l(d,d,-n*l),a.n(d,d,i*l),f&&a.o(d,d,[1,-1,1]),h&&a.p(d,d,s.h([],h)),d}function j(t){var e=t.width,n=t.height,i=t.altitude,r=void 0===i?g:i,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,u=void 0===s?1:s,h=t.farZMultiplier,c=void 0===h?1:h,f=o*l,d=Math.atan(.5/r),p=Math.sin(d)*r/Math.sin(Math.PI/2-f-d),v=Math.cos(Math.PI/2-f)*p+r;return{fov:2*Math.atan(n/2/r),aspect:e/n,focalDistance:r,near:u,far:v*c}}function k(t){var e=t.width,n=t.height,i=t.pitch,r=j({width:e,height:n,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=r.fov,s=r.aspect,u=r.near,h=r.far;return a.j([],o,s,u,h)}function P(t,e){var n=Object(i.a)(t,3),a=n[0],o=n[1],s=n[2],h=void 0===s?0:s;return Object(u.a)(Number.isFinite(a)&&Number.isFinite(o)&&Number.isFinite(h)),Object(r.d)(e,[a,o,h,1])}function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Object(i.a)(t,3),s=a[0],h=a[1],c=a[2];if(Object(u.a)(Number.isFinite(s)&&Number.isFinite(h),"invalid pixel coordinate"),Number.isFinite(c))return Object(r.d)(e,[s,h,c,1]);var l=Object(r.d)(e,[s,h,0,1]),f=Object(r.d)(e,[s,h,1,1]),d=l[2],p=f[2],g=d===p?0:((n||0)-d)/(p-d);return o.c([],l,f,g)}},"B9+J":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return s}));var i="Failed to deduce GL constant from typed array";function r(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(i)}}function a(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function o(t){var e=t.data,n=t.width,i=t.height,r=t.bytesPerPixel,a=void 0===r?4:r,o=t.temp,s=n*a;o=o||new Uint8Array(s);for(var u=0;u<i/2;++u){var h=u*s,c=(i-u-1)*s;o.set(e.subarray(h,h+s)),e.copyWithin(h,c,c+s),e.set(o,c)}}function s(t){for(var e=t.data,n=t.width,i=t.height,r=Math.round(n/2),a=Math.round(i/2),o=new Uint8Array(r*a*4),s=0;s<a;s++)for(var u=0;u<r;u++)for(var h=0;h<4;h++)o[4*(s*r+u)+h]=e[4*(2*s*n+2*u)+h];return{data:o,width:r,height:a}}},BENj:function(t,e,n){"use strict";var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("md7G"),s=n("foSv"),u=n("Ji7U"),h=n("qjXE"),c=n("sxJW"),l=n("rSc4"),f=n("1A8y"),d=n("VKpO"),p=85.05113,g=-85.05113,v=n("VMBB"),m=n("RPaY"),y=n("zheZ");n.d(e,"a",(function(){return j}));var _={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new m.a,transitionInterruption:y.a.BREAK},b={transitionDuration:0},w={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},x={pitch:0,bearing:0,altitude:1.5},O=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.width,a=n.height,u=n.latitude,h=n.longitude,c=n.zoom,l=n.bearing,f=void 0===l?x.bearing:l,d=n.pitch,p=void 0===d?x.pitch:d,g=n.altitude,m=void 0===g?x.altitude:g,y=n.maxZoom,_=void 0===y?w.maxZoom:y,b=n.minZoom,O=void 0===b?w.minZoom:b,j=n.maxPitch,k=void 0===j?w.maxPitch:j,P=n.minPitch,C=void 0===P?w.minPitch:P,T=n.startPanLngLat,M=n.startZoomLngLat,E=n.startBearing,S=n.startPitch,A=n.startZoom;return Object(r.a)(this,e),Object(v.a)(Number.isFinite(h),"`longitude` must be supplied"),Object(v.a)(Number.isFinite(u),"`latitude` must be supplied"),Object(v.a)(Number.isFinite(c),"`zoom` must be supplied"),(t=Object(o.a)(this,Object(s.a)(e).call(this,{width:i,height:a,latitude:u,longitude:h,zoom:c,bearing:f,pitch:p,altitude:m,maxZoom:_,minZoom:O,maxPitch:k,minPitch:C})))._interactiveState={startPanLngLat:T,startZoomLngLat:M,startBearing:E,startPitch:S,startZoom:A},t}return Object(u.a)(e,t),Object(a.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._interactiveState.startPanLngLat||this._unproject(n);if(!r)return this;var a=this._calculateNewLngLat({startPanLngLat:r,pos:e}),o=Object(i.a)(a,2),s=o[0],u=o[1];return this._getUpdatedState({longitude:s,latitude:u})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){return t.pos,this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,i=t.deltaScaleY,r=void 0===i?0:i,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:r,startBearing:o,startPitch:s}),h=u.pitch,c=u.bearing;return this._getUpdatedState({bearing:c,pitch:h})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale;Object(v.a)(r>0,"`scale` must be a positive number");var a=this._interactiveState,o=a.startZoom,s=a.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,s=this._unproject(n)||this._unproject(e)),Object(v.a)(s,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var u=this._calculateNewZoom({scale:r,startZoom:o}),h=new f.a(Object.assign({},this._viewportProps,{zoom:u})).getLocationAtPoint({lngLat:s,pos:e}),c=Object(i.a)(h,2),l=c[0],d=c[1];return this._getUpdatedState({zoom:u,longitude:l,latitude:d})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),n=Object.assign({},this._viewportProps),i=n.bearing,r=n.longitude;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,n=e.width,i=e.height;return this.zoom({pos:[n/2,i/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,n=e.width,i=e.height;return this.pan({startPos:[n/2,i/2],pos:[n/2+t[0],i/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,i=t.zoom;t.zoom=Object(h.a)(i,n,e);var r=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Object(h.a)(o,a,r),Object.assign(t,function(t){var e=t.width,n=t.height,i=t.longitude,r=t.latitude,a=t.zoom,o=t.pitch,s=void 0===o?0:o,u=t.bearing,h=void 0===u?0:u;(i<-180||i>180)&&(i=Object(d.c)(i+180,360)-180),(h<-180||h>180)&&(h=Object(d.c)(h+180,360)-180);var c=new f.a({width:e,height:n,longitude:i,latitude:r,zoom:a}),l=c.project([i,p])[1],v=c.project([i,g])[1],m=0;return v-l<n&&(a+=Math.log2(n/(v-l)),l=(c=new f.a({width:e,height:n,longitude:i,latitude:r,zoom:a})).project([i,p])[1],v=c.project([i,g])[1]),l>0?m=l:v<n&&(m=v-n),m&&(r=c.unproject([e/2,n/2+m])[1]),{width:e,height:n,longitude:i,latitude:r,zoom:a,pitch:s,bearing:h}}(t)),t}},{key:"_unproject",value:function(t){var e=new f.a(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return new f.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,i=this._viewportProps,r=i.maxZoom,a=i.minZoom,o=n+Math.log2(e);return Object(h.a)(o,a,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,i=t.startBearing,r=t.startPitch;n=Object(h.a)(n,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,u=r;return n>0?u=r+n*(s-r):n<0&&(u=r-n*(o-r)),{pitch:u,bearing:i+180*e}}}]),e}(l.a),j=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(o.a)(this,Object(s.a)(e).call(this,O,t))).invertPan=!0,n}return Object(u.a)(e,t),Object(a.a)(e,[{key:"_getTransitionProps",value:function(){return _}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,r=this.getCenter(t),a=Object(i.a)(r,2)[1],o=a-n,s=this.controllerState.getViewportProps(),u=s.width,h=s.height,c=e/u,l=0;n>0?Math.abs(h-o)>5&&(l=n/(o-h)*1.2):n<0&&o>5&&(l=1-a/o),l=Math.min(1,Math.max(-1,l));var f=this.controllerState.rotate({deltaScaleX:c,deltaScaleY:l});return this.updateViewport(f,b,{isDragging:!0,isRotating:!0})}}]),e}(c.a)},C7oE:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var i=n("vpQ4"),r=n("1OyB"),a=n("vuIU"),o=n("VdrS"),s=n("CxzY"),u={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.id,i=void 0===n?Object(o.c)("geometry"):n,a=e.drawMode,s=void 0===a?u.TRIANGLES:a,h=e.attributes,c=void 0===h?{}:h,l=e.indices,f=void 0===l?null:l,d=e.vertexCount,p=void 0===d?null:d;this.id=i,this.drawMode=0|s,this.attributes={},this.userData={},this._setAttributes(c,f),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}return Object(a.a)(t,null,[{key:"DRAW_MODE",get:function(){return u}}]),Object(a.a)(t,[{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?Object(i.a)({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(t){return"Geometry ".concat(this.id," attribute ").concat(t)}},{key:"_setAttributes",value:function(t,e){for(var n in e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e),t){var i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,Object(s.a)(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),"POSITION"!==n&&"positions"!==n||i.size||(i.size=3),"indices"===n?(Object(s.a)(!this.indices),this.indices=i):this.attributes[n]=i}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(t,e){if(e)return e.value.length;var n=1/0;for(var i in t){var r=t[i],a=r.value,o=r.size;!r.constant&&a&&o>=1&&(n=Math.min(n,a.length/o))}return Object(s.a)(Number.isFinite(n)),n}},{key:"mode",get:function(){return this.drawMode}}]),t}()},CxzY:function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},DJG6:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("XM/H"),r=n("pCSj"),a=n("kGlb"),o=/[^.]+$/;function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).nothrow,s=void 0!==i&&i;if(e=e||"",t&&!Array.isArray(t)){var c=t;return Object(a.b)(c),c}(function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;Object(a.b)(s)}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}})(t=t||Object(r.a)()),e=e.replace(/\?.*/,"");var l=null;if(!(l=(l=l||function(t,e){var n=e.match(o),i=n&&n[0];return i&&function(t,e){e=e.toLowerCase();var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=!0,h=!1,c=void 0;try{for(var l,f=s.extensions[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){if(l.value.toLowerCase()===e)return s}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}(t,i)}(t,e))||function(t,e){if(!e)return null;var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if("string"==typeof e){if(u(e,s))return s}else if(ArrayBuffer.isView(e)){if(h(e.buffer,e.byteOffset,s))return s}else if(e instanceof ArrayBuffer&&h(e,0,s))return s}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}(t,n))){if(s)return null;throw new Error("No valid loader found for ".concat(e))}return l}function u(t,e){return e.testText&&e.testText(t)}function h(t,e,n){switch(Array.isArray(n.test)?"array":Object(i.a)(n.test)){case"function":return n.test(t,n);case"string":case"array":return(Array.isArray(n.test)?n.test:[n.test]).some((function(n){return n===function(t,e,n){if(t.byteLength<=e+n)return"";for(var i=new DataView(t),r="",a=0;a<n;a++)r+=String.fromCharCode(i.getUint8(e+a));return r}(t,e,n.length)}));default:return!1}}},EFXr:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("mC81"),h=n("hP3k"),c=n("pRFE"),l=n("Wiem"),f=n("yDDC"),d=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"render",value:function(t){var e=this,n=this.gl;return Object(h.a)(n,{framebuffer:t.outputBuffer},(function(){return e.drawLayers(t)}))}},{key:"drawLayers",value:function(t){var e=this,n=t.layers,i=t.viewports,r=t.views,a=t.onViewportActive,o=t.deviceRect,s=void 0===o?null:o,u=t.parameters,h=void 0===u?{}:u,c=t.pass,l=void 0===c?"draw":c,f=t.redrawReason,d=void 0===f?"":f,p=t.clearCanvas,g=void 0===p||p,v=t.effects,m=t.effectProps,y=this.gl;g&&this.clearCanvas(y);var _=[];return i.forEach((function(t,i){var o=e.getViewportFromDescriptor(t),u=r&&r[o.id];a(o);var c=e.drawLayersInViewport(y,{layers:n,viewport:o,view:u,deviceRect:s,parameters:h,pass:l,redrawReason:d,effects:v,effectProps:m});_.push(c)})),_}},{key:"drawLayersInViewport",value:function(t,e){var n=this,i=e.layers,r=e.viewport,a=e.view,o=(e.deviceRect,e.parameters),s=void 0===o?{}:o,u=(e.pass,e.redrawReason,e.effects),f=e.effectProps,d=this.getGLViewport(t,{viewport:r});if(a&&a.props.clear){var p=!0===a.props.clear?{color:!0,depth:!0}:a.props.clear;Object(h.a)(t,{scissorTest:!0,scissor:d},(function(){return Object(c.a)(t,p)}))}var g={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};return Object(l.a)(t,s||{}),i.forEach((function(e,i){var a=n.shouldDrawLayer(e,r);a&&e.props.pickable&&g.pickableCount++,e.isComposite&&g.compositeCount++,a&&(g.visibleCount++,n.drawLayerInViewport({gl:t,layer:e,layerIndex:i,glViewport:d,parameters:s,effects:u,effectProps:f}))})),g}},{key:"drawLayerInViewport",value:function(t){t.gl;var e=t.layer,n=t.layerIndex,i=t.glViewport,r=t.parameters,a=t.effects,o=t.effectProps,s=this.getModuleParameters(e,a,o),u=Object.assign({},e.context.uniforms,{layerIndex:n}),h=this.getLayerParameters(e,n,i,r);e.drawLayer({moduleParameters:s,uniforms:u,parameters:h})}},{key:"getViewportFromDescriptor",value:function(t){return t.viewport?t.viewport:t}},{key:"shouldDrawLayer",value:function(t,e){var n=this.props.layerFilter,i=!t.isComposite&&t.props.visible;return i&&n&&(i=n({layer:t,viewport:e,isPicking:!1})),i}},{key:"getModuleParameters",value:function(t){return Object.assign(Object.create(t.props),{viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Object(f.b)(this.gl)})}},{key:"getLayerParameters",value:function(t,e,n,i){var r=Object.assign({},t.props.parameters||{},i);return Object.assign(r,{viewport:n}),r}},{key:"getGLViewport",value:function(t,e){var n=e.viewport,i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,r=n,a=Object(f.b)(this.gl);return[r.x*a,(i-r.y-r.height)*a,r.width*a,r.height*a]}},{key:"clearCanvas",value:function(t){var e=t.drawingBufferWidth,n=t.drawingBufferHeight;Object(h.a)(t,{viewport:[0,0,e,n]},(function(){t.clear(16640)}))}}]),e}(u.a)},EJpo:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("maJC");function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t,e){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(n,!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({fetch:"undefined"!=typeof window&&window.fetch},t)}},F8bt:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return g})),n.d(e,"c",(function(){return v})),n.d(e,"e",(function(){return m}));var i=n("b0ih"),r=n("vqa/");function a(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function o(t){var e=t.viewMatrix,n=t.viewMatrixInverse;return{eye:[n[12],n[13],n[14]],direction:[-e[2],-e[6],-e[10]],up:[e[1],e[5],e[9]],right:[e[0],e[4],e[8]]}}var s,u=new r.a,h=new r.a,c=new r.a,l=new r.a,f=new r.a,d=new r.a,p=new r.a;function g(t){var e=t.aspect,n=t.near,i=t.far,a=t.fovyRadians,o=t.position,s=t.direction,g=t.up,v=t.right;h.copy(s);var m=1/h.len();h.normalize(),u.copy(o),c.copy(g).normalize(),l.copy(v).normalize();var y=2*Math.tan(a/2)*n,_=y*e;f.copy(h).scale(n*m).add(u),d.copy(h).scale(i*m).add(u);var b=h.clone().negate(),w=b.dot(f),x={near:{distance:w,normal:b},far:{distance:h.dot(d),normal:h.clone()}};return p.copy(l).scale(.5*_).add(f).subtract(u).normalize(),b=new r.a(c).cross(p),w=u.dot(b),x.right={normal:b,distance:w},p.copy(l).scale(.5*-_).add(f).subtract(u).normalize(),b=new r.a(p).cross(c),w=u.dot(b),x.left={normal:b,distance:w},p.copy(c).scale(.5*y).add(f).subtract(u).normalize(),b=new r.a(p).cross(l),w=u.dot(b),x.top={normal:b,distance:w},p.copy(c).scale(.5*-y).add(f).subtract(u).normalize(),b=new r.a(l).cross(p),w=u.dot(b),x.bottom={normal:b,distance:w},x}function v(t){return t-Math.fround(t)}function m(t,e){var n=e.size,r=void 0===n?1:n,a=e.startIndex,o=void 0===a?0:a,u=e.endIndex;Number.isFinite(u)||(u=t.length);var h=(u-o)/r;s=i.a.allocate(s,h,{type:Float32Array,size:2*r});for(var c=o,l=0;c<u;){for(var f=0;f<r;f++){var d=t[c++];s[l+f]=d,s[l+f+r]=v(d)}l+=2*r}return s.subarray(0,h*r*2)}},FWU8:function(t,e,n){"use strict";(function(t){n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return f}));var i=n("1OyB"),r=n("iTDY"),a="luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.",o=t,s=null;function u(){var t=o.require("gl");if(!t)throw new Error(a);return t.apply(void 0,arguments)}if(!n("IIwk").a)try{s=o.require("gl/wrap")}catch(t){}var h=s||r.a,c=(h.WebGLRenderingContext,h.WebGLProgram,h.WebGLShader,h.WebGLBuffer),l=void 0===c?function t(){Object(i.a)(this,t)}:c;h.WebGLFramebuffer,h.WebGLRenderbuffer,h.WebGLTexture,h.WebGLUniformLocation,h.WebGLActiveInfo,h.WebGLShaderPrecisionFormat;var f=r.a.WebGL2RenderingContext||function t(){Object(i.a)(this,t)};r.a.Image}).call(this,n("3UD+")(t))},GYIa:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("U8pU"),r="count(): argument not an object",a="count(): argument not a container";function o(t){if(!function(t){return null!==t&&"object"===Object(i.a)(t)}(t))throw new Error(r);if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(i.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error(a)}},H58V:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i="",r={};function a(t){for(var e in r)if(t.startsWith(e)){var n=r[e];return t.replace(e,n)}return t+i}},HLba:function(t,e,n){"use strict";var i=n("ftUl"),r=n("VcEp"),a=n.n(r);function o(t){this.wrapped=t}function s(t){return new o(t)}function u(t){var e,n;function i(e,n){try{var a=t[e](n),s=a.value,u=s instanceof o;Promise.resolve(u?s.wrapped:s).then((function(t){u?i("next",t):r(a.done?"return":"normal",t)}),(function(t){i("throw",t)}))}catch(t){r("throw",t)}}function r(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new Promise((function(a,o){var s={key:t,arg:r,resolve:a,reject:o,next:null};n?n=n.next=s:(e=n=s,i(t,r))}))},"function"!=typeof t.return&&(this.return=void 0)}function h(t){return function(){return new u(t.apply(this,arguments))}}"function"==typeof Symbol&&Symbol.asyncIterator&&(u.prototype[Symbol.asyncIterator]=function(){return this}),u.prototype.next=function(t){return this._invoke("next",t)},u.prototype.throw=function(t){return this._invoke("throw",t)},u.prototype.return=function(t){return this._invoke("return",t)};var c=n("23rh");function l(t){if(c.b||c.c>=10){if("function"==typeof t[Symbol.asyncIterator])return t;if("function"==typeof t.getIterator)return t.getIterator()}return c.b?function(t){return f.apply(this,arguments)}(t):function(t){return d.apply(this,arguments)}(t)}function f(){return(f=h(a.a.mark((function t(e){var n,i,r,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.getReader(),t.prev=1;case 2:return t.next=5,s(n.read());case 5:if(i=t.sent,r=i.done,o=i.value,!r){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,o;case 12:t.next=2;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),n.releaseLock();case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))).apply(this,arguments)}function d(){return(d=h(a.a.mark((function t(e){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(e);case 2:e=t.sent;case 3:if(null===(n=e.read())){t.next=9;break}return t.next=8,n;case 8:return t.abrupt("continue",3);case 9:if(!e._readableState.ended){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,s(p(e));case 13:t.next=3;break;case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return g.apply(this,arguments)}function g(){return(g=Object(i.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.once("readable",t)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n.d(e,"a",(function(){return l}))},"HaE+":function(t,e,n){"use strict";function i(t,e,n,i,r,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)}))}}n.d(e,"a",(function(){return r}))},I0ug:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n("U8pU");function r(e){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(i.a)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=e||n;return!!(r&&r.indexOf("Electron")>=0)}}).call(this,n("8oxB"))},I3n7:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"}},IIwk:function(t,e,n){"use strict";(function(t){var i=n("U8pU"),r=n("T8J6"),a=!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||r.a;e.a=a}).call(this,n("8oxB"))},JOTL:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("egY1"),o=function(){function t(e,n){Object(i.a)(this,t),this.name=e,this.type=n,this.sampleSize=1,this.reset()}return Object(r.a)(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(a.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(a.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}();n.d(e,"a",(function(){return s}));var s=function(){function t(e){var n=e.id,r=e.stats;Object(i.a)(this,t),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return Object(r.a)(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,n=t.type;return this.stats[e]||(this.stats[e]=t instanceof o?t:new o(e,n)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}()},JWCg:function(t,e,n){"use strict";var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("5a1V"),s=n("kGlb"),u=n("U/rz"),h=n("+yMZ"),c=n("EJpo"),l=n("Wb0s"),f=n("c5ZK"),d=n("2WEh"),p=null;function g(t){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(r.a.mark((function t(e){var n,i,a,o,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.worker,i=e.data,a=e.resolve,o=e.reject,t.t0=i.type,t.next="done"===t.t0?4:"process"===t.t0?6:"error"===t.t0?17:19;break;case 4:return a(i.result),t.abrupt("break",19);case 6:return t.prev=6,t.next=9,_(i.arraybuffer,i.options,i.url);case 9:s=t.sent,n.postMessage({type:"process-done",id:i.id,result:s},Object(d.a)(s)),t.next=16;break;case 13:t.prev=13,t.t1=t.catch(6),n.postMessage({type:"process-error",id:i.id,message:t.t1.message});case 16:return t.abrupt("break",19);case 17:return o(i.message),t.abrupt("break",19);case 19:case"end":return t.stop()}}),t,null,[[6,13]])})))).apply(this,arguments)}function m(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency),t.onDebug&&(e.onDebug=t.onDebug),p||(p=new f.a({onMessage:g})),p.setProps(e),p}(i));return i=JSON.parse(JSON.stringify(i)),r.process(t,"loaders.gl-".concat(e),{arraybuffer:Object(l.a)(n),options:i,source:"loaders.gl",type:"process"})}var y=n("DJG6");function _(t,e,n,i){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(r.a.mark((function t(e,n,i,a){var o,l,f;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!n||Array.isArray(n)||Object(s.a)(n)||(a=i,i=n,n=null),i=i||{},o=Object(h.d)(e,a),l=Object(y.a)(n,o,e),i=Object(u.a)(i,l),f=Object(c.a)({url:o,parse:_},i),t.next=8,w(l,e,i,f);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t,e,n,i){return x.apply(this,arguments)}function x(){return(x=Object(a.a)(r.a.mark((function t(e,n,i,a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.a)(n,e);case 2:if(n=t.sent,!e.parseTextSync||"string"!=typeof n){t.next=6;break}return i.dataType="text",t.abrupt("return",e.parseTextSync(n,i,a,e));case 6:if(!e.parse){t.next=10;break}return t.next=9,e.parse(n,i,a,e);case 9:return t.abrupt("return",t.sent);case 10:if(!e.parseSync){t.next=12;break}return t.abrupt("return",e.parseSync(n,i,a,e));case 12:if(!e.worker){t.next=16;break}return t.next=15,m(e.worker,e.name,n,i,a,e);case 15:return t.abrupt("return",t.sent);case 16:return t.abrupt("return",Object(o.a)(!1));case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n.d(e,"a",(function(){return _}))},JX7q:function(t,e,n){"use strict";function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,"a",(function(){return i}))},"Jh/b":function(t,e,n){"use strict";var i=n("d3wX");e.a=new i.a({id:"deck"}).enable()},Ji7U:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("s4An");function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(i.a)(t,e)}},K7jV:function(t,e,n){"use strict";var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("md7G"),s=n("foSv"),u=n("Ji7U"),h=n("V3d6"),c=n("nwSC"),l=n("A/p5"),f=n("rePB"),d=n("L9Dj"),p=n("qjXE"),g=n("n6ox"),v=function(t){function e(){return Object(r.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(a.a)(e,[{key:"_onUpdate",value:function(){var t=this.time,e=this.settings,n=e.fromValue,i=e.toValue,r=e.duration,a=(0,e.easing)(t/r);this._value=Object(p.g)(n,i,a)}},{key:"value",get:function(){return this._value}}]),e}(g.a);function m(t,e,n,i,r){var a=e-t;return(n-e)*r+-a*i+a+e}function y(t,e){if(Array.isArray(t)){for(var n=0,i=0;i<t.length;i++){var r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}var _=function(t){function e(){return Object(r.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(a.a)(e,[{key:"_onUpdate",value:function(){var t=this.settings,e=t.fromValue,n=t.toValue,i=t.damping,r=t.stiffness,a=this._prevValue,o=void 0===a?e:a,s=this._currValue,u=void 0===s?e:s,h=function(t,e,n,i,r){if(Array.isArray(n)){for(var a=[],o=0;o<n.length;o++)a[o]=m(t[o],e[o],n[o],i,r);return a}return m(t,e,n,i,r)}(o,u,n,i,r),c=y(h,n),l=y(h,u);c<1e-5&&l<1e-5&&(h=n,this.end()),this._prevValue=u,this._currValue=h}},{key:"value",get:function(){return this._currValue}}]),e}(g.a),b=n("Jh/b");function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var x={interpolation:v,spring:_},O=function(){function t(e){Object(r.a)(this,t),this.transitions=new Map,this.timeline=e}return Object(a.a)(t,[{key:"add",value:function(t,e,n,i){var r=this.transitions;if(r.has(t)&&(e=r.get(t).value,this.remove(t)),i=Object(d.e)(i)){var a=x[i.type];if(a){var o=new a(this.timeline);o.start(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(n,!0).forEach((function(e){Object(f.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},i,{fromValue:e,toValue:n})),r.set(t,o)}else b.a.error("unsupported transition type '".concat(i.type,"'"))()}}},{key:"remove",value:function(t){var e=this.transitions;e.has(t)&&(e.get(t).cancel(),e.delete(t))}},{key:"update",value:function(){var t={},e=!0,n=!1,r=void 0;try{for(var a,o=this.transitions[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=Object(i.a)(a.value,2),u=s[0],h=s[1];h.update(),t[u]=h.value,h.inProgress||this.remove(u)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return t}},{key:"clear",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.transitions.keys()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;this.remove(a)}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}}},{key:"active",get:function(){return this.transitions.size>0}}]),t}(),j=n("U8pU"),k=n("VMBB");function P(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,n=t.oldProps,i=t.ignoreProps,r=void 0===i?{}:i,a=t.propTypes,o=void 0===a?{}:a,s=t.triggerName,u=void 0===s?"props":s;if(Object(k.a)(void 0!==n&&void 0!==e,"compareProps args"),n===e)return null;if("object"!==Object(j.a)(e)||null===e)return"".concat(u," changed shallowly");if("object"!==Object(j.a)(n)||null===n)return"".concat(u," changed shallowly");for(var h=0,c=Object.keys(e);h<c.length;h++){var l=c[h];if(!(l in r)){if(!(l in n))return"".concat(u,".").concat(l," added");var f=C(e[l],n[l],o[l]);if(f)return"".concat(u,".").concat(l," ").concat(f)}}for(var d=0,p=Object.keys(n);d<p.length;d++){var g=p[d];if(!(g in r)){if(!(g in e))return"".concat(u,".").concat(g," dropped");if(!Object.hasOwnProperty.call(e,g)){var v=C(e[g],n[g],o[g]);if(v)return"".concat(u,".").concat(g," ").concat(v)}}}return null}function C(t,e,n){var i=n&&n.equal;return i&&!i(t,e,n)?"changed deeply":i||!(i=t&&e&&t.equals)||i.call(t,e)?i||e===t?null:"changed shallowly":"changed deeply"}function T(t,e,n){var i=t.updateTriggers[n];i=null==i?{}:i;var r=e.updateTriggers[n];return P({oldProps:r=null==r?{}:r,newProps:i,triggerName:n})}function M(t){var e=t._component,n=e&&e.constructor;return n?n._propTypes:{}}var E=n("GYIa"),S=n("hP3k");function A(t,e){if(!e)return t;var n=Object.assign({},t,e);if("defines"in e&&(n.defines=Object.assign({},t.defines,e.defines)),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some((function(t){return"project64"===t||"project64"===t.name})))){var i=n.modules.findIndex((function(t){return"project32"===t||"project32"===t.name}));i>=0&&n.modules.splice(i,1)}return"inject"in e&&(n.inject=Object.assign({},t.inject,e.inject)),n}var L=n("5cL1"),R=n("I3n7"),I=n("rpwb"),D={boolean:{validate:function(t,e){return!0},equal:function(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return N(t)&&(3===t.length||4===t.length)},equal:function(t,e,n){return F(t,e)}},accessor:{validate:function(t,e){var n=U(t);return"function"===n||n===U(e.value)},equal:function(t,e,n){return"function"==typeof e||F(t,e)}},array:{validate:function(t,e){return e.optional&&!t||N(t)},equal:function(t,e,n){return n.compare?F(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,n){return!n.compare||t===e}}};function F(t,e){if(t===e)return!0;if(!N(t)||!N(e))return!1;var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function z(t,e){switch(U(e)){case"object":return B(t,e);case"array":return B(t,{type:"array",value:e,compare:!1});case"boolean":return B(t,{type:"boolean",value:e});case"number":return B(t,{type:"number",value:e});case"function":return B(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function B(t,e){return"type"in e?Object.assign({name:t},D[e.type],e):"value"in e?Object.assign({name:t,type:U(e.value)},e):{name:t,type:"object",value:e}}function N(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function U(t){return N(t)?"array":null===t?"null":Object(j.a)(t)}function V(t,e,n){if(e)for(var i in n)if(Z(e,i)){var r="".concat(t||"Layer",": ").concat(i),a=!0,o=!1,s=void 0;try{for(var u,h=n[i][Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var c=u.value;Z(e,c)||(e[c]=e[i])}}catch(t){o=!0,s=t}finally{try{a||null==h.return||h.return()}finally{if(o)throw s}}b.a.deprecated(r,n[i].join("/"))()}}function G(t){var e=W(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:W(t,"_propTypes"),deprecatedProps:W(t,"_deprecatedProps")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var n=Object.getPrototypeOf(t),r=e&&G(n)||null,a=function(t){for(var e={},n={},r={},a=0,o=Object.entries(t);a<o.length;a++){var s=Object(i.a)(o[a],2),u=s[0],h=s[1];if(h&&h.deprecatedFor)r[u]=Array.isArray(h.deprecatedFor)?h.deprecatedFor:[h.deprecatedFor];else{var c=z(u,h);e[u]=c,n[u]=c.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}(W(t,"defaultProps")||{}),o=Object.assign({},r&&r.propTypes,a.propTypes),s=function(t,e,n,i){var r=Object.create(null);Object.assign(r,e,t);var a=function(t){var e=W(t,"layerName")||W(t,"componentName");return e||b.a.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}(i);return delete t.id,Object.defineProperties(r,{id:{configurable:!1,writable:!0,value:a}}),function(t,e){var n={},i={_asyncPropDefaultValues:{enumerable:!1,value:n},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var r in e){var a=e[r],o=a.name,s=a.value;a.async&&(n[o]=s,i[o]=H(o))}Object.defineProperties(t,i)}(r,n),r}(a.defaultProps,r&&r.defaultProps,o,t),u=Object.assign({},r&&r.deprecatedProps,a.deprecatedProps);return t._mergedDefaultProps=s,t._propTypes=o,t._deprecatedProps=u,{propTypes:o,defaultProps:s,deprecatedProps:u}}(t)}function H(t){return{configurable:!1,enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise||Object(I.b)(e)?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}if(t in this._asyncPropOriginalValues){var n=this._component&&this._component.internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)}}return this._asyncPropDefaultValues[t]}}}function Z(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function W(t,e){return Z(t,e)&&t[e]}var X=n("o0o1"),q=n.n(X),Y=n("HaE+");function J(t){var e;if("function"==typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}var K=Object.freeze({}),Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(r.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=K,this.oldAsyncProps=null}return Object(a.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},n=t._asyncPropOriginalValues||t,i=t._asyncPropDefaultValues||{};for(var r in e){var a=e[r];this._createAsyncPropData(r,a,i[r]),this._updateAsyncProp(r,a)}for(var o in n){var s=n[o];this._createAsyncPropData(o,s,i[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e){var n=this.layer&&this.layer.props.fetch;n&&(e=n(e,{propName:t,layer:this.layer}))}e instanceof Promise?this._watchPromise(t,e):Object(I.b)(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var n=this.asyncProps[t];return e!==n.lastValue&&(n.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var n=this.asyncProps[t];n.value=e,n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,n){var i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&(Object(k.a)(void 0!==e),this.freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var n=this,i=this.asyncProps[t];i.pendingLoadCount++;var r=i.pendingLoadCount;e.then((function(e){e=n._postProcessValue(t,e),n._setAsyncPropValue(t,e,r);var i=n.layer&&n.layer.props.onDataLoad;"data"===t&&i&&i(e,{propName:t,layer:n.layer})})).catch((function(t){return b.a.error(t)()}))}},{key:"_resolveAsyncIterable",value:function(){var t=Object(Y.a)(q.a.mark((function t(e,n){var i,r,a,o,s,u,h,c,l,f,d,p;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"data"!==e&&this._setPropValue(e,n),(i=this.asyncProps[e]).pendingLoadCount++,r=i.pendingLoadCount,a=[],o=0,s=!0,u=!1,t.prev=8,c=J(n);case 10:return t.next=12,c.next();case 12:return l=t.sent,s=l.done,t.next=16,l.value;case 16:if(f=t.sent,s){t.next=26;break}d=f,a=this._postProcessValue(e,d,a),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:o,endRow:a.length}]}),o=a.length,this._setAsyncPropValue(e,a,r);case 23:s=!0,t.next=10;break;case 26:t.next=32;break;case 28:t.prev=28,t.t0=t.catch(8),u=!0,h=t.t0;case 32:if(t.prev=32,t.prev=33,s||null==c.return){t.next=37;break}return t.next=37,c.return();case 37:if(t.prev=37,!u){t.next=40;break}throw h;case 40:return t.finish(37);case 41:return t.finish(32);case 42:(p=this.layer&&this.layer.props.onDataLoad)&&p(a,{propName:e,layer:this.layer});case 44:case"end":return t.stop()}}),t,this,[[8,28,32,42],[33,,37,41]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"_postProcessValue",value:function(t,e,n){var i=(this.component?this.component.props:{}).dataTransform;return"data"!==t?e:i?i(e,n):n?n.concat(e):e}},{key:"_createAsyncPropData",value:function(t,e,n){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),$=0,tt=function(){function t(){Object(r.a)(this,t),this.props=function(){for(var t=G(this.constructor),e=t.defaultProps,n=Object.create(e,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),i=0;i<arguments.length;++i)Object.assign(n,arguments[i]);var r=this.constructor.layerName,a=t.deprecatedProps;return V(r,n,a),V(r,n.updateTriggers,a),V(r,n.transitions,a),Object(l.a)(n),Object.freeze(n),n}.apply(this,arguments),this.id=this.props.id,this.count=$++,this.lifecycle=R.a.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(a.a)(t,[{key:"clone",value:function(t){var e=this.props,n={};for(var i in e._asyncPropDefaultValues)i in e._asyncPropResolvedValues?n[i]=e._asyncPropResolvedValues[i]:i in e._asyncPropOriginalValues&&(n[i]=e._asyncPropOriginalValues[i]);return new this.constructor(Object.assign({},e,n,t))}},{key:"_initState",value:function(){this.internalState=new Q({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();tt.componentName="Component",tt.defaultProps={};var et=function(t){function e(t){var n,i=t.attributeManager,a=t.layer;return Object(r.a)(this,e),(n=Object(o.a)(this,Object(s.a)(e).call(this,a))).attributeManager=i,n.model=null,n.needsRedraw=!0,n.subLayers=null,n}return Object(u.a)(e,t),Object(a.a)(e,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),e}(Q),nt=n("B7nP"),it=n("ieC7");n.d(e,"a",(function(){return st}));var rt=Object.freeze([]),at=new Uint8ClampedArray(0),ot={data:{type:"data",value:rt,async:!0},dataComparator:null,_dataDiff:{type:"function",value:function(t){return t&&t.__diff},compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:function(t,e){var n=e.layer;return Object(it.a)(t,n.getLoadOptions())},compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:h.a.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},uniforms:{},extensions:[],framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}},st=function(t){function e(){return Object(r.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(a.a)(e,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}},{key:"hasUniformTransition",value:function(){return this.internalState.uniformTransitions.active}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,n=!1,i=void 0;try{for(var r,a=t[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)return r.value}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return null}},{key:"project",value:function(t){var e=this.context.viewport,n=Object(L.a)(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),r=Object(nt.k)(n,e.pixelProjectionMatrix),a=Object(i.a)(r,3),o=a[0],s=a[1],u=a[2];return 2===t.length?[o,s]:[o,s,u]}},{key:"unproject",value:function(t){var e=this.context.viewport;return Object(k.a)(Array.isArray(t)),e.unproject(t)}},{key:"projectPosition",value:function(t){return Object(k.a)(Array.isArray(t)),Object(L.b)(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"projectFlat",value:function(t){b.a.deprecated("layer.projectFlat","layer.projectPosition")();var e=this.context.viewport;return Object(k.a)(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){b.a.deprecated("layer.unprojectFlat")();var e=this.context.viewport;return Object(k.a)(Array.isArray(t)),e.unprojectFlat(t)}},{key:"use64bitPositions",value:function(){return this.props.coordinateSystem===h.a.LNGLAT||this.props.coordinateSystem===h.a.IDENTITY}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(k.a)(t<16777215,"index out of picking color range"),e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){Object(k.a)(t instanceof Uint8Array);var e=Object(i.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"getShaders",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.props.extensions[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;t=A(t,o.getShaders.call(this,o))}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"shouldUpdateState",value:function(t){return t.oldProps,t.props,t.context,t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,n=this.getAttributeManager();if(e.dataChanged&&n){var i=e.dataChanged;if(Array.isArray(i)){var r=!0,a=!1,o=void 0;try{for(var s,u=i[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;n.invalidateAll(h)}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}}else n.invalidateAll()}}},{key:"finalizeState",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.getModels()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.delete()}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}var a=this.getAttributeManager();a&&a.finalize(),this.internalState.uniformTransitions.clear()}},{key:"draw",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.draw(t)}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=(t.mode,e.index);return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.getAttributeManager();n&&("all"===t?(b.a.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),n.invalidateAll()):(b.a.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),n.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;this._setModelAttributes(o,t)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"_updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var n=this.getNumInstances(t),i=this.getBufferLayout(t);e.update({data:t.data,numInstances:n,bufferLayout:i,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}}},{key:"_updateAttributeTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition()}},{key:"_updateUniformTransition",value:function(){var t=this.internalState.uniformTransitions;if(t.active){var e=t.update(),n=Object.create(this.props);for(var i in e)Object.defineProperty(n,i,{value:e[i]});return n}return this.props}},{key:"calculateInstancePickingColors",value:function(t,e){var n=e.numInstances,i=e.startRow,r=e.endRow,a=t.value,o=t.size,s=at.length/o;if(s<n){var u=new Uint8ClampedArray(n*o);u.set(at);for(var h=[],c=s;c<n;c++)this.encodePickingColor(c,h),u[c*o+0]=h[0],u[c*o+1]=h[1],u[c*o+2]=h[2];at=u}r=Math.min(r,n),a.set(at.subarray(i*o,r*o),i*o)}},{key:"_setModelAttributes",value:function(t,e){var n={},i=t.userData.excludeAttributes||{};for(var r in e)i[r]||Object.assign(n,e[r].getShaderAttributes());t.setAttributes(n)}},{key:"clearPickingColor",value:function(t){var e=this.getAttributeManager().attributes,n=e.pickingColors,i=e.instancePickingColors,r=n||i,a=this.decodePickingColor(t),o=r.getVertexOffset(a),s=r.getVertexOffset(a+1);r.buffer.subData({data:new Uint8Array(s-o),offset:o})}},{key:"restorePickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,n=t.instancePickingColors,i=e||n;i.update({value:i.value})}},{key:"getNumInstances",value:function(t){if(void 0!==(t=t||this.props).numInstances)return t.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;var e=this.props.data;return Object(E.a)(e)}},{key:"getBufferLayout",value:function(t){return void 0!==(t=t||this.props).bufferLayout?t.bufferLayout:this.state&&void 0!==this.state.bufferLayout?this.state.bufferLayout:null}},{key:"_initialize",value:function(){this._initState(),this.initializeState(this.context);var t=!0,e=!1,n=void 0;try{for(var i,r=this.props.extensions[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;a.initializeState.call(this,this.context,a)}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState();var o=this.getSingleModel();o&&(o.id=this.props.id,o.program.id="".concat(this.props.id,"-program"))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this.props,e=this._updateUniformTransition();this.internalState.propsInTransition=e,this.props=e;var n=this._getUpdateParams();if(this.context.gl)this.updateState(n);else try{this.updateState(n)}catch(t){}var i=!0,r=!1,a=void 0;try{for(var o,s=this.props.extensions[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;u.updateState.call(this,n,u)}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}this.isComposite?this._renderLayers(n):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.props=t,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}},{key:"_finalize",value:function(){Object(k.a)(this.internalState&&this.state),this.finalizeState(this.context);var t=!0,e=!1,n=void 0;try{for(var i,r=this.props.extensions[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;a.finalizeState.call(this,a)}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}Object(l.d)(this.id)}},{key:"drawLayer",value:function(t){var e=this,n=t.moduleParameters,i=void 0===n?null:n,r=t.uniforms,a=void 0===r?{}:r,o=t.parameters,s=void 0===o?{}:o;this._updateAttributeTransition();var u=this.props;this.props=this.internalState.propsInTransition;var h=this.props.opacity;a.opacity=Math.pow(h,1/2.2),i&&this.setModuleParameters(i);var c=this.props.getPolygonOffset,l=c&&c(a)||[0,0];s.polygonOffset=l,Object(S.a)(this.context.gl,s,(function(){e.draw({moduleParameters:i,uniforms:a,parameters:s,context:e.context})})),this.props=u}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var n=this.internalState.changeFlags;t.dataChanged&&!n.dataChanged&&(n.dataChanged=t.dataChanged,b.a.log(2,(function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)}))()),t.updateTriggersChanged&&!n.updateTriggersChanged&&(n.updateTriggersChanged=n.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,n.updateTriggersChanged):t.updateTriggersChanged||n.updateTriggersChanged,b.a.log(2,(function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)}))()),t.propsChanged&&!n.propsChanged&&(n.propsChanged=t.propsChanged,b.a.log(2,(function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)}))()),t.extensionsChanged&&!n.extensionsChanged&&(n.extensionsChanged=t.extensionsChanged,b.a.log(2,(function(){return"extensionsChanged: ".concat(t.extensionsChanged," in ").concat(e.id)}))()),t.viewportChanged&&!n.viewportChanged&&(n.viewportChanged=t.viewportChanged,b.a.log(3,(function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)}))()),t.stateChanged&&!n.stateChanged&&(n.stateChanged=t.stateChanged,b.a.log(2,(function(){return"stateChanged: ".concat(t.stateChanged," in ").concat(e.id)}))());var i=t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged;n.propsOrDataChanged=n.propsOrDataChanged||i,n.somethingChanged=n.somethingChanged||i||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var n=function(t,e){var n=P({newProps:t,oldProps:e,propTypes:M(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";var n=null,i=t.dataComparator,r=t._dataDiff;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}(t,e),r=!1;return i||(r=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers&&T(t,e,"all"))return{all:!0};var n={},i=!1;for(var r in t.updateTriggers)if("all"!==r){T(t,e,r)&&(n[r]=!0,i=n)}return i}(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:function(t,e){if(null===e)return"oldProps is null, initial diff";var n=e.extensions,i=t.extensions;if(i===n)return!1;if(i.length!==n.length)return!0;for(var r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}(t,e),transitionsChanged:function(t,e){if(!t.transitions)return null;var n={},i=M(t);for(var r in t.transitions){var a=i[r],o=a&&a.type;("number"===o||"color"===o||"array"===o)&&C(t[r],e[r],a)&&(n[r]=!0)}return n}(t,e)}}(t,e);if(n.updateTriggersChanged)for(var i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this._activeUpdateTrigger(i);if(n.transitionsChanged)for(var r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,e[r],t[r],t.transitions[r]);return this.setChangeFlags(n)}},{key:"validateProps",value:function(){!function(t){var e=M(t);for(var n in e){var i=e[n],r=i.validate;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.updateModuleSettings(t)}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var n=this.getAttributeManager(),i=n&&n.getNeedsRedraw(t);return e||i}},{key:"_getAttributeManager",value:function(){return new c.a(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}},{key:"_initState",value:function(){Object(k.a)(!this.internalState&&!this.state);var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new et({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=t,this.internalState.uniformTransitions=new O(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,n=t.internalState;if(Object(k.a)(e&&n),this!==t){this.internalState=n,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var i=!0,r=!1,a=void 0;try{for(var o,s=this.getModels()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)o.value.userData.layer=this}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"setLayerNeedsUpdate",value:function(){b.a.deprecated("layer.setLayerNeedsUpdate","layer.setNeedsUpdate")(),this.setNeedsUpdate()}},{key:"setUniforms",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.setUniforms(t)}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}this.setNeedsRedraw(),b.a.deprecated("layer.setUniforms","model.setUniforms")()}},{key:"use64bitProjection",value:function(){return b.a.removed("use64bitProjection","Fp64Extension")(),!1}}]),e}(tt);st.layerName="Layer",st.defaultProps=ot},K9nA:function(t,e,n){"use strict";(function(t,i){n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var r=n("U8pU"),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(r.a)(i))&&i},o=a.window||a.self||a.global,s=a.process||{};console}).call(this,n("yLpj"),n("8oxB"))},KQm4:function(t,e,n){"use strict";function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(e,"a",(function(){return i}))},L8KH:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n("1OyB"),r=n("vuIU"),a=n("rta6"),o=n("SUVH"),s=n("rnmN"),u=n("VdrS"),h=n("CxzY"),c=n("sgaE"),l="Resource subclass must define virtual methods",f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),Object(o.b)(e);var r=n.id,a=n.userData,s=void 0===a?{}:a;this.gl=e,this.id=r||Object(u.c)(this.constructor.name),this.userData=s,this._bound=!1,this._handle=n.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return Object(r.a)(t,[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"delete",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,e=void 0!==t&&t,n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach((function(t){t.delete()})),this}},{key:"bind",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object(s.b)(this.gl,t),Object(h.a)(t);var n=(this.constructor.PARAMETERS||{})[t];if(n){var i=Object(o.d)(this.gl);if("webgl2"in n&&!i||"extension"in n&&!this.gl.getExtension(n.extension)){var r=n.webgl1,a="webgl2"in n?n.webgl2:n.webgl1;return i?a:r}}return this._getParameter(t,e)}},{key:"getParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},n=e.parameters,i=e.keys,r=this.constructor.PARAMETERS||{},a=Object(o.d)(this.gl),u={},h=n||Object.keys(r),c=!0,l=!1,f=void 0;try{for(var d,p=h[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var g=d.value,v=r[g];if(v&&(!("webgl2"in v)||a)&&(!("extension"in v)||this.gl.getExtension(v.extension))){var m=i?Object(s.a)(this.gl,g):g;u[m]=this.getParameter(g,t),i&&"GLenum"===v.type&&(u[m]=Object(s.a)(this.gl,u[m]))}}}catch(t){l=!0,f=t}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}return u}},{key:"setParameter",value:function(t,e){t=Object(s.b)(this.gl,t),Object(h.a)(t);var n=(this.constructor.PARAMETERS||{})[t];if(n){var i=Object(o.d)(this.gl);if("webgl2"in n&&!i||"extension"in n&&!this.gl.getExtension(n.extension))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=Object(s.b)(e))}return this._setParameter(t,e),this}},{key:"setParameters",value:function(t){for(var e in t)this.setParameter(e,t[e]);return this}},{key:"stubRemovedMethods",value:function(t,e,n){return Object(c.a)(this,t,e,n)}},{key:"initialize",value:function(t){}},{key:"_createHandle",value:function(){throw new Error(l)}},{key:"_deleteHandle",value:function(){throw new Error(l)}},{key:"_bindHandle",value:function(){throw new Error(l)}},{key:"_getOptsFromHandle",value:function(){throw new Error(l)}},{key:"_getParameter",value:function(t,e){throw new Error(l)}},{key:"_setParameter",value:function(t,e){throw new Error(l)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var t=this.constructor.name,e=a.a.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var t=this.constructor.name;a.a.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.constructor.name,n=a.a.get("Memory Usage");n.get("GPU Memory").addCount(t),n.get("".concat(e," Memory")).addCount(t),this.byteLength=t}},{key:"_trackDeallocatedMemory",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.constructor.name,e=a.a.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}},{key:"handle",get:function(){return this._handle}}]),t}()},L9Dj:function(t,e,n){"use strict";var i=n("Wxfb");function r(t){var e=t.source,n=t.target,i=t.start,r=void 0===i?0:i,a=t.end,o=t.getData;a=a||n.length;var s=e.length,u=a-r;if(s>u)n.set(e.subarray(0,u),r);else if(n.set(e,r),o)for(var h=s;h<u;)for(var c=o(h,e),l=0;l<c.length;l++)n[r+h]=c[l],h++}n.d(e,"e",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return c})),n.d(e,"f",(function(){return l}));var a={interpolation:{duration:0,easing:function(t){return t}},spring:{stiffness:.05,damping:.5}};function o(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",Object.assign({},a[t.type],e,t)):null}function s(t,e){var n=e.size,r=e.value,a=e.normalized,o=e.constant;if(o)return new i.a(t,{constant:o,value:r,size:n});var s=e.getBuffer();return new i.a(t,{divisor:0,constant:o,buffer:s,size:n,normalized:a})}function u(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function h(t){t.push(t.shift())}function c(t,e){var n=t.doublePrecision,i=t.userData,r=t.value,a=t.size,o=n?2:1;return(i.noAlloc?r.length:e*a)*o}function l(t){var e=t.buffer,n=t.numInstances,i=t.attribute,a=t.fromLength,o=t.fromBufferLayout,s=t.getData,u=void 0===s?function(t){return t}:s,h=i.doublePrecision?2:1,l=i.size*h,f=i.elementOffset*h,d=i.bufferLayout,p=o&&d,g=c(i,n);if(p||!(a>=g)){var v=i.constant?i.getValue():i.getBuffer().getData({});if(i.normalized){var m=u;u=function(t,e){return i._normalizeConstant(m(t,e))}}var y=i.constant?function(t,e){return u(v,e)}:function(t,e){return u(v.subarray(t,t+l),e)},_=e.getData({length:a}),b=new Float32Array(g);!function(t){var e=t.source,n=t.target,i=t.size,a=t.offset,o=void 0===a?0:a,s=t.getData,u=t.sourceLayout,h=t.targetLayout;if(!Array.isArray(h))return r({source:e,target:n,getData:s}),n;for(var c=o,l=o,f=s&&function(t,e){return s(t+l,e)},d=Math.min(u.length,h.length),p=0;p<d;p++){var g=u[p]*i,v=h[p]*i;r({source:e.subarray(c,c+g),target:n,start:l,end:l+v,getData:f}),c+=g,l+=v}l<n.length&&r({source:[],target:n,start:l,getData:f})}({source:_,target:b,sourceLayout:o,targetLayout:d,offset:f,size:l,getData:y}),e.setData({data:b})}}},LDVv:function(t,e,n){"use strict";function i(t,e){return t===e||Object.keys(t).every((function(n){return Array.isArray(t[n])&&Array.isArray(e[n])?i(t[n],e[n]):t[n]===e[n]}))}n.d(e,"a",(function(){return i}))},LE90:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("5+o2");function r(t,e,n){var r=n.removedProps,a=void 0===r?{}:r,o=n.deprecatedProps,s=void 0===o?{}:o,u=n.replacedProps,h=void 0===u?{}:u;for(var c in a)if(c in e){var l=a[c]?"".concat(t,".").concat(a[c]):"N/A";i.a.removed("".concat(t,".").concat(c),l)()}for(var f in s)if(f in e){var d=s[f];i.a.deprecated("".concat(t,".").concat(f),"".concat(t,".").concat(d))()}var p=null;for(var g in h)if(g in e){var v=h[g];i.a.deprecated("".concat(t,".").concat(g),"".concat(t,".").concat(v))(),(p=p||Object.assign({},e))[v]=e[g],delete p[g]}return p||e}},LhmN:function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"d",(function(){return d})),n.d(e,"a",(function(){return p})),n.d(e,"c",(function(){return v}));var i,r,a,o=n("KQm4"),s=n("rePB"),u=n("y7xQ"),h=(i={},Object(s.a)(i,3042,!1),Object(s.a)(i,32773,new Float32Array([0,0,0,0])),Object(s.a)(i,32777,32774),Object(s.a)(i,34877,32774),Object(s.a)(i,32969,1),Object(s.a)(i,32968,0),Object(s.a)(i,32971,1),Object(s.a)(i,32970,0),Object(s.a)(i,3106,new Float32Array([0,0,0,0])),Object(s.a)(i,3107,[!0,!0,!0,!0]),Object(s.a)(i,2884,!1),Object(s.a)(i,2885,1029),Object(s.a)(i,2929,!1),Object(s.a)(i,2931,1),Object(s.a)(i,2932,513),Object(s.a)(i,2928,new Float32Array([0,1])),Object(s.a)(i,2930,!0),Object(s.a)(i,3024,!0),Object(s.a)(i,36006,null),Object(s.a)(i,2886,2305),Object(s.a)(i,33170,4352),Object(s.a)(i,2849,1),Object(s.a)(i,32823,!1),Object(s.a)(i,32824,0),Object(s.a)(i,10752,0),Object(s.a)(i,32938,1),Object(s.a)(i,32939,!1),Object(s.a)(i,3089,!1),Object(s.a)(i,3088,new Int32Array([0,0,1024,1024])),Object(s.a)(i,2960,!1),Object(s.a)(i,2961,0),Object(s.a)(i,2968,4294967295),Object(s.a)(i,36005,4294967295),Object(s.a)(i,2962,519),Object(s.a)(i,2967,0),Object(s.a)(i,2963,4294967295),Object(s.a)(i,34816,519),Object(s.a)(i,36003,0),Object(s.a)(i,36004,4294967295),Object(s.a)(i,2964,7680),Object(s.a)(i,2965,7680),Object(s.a)(i,2966,7680),Object(s.a)(i,34817,7680),Object(s.a)(i,34818,7680),Object(s.a)(i,34819,7680),Object(s.a)(i,2978,new Int32Array([0,0,1024,1024])),Object(s.a)(i,3333,4),Object(s.a)(i,3317,4),Object(s.a)(i,37440,!1),Object(s.a)(i,37441,!1),Object(s.a)(i,37443,37444),Object(s.a)(i,35723,4352),Object(s.a)(i,36010,null),Object(s.a)(i,35977,!1),Object(s.a)(i,3330,0),Object(s.a)(i,3332,0),Object(s.a)(i,3331,0),Object(s.a)(i,3314,0),Object(s.a)(i,32878,0),Object(s.a)(i,3316,0),Object(s.a)(i,3315,0),Object(s.a)(i,32877,0),i),c=function(t,e,n){return e?t.enable(n):t.disable(n)},l=function(t,e,n){return t.hint(n,e)},f=function(t,e,n){return t.pixelStorei(n,e)},d=(r={},Object(s.a)(r,3042,c),Object(s.a)(r,32773,(function(t,e){return t.blendColor.apply(t,Object(o.a)(e))})),Object(s.a)(r,32777,"blendEquation"),Object(s.a)(r,34877,"blendEquation"),Object(s.a)(r,32969,"blendFunc"),Object(s.a)(r,32968,"blendFunc"),Object(s.a)(r,32971,"blendFunc"),Object(s.a)(r,32970,"blendFunc"),Object(s.a)(r,3106,(function(t,e){return t.clearColor.apply(t,Object(o.a)(e))})),Object(s.a)(r,3107,(function(t,e){return t.colorMask.apply(t,Object(o.a)(e))})),Object(s.a)(r,2884,c),Object(s.a)(r,2885,(function(t,e){return t.cullFace(e)})),Object(s.a)(r,2929,c),Object(s.a)(r,2931,(function(t,e){return t.clearDepth(e)})),Object(s.a)(r,2932,(function(t,e){return t.depthFunc(e)})),Object(s.a)(r,2928,(function(t,e){return t.depthRange.apply(t,Object(o.a)(e))})),Object(s.a)(r,2930,(function(t,e){return t.depthMask(e)})),Object(s.a)(r,3024,c),Object(s.a)(r,35723,l),Object(s.a)(r,36006,(function(t,e){var n=Object(u.b)(t)?36009:36160;return t.bindFramebuffer(n,e)})),Object(s.a)(r,2886,(function(t,e){return t.frontFace(e)})),Object(s.a)(r,33170,l),Object(s.a)(r,2849,(function(t,e){return t.lineWidth(e)})),Object(s.a)(r,32823,c),Object(s.a)(r,32824,"polygonOffset"),Object(s.a)(r,10752,"polygonOffset"),Object(s.a)(r,35977,c),Object(s.a)(r,32938,"sampleCoverage"),Object(s.a)(r,32939,"sampleCoverage"),Object(s.a)(r,3089,c),Object(s.a)(r,3088,(function(t,e){return t.scissor.apply(t,Object(o.a)(e))})),Object(s.a)(r,2960,c),Object(s.a)(r,2961,(function(t,e){return t.clearStencil(e)})),Object(s.a)(r,2968,(function(t,e){return t.stencilMaskSeparate(1028,e)})),Object(s.a)(r,36005,(function(t,e){return t.stencilMaskSeparate(1029,e)})),Object(s.a)(r,2962,"stencilFuncFront"),Object(s.a)(r,2967,"stencilFuncFront"),Object(s.a)(r,2963,"stencilFuncFront"),Object(s.a)(r,34816,"stencilFuncBack"),Object(s.a)(r,36003,"stencilFuncBack"),Object(s.a)(r,36004,"stencilFuncBack"),Object(s.a)(r,2964,"stencilOpFront"),Object(s.a)(r,2965,"stencilOpFront"),Object(s.a)(r,2966,"stencilOpFront"),Object(s.a)(r,34817,"stencilOpBack"),Object(s.a)(r,34818,"stencilOpBack"),Object(s.a)(r,34819,"stencilOpBack"),Object(s.a)(r,2978,(function(t,e){return t.viewport.apply(t,Object(o.a)(e))})),Object(s.a)(r,3333,f),Object(s.a)(r,3317,f),Object(s.a)(r,37440,f),Object(s.a)(r,37441,f),Object(s.a)(r,37443,f),Object(s.a)(r,3330,f),Object(s.a)(r,3332,f),Object(s.a)(r,3331,f),Object(s.a)(r,36010,(function(t,e){return t.bindFramebuffer(36008,e)})),Object(s.a)(r,3314,f),Object(s.a)(r,32878,f),Object(s.a)(r,3316,f),Object(s.a)(r,3315,f),Object(s.a)(r,32877,f),r),p={blendEquation:function(t,e){return t.blendEquationSeparate(e[32777],e[34877])},blendFunc:function(t,e){return t.blendFuncSeparate(e[32969],e[32968],e[32971],e[32970])},polygonOffset:function(t,e){return t.polygonOffset(e[32824],e[10752])},sampleCoverage:function(t,e){return t.sampleCoverage(e[32938],e[32939])},stencilFuncFront:function(t,e){return t.stencilFuncSeparate(1028,e[2962],e[2967],e[2963])},stencilFuncBack:function(t,e){return t.stencilFuncSeparate(1029,e[34816],e[36003],e[36004])},stencilOpFront:function(t,e){return t.stencilOpSeparate(1028,e[2964],e[2965],e[2966])},stencilOpBack:function(t,e){return t.stencilOpSeparate(1029,e[34817],e[34818],e[34819])}},g=function(t,e){return t.isEnabled(e)},v=(a={},Object(s.a)(a,3042,g),Object(s.a)(a,2884,g),Object(s.a)(a,2929,g),Object(s.a)(a,3024,g),Object(s.a)(a,32823,g),Object(s.a)(a,32926,g),Object(s.a)(a,32928,g),Object(s.a)(a,3089,g),Object(s.a)(a,2960,g),Object(s.a)(a,35977,g),a)},MdWm:function(t,e,n){"use strict";var i=n("rePB"),r=n("f5Sf"),a=n("o0o1"),o=n.n(a),s=n("HaE+"),u=n("1OyB"),h=n("vuIU"),c=n("md7G"),l=n("foSv"),f=n("JX7q"),d=n("Ji7U"),p=n("l6PP"),g=n("SUVH"),v=n("5+o2"),m=[34069,34070,34071,34072,34073,34074],y=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,e),Object(g.b)(t),(n=Object(c.a)(this,Object(l.a)(e).call(this,t,Object.assign({},i,{target:34067})))).initialize(i),Object.seal(Object(f.a)(n)),n}return Object(d.a)(e,t),Object(h.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.mipmaps,i=void 0===n||n,r=e.parameters,a=void 0===r?{}:r;this.opts=e,this.setCubeMapImageData(e).then((function(){t.loaded=!0,i&&t.generateMipmap(e),t.setParameters(a)}))}},{key:"subImage",value:function(t){var e=t.face,n=t.data,i=t.x,r=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.mipmapLevel,u=void 0===s?0:s;return this._subImage({target:e,data:n,x:r,y:o,mipmapLevel:u})}},{key:"setCubeMapImageData",value:function(){var t=Object(s.a)(o.a.mark((function t(e){var n,i,r,a,s,u,h,c,l,f,d,p,g,y=this;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.width,i=e.height,r=e.pixels,a=e.data,s=e.border,u=void 0===s?0:s,h=e.format,c=void 0===h?6408:h,l=e.type,f=void 0===l?5121:l,d=this.gl,p=r||a,t.next=5,Promise.all(m.map((function(t){var e=p[t];return Promise.all(Array.isArray(e)?e:[e])})));case 5:g=t.sent,this.bind(),m.forEach((function(t,e){g[e].length>1&&!1!==y.opts.mipmaps&&v.a.warn("".concat(y.id," has mipmap and multiple LODs."))(),g[e].forEach((function(e,r){n&&i?d.texImage2D(t,r,c,n,i,u,c,f,e):d.texImage2D(t,r,c,c,f,e)}))})),this.unbind();case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setImageDataForFace",value:function(t){var e=this,n=t.face,i=t.width,r=t.height,a=t.pixels,o=t.data,s=t.border,u=void 0===s?0:s,h=t.format,c=void 0===h?6408:h,l=t.type,f=void 0===l?5121:l,d=this.gl,p=a||o;return this.bind(),p instanceof Promise?p.then((function(i){return e.setImageDataForFace(Object.assign({},t,{face:n,data:i,pixels:i}))})):this.width||this.height?d.texImage2D(n,0,c,i,r,u,c,f,p):d.texImage2D(n,0,c,c,f,p),this}}]),e}(p.a);y.FACES=m;var _=n("hP3k"),b=n("uYBD"),w=n("sc/6"),x=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,e),Object(g.a)(t),i=Object.assign({depth:1},i,{target:32879,unpackFlipY:!1}),(n=Object(c.a)(this,Object(l.a)(e).call(this,t,i))).initialize(i),Object.seal(Object(f.a)(n)),n}return Object(d.a)(e,t),Object(h.a)(e,null,[{key:"isSupported",value:function(t){return Object(g.d)(t)}}]),Object(h.a)(e,[{key:"setImageData",value:function(t){var e=this,n=t.level,i=void 0===n?0:n,r=t.dataFormat,a=void 0===r?6408:r,o=t.width,s=t.height,u=t.depth,h=void 0===u?1:u,c=t.border,l=void 0===c?0:c,f=t.format,d=t.type,p=void 0===d?5121:d,g=t.offset,v=void 0===g?0:g,m=t.data,y=t.parameters,x=void 0===y?{}:y;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(_.a)(this.gl,x,(function(){ArrayBuffer.isView(m)&&e.gl.texImage3D(e.target,i,a,o,s,h,l,f,p,m),m instanceof w.a&&(e.gl.bindBuffer(35052,m.handle),e.gl.texImage3D(e.target,i,a,o,s,h,l,f,p,v))})),m&&m.byteLength)this._trackAllocatedMemory(m.byteLength,"Texture");else{var O=b.a[this.dataFormat]||4,j=b.c[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*O*j,"Texture")}return this.loaded=!0,this}}]),e}(p.a),O=n("11Ib"),j=n("CxzY");function k(t,e){Object(j.a)(t instanceof r.a||t instanceof y||t instanceof x);var n=t.constructor,i=t.gl,a=t.width,o=t.height,s=t.format,u=t.type,h=t.dataFormat,c=t.border,l=t.mipmaps;return new n(i,Object.assign({width:a,height:o,format:s,type:u,dataFormat:h,border:c,mipmaps:l},e))}function P(t,e){var n=t.gl,r=t.width,a=t.height,o=t.id;return new O.a(n,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:a,attachments:Object(i.a)({},36064,t)}))}n.d(e,"a",(function(){return k})),n.d(e,"b",(function(){return P}))},ODXe:function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(e,"a",(function(){return i}))},OIVS:function(t,e,n){"use strict";function i(t,e){if(t===e)return!0;if(Array.isArray(t)){var n=t.length;if(!e||e.length!==n)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function r(t){var e,n={};return function(r){for(var a in r)if(!i(r[a],n[a])){e=t(r),n=r;break}return e}}n.d(e,"a",(function(){return r}))},OklE:function(t,e,n){"use strict";var i,r=n("1OyB"),a=n("vuIU"),o=n("md7G"),s=n("JX7q"),u=n("foSv"),h=n("ReuC"),c=n("Ji7U"),l=n("L8KH"),f=n("l6PP"),d=n("11Ib"),p=n("rePB"),g=n("n4Ve"),v=n("5+o2"),m=(i={},Object(p.a)(i,5126,(function(t,e,n){return t.uniform1fv(e,O(n,1))})),Object(p.a)(i,35664,(function(t,e,n){return t.uniform2fv(e,O(n,2))})),Object(p.a)(i,35665,(function(t,e,n){return t.uniform3fv(e,O(n,3))})),Object(p.a)(i,35666,(function(t,e,n){return t.uniform4fv(e,O(n,4))})),Object(p.a)(i,5124,(function(t,e,n){return t.uniform1iv(e,j(n,1))})),Object(p.a)(i,35667,(function(t,e,n){return t.uniform2iv(e,j(n,2))})),Object(p.a)(i,35668,(function(t,e,n){return t.uniform3iv(e,j(n,3))})),Object(p.a)(i,35669,(function(t,e,n){return t.uniform4iv(e,j(n,4))})),Object(p.a)(i,35670,(function(t,e,n){return t.uniform1iv(e,j(n,1))})),Object(p.a)(i,35671,(function(t,e,n){return t.uniform2iv(e,j(n,2))})),Object(p.a)(i,35672,(function(t,e,n){return t.uniform3iv(e,j(n,3))})),Object(p.a)(i,35673,(function(t,e,n){return t.uniform4iv(e,j(n,4))})),Object(p.a)(i,35674,(function(t,e,n){return t.uniformMatrix2fv(e,!1,O(n,4))})),Object(p.a)(i,35675,(function(t,e,n){return t.uniformMatrix3fv(e,!1,O(n,9))})),Object(p.a)(i,35676,(function(t,e,n){return t.uniformMatrix4fv(e,!1,O(n,16))})),Object(p.a)(i,35678,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,35680,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,5125,(function(t,e,n){return t.uniform1uiv(e,k(n,1))})),Object(p.a)(i,36294,(function(t,e,n){return t.uniform2uiv(e,k(n,2))})),Object(p.a)(i,36295,(function(t,e,n){return t.uniform3uiv(e,k(n,3))})),Object(p.a)(i,36296,(function(t,e,n){return t.uniform4uiv(e,k(n,4))})),Object(p.a)(i,35685,(function(t,e,n){return t.uniformMatrix2x3fv(e,!1,O(n,6))})),Object(p.a)(i,35686,(function(t,e,n){return t.uniformMatrix2x4fv(e,!1,O(n,8))})),Object(p.a)(i,35687,(function(t,e,n){return t.uniformMatrix3x2fv(e,!1,O(n,6))})),Object(p.a)(i,35688,(function(t,e,n){return t.uniformMatrix3x4fv(e,!1,O(n,12))})),Object(p.a)(i,35689,(function(t,e,n){return t.uniformMatrix4x2fv(e,!1,O(n,8))})),Object(p.a)(i,35690,(function(t,e,n){return t.uniformMatrix4x3fv(e,!1,O(n,12))})),Object(p.a)(i,35679,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,35682,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36289,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36292,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36293,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36298,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36299,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36300,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36303,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36306,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36307,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36308,(function(t,e,n){return t.uniform1i(e,n)})),Object(p.a)(i,36311,(function(t,e,n){return t.uniform1i(e,n)})),i),y={},_={},b={},w=[0];function x(t,e,n,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(w[0]=t,t=w);var r=t.length;if(r%e&&v.a.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;var a=i[r];a||(a=new n(r),i[r]=a);for(var o=0;o<r;o++)a[o]=t[o];return a}function O(t,e){return x(t,e,Float32Array,y)}function j(t,e){return x(t,e,Int32Array,_)}function k(t,e){return x(t,e,Uint32Array,b)}function P(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function C(t,e,n){var i=m[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i.bind(null,t,e)}function T(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;for(var e=Math.min(t.length,16),n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||!0===t||!1===t||t instanceof f.a||t instanceof g.a||t instanceof d.a&&Boolean(t.texture)}function M(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t)){if(!e)return!1;var n=t.length;if(e.length!==n)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return t===e}function E(t){return Array.isArray(t)||ArrayBuffer.isView(t)?t.slice():t}function S(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e}var A=35632,L=35633;function R(t,e,n,i){for(var r=t.split(/\r?\n/),a={},o={},s=i||S(e)||"(unnamed)",u="".concat(function(t){switch(t){case A:return"fragment";case L:return"vertex";default:return"unknown type"}}(n)," shader ").concat(s),h=0;h<r.length;h++){var c=r[h];if(!(c.length<=1)){var l=c.split(":"),f=l[0],d=parseInt(l[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));"WARNING"!==f?a[d]=c:o[d]=c}}var p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((function(t,i){var a=i+e,o=String(a).length;return D(a,r-o)+n+t}))}(e);return{shaderName:u,errors:I(a,p),warnings:I(o,p)}}function I(t,e){for(var n="",i=0;i<e.length;i++){var r=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(n+="".concat(r,"\n"),t[i+1])){var a=t[i+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,h=a.substring(o.join(":").length+1).trim();n+=D("^^^ ".concat(s,": ").concat(h,"\n\n"),u)}}return n}function D(t,e){for(var n="",i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}var F=n("SUVH"),z=n("CxzY"),B=n("VdrS"),N="Shader: GLSL source code must be a JavaScript string",U=function(t){function e(t,n){var i;Object(r.a)(this,e),Object(F.b)(t),Object(z.a)("string"==typeof n.source,N);var a=S(n.source,null)||n.id||Object(B.c)("unnamed ".concat(e.getTypeName(n.shaderType)));return(i=Object(o.a)(this,Object(u.a)(e).call(this,t,{id:a}))).shaderType=n.shaderType,i.source=n.source,i.initialize(n),i}return Object(c.a)(e,t),Object(a.a)(e,null,[{key:"getTypeName",value:function(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Object(z.a)(!1),"unknown"}}}]),Object(a.a)(e,[{key:"initialize",value:function(t){var e=t.source,n=S(e,null);n&&(this.id=Object(B.c)(n)),this._compile(e)}},{key:"getParameter",value:function(t){return this.gl.getShaderParameter(this.handle,t)}},{key:"toString",value:function(){return"".concat(e.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return S(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var t=this.gl.getExtension("WEBGL.debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}},{key:"_compile",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var e=R(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType,this.id),n=e.shaderName,i=e.errors,r=e.warnings;throw v.a.error("GLSL compilation errors in ".concat(n,"\n").concat(i))(),v.a.warn("GLSL compilation warnings in ".concat(n,"\n").concat(r))(),new Error("GLSL compilation errors in ".concat(n))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}]),e}(l.a),V=function(t){function e(t,n){return Object(r.a)(this,e),"string"==typeof n&&(n={source:n}),Object(o.a)(this,Object(u.a)(e).call(this,t,Object.assign({},n,{shaderType:35633})))}return Object(c.a)(e,t),Object(a.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),e}(U),G=function(t){function e(t,n){return Object(r.a)(this,e),"string"==typeof n&&(n={source:n}),Object(o.a)(this,Object(u.a)(e).call(this,t,Object.assign({},n,{shaderType:35632})))}return Object(c.a)(e,t),Object(a.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),e}(U),H=n("T2Hy"),Z=n("oejM"),W=function(){function t(e){Object(r.a)(this,t),this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}return Object(a.a)(t,[{key:"getAttributeInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}},{key:"getAttributeLocation",value:function(t){var e=this.getAttributeInfo(t);return e?e.location:-1}},{key:"getAttributeAccessor",value:function(t){var e=this.getAttributeInfo(t);return e?e.accessor:null}},{key:"getVaryingInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}},{key:"getVaryingIndex",value:function(t){var e=this.getVaryingInfo();return e?e.location:-1}},{key:"getVaryingAccessor",value:function(t){var e=this.getVaryingInfo();return e?e.accessor:null}},{key:"_readAttributesFromProgram",value:function(t){for(var e=t.gl,n=e.getProgramParameter(t.handle,35721),i=0;i<n;i++){var r=e.getActiveAttrib(t.handle,i),a=r.name,o=r.type,s=r.size,u=e.getAttribLocation(t.handle,a);u>=0&&this._addAttribute(u,a,o,s)}this.attributeInfos.sort((function(t,e){return t.location-e.location}))}},{key:"_readVaryingsFromProgram",value:function(t){var e=t.gl;if(Object(F.d)(e)){for(var n=e.getProgramParameter(t.handle,35971),i=0;i<n;i++){var r=e.getTransformFeedbackVarying(t.handle,i),a=r.name,o=r.type,s=r.size;this._addVarying(i,a,o,s)}this.varyingInfos.sort((function(t,e){return t.location-e.location}))}}},{key:"_addAttribute",value:function(t,e,n,i){var r=Object(Z.a)(n),a={type:r.type,size:i*r.components};this._inferProperties(t,e,a);var o={location:t,name:e,accessor:new H.a(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[t]=o,this.attributeInfosByName[o.name]=o}},{key:"_inferProperties",value:function(t,e,n){/instance/i.test(e)&&(n.divisor=1)}},{key:"_addVarying",value:function(t,e,n,i){var r=Object(Z.a)(n),a=r.type,o=r.components,s={location:t,name:e,accessor:new H.a({type:a,size:i*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}]),t}(),X=n("hP3k"),q=n("rnmN");n.d(e,"a",(function(){return J}));var Y=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],J=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(r.a)(this,e),(n=Object(o.a)(this,Object(u.a)(e).call(this,t,i))).stubRemovedMethods("Program","v6.0",Y),n._isCached=!1,n.initialize(i),Object.seal(Object(s.a)(n)),n._setId(i.id),n}return Object(c.a)(e,t),Object(a.a)(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.hash,n=t.vs,i=t.fs,r=t.varyings,a=t.bufferMode,o=void 0===a?35981:a;return this.hash=e||"",this.vs="string"==typeof n?new V(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs="string"==typeof i?new G(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,Object(z.a)(this.vs instanceof V),Object(z.a)(this.fs instanceof G),this.uniforms={},r&&r.length>0&&(Object(F.a)(this.gl),this.varyings=r,this.gl.transformFeedbackVaryings(this.handle,r,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new W(this),this.setProps(t)}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:Object(h.a)(Object(u.a)(e.prototype),"delete",this).call(this,t)}},{key:"setProps",value:function(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}},{key:"draw",value:function(t){var e=this,n=t.logPriority,i=t.drawMode,r=void 0===i?4:i,a=t.vertexCount,o=t.offset,s=void 0===o?0:o,u=t.start,h=t.end,c=t.isIndexed,l=void 0!==c&&c,f=t.indexType,d=void 0===f?5123:f,p=t.isInstanced,g=void 0!==p&&p,m=t.instanceCount,y=void 0===m?0:m,_=t.vertexArray,b=void 0===_?null:_,w=t.transformFeedback,x=t.framebuffer,O=t.parameters,j=void 0===O?{}:O,k=t.uniforms,P=t.samplers;if((k||P)&&(v.a.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(k||{})),void 0!==n){var C=x?x.id:"default",T="mode=".concat(Object(q.a)(this.gl,r)," verts=").concat(a," ")+"instances=".concat(y," indexType=").concat(Object(q.a)(this.gl,d)," ")+"isInstanced=".concat(g," isIndexed=").concat(l," ")+"Framebuffer=".concat(C);v.a.log(n,T)()}return Object(z.a)(b),this.gl.useProgram(this.handle),!!this._areTexturesRenderable()&&(b.bindForDraw(a,y,(function(){if(void 0!==x&&(j=Object.assign({},j,{framebuffer:x})),w){var t=Object(Z.c)(r);w.begin(t)}e._bindTextures(),Object(X.a)(e.gl,j,(function(){l&&g?e.gl.drawElementsInstanced(r,a,d,s,y):l&&Object(F.d)(e.gl)&&!isNaN(u)&&!isNaN(h)?e.gl.drawRangeElements(r,u,h,a,d,s):l?e.gl.drawElements(r,a,d,s):g?e.gl.drawArraysInstanced(r,s,a,y):e.gl.drawArrays(r,s,a)})),w&&w.end()})),!0)}},{key:"setUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=!1,i={};for(var r in t)M(this.uniforms[r],t[r])||(n=!0,i[r]=t[r],this.uniforms[r]=E(t[r]));return n&&(e(),function(t,e,n){for(var i in t){var r=t[i];if((!n||Boolean(n[i]))&&!T(r))throw e=e?"".concat(e," "):"",new Error("".concat(e," Bad uniform ").concat(i))}}(i,this.id,this._uniformSetters),this._setUniforms(i)),this}},{key:"reset",value:function(){}},{key:"_areTexturesRenderable",value:function(){var t=!0;for(var e in this.uniforms){var n=this._uniformSetters[e];if(n&&void 0!==n.textureIndex){var i=this.uniforms[e];i instanceof d.a&&(i=i.texture),i instanceof f.a&&(t=t&&i.loaded)}}return t}},{key:"_bindTextures",value:function(){for(var t in this.uniforms){var e=this._uniformSetters[t];if(e&&void 0!==e.textureIndex){var n=this.uniforms[t];n instanceof d.a&&(n=n.texture),n instanceof f.a&&n.bind(e.textureIndex)}}}},{key:"_setUniforms",value:function(t){for(var e in this.gl.useProgram(this.handle),t){var n=t[e],i=this._uniformSetters[e];if(i)if(n instanceof d.a&&(n=n.texture),n instanceof f.a){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);var r=n,a=i.textureIndex;r.bind(a),i(a)}else i(n)}return this}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(t){var e=this.gl.getAttachedShaders(t),n={},i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new V({handle:u});break;case 35632:n.fs=new G({handle:u})}}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}},{key:"_getParameter",value:function(t){return this.gl.getProgramParameter(this.handle,t)}},{key:"_setId",value:function(t){if(!t){var e=this._getName();this.id=Object(B.c)(e)}}},{key:"_getName",value:function(){var t=this.vs.getName()||this.fs.getName();return(t=t.replace(/shader/i,""))?"".concat(t,"-program"):"program"}},{key:"_compileAndLink",value:function(){var t=this.gl;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),v.a.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),v.a.timeEnd(4,"linkProgram for ".concat(this._getName()))(),(t.debug||v.a.priority>0)&&(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35714)))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)))}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var t=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var e=0;e<this._uniformCount;e++){var n=this.gl.getActiveUniform(this.handle,e),i=P(n.name),r=i.name,a=(i.isArray,t.getUniformLocation(this.handle,r));if(this._uniformSetters[r]=C(t,a,n),n.size>1)for(var o=0;o<n.size;o++)a=t.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=C(t,a,n)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(t,e){return this.gl.getActiveUniforms(this.handle,t,e)}},{key:"getUniformBlockIndex",value:function(t){return this.gl.getUniformBlockIndex(this.handle,t)}},{key:"getActiveUniformBlockParameter",value:function(t,e){return this.gl.getActiveUniformBlockParameter(this.handle,t,e)}},{key:"uniformBlockBinding",value:function(t,e){this.gl.uniformBlockBinding(this.handle,t,e)}}]),e}(l.a)},P0Fk:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("bHAT"),o=n("uzDn"),s=function(){function t(){Object(i.a)(this,t),this.shaderModules={},this.defaultShaderModules=[]}return Object(r.a)(t,[{key:"setDefaultShaderModules",value:function(t){this.defaultShaderModules=this.resolveModules(t)}},{key:"getDefaultShaderModules",value:function(){return this.defaultShaderModules}},{key:"registerShaderModules",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==e&&e,i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;this._registerShaderModule(u,n)}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}}},{key:"getShaderModule",value:function(t){if(t instanceof a.a)return t;if("string"!=typeof t)return this._registerShaderModule(t,!0);var e=this.shaderModules[t];return e||Object(o.a)(!1,"Unknown shader module ".concat(t)),e}},{key:"resolveModules",value:function(t){var e=this;return t.map((function(t){return e.getShaderModule(t)}))}},{key:"_registerShaderModule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof a.a)return t;if(Object(o.a)(t.name,"shader module has no name"),this.shaderModules[t.name]&&!e)throw new Error("shader module ".concat(t.name," already registered"));return(t=new a.a(t)).dependencies=this.resolveModules(t.dependencies),this.shaderModules[t.name]=t,this.shaderModules[t.name]}}]),t}();n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return l}));var u=new s;function h(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==e&&e;u.registerShaderModules(t,{ignoreMultipleRegistrations:n})}function c(t){return t=t.concat(u.defaultShaderModules),function(t){var e={},n={};return function t(e){var n=e.modules,i=e.level,r=e.moduleMap,a=e.moduleDepth;if(i>=5)throw new Error("Possible loop in shader dependency graph");var o=!0,s=!1,u=void 0;try{for(var h,c=n[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;r[l.name]=l,(void 0===a[l.name]||a[l.name]<i)&&(a[l.name]=i)}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}var f=!0,d=!1,p=void 0;try{for(var g,v=n[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var m=g.value;m.dependencies&&t({modules:m.dependencies,level:i+1,moduleMap:r,moduleDepth:a})}}catch(e){d=!0,p=e}finally{try{f||null==v.return||v.return()}finally{if(d)throw p}}}({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((function(t,e){return n[e]-n[t]})).map((function(t){return e[t]}))}(t=u.resolveModules(t))}function l(t){return u.getShaderModule(t)}},QPTa:function(t,e,n){"use strict";var i="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",r=(e.a={name:"lights",vs:i,fs:i,getUniforms:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if("lightSources"in e){var n=e.lightSources||{},i=n.ambientLight,o=n.pointLights,s=n.directionalLights,u=i||o&&o.length>0||s&&s.length>0;return u?Object.assign({},function(t){var e=t.ambientLight,n=t.pointLights,i=void 0===n?[]:n,r=t.directionalLights,o=void 0===r?[]:r,s={};return s["lighting_uAmbientLight.color"]=e?a(e):[0,0,0],i.forEach((function(t,e){s["lighting_uPointLight[".concat(e,"].color")]=a(t),s["lighting_uPointLight[".concat(e,"].position")]=t.position,s["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation})),s.lighting_uPointLightCount=i.length,o.forEach((function(t,e){s["lighting_uDirectionalLight[".concat(e,"].color")]=a(t),s["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction})),s.lighting_uDirectionalLightCount=o.length,s}({ambientLight:i,pointLights:o,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){var h={pointLights:[],directionalLights:[]},c=!0,l=!1,f=void 0;try{for(var d,p=(e.lights||[])[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var g=d.value;switch(g.type){case"ambient":h.ambientLight=g;break;case"directional":h.directionalLights.push(g);break;case"point":h.pointLights.push(g)}}}catch(t){l=!0,f=t}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}return t({lightSources:h})}return{}},defines:{MAX_LIGHTS:3}},{});function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,n=void 0===e?[0,0,0]:e,i=t.intensity,r=void 0===i?1:i;return n.map((function(t){return t*r/255}))}},RHh3:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("s4An");function r(t,e,n){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&Object(i.a)(a,n.prototype),a}).apply(null,arguments)}},RPaY:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("wldP"),h=n("qjXE"),c=["longitude","latitude","zoom","bearing","pitch"],l=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).call(this,t))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"interpolateProps",value:function(t,e,n){var i={};for(var r in e)i[r]=Object(h.g)(t[r],e[r],n);return i}}]),e}(u.a)},ReuC:function(t,e,n){"use strict";var i=n("foSv");function r(t,e,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(i.a)(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(n):a.value}})(t,e,n||t)}n.d(e,"a",(function(){return r}))},RfdS:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n("1OyB"),r=n("md7G"),a=n("foSv"),o=n("JX7q"),s=n("vuIU"),u=n("Ji7U"),h=n("L8KH"),c=n("d3kR"),l=n("tMmZ"),f=n("SUVH"),d=n("CxzY"),p=function(t){function e(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(r.a)(this,Object(a.a)(e).call(this,t,s))).target=null,n._queryPending=!1,n._pollingPromise=null,Object.seal(Object(o.a)(n)),n}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(f.d)(t),i=Object(c.c)(t,l.a.TIMER_QUERY),r=n||i,a=!0,o=!1,s=void 0;try{for(var u,h=e[Symbol.iterator]();!(a=(u=h.next()).done);a=!0)switch(u.value){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:Object(d.a)(!1)}}catch(t){o=!0,s=t}finally{try{a||null==h.return||h.return()}finally{if(o)throw s}}return r}}]),Object(s.a)(e,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative,e=void 0!==t&&t;return this.begin(e?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"begin",value:function(t){return this._queryPending?this:(this.target=t,this.gl.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var t=this.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}},{key:"isTimerDisjoint",value:function(){return this.gl.getParameter(36795)}},{key:"getResult",value:function(){return this.gl.getQueryParameter(this.handle,34918)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var n=0;return this._pollingPromise=new Promise((function(i,r){requestAnimationFrame((function a(){t.isResultAvailable()?(i(t.getResult()),t._pollingPromise=null):n++>e?(r("Timed out"),t._pollingPromise=null):requestAnimationFrame(a)}))})),this._pollingPromise}},{key:"_createHandle",value:function(){return e.isSupported(this.gl)?this.gl.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl.deleteQuery(this.handle)}}]),e}(h.a)},S2EH:function(t,e,n){"use strict";var i=n("rePB"),r=n("vpQ4"),a=n("1OyB"),o=n("vuIU"),s=n("md7G"),u=n("foSv"),h=n("ReuC"),c=n("Ji7U"),l=n("sc/6"),f=n("bphH"),d=n("CxzY"),p={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function g(t,e){var n=(e||{}).attributeMap,i=void 0===n?p:n;return i&&i[t]||t}function v(t,e){var n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}Object(d.a)(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}var m=n("1kz3"),y=n("SUVH"),_=n("pRFE"),b=n("RfdS"),w=n("OklE"),x=n("T2Hy"),O=n("JX7q"),j=n("L8KH"),k=null;var P=n("K9nA"),C=n("5ku3"),T=n("I0ug"),M=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,e);var r=i.id||i.program&&i.program.id;return(n=Object(s.a)(this,Object(u.a)(e).call(this,t,Object.assign({},i,{id:r})))).hasVertexArrays=e.isSupported(t),n.buffer=null,n.bufferValue=null,n.initialize(i),Object.seal(Object(O.a)(n)),n}return Object(c.a)(e,t),Object(o.a)(e,null,[{key:"isSupported",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero?Object(y.d)(t)||"Chrome"===function(t){if(!Object(C.a)())return"Node";if(Object(T.a)(t))return"Electron";var e=("undefined"!=typeof navigator?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var n=-1!==e.indexOf("MSIE "),i=-1!==e.indexOf("Trident/");return n||i?"IE":P.b.chrome?"Chrome":P.b.safari?"Safari":P.b.mozInnerScreenX?"Firefox":"Unknown"}():Object(y.d)(t)||t.getExtension("OES_vertex_array_object")}},{key:"getDefaultArray",value:function(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new e(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(t){return e.MAX_ATTRIBUTES=e.MAX_ATTRIBUTES||t.getParameter(34921),e.MAX_ATTRIBUTES}},{key:"setConstant",value:function(t,n,i){switch(i.constructor){case Float32Array:e._setConstantFloatArray(t,n,i);break;case Int32Array:e._setConstantIntArray(t,n,i);break;case Uint32Array:e._setConstantUintArray(t,n,i);break;default:Object(d.a)(!1)}}}]),Object(o.a)(e,[{key:"delete",value:function(){Object(h.a)(Object(u.a)(e.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}},{key:"setProps",value:function(t){return this}},{key:"setElementBuffer",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return arguments.length>1&&void 0!==arguments[1]&&arguments[1],Object(d.a)(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((function(){t.gl.bindBuffer(34963,e?e.handle:null)})),this}},{key:"setBuffer",value:function(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);var i=n.size,r=n.type,a=n.stride,o=n.offset,s=n.normalized,u=n.integer,h=n.divisor,c=this.gl;return t=Number(t),this.bind((function(){c.bindBuffer(34962,e.handle),u?(Object(d.a)(Object(y.d)(c)),c.vertexAttribIPointer(t,i,r,a,o)):c.vertexAttribPointer(t,i,r,s,a,o),c.enableVertexAttribArray(t),c.vertexAttribDivisor(t,h||0)})),this}},{key:"enable",value:function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!i&&0===t&&!e.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind((function(){return i?n.gl.enableVertexAttribArray(t):n.gl.disableVertexAttribArray(t)}))),this}},{key:"getConstantBuffer",value:function(t,e,n){var i=this._normalizeConstantArrayValue(e,n),r=i.byteLength*t,a=i.length*t,o=!this.buffer;if(this.buffer=this.buffer||new l.a(this.gl,r),o=(o=o||this.buffer.reallocate(r))||!this._compareConstantArrayValues(i,this.bufferValue)){var s=function(t,e){return new t(function(t){return(!k||k.byteLength<t)&&(k=new ArrayBuffer(t)),k}(t.BYTES_PER_ELEMENT*e),0,e)}(e.constructor,a);!function(t){for(var e=t.target,n=t.source,i=t.start,r=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=n.length,u=o*s,h=0,c=r;h<s;h++)e[c++]=n[h];for(;h<u;)h<u-h?(e.copyWithin(r+h,r,r+h),h*=2):(e.copyWithin(r+h,r,r+u-h),h=u)}({target:s,source:i,start:0,count:a}),this.buffer.subData(s),this.bufferValue=e}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(t,e){return Array.isArray(t)?new Float32Array(t):t}},{key:"_compareConstantArrayValues",value:function(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}},{key:"_createHandle",value:function(){return this.hasVertexArrays=e.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}},{key:"_deleteHandle",value:function(t){return this.hasVertexArrays&&this.gl.deleteVertexArray(t),[this.elements]}},{key:"_bindHandle",value:function(t){this.hasVertexArrays&&this.gl.bindVertexArray(t)}},{key:"_getParameter",value:function(t,e){var n=this,i=e.location;return Object(d.a)(Number.isFinite(i)),this.bind((function(){switch(t){case 34373:return n.gl.getVertexAttribOffset(i,t);default:return n.gl.getVertexAttrib(i,t)}}))}},{key:"MAX_ATTRIBUTES",get:function(){return e.getMaxAttributes(this.gl)}}],[{key:"_setConstantFloatArray",value:function(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:Object(d.a)(!1)}}},{key:"_setConstantIntArray",value:function(t,e,n){switch(Object(d.a)(Object(y.d)(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:Object(d.a)(!1)}}},{key:"_setConstantUintArray",value:function(t,e,n){switch(Object(d.a)(Object(y.d)(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:Object(d.a)(!1)}}}]),e}(j.a),E=n("sgaE"),S=n("5+o2"),A=/^(.+)__LOCATION_([0-9]+)$/,L=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],R=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,t);var i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=M.isSupported(e)?new M(e):M.getDefaultArray(e),Object(E.a)(this,"VertexArray","v6.0",L),this.initialize(n),Object.seal(this)}return Object(o.a)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var t=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(t){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,t)}},{key:"setAttributes",value:function(t){var e=this;return Object.assign(this.attributes,t),this.vertexArrayObject.bind((function(){for(var n in t){var i=t[n];e._setAttribute(n,i)}e.gl.bindBuffer(34962,null)})),this}},{key:"setElementBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(t,e),this}},{key:"setBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,n);var i=this._resolveLocationAndAccessor(t,e,e.accessor,n),r=i.location,a=i.accessor;return r>=0&&(this.values[r]=e,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(r,e,a)),this}},{key:"setConstant",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n)),r=i.location,a=i.accessor;return r>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e,a),this.values[r]=e,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(r,!1)),this}},{key:"unbindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind((function(){t.elements&&(t.vertexArrayObject.isDefaultArray||t.vertexArrayObject.setElementBuffer(null)),t.buffer=t.buffer||new l.a(t.gl,{accessor:{size:4}});for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++)t.values[e]instanceof l.a&&(t.gl.disableVertexAttribArray(e),t.gl.bindBuffer(34962,t.buffer.handle),t.gl.vertexAttribPointer(e,1,5126,!1,0,0))})),this}},{key:"bindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind((function(){t.elements&&t.setElementBuffer(t.elements);for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++){var n=t.values[e];n instanceof l.a&&t.setBuffer(e,n)}})),this}},{key:"bindForDraw",value:function(t,e,n){var i,r=this;return this.vertexArrayObject.bind((function(){r._setConstantAttributes(t,e),r.vertexArrayObject.hasVertexArrays||r.bindBuffers(),i=n(),r.vertexArrayObject.hasVertexArrays||r.unbindBuffers()})),i}},{key:"_resolveLocationAndAccessor",value:function(t,e,n,i){var r=this,a=this._getAttributeIndex(t),o=a.location,s=a.name;if(!Number.isFinite(o)||o<0)return this.unused[t]=e,S.a.once(3,(function(){return"unused value ".concat(t," in ").concat(r.id)}))(),this;var u=this._getAttributeInfo(s||o);if(!u)return{location:-1,accessor:null};var h=x.a.resolve(u.accessor,n,i),c=h.size,l=h.type;return Object(d.a)(Number.isFinite(c)&&Number.isFinite(l)),{location:o,accessor:h}}},{key:"_getAttributeInfo",value:function(t){return this.configuration&&this.configuration.getAttributeInfo(t)}},{key:"_getAttributeIndex",value:function(t){var e=Number(t);if(Number.isFinite(e))return{location:e};var n=A.exec(t),i=n?n[1]:t,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}},{key:"_setAttribute",value:function(t,e){if(e instanceof l.a)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof l.a){var n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){var r=e;this.setConstant(t,r)}else{if(!(e.buffer instanceof l.a))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");var a=e;this.setBuffer(t,a.buffer,a)}}},{key:"_setConstantAttributes",value:function(t,e){var n=Math.max(0|t,0|e),i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(var r=1;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)i=this.values[r],ArrayBuffer.isView(i)&&this._setConstantAttribute(r,i)}},{key:"_setConstantAttributeZero",value:function(t,e){if(M.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,t);else{var n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(t,e){M.setConstant(this.gl,t,e),this.vertexArrayObject.isDefaultArray&&this.vertexArrayObject.enable(t,!1)}},{key:"_updateDrawParams",value:function(){for(var t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}},{key:"_updateDrawParamsForLocation",value:function(t,e){var n=this.values[e],i=this.accessors[e];if(n){var r=i.divisor>0;if(t.isInstanced=t.isInstanced||r,n instanceof l.a){var a=n;if(r){var o=a.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,o)}else{var s=a.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,s)}}}}},{key:"setElements",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return S.a.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}]),t}(),I=n("yq7u"),D=n("rnmN"),F=n("oejM");function z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.isInteger,i=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){for(var n=e.maxElts,i=void 0===n?16:n,r=e.size,a=void 0===r?1:r,o="[",s=0;s<t.length&&s<i;++s)s>0&&(o+=",".concat(s%a==0?" ":"")),o+=z(t[s],e);var u=t.length>i?"...":"]";return"".concat(o).concat(u)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function B(t,e,n,r){var a,o,s=t.gl;if(!e)return o={},Object(i.a)(o,r,"null"),Object(i.a)(o,"Format ","N/A"),o;var u,h,c,f="NOT PROVIDED",d="N/A",p="N/A",g="N/A";if(n&&(f=n.type,d=n.size,u=-1!==(f=String(f).replace("Array","")).indexOf("nt")),e instanceof l.a){var v,m,y=e,_=y.getDebugData(),b=_.data;if(h=_.modified?"*":"",c=b,p=(g=y.byteLength)/b.BYTES_PER_ELEMENT/d,n){var w=n.divisor>0;m="".concat(w?"I ":"P "," ").concat(p," (x").concat(d,"=").concat(g," bytes ").concat(Object(D.a)(s,f),")")}else u=!0,m="".concat(g," bytes");return v={},Object(i.a)(v,r,"".concat(h).concat(z(c,{size:d,isInteger:u}))),Object(i.a)(v,"Format ",m),v}return c=e,d=e.length,u=-1!==(f=String(e.constructor.name).replace("Array","")).indexOf("nt"),a={},Object(i.a)(a,r,"".concat(z(c,{size:d,isInteger:u})," (constant)")),Object(i.a)(a,"Format ","".concat(d,"x").concat(f," (constant)")),a}function N(t,e){var n=e.type,i=e.size,r=Object(F.b)(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function U(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.header,n=void 0===e?"Uniforms":e,r=t.program,a=t.uniforms,o=t.undefinedOnly,s=void 0!==o&&o;Object(d.a)(r);var u=r._uniformSetters,h={},c=Object.keys(u).sort(),l=0,f=!0,p=!1,g=void 0;try{for(var v,m=c[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var y=v.value;y.match(".*_.*")||y.match(".*Matrix")||V({table:h,header:n,uniforms:a,uniformName:y,undefinedOnly:s})&&l++}}catch(t){p=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(p)throw g}}var _=!0,b=!1,w=void 0;try{for(var x,O=c[Symbol.iterator]();!(_=(x=O.next()).done);_=!0){var j=x.value;j.match(".*Matrix")&&V({table:h,header:n,uniforms:a,uniformName:j,undefinedOnly:s})&&l++}}catch(t){b=!0,w=t}finally{try{_||null==O.return||O.return()}finally{if(b)throw w}}var k=!0,P=!1,C=void 0;try{for(var T,M=c[Symbol.iterator]();!(k=(T=M.next()).done);k=!0){var E=T.value;h[E]||V({table:h,header:n,uniforms:a,uniformName:E,undefinedOnly:s})&&l++}}catch(t){P=!0,C=t}finally{try{k||null==M.return||M.return()}finally{if(P)throw C}}var S=0,A={};if(!s)for(var L in a){var R=a[L];h[L]||(S++,A[L]=Object(i.a)({Type:"NOT USED: ".concat(R)},n,z(R)))}return{table:h,count:l,unusedTable:A,unusedCount:S}}function V(t){var e,n=t.table,r=t.header,a=t.uniforms,o=t.uniformName,s=t.undefinedOnly,u=a[o],h=function(t){return null!=t}(u);return!(s&&h||(n[o]=(e={},Object(i.a)(e,r,h?z(u):"N/A"),Object(i.a)(e,"Uniform Type",h?u:"NOT PROVIDED"),e),0))}function G(t){var e=t.accessor,n=e.type,i=e.size,r=Object(F.b)(n,i);return r?"".concat(r.name," ").concat(t.name):t.name}var H=n("kLp3"),Z=n.n(H),W=n("iTDY"),X={},q=function t(e,n,i){e&&(n.length>1?t(e[n[0]],n.slice(1),i):e[n[0]]=i)},Y=new Map;Z.a.listenFor("luma.gl",(function(t){var e=X[t.itemKey];if(e&&"edit"===t.type&&"uniforms"===t.valuePath[0]){var n=t.valuePath.slice(1);!function(t,e,n){W.b.__SEER_INITIALIZED__&&(Y.has(t)||Y.set(t,new Map),Y.get(t).set(e,n))}(t.itemKey,n,t.value);var i=e.getUniforms();q(i,n,t.value),e.setUniforms(i)}}));var J=n("VdrS"),K=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,t),Object(d.a)(Object(y.c)(e));var i=n.id,r=void 0===i?Object(J.c)("base-model"):i;this.id=r,this.gl=e,this.id=n.id||Object(J.c)("Model"),this.lastLogTime=0,this.initialize(n)}return Object(o.a)(t,[{key:"initialize",value:function(t){this.props={},t.shaderCache&&S.a.warn("ShaderCache property is deprecated")(),this.programManager=t.programManager||m.a.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var e=t.program,n=void 0===e?null:e,i=t.vs,r=t.fs,a=t.modules,o=t.defines,s=t.inject,u=t.varyings,h=t.bufferMode;this.programProps={program:n,vs:i,fs:r,modules:a,defines:o,inject:s,varyings:u,bufferMode:h},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.animatedUniforms={},this.animated=!1,this.animationLoop=null,this.timerQueryEnabled=!1,this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0},this.pickable=!0,this._checkProgram(),this._setBaseModelProps(t),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings)))}},{key:"setProps",value:function(t){this._setBaseModelProps(t)}},{key:"delete",value:function(){for(var t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&this.programManager.release(this.program),this.vertexArray.delete(),function(t){delete X[t],Z.a.deleteItem("luma.gl",t)}(this.id)}},{key:"isAnimated",value:function(){return this.animated}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(t){this.programProps=Object.assign({},t),this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=Object.assign({},t),function(t,e){if(W.b.__SEER_INITIALIZED__&&t){var n=Y.get(t);n&&n.forEach((function(t,n){q(e,n,t)}))}}(this.id,t),t=this._extractAnimatedUniforms(t),Object.assign(this.uniforms,t),this}},{key:"getModuleUniforms",value:function(t){this._checkProgram();var e=this.programManager.getUniforms(this.program);return e?e(t):{}}},{key:"updateModuleSettings",value:function(t){var e=this.getModuleUniforms(t||{});return this.setUniforms(e)}},{key:"clear",value:function(t){return Object(_.a)(this.program.gl,t),this}},{key:"drawGeometry",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();var e=t.moduleSettings,n=void 0===e?null:e,i=t.framebuffer,r=t.uniforms,a=void 0===r?{}:r,o=t.attributes,s=void 0===o?{}:o,u=t.transformFeedback,h=void 0===u?this.transformFeedback:u,c=t.parameters,l=void 0===c?{}:c,f=t.vertexArray,d=void 0===f?this.vertexArray:f,p=t.animationProps;!function(t){X[t.id]||(X[t.id]=t,Z.a.listItem("luma.gl",t.id))}(this),this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(a),this._refreshAnimationProps(p);var g=this._logDrawCallStart(2),v=this.vertexArray.getDrawParams(this.props);v.isInstanced&&!this.isInstanced&&S.a.warn("Found instanced attributes on non-instanced model",this.id)();var m=v.isIndexed,y=v.indexType,_=v.indexOffset,b=this.isInstanced,w=this.instanceCount,x=function(){},O=this.props,j=O.onBeforeRender,k=void 0===j?x:j,P=O.onAfterRender,C=void 0===P?x:P;k(),this._timerQueryStart(),this.program.setUniforms(this.uniforms);var T=this.program.draw(Object.assign({},t,{logPriority:g,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:d,transformFeedback:h,isIndexed:m,indexType:y,isInstanced:b,instanceCount:w,offset:m?_:0}));return this._timerQueryEnd(),C(),this._logDrawCallEnd(g,d,i),T}},{key:"_setBaseModelProps",value:function(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"timerQueryEnabled"in t&&(this.timerQueryEnabled=t.timerQueryEnabled&&b.a.isSupported(this.gl,["timers"]),t.timerQueryEnabled&&!this.timerQueryEnabled&&S.a.warn("GPU timer not supported")()),"_animationProps"in t&&this._setAnimationProps(t._animationProps),"_animationLoop"in t&&(this.animationLoop=t._animationLoop)}},{key:"_checkProgram",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0],this._programDirty||this.programManager.stateHash!==this._programManagerState){var t=this.programProps.program;if(t)this._managedProgram=!1;else{var e=this.programProps,n=e.vs,i=void 0===n?I.a.vs:n,r=e.fs,a=void 0===r?I.a.fs:r,o=e.modules,s=e.inject,u=e.defines,h=e.varyings,c=e.bufferMode;t=this.programManager.get({vs:i,fs:a,modules:o,inject:s,defines:u,varyings:h,bufferMode:c}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Object(d.a)(t instanceof w.a,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new R(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_refreshAnimationProps",value:function(t){(t=t||this.animationLoop&&this.animationLoop.animationProps)&&this._setAnimationProps(t)}},{key:"_evaluateAnimateUniforms",value:function(t){if(!this.animated)return{};var e={};for(var n in this.animatedUniforms){var i=this.animatedUniforms[n];e[n]=i(t)}return e}},{key:"_extractAnimatedUniforms",value:function(t){var e=!1;for(var n in t){var i=t[n];"function"==typeof i?(this.animatedUniforms[n]=i,e=!0):delete this.animatedUniforms[n]}if(this.animated=!Object(J.a)(this.animatedUniforms),!e)return t;var r={};for(var a in t)this.animatedUniforms[a]||(r[a]=t[a]);return r}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new b.a(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,S.a.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}},{key:"_logDrawCallStart",value:function(t){var e=t>3?0:1e4;if(!(S.a.priority<t||Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),S.a.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:S.a.priority<=2})(),t}},{key:"_logDrawCallEnd",value:function(t,e,n,r){if(void 0!==t){var a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertexArray,n=t.header,i=void 0===n?"Attributes":n;if(!e.configuration)return{};var r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=B(e,e.elements,null,i));var a=e.values;for(var o in a){var s=e._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),h=e.accessors[s.location];h&&(u="".concat(o,": ").concat(N(s.name,h))),r[u]=B(e,a[o],h,i)}}return r}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),o=U({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),s=o.table,u=o.unusedTable,h=o.unusedCount,c=U({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0}),l=c.table;c.count>0&&S.a.log("MISSING UNIFORMS",Object.keys(l))(),h>0&&S.a.log("UNUSED UNIFORMS",Object.keys(u))();var f=function(t){var e={},n="Accessors for ".concat(t.id),r=!0,a=!1,o=void 0;try{for(var s,u=t.attributeInfos[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;if(h){var c=G(h);e["in ".concat(c)]=Object(i.a)({},n,JSON.stringify(h.accessor))}}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}var l=!0,f=!1,d=void 0;try{for(var p,g=t.varyingInfos[Symbol.iterator]();!(l=(p=g.next()).done);l=!0){var v=p.value;if(v){var m=G(v);e["out ".concat(m)]=Object(i.a)({},n,JSON.stringify(v.accessor))}}}catch(t){f=!0,d=t}finally{try{l||null==g.return||g.return()}finally{if(f)throw d}}return e}(this.vertexArray.configuration);S.a.table(t,a)(),S.a.table(t,s)(),S.a.table(t+1,f)(),function(t,e){if(Z.a.isReady()&&!Z.a.throttle("luma.gl:".concat(t.id),1e3)){var n=t.geometry?Object.assign({},t.geometry.attributes,t.attributes):t.attributes,i=Object.assign({},t.uniforms,e);Z.a.multiUpdate("luma.gl",t.id,[{path:"objects.uniforms",data:i},{path:"objects.attributes",data:n}])}}(this,n),r&&r.log({priority:2,message:"Rendered to ".concat(r.id)}),S.a.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}}]),t}();n.d(e,"a",(function(){return Q}));var Q=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,e);var i=n.id,o=void 0===i?Object(J.c)("model"):i;return Object(s.a)(this,Object(u.a)(e).call(this,t,Object(r.a)({},n,{id:o})))}return Object(c.a)(e,t),Object(o.a)(e,[{key:"initialize",value:function(t){Object(h.a)(Object(u.a)(e.prototype),"initialize",this).call(this,t),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced,this._setModelProps(t),this.geometry={},Object(d.a)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(t){Object(h.a)(Object(u.a)(e.prototype),"setProps",this).call(this,t),this._setModelProps(t)}},{key:"delete",value:function(){Object(h.a)(Object(u.a)(e.prototype),"delete",this).call(this),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setDrawMode",value:function(t){return this.drawMode=t,this}},{key:"setVertexCount",value:function(t){return Object(d.a)(Number.isFinite(t)),this.vertexCount=t,this}},{key:"setInstanceCount",value:function(t){return Object(d.a)(Number.isFinite(t)),this.instanceCount=t,this}},{key:"setGeometry",value:function(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){var i={},a=e.indices;for(var o in e.attributes){var s=e.attributes[o],u=g(o,void 0);if("indices"===o)a=s;else if(s.constant)i[u]=s.value;else{var h=s.value,c=Object(r.a)({},s);delete c.value,i[u]=[new l.a(t,h),c],v(o,c)}}if(a){var f=a.value||a;Object(d.a)(f instanceof Uint16Array||f instanceof Uint32Array,'attribute array for "indices" must be of integer type');var p={size:1,isIndexed:void 0===a.isIndexed||a.isIndexed};i.indices=[new l.a(t,{data:f,target:34963}),p]}return i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(J.a)(t))return this;var e={};for(var n in t){var i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.drawGeometry(t)}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,n=void 0===e||e,r=t.feedbackBuffers,a=t.unbindModels,o=void 0===a?[]:a,s=t.parameters;r&&this._setFeedbackBuffers(r),n&&(s=Object.assign({},s,Object(i.a)({},35977,n))),o.forEach((function(t){return t.vertexArray.unbindBuffers()}));try{this.draw(Object.assign({},t,{parameters:s}))}finally{o.forEach((function(t){return t.vertexArray.bindBuffers()}))}return this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S.a.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}},{key:"_setModelProps",value:function(t){"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}},{key:"_deleteGeometryBuffers",value:function(){for(var t in this.geometryBuffers){var e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof l.a&&e.delete()}}},{key:"_setAnimationProps",value:function(t){if(this.animated){Object(d.a)(t,"Model.draw(): animated uniforms but no animationProps");var e=this._evaluateAnimateUniforms(t);Object.assign(this.uniforms,e)}}},{key:"_setFeedbackBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(J.a)(t))return this;var e=this.program.gl;return this.transformFeedback=this.transformFeedback||new f.a(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}}]),e}(K)},SUVH:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return h}));var i=n("CxzY"),r="Invalid WebGLRenderingContext",a="Requires WebGL2";function o(t){return Boolean(t&&Number.isFinite(t._version))}function s(t){return Boolean(t&&2===t._version)}function u(t){Object(i.a)(o(t),r)}function h(t){Object(i.a)(s(t),a)}},T2Hy:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("RHh3"),r=n("1OyB"),a=n("vuIU"),o=n("B9+J"),s=n("CxzY"),u=n("LE90"),h={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},c={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},l=function(){function t(){var e=this;Object(r.a)(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];i.forEach((function(t){return e._assign(t)})),Object.freeze(this)}return Object(a.a)(t,null,[{key:"getBytesPerElement",value:function(t){return Object(o.c)(t.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(t){return Object(s.a)(t.size),Object(o.c)(t.type||5126).BYTES_PER_ELEMENT*t.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Object(i.a)(t,[h].concat(n))}}]),Object(a.a)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"_assign",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==(t=Object(u.a)("Accessor",t,c)).type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}}]),t}()},T8J6:function(t,e,n){"use strict";(function(t){var i=n("U8pU");e.a="undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type||!(void 0===t||"object"!==Object(i.a)(t.versions)||!Boolean(t.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n("8oxB"))},TZTB:function(t,e,n){"use strict";(function(t,i){n.d(e,"a",(function(){return a}));var r=n("U8pU"),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||t.browser,"undefined"!=typeof window&&window,void 0!==i?i:window);"undefined"!=typeof document&&document}).call(this,n("8oxB"),n("yLpj"))},Tl6c:function(t,e,n){"use strict";n.d(e,"a",(function(){return g})),n.d(e,"b",(function(){return v})),n.d(e,"c",(function(){return m}));var i=n("vuIU"),r=n("md7G"),a=n("foSv"),o=n("Ji7U"),s=n("1OyB"),u=n("vqa/"),h=n("VdrS"),c=[255,255,255],l=[0,0,1],f=[0,0,-1],d=[0,0,1],p=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.id=e.id||Object(h.c)("light");var n=e.color,i=void 0===n?c:n;this.color=i;var r=e.intensity,a=void 0===r?1:r;this.intensity=a},g=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,e),(t=Object(r.a)(this,Object(a.a)(e).call(this,n))).type="ambient",t}return Object(o.a)(e,t),e}(p),v=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),(t=Object(r.a)(this,Object(a.a)(e).call(this,n))).type="directional";var i=n.direction,o=void 0===i?f:i;return t.direction=new u.a(o).normalize().toArray(),t}return Object(o.a)(e,t),e}(p),m=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),(t=Object(r.a)(this,Object(a.a)(e).call(this,n))).type="point";var i=n.position,o=void 0===i?d:i;return t.position=o,t.attenuation=t._getAttenuation(n),t}return Object(o.a)(e,t),Object(i.a)(e,[{key:"_getAttenuation",value:function(t){return"attenuation"in t?t.attenuation:"intensity"in t?[0,0,t.intensity]:l}}]),e}(p)},"U//q":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return d})),n.d(e,"c",(function(){return p})),n.d(e,"b",(function(){return g}));var i=n("1OyB"),r=n("vuIU"),a=n("7+mA"),o=n("LhmN"),s=n("t+rZ"),u=n("c+tY"),h=n("1eIE");function c(t,e){var n=t[e].bind(t);t[e]=function(){var e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache||(t.state.cache[e]=n.apply(void 0,arguments)),t.state.enable?t.state.cache[e]:n.apply(void 0,arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function l(t,e,n){var i=t[e].bind(t);t[e]=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s,u=n.apply(void 0,[t.state._updateCache].concat(a)),h=u.valueChanged,c=u.oldValue;return h&&((s=t.state).log.apply(s,["gl.".concat(e)].concat(a)),i.apply(void 0,a)),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}var f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copyState,a=void 0!==r&&r,u=n.log,h=void 0===u?function(){}:u;Object(i.a)(this,t),this.gl=e,this.stateStack=[],this.enable=!0,this.cache=a?Object(s.a)(e):Object.assign({},o.b),this.log=h,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return Object(r.a)(t,[{key:"push",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.stateStack.push({})}},{key:"pop",value:function(){Object(u.a)(this.stateStack.length>0);var t=this.stateStack[this.stateStack.length-1];Object(s.c)(this.gl,t,this.cache),this.stateStack.pop()}},{key:"_updateCache",value:function(t){var e,n=!1,i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var r in t)Object(u.a)(void 0!==r),Object(h.a)(t[r],this.cache[r])||(n=!0,e=this.cache[r],!i||r in i||(i[r]=this.cache[r]),this.cache[r]=t[r]);return{valueChanged:n,oldValue:e}}}]),t}();function d(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.enable,r=void 0===i||i,o=n.copyState;if(Object(u.a)(void 0!==o),!e.state){var s=void 0!==t?t:window;for(var h in s.polyfillContext&&s.polyfillContext(e),e.state=new f(e,{copyState:o,enable:r}),a.a)l(e,h,a.a[h]);c(e,"getParameter"),c(e,"isEnabled")}return e.state.enable=r,e}function p(t){t.state||d(t,{copyState:!1}),t.state.push()}function g(t){Object(u.a)(t.state),t.state.pop()}}).call(this,n("yLpj"))},"U/rz":function(t,e,n){"use strict";var i=n("4TbO"),r=n("4oKg"),a=function(){function t(){Object(i.a)(this,t)}return Object(r.a)(t,[{key:"log",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}}]),t}();function o(t,e){return null===(t=Object.assign({},e&&e.DEFAULT_OPTIONS,e&&e.defaultOptions,e&&e.options,t,{dataType:"arraybuffer"})).log&&(t.log=new a),"log"in t||(t.log=console),t}n.d(e,"a",(function(){return o}))},U8pU:function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return(r="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}n.d(e,"a",(function(){return r}))},V3d6:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var i={LNGLAT:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},r={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}}},V8ep:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return v}));var i=n("ZaHm"),r=n("bl9R"),a=n("V3d6"),o=n("OIVS"),s=n("VMBB"),u=n("puIE"),h=[0,0,0,0],c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0,0],d=[0,0,0],p=12,g=Object(o.a)((function(t){var e=t.viewport,n=t.devicePixelRatio,o=t.coordinateSystem,l=t.coordinateOrigin,d=t.wrapLongitude,g=function(t){var e,n=t.viewport,o=t.coordinateSystem,s=t.coordinateOrigin,l=t.coordinateZoom,f=n.viewMatrixUncentered,d=n.viewMatrix,g=n.projectionMatrix,v=n.viewProjectionMatrix,m=n.cameraPosition,y=function(t){switch(t){case a.a.LNGLAT:default:return u.a.LNGLAT_AUTO_OFFSET;case a.a.LNGLAT_DEPRECATED:return u.a.LNG_LAT;case a.a.METER_OFFSETS:case a.a.METERS:return u.a.METER_OFFSETS;case a.a.LNGLAT_OFFSETS:return u.a.LNGLAT_OFFSETS;case a.a.IDENTITY:return u.a.IDENTITY}}(o),_=s;if(y===u.a.LNGLAT_AUTO_OFFSET)if(l<p)y=u.a.LNG_LAT;else{_=[Math.fround(n.longitude),Math.fround(n.latitude)]}switch(y===u.a.IDENTITY&&(_=[Math.fround(n.position[0]),Math.fround(n.position[1])]),_[2]=_[2]||0,y){case u.a.LNG_LAT:e=h;break;case u.a.LNGLAT_OFFSETS:case u.a.METER_OFFSETS:case u.a.LNGLAT_AUTO_OFFSET:case u.a.IDENTITY:var b=n.projectPosition(_,Math.pow(2,l));m=[m[0]-b[0],m[1]-b[1],m[2]-b[2]],b[3]=1,e=r.n([],b,v),d=f||d,v=i.h([],g,d),v=i.h([],v,c);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:d,viewProjectionMatrix:v,projectionCenter:e,cameraPosCommon:m,shaderCoordinateSystem:y,shaderCoordinateOrigin:_}}({coordinateSystem:o,coordinateOrigin:l,coordinateZoom:e.zoom,viewport:e}),v=g.projectionCenter,m=g.viewProjectionMatrix,y=g.cameraPosCommon,_=g.shaderCoordinateSystem,b=g.shaderCoordinateOrigin;Object(s.a)(m,"Viewport missing modelViewProjectionMatrix");var w=e.getDistanceScales(),x=[e.width*n,e.height*n],O={project_uCoordinateSystem:_,project_uCenter:v,project_uWrapLongitude:d,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:x,project_uDevicePixelRatio:n,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:w.pixelsPerMeter,project_uCommonUnitsPerWorldUnit:w.pixelsPerMeter,project_uCommonUnitsPerWorldUnit2:f,project_uScale:e.scale,project_uViewProjectionMatrix:m,project_uCameraPosition:y},j=e.getDistanceScales(b);switch(_){case u.a.METER_OFFSETS:O.project_uCommonUnitsPerWorldUnit=j.pixelsPerMeter,O.project_uCommonUnitsPerWorldUnit2=j.pixelsPerMeter2;break;case u.a.LNGLAT_AUTO_OFFSET:O.project_uCoordinateOrigin=b;case u.a.LNG_LAT:case u.a.LNGLAT_OFFSETS:O.project_uCommonUnitsPerWorldUnit=j.pixelsPerDegree,O.project_uCommonUnitsPerWorldUnit2=j.pixelsPerDegree2;break;case u.a.IDENTITY:O.project_uCoordinateOrigin=b}return O}));function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,n=t.devicePixelRatio,i=void 0===n?1:n,r=t.modelMatrix,o=void 0===r?null:r,u=t.coordinateSystem,h=void 0===u?a.a.LNGLAT:u,c=t.coordinateOrigin,f=void 0===c?d:c,p=t.wrapLongitude,v=void 0!==p&&p;return t.projectionMode,t.positionOrigin,Object(s.a)(e),Object.assign({project_uModelMatrix:o||l},g({viewport:e,devicePixelRatio:i,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:v}))}},VBTR:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=function(t){function e(t){var n;Object(i.a)(this,e),n=Object(a.a)(this,Object(o.a)(e).call(this,t));var r=t._shadow,s=void 0!==r&&r;return n.shadow=s,n}return Object(s.a)(e,t),Object(r.a)(e,[{key:"getProjectedLight",value:function(){return this}}]),e}(n("Tl6c").b)},VKpO:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return s}));var i=n("bl9R");function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(t,e){var n=i.n([],e,t);return i.k(n,n,1/n[3]),n}function o(t,e){var n=t%e;return n<0?e+n:n}function s(t,e,n){return n*e+(1-n)*t}},VMBB:function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},Vame:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}));var i="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:t,a=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){return a=!0,!0}};r.addEventListener("test",o,o),r.removeEventListener("test",o,o)}catch(t){}}).call(this,n("yLpj"))},VcEp:function(t,e,n){t.exports=n("+dGn")},VdrS:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var i=n("CxzY"),r={};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";r[t]=r[t]||1;var e=r[t]++;return"".concat(t,"-").concat(e)}function o(t){return Object(i.a)("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function s(t){var e=!0;for(var n in t){e=!1;break}return e}},W1BH:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a}));var i=n("5ku3"),r="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",a=Object(i.a)()},Wb0s:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("5a1V"),r=n(1);function a(t){if(r.toArrayBuffer&&(t=Object(r.toArrayBuffer)(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}return Object(i.a)(!1)}},Wiem:function(t,e,n){"use strict";var i=n("t+rZ"),r=n("ODXe"),a=n("KQm4");function o(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var s={framebuffer:function(t,e){var n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:function(t,e){return e?t.enable(3042):t.disable(3042)},blendColor:function(t,e){return t.blendColor.apply(t,Object(a.a)(e))},blendEquation:function(t,e){e=o(e)?e:[e,e],t.blendEquationSeparate.apply(t,Object(a.a)(e))},blendFunc:function(t,e){e=o(e)&&2===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,t.blendFuncSeparate.apply(t,Object(a.a)(e))},clearColor:function(t,e){return t.clearColor.apply(t,Object(a.a)(e))},clearDepth:function(t,e){return t.clearDepth(e)},clearStencil:function(t,e){return t.clearStencil(e)},colorMask:function(t,e){return t.colorMask.apply(t,Object(a.a)(e))},cull:function(t,e){return e?t.enable(2884):t.disable(2884)},cullFace:function(t,e){return t.cullFace(e)},depthTest:function(t,e){return e?t.enable(2929):t.disable(2929)},depthFunc:function(t,e){return t.depthFunc(e)},depthMask:function(t,e){return t.depthMask(e)},depthRange:function(t,e){return t.depthRange.apply(t,Object(a.a)(e))},dither:function(t,e){return e?t.enable(3024):t.disable(3024)},derivativeHint:function(t,e){t.hint(35723,e)},frontFace:function(t,e){return t.frontFace(e)},mipmapHint:function(t,e){return t.hint(33170,e)},lineWidth:function(t,e){return t.lineWidth(e)},polygonOffsetFill:function(t,e){return e?t.enable(32823):t.disable(32823)},polygonOffset:function(t,e){return t.polygonOffset.apply(t,Object(a.a)(e))},sampleCoverage:function(t,e){return t.sampleCoverage.apply(t,Object(a.a)(e))},scissorTest:function(t,e){return e?t.enable(3089):t.disable(3089)},scissor:function(t,e){return t.scissor.apply(t,Object(a.a)(e))},stencilTest:function(t,e){return e?t.enable(2960):t.disable(2960)},stencilMask:function(t,e){var n=e=o(e)?e:[e,e],i=Object(r.a)(n,2),a=i[0],s=i[1];t.stencilMaskSeparate(1028,a),t.stencilMaskSeparate(1029,s)},stencilFunc:function(t,e){var n=e=o(e)&&3===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,i=Object(r.a)(n,6),s=i[0],u=i[1],h=i[2],c=i[3],l=i[4],f=i[5];t.stencilFuncSeparate(1028,s,u,h),t.stencilFuncSeparate(1029,c,l,f)},stencilOp:function(t,e){var n=e=o(e)&&3===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,i=Object(r.a)(n,6),s=i[0],u=i[1],h=i[2],c=i[3],l=i[4],f=i[5];t.stencilOpSeparate(1028,s,u,h),t.stencilOpSeparate(1029,c,l,f)},viewport:function(t,e){return t.viewport.apply(t,Object(a.a)(e))}};function u(t,e){for(var n in Object(i.c)(t,e),e){var r=s[n];r&&r(t,e[n],n)}}n.d(e,"a",(function(){return u}))},Wxfb:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("d3kR"),o=n("tMmZ"),s=n("sc/6"),u=n("T2Hy"),h=n("VdrS"),c=n("5+o2"),l=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t);var r=n.id,s=void 0===r?Object(h.c)("attribute"):r,u=n.type,c=n.isIndexed,l=void 0!==c&&c;this.gl=e,this.id=s,this.isIndexed=l,this.target=l?34963:34962,this.type=u,l&&!u&&(this.type=e&&Object(a.b)(e,o.a.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(n),this._validateAttributeDefinition()}return Object(r.a)(t,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,n=t.buffer,i=t.constant,r=void 0===i?this.constant||!1:i;if(this.constant=r,n)this.externalBuffer=n,this.constant=!1,this.value=e||null,this.type=t.type||n.accessor.type,void 0!==n.accessor.divisor&&(this.divisor=n.accessor.divisor),void 0!==t.divisor&&(this.divisor=t.divisor);else if(e){this.externalBuffer=null;var a=this.size||t.size||0;if(r&&e.length!==a){this.value=new Float32Array(a),this._setAccessor(t);for(var o=this.elementOffset,s=0;s<this.size;++s)this.value[s]=e[o+s]}else this.value=e;!r&&this.gl&&(this.buffer=this.buffer||this._createBuffer(t),this.buffer.setData({data:e}),this.type=this.buffer.accessor.type)}this._setAccessor(t),r&&this.normalized&&(this.value=this._normalizeConstant(this.value))}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var t=this.externalBuffer||this.buffer;return t?[t,this]:null}},{key:"_createBuffer",value:function(t){var e=Object.assign({},t,{id:this.id,target:this.target,accessor:{type:this.type}});return Number.isFinite(e.divisor)&&(e.accessor.divisor=e.divisor),delete e.divisor,Number.isFinite(e.size)&&(e.accessor.size=e.size),delete e.size,new s.a(this.gl,e)}},{key:"_setAccessor",value:function(t){var e=t.size,n=void 0===e?this.size:e,i=t.offset,r=void 0===i?this.offset||0:i,a=t.stride,o=void 0===a?this.stride||0:a,s=t.normalized,h=void 0===s?this.normalized||!1:s,l=t.integer,f=void 0===l?this.integer||!1:l,d=t.divisor,p=void 0===d?this.divisor||0:d,g=t.instanced,v=t.isInstanced;this.size=n,this.offset=r,this.elementOffset=r/u.a.getBytesPerElement(this),this.stride=o,this.normalized=h,this.integer=f,this.divisor=p,void 0!==v&&(c.a.deprecated("Attribute.isInstanced")(),this.divisor=v?1:0),void 0!==g&&(c.a.deprecated("Attribute.instanced")(),this.divisor=g?1:0)}},{key:"_normalizeConstant",value:function(t){switch(this.type){case 5120:return new Float32Array(t).map((function(t){return(t+128)/255*2-1}));case 5122:return new Float32Array(t).map((function(t){return(t+32768)/65535*2-1}));case 5121:return new Float32Array(t).map((function(t){return t/255}));case 5123:return new Float32Array(t).map((function(t){return t/65535}));default:return t}}},{key:"_validateAttributeDefinition",value:function(){}}]),t}()},"XM/H":function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return(r="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}n.d(e,"a",(function(){return r}))},ZaHm:function(t,e,n){"use strict";n.d(e,"q",(function(){return r})),n.d(e,"f",(function(){return a})),n.d(e,"a",(function(){return o})),n.d(e,"h",(function(){return s})),n.d(e,"p",(function(){return u})),n.d(e,"o",(function(){return h})),n.d(e,"k",(function(){return c})),n.d(e,"l",(function(){return l})),n.d(e,"m",(function(){return f})),n.d(e,"n",(function(){return d})),n.d(e,"e",(function(){return p})),n.d(e,"c",(function(){return g})),n.d(e,"d",(function(){return v})),n.d(e,"j",(function(){return m})),n.d(e,"i",(function(){return y})),n.d(e,"g",(function(){return _})),n.d(e,"b",(function(){return b}));var i=n("yU0y");function r(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=r,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function a(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],g=e[13],v=e[14],m=e[15],y=n*s-i*o,_=n*u-r*o,b=n*h-a*o,w=i*u-r*s,x=i*h-a*s,O=r*h-a*u,j=c*g-l*p,k=c*v-f*p,P=c*m-d*p,C=l*v-f*g,T=l*m-d*g,M=f*m-d*v,E=y*M-_*T+b*C+w*P-x*k+O*j;return E?(E=1/E,t[0]=(s*M-u*T+h*C)*E,t[1]=(r*T-i*M-a*C)*E,t[2]=(g*O-v*x+m*w)*E,t[3]=(f*x-l*O-d*w)*E,t[4]=(u*P-o*M-h*k)*E,t[5]=(n*M-r*P+a*k)*E,t[6]=(v*b-p*O-m*_)*E,t[7]=(c*O-f*b+d*_)*E,t[8]=(o*T-s*P+h*j)*E,t[9]=(i*P-n*T-a*j)*E,t[10]=(p*x-g*b+m*y)*E,t[11]=(l*b-c*x-d*y)*E,t[12]=(s*k-o*C-u*j)*E,t[13]=(n*C-i*k+r*j)*E,t[14]=(g*_-p*w-v*y)*E,t[15]=(c*w-l*_+f*y)*E,t):null}function o(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],g=t[14],v=t[15];return(e*o-n*a)*(l*v-f*g)-(e*s-i*a)*(c*v-f*p)+(e*u-r*a)*(c*g-l*p)+(n*s-i*o)*(h*v-f*d)-(n*u-r*o)*(h*g-l*d)+(i*u-r*s)*(h*p-c*d)}function s(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],g=e[12],v=e[13],m=e[14],y=e[15],_=n[0],b=n[1],w=n[2],x=n[3];return t[0]=_*i+b*s+w*l+x*g,t[1]=_*r+b*u+w*f+x*v,t[2]=_*a+b*h+w*d+x*m,t[3]=_*o+b*c+w*p+x*y,_=n[4],b=n[5],w=n[6],x=n[7],t[4]=_*i+b*s+w*l+x*g,t[5]=_*r+b*u+w*f+x*v,t[6]=_*a+b*h+w*d+x*m,t[7]=_*o+b*c+w*p+x*y,_=n[8],b=n[9],w=n[10],x=n[11],t[8]=_*i+b*s+w*l+x*g,t[9]=_*r+b*u+w*f+x*v,t[10]=_*a+b*h+w*d+x*m,t[11]=_*o+b*c+w*p+x*y,_=n[12],b=n[13],w=n[14],x=n[15],t[12]=_*i+b*s+w*l+x*g,t[13]=_*r+b*u+w*f+x*v,t[14]=_*a+b*h+w*d+x*m,t[15]=_*o+b*c+w*p+x*y,t}function u(t,e,n){var i,r,a,o,s,u,h,c,l,f,d,p,g=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*g+e[4]*v+e[8]*m+e[12],t[13]=e[1]*g+e[5]*v+e[9]*m+e[13],t[14]=e[2]*g+e[6]*v+e[10]*m+e[14],t[15]=e[3]*g+e[7]*v+e[11]*m+e[15]):(i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=i*g+s*v+l*m+e[12],t[13]=r*g+u*v+f*m+e[13],t[14]=a*g+h*v+d*m+e[14],t[15]=o*g+c*v+p*m+e[15]),t}function h(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(t,e,n,r){var a,o,s,u,h,c,l,f,d,p,g,v,m,y,_,b,w,x,O,j,k,P,C,T,M=r[0],E=r[1],S=r[2],A=Math.hypot(M,E,S);return A<i.b?null:(M*=A=1/A,E*=A,S*=A,a=Math.sin(n),s=1-(o=Math.cos(n)),u=e[0],h=e[1],c=e[2],l=e[3],f=e[4],d=e[5],p=e[6],g=e[7],v=e[8],m=e[9],y=e[10],_=e[11],b=M*M*s+o,w=E*M*s+S*a,x=S*M*s-E*a,O=M*E*s-S*a,j=E*E*s+o,k=S*E*s+M*a,P=M*S*s+E*a,C=E*S*s-M*a,T=S*S*s+o,t[0]=u*b+f*w+v*x,t[1]=h*b+d*w+m*x,t[2]=c*b+p*w+y*x,t[3]=l*b+g*w+_*x,t[4]=u*O+f*j+v*k,t[5]=h*O+d*j+m*k,t[6]=c*O+p*j+y*k,t[7]=l*O+g*j+_*k,t[8]=u*P+f*C+v*T,t[9]=h*P+d*C+m*T,t[10]=c*P+p*C+y*T,t[11]=l*P+g*C+_*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function l(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+h*i,t[5]=o*r+c*i,t[6]=s*r+l*i,t[7]=u*r+f*i,t[8]=h*r-a*i,t[9]=c*r-o*i,t[10]=l*r-s*i,t[11]=f*r-u*i,t}function f(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-h*i,t[1]=o*r-c*i,t[2]=s*r-l*i,t[3]=u*r-f*i,t[8]=a*i+h*r,t[9]=o*i+c*r,t[10]=s*i+l*r,t[11]=u*i+f*r,t}function d(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+h*i,t[1]=o*r+c*i,t[2]=s*r+l*i,t[3]=u*r+f*i,t[4]=h*r-a*i,t[5]=c*r-o*i,t[6]=l*r-s*i,t[7]=f*r-u*i,t}function p(t,e){var n=e[0],i=e[1],r=e[2],a=e[4],o=e[5],s=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,h,c),t}function g(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n+n,s=i+i,u=r+r,h=n*o,c=i*o,l=i*s,f=r*o,d=r*s,p=r*u,g=a*o,v=a*s,m=a*u;return t[0]=1-l-p,t[1]=c+m,t[2]=f-v,t[3]=0,t[4]=c-m,t[5]=1-h-p,t[6]=d+g,t[7]=0,t[8]=f+v,t[9]=d-g,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function v(t,e,n,i,r,a,o){var s=1/(n-e),u=1/(r-i),h=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*u,t[10]=(o+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*h,t[15]=0,t}function m(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(a=1/(i-r),t[10]=(r+i)*a,t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t}function y(t,e,n,i,r,a,o){var s=1/(e-n),u=1/(i-r),h=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(o+a)*h,t[15]=1,t}function _(t,e,n,r){var a,o,s,u,h,c,l,f,d,p,g=e[0],v=e[1],m=e[2],y=r[0],_=r[1],b=r[2],w=n[0],x=n[1],O=n[2];return Math.abs(g-w)<i.b&&Math.abs(v-x)<i.b&&Math.abs(m-O)<i.b?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(l=g-w,f=v-x,d=m-O,a=_*(d*=p=1/Math.hypot(l,f,d))-b*(f*=p),o=b*(l*=p)-y*d,s=y*f-_*l,(p=Math.hypot(a,o,s))?(a*=p=1/p,o*=p,s*=p):(a=0,o=0,s=0),u=f*s-d*o,h=d*a-l*s,c=l*o-f*a,(p=Math.hypot(u,h,c))?(u*=p=1/p,h*=p,c*=p):(u=0,h=0,c=0),t[0]=a,t[1]=u,t[2]=l,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(a*g+o*v+s*m),t[13]=-(u*g+h*v+c*m),t[14]=-(l*g+f*v+d*m),t[15]=1,t)}function b(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],h=t[6],c=t[7],l=t[8],f=t[9],d=t[10],p=t[11],g=t[12],v=t[13],m=t[14],y=t[15],_=e[0],b=e[1],w=e[2],x=e[3],O=e[4],j=e[5],k=e[6],P=e[7],C=e[8],T=e[9],M=e[10],E=e[11],S=e[12],A=e[13],L=e[14],R=e[15];return Math.abs(n-_)<=i.b*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(r-b)<=i.b*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-w)<=i.b*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-x)<=i.b*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-O)<=i.b*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(u-j)<=i.b*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(h-k)<=i.b*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(c-P)<=i.b*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(l-C)<=i.b*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-T)<=i.b*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(d-M)<=i.b*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-E)<=i.b*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(g-S)<=i.b*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(v-A)<=i.b*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(m-L)<=i.b*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(y-R)<=i.b*Math.max(1,Math.abs(y),Math.abs(R))}},Zk56:function(t,e,n){"use strict";function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.filter,i=void 0===n?function(){return!0}:n,r=e.map,a=void 0===r?function(t){return t}:r,o=e.result,s=void 0===o?[]:o;return Array.isArray(t)?function t(e,n,i,r){for(var a=-1;++a<e.length;){var o=e[a];Array.isArray(o)?t(o,n,i,r):n(o)&&r.push(i(o))}return r}(t,i,a,s):i(t)?[a(t)]:[]}function r(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.result,i=void 0===n?[]:n,a=e.dimensions,o=void 0===a?3:a,s=-1,u=0;++s<t.length;){var h=t[s];Array.isArray(h)||ArrayBuffer.isView(h)?r(h,{result:i,dimensions:o}):u<o&&(i.push(h),u++)}return u>0&&u<o&&i.push(0),i}function a(t){for(var e=t.target,n=t.source,i=t.start,r=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=n.length,u=o*s,h=0,c=r;h<s;h++)e[c++]=n[h];for(;h<u;)h<u-h?(e.copyWithin(r+h,r,r+h),h*=2):(e.copyWithin(r+h,r,r+u-h),h=u);return e}n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}))},ZxFD:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"e",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"g",(function(){return h})),n.d(e,"h",(function(){return c})),n.d(e,"i",(function(){return l})),n.d(e,"j",(function(){return f})),n.d(e,"f",(function(){return d}));var i=n("yU0y");function r(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function o(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u(t,e,n,i){var r=e[0],a=e[1];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t}function h(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function c(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function l(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function f(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}var d=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};!function(){var t=new i.a(2);i.a!=Float32Array&&(t[0]=0,t[1]=0)}()},b0ih:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.overAlloc,r=void 0===n?2:n,a=e.poolSize,o=void 0===a?100:a;Object(i.a)(this,t),this.overAlloc=r,this.poolSize=o,this._pool=[]}return Object(r.a)(t,[{key:"allocate",value:function(t,e,n){var i=n.size,r=void 0===i?1:i,a=n.type,o=n.padding,s=void 0===o?0:o,u=n.copy,h=void 0!==u&&u,c=a||t&&t.constructor||Float32Array,l=e*r+s;if(ArrayBuffer.isView(t)){if(l<=t.length)return t;if(l*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,l)}var f=this._allocate(c,l);return t&&h?f.set(t):f.fill(0,0,4),this._release(t),f}},{key:"release",value:function(t){this._release(t)}},{key:"_allocate",value:function(t,e){e=Math.max(Math.ceil(e*this.overAlloc),1);var n=this._pool,i=t.BYTES_PER_ELEMENT*e,r=n.findIndex((function(t){return t.byteLength>=i}));return r>=0?new t(n.splice(r,1)[0],0,e):new t(e)}},{key:"_release",value:function(t){if(ArrayBuffer.isView(t)){var e=this._pool,n=t.buffer,i=n.byteLength,r=e.findIndex((function(t){return t.byteLength>=i}));r<0?e.push(n):(r>0||e.length<this.poolSize)&&e.splice(r,0,n),e.length>this.poolSize&&e.shift()}}}]),t}();e.a=new a},bHAT:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU");function a(t,e,n){switch(e){case 300:return n?function(t){return t.replace(/attribute\s+/g,"in ").replace(/varying\s+/g,"out ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(+/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t):function(t){return t.replace(/varying\s+/g,"in ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t);case 100:return n?function(t){return t.replace(/^in\s+/gm,"attribute ").replace(/^out\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t):function(t){return t.replace(/^in\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t);default:throw new Error("unknown GLSL version ".concat(e))}}var o=n("uzDn"),s=n("U8pU"),u={number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate:function(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function h(t){var e=c(t);return"object"===e?t?"type"in t?Object.assign({},t,u[t.type]):"value"in t?(e=c(t.value),Object.assign({type:e},t,u[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},u[e])}function c(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":Object(s.a)(t)}n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return f}));var l=function(){function t(e){var n=e.name,r=e.vs,a=e.fs,s=e.dependencies,u=void 0===s?[]:s,c=e.uniforms,l=e.getUniforms,f=e.deprecations,d=void 0===f?[]:f,p=e.defines,g=void 0===p?{}:p,v=e.vertexShader,m=e.fragmentShader;Object(i.a)(this,t),Object(o.a)("string"==typeof n),this.name=n,this.vs=r||v,this.fs=a||m,this.getModuleUniforms=l,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(d),this.defines=g,c&&(this.uniforms=function(t){var e={};for(var n in t){var i=h(t[n]);e[n]=i}return e}(c))}return Object(r.a)(t,[{key:"getModuleSource",value:function(t,e){var n;switch(t){case"vs":n=a(this.vs||"",e,!0);break;case"fs":n=a(this.fs||"",e,!1);break;default:Object(o.a)(!1)}return"#define MODULE_".concat(this.name.toUpperCase(),"\n").concat(n,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(t,e){this.deprecations.forEach((function(n){n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())}))}},{key:"_parseDeprecationDefinitions",value:function(t){return t.forEach((function(t){switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}})),t}},{key:"_defaultGetUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},n=this.uniforms;for(var i in n){var r=n[i];i in t&&!r.private?(r.validate&&Object(o.a)(r.validate(t[i],r),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=r.value}return e}}]),t}();function f(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var e=new l(t);t.getUniforms=e.getUniforms.bind(e)}return t}},bl9R:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"g",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"k",(function(){return h})),n.d(e,"h",(function(){return c})),n.d(e,"m",(function(){return l})),n.d(e,"j",(function(){return f})),n.d(e,"d",(function(){return d})),n.d(e,"i",(function(){return p})),n.d(e,"n",(function(){return g})),n.d(e,"o",(function(){return v})),n.d(e,"f",(function(){return m})),n.d(e,"e",(function(){return y}));var i=n("yU0y");function r(t){var e=new i.a(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,n,r){var a=new i.a(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function h(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function c(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function l(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function f(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=a*o,t}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function p(t,e,n,i){var r=e[0],a=e[1],o=e[2],s=e[3];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t[2]=o+i*(n[2]-o),t[3]=s+i*(n[3]-s),t}function g(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}function v(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],u=n[2],h=n[3],c=h*i+s*a-u*r,l=h*r+u*i-o*a,f=h*a+o*r-s*i,d=-o*i-s*r-u*a;return t[0]=c*h+d*-o+l*-u-f*-s,t[1]=l*h+d*-s+f*-o-c*-u,t[2]=f*h+d*-u+c*-s-l*-o,t[3]=e[3],t}function m(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function y(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=e[0],u=e[1],h=e[2],c=e[3];return Math.abs(n-s)<=i.b*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-u)<=i.b*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-h)<=i.b*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-c)<=i.b*Math.max(1,Math.abs(o),Math.abs(c))}!function(){var t=new i.a(4);i.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}()},bphH:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n("1OyB"),r=n("md7G"),a=n("foSv"),o=n("JX7q"),s=n("vuIU"),u=n("Ji7U"),h=n("L8KH"),c=n("sc/6"),l=n("SUVH"),f=n("VdrS"),d=n("5+o2"),p=function(t){function e(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),Object(l.a)(t),(n=Object(r.a)(this,Object(a.a)(e).call(this,t,s))).initialize(s),n.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(Object(o.a)(n)),n}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"isSupported",value:function(t){return Object(l.d)(t)}}]),Object(s.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Object(f.a)(this.buffers)||this.bind((function(){return t._unbindBuffers()})),this.setProps(e),this}},{key:"setProps",value:function(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}},{key:"setBuffers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((function(){for(var n in e)t.setBuffer(n,e[n])})),this}},{key:"setBuffer",value:function(t,e){var n=this,i=this._getVaryingIndex(t),r=this._getBufferParams(e),a=r.buffer,o=r.byteSize,s=r.byteOffset;return i<0?(this.unused[t]=a,d.a.warn((function(){return"".concat(n.id," unused varying buffer ").concat(t)}))(),this):(this.buffers[i]=e,this.bindOnUse||this._bindBuffer(i,a,s,o),this)}},{key:"begin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(t){var e,n,i;return t instanceof c.a==0?(i=t.buffer,n=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===n||(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}},{key:"_getVaryingInfo",value:function(t){return this.configuration&&this.configuration.getVaryingInfo(t)}},{key:"_getVaryingIndex",value:function(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;var e=Number(t);return Number.isFinite(e)?e:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers){var e=this._getBufferParams(this.buffers[t]),n=e.buffer,i=e.byteSize,r=e.byteOffset;this._bindBuffer(t,n,r,i)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers)this._bindBuffer(t,null)}},{key:"_bindBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r=e&&e.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,t,r,n,i):this.gl.bindBufferBase(35982,t,r),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(t){this.gl.bindTransformFeedback(36386,this.handle)}}]),e}(h.a)},"c+tY":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},c5ZK:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("4TbO"),s=n("4oKg"),u=n("i42S"),h=5,c=function(){function t(e){var n=e.maxConcurrency,i=void 0===n?h:n,r=e.onMessage,a=e.onDebug,s=void 0===a?function(){}:a;Object(o.a)(this,t),this.maxConcurrency=i,this.onMessage=r,this.onDebug=s,this.workerPools=new Map}return Object(s.a)(t,[{key:"setProps",value:function(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}},{key:"destroy",value:function(){this.workerPools.forEach((function(t){return t.destroy()}))}},{key:"process",value:function(){var t=Object(a.a)(r.a.mark((function t(e,n,i){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this._getWorkerPool(e,n),t.abrupt("return",a.process(i));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,i){return t.apply(this,arguments)}}()},{key:"_getWorkerPool",value:function(t,e){var n=this.workerPools.get(e);return n||(n=new u.a({source:t,name:e,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,n)),n}}]),t}()},d3kR:function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return h})),n.d(e,"a",(function(){return c}));var i=n("tMmZ"),r=n("SUVH"),a=n("CxzY"),o=n("5+o2"),s=2;function u(t,e){return h(t,e)}function h(t,e){return(e=Array.isArray(e)?e:[e]).every((function(e){return l(t,e)}))}function c(t){if(t.luma=t.luma||{},!t.luma.caps)for(var e in t.luma.caps={},t.luma.caps.webgl2=Object(r.d)(t),i.b)t.luma.caps[e]=l(t,e);return t.luma.caps}function l(t,e){var n=i.b[e];Object(a.a)(n,e);var u,h=Object(r.d)(t)&&n[1]||n[0];if("function"==typeof h)u=h(t);else if(Array.isArray(h)){u=!0;var c=!0,l=!1,f=void 0;try{for(var d,p=h[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var g=d.value;u=u&&Boolean(t.getExtension(g))}}catch(t){l=!0,f=t}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}}else"string"==typeof h?u=Boolean(t.getExtension(h)):"boolean"==typeof h?u=h:Object(a.a)(!1);return u||o.a.log(s,"Feature: ".concat(e," not supported"))(),u}},d3wX:function(t,e,n){"use strict";var i=n("U8pU"),r=n("KQm4"),a=n("rePB"),o=n("1OyB"),s=n("vuIU"),u=n("W1BH"),h=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(o.a)(this,t),this.storage=function(t){try{var e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return Object(s.a)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function c(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));var a=t.width*n,o=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}var l={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function f(t){return"string"==typeof t?l[t.toUpperCase()]||l.WHITE:t}function d(t,e){if(!t)throw new Error(e||"Assertion failed")}var p=n("egY1");n.d(e,"a",(function(){return _}));var g={debug:u.b&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},v={enabled:!1,priority:0};function m(){}var y={},_=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(o.a)(this,t),this.id=e,this.VERSION=u.a,this._startTs=Object(p.a)(),this._deltaTs=Object(p.a)(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new h("__probe-".concat(this.id,"__"),v),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=!0,a=!1,o=void 0;try{for(var s,u=function(){var n=s.value;"function"==typeof t[n]&&(e.find((function(t){return n===t}))||(t[n]=t[n].bind(t)))},h=i[Symbol.iterator]();!(r=(s=h.next()).done);r=!0)u()}catch(t){a=!0,o=t}finally{try{r||null==h.return||h.return()}finally{if(a)throw o}}}(this),Object.seal(this)}return Object(s.a)(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((Object(p.a)()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((Object(p.a)()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({priority:t}),this}},{key:"assert",value:function(t,e){d(t,e)}},{key:"warn",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._getLogFunction({message:t,args:n,method:g.warn,once:!0})}},{key:"error",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._getLogFunction({message:t,args:n,method:g.error})}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:g.log,time:!0,once:!0})}},{key:"log",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:g.debug})}},{key:"info",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:console.info})}},{key:"once",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:g.debug||g.info,once:!0})}},{key:"table",value:function(t,e,n){if(e){var i=function(t){for(var e in t)for(var n in t[e])return n||"untitled";return"empty"}(e);return this._getLogFunction({priority:t,message:e,args:n&&[n],tag:i,method:console.table||m})}return m}},{key:"image",value:function(t){var e=t.priority,n=t.image,i=t.message,r=void 0===i?"":i,a=t.scale,o=void 0===a?1:a;return e>this.getPriority()?m:u.b?this._logImageInBrowser({image:n,message:r,scale:o}):this._logImageInNode({image:n,message:r,scale:o})}},{key:"settings",value:function(){console.table}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(Object(a.a)({},t,e))}},{key:"_logImageInNode",value:function(t){var e=t.image,i=(t.message,t.scale),r=void 0===i?1:i,a=null;try{a=n(0)}catch(t){}return a?function(){return a(e,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then((function(t){}))}:m}},{key:"_logImageInBrowser",value:function(t){var e=t.image,n=t.message,i=void 0===n?"":n,a=t.scale,o=void 0===a?1:a;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=c(s,i,o);(t=console).log.apply(t,Object(r.a)(e))},s.src=e,m}var u,h=e.nodeName||"";if("img"===h.toLowerCase())return(u=console).log.apply(u,Object(r.a)(c(e,i,o))),m;if("canvas"===h.toLowerCase()){var l=new Image;return l.onload=function(){var t;return(t=console).log.apply(t,Object(r.a)(c(l,i,o)))},l.src=e.toDataURL(),m}return m}},{key:"time",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeStamp||m})}},{key:"group",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=(n=this._normalizeArguments({priority:t,message:e,opts:n})).collapsed;return this._getLogFunction({priority:t,message:e,opts:n,method:(i?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction({priority:t,message:"",method:console.groupEnd||m})}},{key:"withGroup",value:function(t,e,n){var i=this._normalizeArguments({priority:t,message:e});this.group(i);try{n()}finally{this.groupEnd(i.message)}}},{key:"trace",value:function(){console.trace}},{key:"_shouldLog",value:function(t){return 0===(t=this._normalizePriority(t))||this.isEnabled()&&this.getPriority()>=t}},{key:"_getElapsedTime",value:function(){var t=this.getTotal(),e=this.getDelta();return this._deltaTs=Object(p.a)(),{total:t,delta:e}}},{key:"_getLogFunction",value:function(t){if(this._shouldLog(t.priority)){var e=t.method;t=this._parseArguments(t),d(e);var n=t.message,i=t.tag||t.message;if(t.once){if(y[i])return m;y[i]=Object(p.a)()}return n=this._decorateMessage(n,t),e.bind.apply(e,[console,n].concat(Object(r.a)(t.args)))}return m}},{key:"_parseArguments",value:function(t){var e=this._normalizeArguments(t),n=this._getElapsedTime(),i=n.delta,r=n.total;return Object.assign(t,e,{delta:i,total:r})}},{key:"_normalizePriority",value:function(t){var e;switch(Object(i.a)(t)){case"number":e=t;break;case"object":e=t.priority||0;break;default:e=0}return d(Number.isFinite(e)&&e>=0),e}},{key:"_normalizeArguments",value:function(t){var e=t.priority,n=t.message,r=t.args,a=void 0===r?[]:r,o=t.opts,s={priority:this._normalizePriority(e),message:n,args:a};switch(Object(i.a)(e)){case"string":case"function":void 0!==n&&a.unshift(n),Object.assign(s,{message:e});break;case"object":Object.assign(s,e)}return"function"==typeof s.message&&(s.message=this._shouldLog(s.priority)?s.message():""),d("string"==typeof s.message||"object"===Object(i.a)(s.message)),Object.assign(s,o)}},{key:"_decorateMessage",value:function(t,e){if("string"==typeof t){var n="";e.time&&(n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){return t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s")}(this._getElapsedTime().total))),t=function(t,e,n){return u.b||"string"!=typeof t||(e&&(e=f(e),t="[".concat(e,"m").concat(t,"[39m")),n&&(e=f(n),t="[".concat(n+10,"m").concat(t,"[49m"))),t}(t=e.time?"".concat(this.id,": ").concat(n,"  ").concat(t):"".concat(this.id,": ").concat(t),e.color,e.background)}return t}},{key:"priority",set:function(t){return this._storage.updateConfiguration({priority:t}),this},get:function(){return this._storage.config.priority}}]),t}();_.VERSION=u.a},djvz:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("uCGa"),h=n("hP3k"),c=n("S2EH"),l=n("C7oE"),f="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",d=[-1,-1,1,-1,-1,1,1,1],p=function(t){function e(t,n){var r;Object(i.a)(this,e);var s=d.map((function(t){return-1===t?0:t}));return(r=Object(a.a)(this,Object(o.a)(e).call(this,t,Object.assign({},n,{vs:f,geometry:new l.a({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(d)},aTexCoord:{size:2,value:new Float32Array(s)},aCoordinate:{size:2,value:new Float32Array(s)}}})})))).setVertexCount(4),r}return Object(s.a)(e,t),e}(c.a),g=n("pRFE"),v=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e),n=Object(a.a)(this,Object(o.a)(e).call(this,t,r));var s=r.module,u=r.fs,h=r.id,c=r.moduleProps;return n.model=n._getModel(t,s,u,h,c),n}return Object(s.a)(e,t),Object(r.a)(e,[{key:"render",value:function(t){var e=this,n=this.gl;Object(h.a)(n,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},(function(){return e._renderPass(n,t)}))}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_getModel",value:function(t,e,n,i,r){var a=new p(t,{id:i,fs:n,modules:[e]}),o=Object.assign(e.getUniforms(),e.getUniforms(r));return a.setUniforms(o),a}},{key:"_renderPass",value:function(t,e){var n=e.inputBuffer;e.outputBuffer,Object(g.a)(t,{color:!0}),this.model.draw({uniforms:{texture:n,texSize:[n.width,n.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(n("mC81").a),m=n("bHAT");n.d(e,"a",(function(){return y}));var y=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(a.a)(this,Object(o.a)(e).call(this,r))).id="".concat(t.name,"-pass"),Object(m.b)(t),n.module=t,n}return Object(s.a)(e,t),Object(r.a)(e,[{key:"prepare",value:function(t){this.passes||(this.passes=function(t,e,n,i){if(e.filter||e.sampler){var r=w(e);return[new v(t,{id:n,module:e,fs:r,moduleProps:i})]}return(e.passes||[]).map((function(r,a){var o=w(e,r),s="".concat(n,"-").concat(a);return new v(t,{id:s,module:e,fs:o,moduleProps:i})}))}(t,this.module,this.id,this.props))}},{key:"render",value:function(t){for(var e=t.target,n=void 0===e?null:e,i=!1,r=0;r<this.passes.length;r++){var a=i?t.outputBuffer:t.inputBuffer,o=i?t.inputBuffer:t.outputBuffer;n&&r===this.passes.length-1&&(o=n),this.passes[r].render({inputBuffer:a,outputBuffer:o}),i=!i}return{inputBuffer:i?t.outputBuffer:t.inputBuffer,outputBuffer:i?t.inputBuffer:t.outputBuffer}}},{key:"cleanup",value:function(){if(this.passes){var t=!0,e=!1,n=void 0;try{for(var i,r=this.passes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.delete()}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}this.passes=null}}}]),e}(u.a),_=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},b=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var n="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return _(n)}if(e.sampler){var i="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return b(i)}return null}},"e/LK":function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("Jh/b"),s=n("F8bt"),u=n("qjXE"),h=n("sY1B"),c=n("vqa/"),l=n("ZaHm"),f=n("B7nP"),d=n("VMBB"),p=Math.PI/180,g=Object(s.a)(),v=[0,0,0],m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.id,i=void 0===n?null:n,a=e.x,o=void 0===a?0:a,s=e.y,u=void 0===s?0:s,h=e.width,c=void 0===h?1:h,l=e.height,f=void 0===l?1:l;this.id=i||this.constructor.displayName||"viewport",this.x=o,this.y=u,this.width=c||1,this.height=f||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}return Object(a.a)(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(u.d)(e.projectionMatrix,this.projectionMatrix)&&Object(u.d)(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===e||e,r=this.projectPosition(t),a=Object(f.k)(r,this.pixelProjectionMatrix),o=Object(i.a)(a,2),s=o[0],u=o[1],h=n?u:this.height-u;return 2===t.length?[s,h]:[s,h,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,a=e.targetZ,o=Object(i.a)(t,3),s=o[0],u=o[1],h=o[2],c=r?u:this.height-u,l=a&&a*this.distanceScales.pixelsPerMeter[2],d=Object(f.h)([s,c,h],this.pixelUnprojectionMatrix,l),p=this.unprojectPosition(d),g=Object(i.a)(p,3),v=g[0],m=g[1],y=g[2];return Number.isFinite(h)?[v,m,y]:Number.isFinite(a)?[v,m,a]:[v,m]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(i.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.pixelsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(i.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.metersPerPixel[2]]}},{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(f.g)(t,e);var n=this.distanceScales.pixelsPerMeter;return[t[0]*n[0],t[1]*n[1]]}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(f.j)(t,e);var n=this.distanceScales.metersPerPixel;return[t[0]*n[0],t[1]*n[1]]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(f.b)({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modelMatrix,e=void 0===t?null:t,n=this.viewProjectionMatrix,i=this.pixelProjectionMatrix,r=this.pixelUnprojectionMatrix;return e&&(n=l.h([],this.viewProjectionMatrix,e),i=l.h([],this.pixelProjectionMatrix,e),r=l.f([],i)),Object.assign({modelViewProjectionMatrix:n,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:i,pixelUnprojectionMatrix:r,width:this.width,height:this.height,scale:this.scale})}},{key:"containsPixel",value:function(t){var e=t.x,n=t.y,i=t.width,r=void 0===i?1:i,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+o}},{key:"getFrustumPlanes",value:function(){if(this._frustumPlanes.near)return this._frustumPlanes;var t=this.projectionProps,e=t.near,n=t.far,i=t.fovyRadians,r=t.aspect;return Object.assign(this._frustumPlanes,Object(s.d)({aspect:r,near:e,far:n,fovyRadians:i,position:this.cameraPosition,direction:this.cameraDirection,up:this.cameraUp,right:this.cameraRight})),this._frustumPlanes}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,n=t.fovyRadians,i=t.aspect,r=t.focalDistance,a=t.near,o=t.far;return Object(d.a)(Number.isFinite(n)),e?(new h.a).orthographic({fovy:n,aspect:i,focalDistance:r,near:a,far:o}):(new h.a).perspective({fovy:n,aspect:i,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,n=void 0===e?g:e,i=t.longitude,r=void 0===i?null:i,a=t.latitude,o=void 0===a?null:a,s=t.zoom,u=void 0===s?null:s,d=t.position,p=void 0===d?null:d,m=t.modelMatrix,y=void 0===m?null:m,_=t.focalDistance,b=void 0===_?1:_,w=t.distanceScales,x=void 0===w?null:w;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(r),this.zoom=u,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(f.c)({latitude:o})+Math.log2(b):0);var O=Math.pow(2,this.zoom);this.scale=O,this.distanceScales=this.isGeospatial?Object(f.b)({latitude:o,longitude:r,scale:this.scale}):x||{pixelsPerMeter:[O,O,O],metersPerPixel:[1/O,1/O,1/O]},this.focalDistance=b,this.distanceScales.metersPerPixel=new c.a(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new c.a(this.distanceScales.pixelsPerMeter),this.position=v,this.meterOffset=v,p&&(this.position=p,this.modelMatrix=y,this.meterOffset=y?y.transformVector(p):p),this.isGeospatial?(this.longitude=r,this.latitude=o,this.center=this._getCenterInWorld({longitude:r,latitude:o}),this.viewMatrixUncentered=l.o([],n,[1,-1,1])):(this.center=p?this.projectPosition(p):[0,0,0],this.viewMatrixUncentered=n),this.viewMatrix=(new h.a).multiplyRight(this.viewMatrixUncentered).translate(new c.a(this.center||v).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,n=t.latitude,i=this.meterOffset,r=this.scale,a=this.distanceScales,o=this.projectFlat([e,n],r),s=new c.a(o[0],o[1],0);if(i){var u=new c.a(i).scale(a.pixelsPerMeter);s.add(u)}return s}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,n=void 0===e?null:e,i=t.orthographic,r=void 0!==i&&i,a=t.fovyRadians,o=t.fovyDegrees,s=t.fovy,u=t.near,h=void 0===u?.1:u,c=t.far,l=void 0===c?1e3:c,f=t.focalDistance,d=void 0===f?1:f,g=t.orthographicFocalDistance,v=a||(o||s||75)*p;this.projectionProps={orthographic:r,fovyRadians:v,aspect:this.width/this.height,focalDistance:g||d,near:h,far:l},this.projectionMatrix=n||this._createProjectionMatrix(this.projectionProps)}},{key:"_initPixelMatrices",value:function(){var t=Object(s.a)();l.h(t,t,this.projectionMatrix),l.h(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=l.f([],this.viewMatrix)||this.viewMatrix;var e=Object(s.b)({viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse}),n=e.eye,i=e.direction,r=e.up,a=e.right;this.cameraPosition=n,this.cameraDirection=i,this.cameraUp=r,this.cameraRight=a;var u=Object(s.a)(),h=Object(s.a)();l.o(u,u,[this.width/2,-this.height/2,1]),l.p(u,u,[1,-1,0]),l.h(h,u,this.viewProjectionMatrix),this.pixelProjectionMatrix=h,this.viewportMatrix=u,this.pixelUnprojectionMatrix=l.f(Object(s.a)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||o.a.warn("Pixel project matrix not invertible")()}}]),t}();m.displayName="Viewport"},eUbh:function(t,e,n){"use strict";(function(t){var e=n("9Hqq"),i=n("gVfD");function r(t,n){var r=n.extension,a=n.target,o=n.target2,s=i.b[r];Object(e.a)(s);for(var u=s.meta,h=(void 0===u?{}:u).suffix,c=void 0===h?"":h,l=t.getExtension(r),f=function(){var e=p[d],n="".concat(e).concat(c),i=null;"meta"===e||"function"==typeof t[e]||(l&&"function"==typeof l[n]?i=function(){return l[n].apply(l,arguments)}:"function"==typeof s[e]&&(i=s[e].bind(a))),i&&(a[e]=i,o[e]=i)},d=0,p=Object.keys(s);d<p.length;d++)f()}(void 0!==t?t:window).polyfillContext=function(t){return t.luma=t.luma||{},function(t){t.luma.extensions={};var e=t.getSupportedExtensions()||[],n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t.luma[s]=t.getExtension(s)}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}(t),t.luma.polyfilled||(function(t,e){var n=!0,i=!1,a=void 0;try{for(var o,s=Object.getOwnPropertyNames(e)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;"overrides"!==u&&r(t,{extension:u,target:t.luma,target2:t})}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}(t,i.b),function(t,e){var n=e.target,r=e.target2;Object.keys(i.a).forEach((function(e){if("function"==typeof i.a[e]){var a=t[e]?t[e].bind(t):function(){},o=i.a[e].bind(null,t,a);n[e]=o,r[e]=o}}))}(t,{target:t.luma,target2:t}),t.luma.polyfilled=!0),t}}).call(this,n("yLpj"))},edxD:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("s4An"),h=n("RHh3");function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||!function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Object(h.a)(t,arguments,Object(o.a)(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object(u.a)(n,t)})(t)}var l=n("qjXE");n.d(e,"a",(function(){return f}));var f=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Object(l.f)(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(l.b)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Object(l.e)(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(l.d)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var i=0;i<this.ELEMENTS;++i){var r=t[i];this[i]=r+n*(e[i]-r)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var a=r[i],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var a=r[i],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(l.b.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(c(Array))},egY1:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("W1BH"),r=n("K9nA");function a(){var t;if(i.b&&r.b.performance)t=r.b.performance.now();else if(r.a.hrtime){var e=r.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}},eqkD:function(t,e,n){"use strict";(function(t,i){n.d(e,"a",(function(){return o}));var r=n("U8pU"),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||t.browser,{self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==i&&i}),o=a.global||a.self||a.window}).call(this,n("8oxB"),n("yLpj"))},f5Sf:function(t,e,n){"use strict";var i=n("1OyB"),r=n("md7G"),a=n("foSv"),o=n("JX7q"),s=n("vuIU"),u=n("Ji7U"),h=n("l6PP"),c=n("SUVH"),l=n("CxzY"),f="";n.d(e,"a",(function(){return d}));var d=function(t){function e(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),Object(c.b)(t),(s instanceof Promise||"string"==typeof s)&&(s={data:s}),"string"==typeof s.data&&(s=Object.assign({},s,{data:function(t,e){return Object(l.a)("string"==typeof t),t=f+t,new Promise((function(e,n){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin="anonymous",i.src=t}catch(t){n(t)}}))}(s.data)})),(n=Object(r.a)(this,Object(a.a)(e).call(this,t,Object.assign({},s,{target:3553})))).initialize(s),Object.seal(Object(o.a)(n)),n}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"isSupported",value:function(t,e){return h.a.isSupported(t,e)}}]),e}(h.a)},foSv:function(t,e,n){"use strict";function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.d(e,"a",(function(){return i}))},ftUl:function(t,e,n){"use strict";function i(t,e,n,i,r,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)}))}}n.d(e,"a",(function(){return r}))},gVfD:function(t,e,n){"use strict";var i,r,a=n("rePB"),o=n("9Hqq"),s=function(t){return h(t)?void 0:0},u=(i={},Object(a.a)(i,3074,(function(t){return h(t)?void 0:36064})),Object(a.a)(i,35723,(function(t){return h(t)?void 0:4352})),Object(a.a)(i,35977,s),Object(a.a)(i,32937,s),Object(a.a)(i,36795,(function(t,e){var n=h(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0})),Object(a.a)(i,37445,(function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)})),Object(a.a)(i,37446,(function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)})),Object(a.a)(i,34047,(function(t,e){var n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1})),Object(a.a)(i,32883,s),Object(a.a)(i,35071,s),Object(a.a)(i,37447,s),Object(a.a)(i,36063,(function(t,e){if(!h(t)){var n=t.getExtension("WEBGL_draw_buffers");return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}})),Object(a.a)(i,35379,s),Object(a.a)(i,35374,s),Object(a.a)(i,35377,s),Object(a.a)(i,34852,(function(t){if(!h(t)){var e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}})),Object(a.a)(i,36203,(function(t){return t.getExtension("OES_element_index")?2147483647:65535})),Object(a.a)(i,33001,(function(t){return t.getExtension("OES_element_index")?16777216:65535})),Object(a.a)(i,33e3,(function(t){return 16777216})),Object(a.a)(i,37157,s),Object(a.a)(i,35373,s),Object(a.a)(i,35657,s),Object(a.a)(i,36183,s),Object(a.a)(i,37137,s),Object(a.a)(i,34045,s),Object(a.a)(i,35978,s),Object(a.a)(i,35979,s),Object(a.a)(i,35968,s),Object(a.a)(i,35376,s),Object(a.a)(i,35375,s),Object(a.a)(i,35659,s),Object(a.a)(i,37154,s),Object(a.a)(i,35371,s),Object(a.a)(i,35658,s),Object(a.a)(i,35076,s),Object(a.a)(i,35077,s),Object(a.a)(i,35380,s),i);function h(t){return Boolean(t&&2===t._version)}function c(t){return Boolean(t&&2===t._version)}n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return f}));var l=(r={},Object(a.a)(r,"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){Object(o.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),Object(a.a)(r,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(t,e){Object(o.a)(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),Object(a.a)(r,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){Object(o.a)(!1)}}),Object(a.a)(r,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){Object(o.a)(!1)},deleteQuery:function(){Object(o.a)(!1)},beginQuery:function(){Object(o.a)(!1)},endQuery:function(){},getQuery:function(t,e){return this.getQueryObject(t,e)},getQueryParameter:function(t,e){return this.getQueryObject(t,e)},getQueryObject:function(){}}),r),f={readBuffer:function(t,e,n){c(t)&&e(n)},getVertexAttrib:function(t,e,n,i){var r,a=function(t,e){return{webgl2:c(t),ext:t.getExtension("ANGLE_instanced_arrays")}}(t),o=a.webgl2,s=a.ext;switch(i){case 35069:r=!!o&&void 0;break;case 35070:r=o||s?void 0:0}return void 0!==r?r:e(n,i)},getProgramParameter:function(t,e,n,i){if(!c(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,i)},getInternalformatParameter:function(t,e,n,i,r){if(!c(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter:function(t,e,n,i){switch(i){case 34046:var r=t.luma.extensions.EXT_texture_filter_anisotropic;i=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,i)},getParameter:function(t,e,n){var i=u[n],r="function"==typeof i?i(t,e,n):i;return void 0!==r?r:e(n)},hint:function(t,e,n,i){return e(n,i)}}},h9Q3:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("Jh/b"),o=n("md7G"),s=n("foSv"),u=n("ReuC"),h=n("Ji7U"),c=function(t){function e(){return Object(i.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(r.a)(e,[{key:"getModuleParameters",value:function(t,n,i){var r=Object(u.a)(Object(s.a)(e.prototype),"getModuleParameters",this).call(this,t);Object.assign(r,this.getObjectHighlightParameters(t),i);var a=!0,o=!1,h=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;Object.assign(r,f.getParameters(t))}}catch(t){o=!0,h=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw h}}return r}},{key:"getObjectHighlightParameters",value:function(t){var e=t.props,n=e.highlightedObjectIndex,i=e.highlightColor,r={pickingHighlightColor:[i[0],i[1],i[2],i[3]||255]};return Number.isInteger(n)&&(r.pickingSelectedColor=n>=0?t.encodePickingColor(n):null),r}}]),e}(n("EFXr").a),l=n("iwLF"),f=n("djvz"),d=n("11Ib");n.d(e,"a",(function(){return p}));var p=function(){function t(e){Object(i.a)(this,t),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new c(e),this.pickLayersPass=new l.a(e),this.renderCount=0,this._needsRedraw="Initial render",this.screenBuffer=null,this.offscreenBuffer=null,this.lastPostProcessEffect=null}return Object(r.a)(t,[{key:"setProps",value:function(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed");var e=this.layerFilter;this.drawLayersPass.setProps({layerFilter:e}),this.pickLayersPass.setProps({layerFilter:e})}},{key:"renderLayers",value:function(t){var e=this,n=t.layers,i=t.viewports,r=t.activateViewport,o=t.views,s=t.redrawReason,u=void 0===s?"unknown reason":s,h=t.clearCanvas,c=void 0===h||h,l=t.effects,f=void 0===l?[]:l,p=t.pass,g=t.stats,v=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,m=this.prepareEffects({layers:n,viewports:i,onViewportActive:r,views:o,effects:f}),y=this.lastPostProcessEffect?this.screenBuffer:d.a.getDefaultFramebuffer(this.gl),_=v.render({layers:n,viewports:i,views:o,onViewportActive:r,redrawReason:u,clearCanvas:c,effects:f,effectProps:m,outputBuffer:y});this.postRender(f),this.renderCount++,a.a.priority>=2&&_.forEach((function(t){e.logRenderStats({status:t,pass:p,redrawReason:u,stats:g,renderStats:_})}))}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"finalize",value:function(){this.screenBuffer&&(this.screenBuffer.delete(),this.screenBuffer=null),this.offscreenBuffer&&(this.offscreenBuffer.delete(),this.offscreenBuffer=null)}},{key:"prepareEffects",value:function(t){var e=t.effects,n={};this.lastPostProcessEffect=null;var i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;Object.assign(n,u.prepare(this.gl,t)),u instanceof f.a&&(this.lastPostProcessEffect=u)}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return this.lastPostProcessEffect&&this.prepareRenderBuffers(),n}},{key:"prepareRenderBuffers",value:function(){this.screenBuffer||(this.screenBuffer=new d.a(this.gl)),this.screenBuffer.resize(),this.offscreenBuffer||(this.offscreenBuffer=new d.a(this.gl)),this.offscreenBuffer.resize()}},{key:"postRender",value:function(t){var e={inputBuffer:this.screenBuffer,outputBuffer:this.offscreenBuffer,target:null},n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s instanceof f.a){if(s===this.lastPostProcessEffect){Object.assign(e,{target:d.a.getDefaultFramebuffer(this.gl)}),e=s.render(e);break}e=s.render(e)}}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"logRenderStats",value:function(t){var e=t.renderStats,n=t.pass,i=t.redrawReason,r=t.stats,o=e.totalCount,s=e.visibleCount,u=e.compositeCount,h=e.pickableCount,c=o-u-s,l="";l+="RENDER #".concat(this.renderCount," ").concat(s," (of ").concat(o," layers) to ").concat(n," because ").concat(i," "),a.a.priority>2&&(l+="(".concat(c," hidden, ").concat(u," composite ").concat(h," pickable)")),a.a.log(2,l)(),r&&r.get("Redraw Layers").add(s)}}]),t}()},hJkN:function(t,e,n){"use strict";var i=n("pE0Q"),r=n("puIE"),a=Object.keys(r.a).map((function(t){return"const float COORDINATE_SYSTEM_".concat(t," = ").concat(r.a[t],".;")})).join(""),o="".concat(a,"\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_size(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    float X = position.x - project_uCoordinateOrigin.x;\n    float Y = position.y - project_uCoordinateOrigin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_IDENTITY) {\n    position_world.xyz -= project_uCoordinateOrigin;\n    position_world += project_uModelMatrix * vec4(position64xyLow, 0.0, 0.0);\n  }\n\n  return project_offset_(position_world);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    position.w *= project_uCommonUnitsPerMeter.z;\n  }\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters);\n}\nfloat project_pixel_size(float pixels) {\n  return pixels;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels;\n}\nfloat project_scale(float meters) {\n  return project_size(meters);\n}\nvec2 project_scale(vec2 meters) {\n  return project_size(meters);\n}\nvec3 project_scale(vec3 meters) {\n  return project_size(meters);\n}\nvec4 project_scale(vec4 meters) {\n  return project_size(meters);\n}\nvec4 project_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position);\n}\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  return vec4(project_pixel_size_to_clipspace(pixels), 0.0, 0.0);\n}\n"),s=n("V8ep"),u={};e.a={name:"project",dependencies:[i.a],vs:o,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;return t.viewport?Object(s.b)(t):{}},deprecations:[{type:"function",old:"project_scale",new:"project_size"},{type:"function",old:"project_to_clipspace",new:"project_common_position_to_clipspace"},{type:"function",old:"project_pixel_to_clipspace",new:"project_pixel_size_to_clipspace"}]}},hLBe:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("4TbO"),s=n("4oKg"),u=n("2WEh"),h=0;function c(t){var e=t.data;(0,t.resolve)(e)}var l=function(){function t(e){var n=e.source,i=e.name,r=void 0===i?"web-worker-".concat(h++):i,a=e.onMessage;Object(o.a)(this,t);var s=Object(u.b)(n);this.worker=new Worker(s,{name:r}),this.name=r,this.onMessage=a||c}return Object(s.a)(t,[{key:"process",value:function(){var t=Object(a.a)(r.a.mark((function t(e){var n=this;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,i){n.worker.onmessage=function(e){return n.onMessage({worker:n.worker,data:e.data,resolve:t,reject:i})},n.worker.onerror=function(t){return i(t)};var r=Object(u.a)(e);n.worker.postMessage(e,r)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"destroy",value:function(){this.worker.terminate(),this.worker=null}}]),t}()},hP3k:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("U//q"),r=n("Wiem"),a=n("y7xQ"),o=n("c+tY");function s(t,e,n){if(Object(a.a)(e))return n(t);var s,u=e.nocatch,h=void 0===u||u;if(Object(o.a)(!e.frameBuffer),Object(i.c)(t),Object(r.a)(t,e),h)s=n(t),Object(i.b)(t);else try{s=n(t)}finally{Object(i.b)(t)}return s}},"ho2+":function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("edxD"),h=n("nzaO"),c=n("qjXE"),l=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"toString",value:function(){var t="[";if(c.b.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var i=0;i<this.ELEMENTS;++i)t+=" ".concat(this[i])}return t+"]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=Object(h.a)(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,i=0;i<this.RANK;++i)e[i]=this[n+i];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}]),e}(u.a)},"i+E3":function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("1zMu"),s=n("H58V"),u=n("nwRP");function h(t,e){return c.apply(this,arguments)}function c(){return(c=Object(a.a)(r.a.mark((function t(e,n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(o.c)(e)){t.next=2;break}return t.abrupt("return",Object(u.a)(e,n));case 2:return e=Object(s.a)(e),t.abrupt("return",fetch(e,n));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},i42S:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("4TbO"),s=n("4oKg"),u=n("hLBe"),h=function(){function t(e){var n=e.source,i=e.name,r=void 0===i?"unnamed":i,a=e.maxConcurrency,s=void 0===a?1:a,u=e.onMessage,h=e.onDebug,c=void 0===h?function(){}:h;Object(o.a)(this,t),this.source=n,this.name=r,this.maxConcurrency=s,this.onMessage=u,this.onDebug=c,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}return Object(s.a)(t,[{key:"destroy",value:function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0}},{key:"process",value:function(){var t=Object(a.a)(r.a.mark((function t(e,n){var i=this;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){i.jobQueue.push({data:e,jobName:n,resolve:t,reject:r}),i._startQueuedJob()})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"_startQueuedJob",value:function(){var t=this;if(this.jobQueue.length){var e=this._getAvailableWorker();if(e){var n=this.jobQueue.shift();this.onDebug({message:"processing",worker:e.name,job:n.jobName,backlog:this.jobQueue.length}),e.process(n.data).then((function(t){return n.resolve(t)})).catch((function(t){return n.reject(t)})).then((function(){return t._onWorkerDone(e)}))}}}},{key:"_onWorkerDone",value:function(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var t="".concat(this.name.toLowerCase(),"-worker-").concat(this.count,"-of-").concat(this.maxConcurrency);return new u.a({source:this.source,onMessage:this.onMessage,name:t})}return null}}]),t}()},iTDY:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}));var i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},r=i.window||i.self||i.global,a=i.global||i.self||i.window}).call(this,n("yLpj"))},ieC7:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("1zMu"),s=n("i+E3"),u=n("kGlb"),h=n("U/rz"),c=n("DJG6"),l=n("JWCg");function f(t,e,n){return d.apply(this,arguments)}function d(){return(d=Object(a.a)(r.a.mark((function t(e,n,i){var a,f,d,p;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(n)||Object(u.a)(n)||(i=n,n=null),a=Object(o.c)(e)?e.name:e,!(f=Object(c.a)(n,a,null,{nothrow:!0}))){t.next=9;break}if(!f.loadAndParse){t.next=9;break}return d=Object(h.a)(i,f),t.next=8,f.loadAndParse(e,d);case 8:return t.abrupt("return",t.sent);case 9:if(p=e,!Object(o.c)(p)&&"string"!=typeof p){t.next=14;break}return t.next=13,Object(s.a)(e,i);case 13:p=t.sent;case 14:return t.abrupt("return",Object(l.a)(p,n,i,e));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n("lCa4")},iwLF:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("ReuC"),u=n("Ji7U"),h=n("EFXr"),c=n("hP3k"),l=n("yDDC"),f=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(r.a)(e,[{key:"render",value:function(t){t.pickingFBO?this.drawPickingBuffer(t):Object(s.a)(Object(o.a)(e.prototype),"render",this).call(this,t)}},{key:"drawPickingBuffer",value:function(t){var e=this,n=t.layers,i=t.viewports,r=t.onViewportActive,a=t.pickingFBO,o=t.effectProps,s=t.deviceRect,u=s.x,h=s.y,l=s.width,f=s.height,d=t.redrawReason,p=void 0===d?"":d,g=this.gl;return Object(c.a)(g,{framebuffer:a,scissorTest:!0,scissor:[u,h,l,f],clearColor:[0,0,0,0]},(function(){e.drawLayers({layers:n,viewports:i,onViewportActive:r,pass:"picking",redrawReason:p,effectProps:o,parameters:{blend:!0,blendFunc:[1,0,32771,0],blendEquation:32774,blendColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]}})}))}},{key:"shouldDrawLayer",value:function(t,e){var n=this.props.layerFilter,i=!t.isComposite&&t.props.visible&&t.props.pickable;return i&&n&&(i=n({layer:t,viewport:e,isPicking:!0})),i}},{key:"getModuleParameters",value:function(t,e,n){var i=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:1,devicePixelRatio:Object(l.b)(this.gl)});return Object.assign(i,n),i}},{key:"getLayerParameters",value:function(t,e,n,i){var r=Object.assign({},t.props.parameters||{},i);return Object.assign(r,{viewport:n,blendColor:[0,0,0,(e+1)/255]}),r}}]),e}(h.a)},kGlb:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return u}));var i=n("maJC"),r=n("5a1V");function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(n,!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return!!t&&(Array.isArray(t)&&(t=t[0]),t.parseTextSync||t.parseSync||t.parse||t.loadAndParse||t.parseStream||t.parseInBatches||t.worker)}function u(t){var e;return Object(r.a)(s(t)),Array.isArray(t)&&(e=t[1],t=o({},t=t[0],{options:o({},t.options,{},e)})),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Object(r.a)(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}},kLp3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="undefined"!=typeof window&&window.addEventListener,a=new Map,o=function(){return r&&window.__SEER_INITIALIZED__},s=function(t,e){var n=a.get(t),i=Date.now();return!!(n&&i-n<e)||(a.set(t,i),!1)},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&o()){var n=new Set,a=JSON.stringify(e,function(t){return function(e,n){if(!n||"object"!==(void 0===n?"undefined":i(n))||!t.has(n))return t.add(n),Object.prototype.toString.call(n).slice(8,-1).includes("Array")?Array.prototype.slice.call(n,0,20):n}}(n));try{window.postMessage({type:t,payload:a,source:"seer-agent"},"*")}catch(t){if(s("seer-log",2e3))return}}},h=new Map,c=function(t){if(t&&t.data&&"seer-core"===t.data.source){var e=t.data,n=e.type,i=e.payload,r=h.get(n);r&&r.forEach((function(t){return t(i)}))}},l=function(){r&&!window.__SEER_LISTENER__&&(window.addEventListener("message",c),window.__SEER_LISTENER__=!0)};e.default={send:u,throttle:s,isReady:o,list:function(t,e){return u("LIST",{key:t,data:e})},listItem:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u("LIST_ITEM",{key:t,itemKey:e,data:n})},updateItem:function(t,e,n,i){return u("UPDATE_ITEM",{key:t,itemKey:e,path:n,data:i})},multiUpdate:function(t,e,n){return u("MULTI_UPDATE_ITEM",{key:t,itemKey:e,array:n})},deleteItem:function(t,e){return u("DELETE_ITEM",{key:t,itemKey:e})},addLog:function(t,e,n){return u("ADD_LOG",{key:t,itemKey:e,msg:n})},listeners:h,listenFor:function(t,e){if(r){if(!t||!e)throw new Error("Please provide a type and callback");h.has(t)||h.set(t,[]),window.__SEER_LISTENER__||l(),h.get(t).push(e)}},removeListener:function(t){h.forEach((function(e,n){h.set(n,e.filter((function(e){return e!==t})))}))},init:l,clean:function(){r&&window.__SEER_LISTENER__&&(window.removeEventListener("message",c),delete window.__SEER_LISTENER__)}}},kSne:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=1,s=1,u=function(){function t(){Object(r.a)(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return Object(a.a)(t,[{key:"addChannel",value:function(t){var e=t.delay,n=void 0===e?0:e,i=t.duration,r=void 0===i?Number.POSITIVE_INFINITY:i,a=t.rate,s=void 0===a?1:a,u=t.repeat,h=o++,c={time:0,delay:n,duration:r,rate:s,repeat:void 0===u?1:u};return this._setChannelTime(c,this.time),this.channels.set(h,c),h}},{key:"removeChannel",value:function(t){this.channels.delete(t);var e=!0,n=!1,r=void 0;try{for(var a,o=this.animations[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=Object(i.a)(a.value,2),u=s[0];s[1].channel===t&&this.detachAnimation(u)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"isFinished",value:function(t){var e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}},{key:"getTime",value:function(t){if(void 0===t)return this.time;var e=this.channels.get(t);return void 0===e?-1:e.time}},{key:"setTime",value:function(t){this.time=Math.max(0,t);var e=this.channels.values(),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this._setChannelTime(s,this.time)}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}var u=this.animations.values(),h=!0,c=!1,l=void 0;try{for(var f,d=u[Symbol.iterator]();!(h=(f=d.next()).done);h=!0){var p=f.value,g=p.animation,v=p.channel;g.setTime(this.getTime(v))}}catch(t){c=!0,l=t}finally{try{h||null==d.return||d.return()}finally{if(c)throw l}}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(t,e){var n=s++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}},{key:"detachAnimation",value:function(t){this.animations.delete(t)}},{key:"update",value:function(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}},{key:"_setChannelTime",value:function(t,e){var n=e-t.delay;n>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}]),t}()},l6PP:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var i=n("rePB"),r=n("1OyB"),a=n("md7G"),o=n("foSv"),s=n("vuIU"),u=n("Ji7U"),h=n("L8KH"),c=n("sc/6"),l=n("uYBD"),f=n("hP3k"),d=n("SUVH"),p=n("FWU8"),g=n("VdrS"),v=n("5+o2"),m=n("CxzY"),y=[9729,9728],_=function(t){function e(t,n){var i;Object(r.a)(this,e);var s=n.id,u=void 0===s?Object(g.c)("texture"):s,h=n.handle,c=n.target;return(i=Object(a.a)(this,Object(o.a)(e).call(this,t,{id:u,handle:h}))).target=c,i.textureUnit=void 0,i.loaded=!1,i.width=void 0,i.height=void 0,i.depth=void 0,i.format=void 0,i.type=void 0,i.dataFormat=void 0,i.border=void 0,i.textureUnit=void 0,i.mipmaps=void 0,i}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.format,i=e.linearFiltering,r=!0;return n&&(r=(r=r&&Object(l.d)(t,n))&&(!i||Object(l.e)(t,n))),r}}]),Object(s.a)(e,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then((function(n){return t.initialize(Object.assign({},e,{pixels:n,data:n}))})),this;var r=e.pixels,a=void 0===r?null:r,o=e.format,s=void 0===o?6408:o,u=e.border,h=void 0===u?0:u,c=e.recreate,l=void 0!==c&&c,f=e.parameters,d=void 0===f?{}:f,p=e.pixelStore,g=void 0===p?{}:p,m=e.textureUnit,y=void 0===m?void 0:m,_=e.unpackFlipY,b=void 0===_||_,w=e.mipmaps,x=void 0===w||w;n||(n=a);var O=e.width,j=e.height,k=e.dataFormat,P=e.type,C=e.depth,T=void 0===C?0:C,M=this._deduceParameters({format:s,type:P,dataFormat:k,compressed:!1,data:n,width:O,height:j});O=M.width,j=M.height,k=M.dataFormat,P=M.type,this.width=O,this.height=j,this.depth=T,this.format=s,this.type=P,this.dataFormat=k,this.border=h,this.textureUnit=y,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle));var E=Object(i.a)({},37440,b),S=Object.assign({},E,g);return x&&this._isNPOT()&&(v.a.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),x=!1,this._updateForNPOT(d)),this.mipmaps=x,this.setImageData({data:n,width:O,height:j,depth:T,format:s,type:P,dataFormat:k,border:h,mipmaps:x,parameters:S}),x&&this.generateMipmap(),this.setParameters(d),l&&(this.data=n),this}},{key:"resize",value:function(t){var e=t.height,n=t.width,i=t.mipmaps,r=void 0!==i&&i;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}},{key:"generateMipmap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(v.a.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(f.a)(this.gl,e,(function(){t.gl.generateMipmap(t.target)})),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(t){this._trackDeallocatedMemory("Texture");var e=t.target,n=void 0===e?this.target:e,i=t.pixels,r=void 0===i?null:i,a=t.level,o=void 0===a?0:a,s=t.format,u=void 0===s?this.format:s,h=t.border,c=void 0===h?this.border:h,p=t.offset,g=void 0===p?0:p,v=t.parameters,y=void 0===v?{}:v,_=t.data,b=void 0===_?null:_,w=t.type,x=void 0===w?this.type:w,O=t.width,j=void 0===O?this.width:O,k=t.height,P=void 0===k?this.height:k,C=t.dataFormat,T=void 0===C?this.dataFormat:C,M=t.compressed,E=void 0!==M&&M;b||(b=r);var S=this._deduceParameters({format:u,type:x,dataFormat:T,compressed:E,data:b,width:j,height:P});x=S.type,T=S.dataFormat,E=S.compressed,j=S.width,P=S.height;var A=this.gl;A.bindTexture(this.target,this.handle);var L,R=this._getDataType({data:b,compressed:E});if(b=R.data,L=R.dataType,Object(f.a)(this.gl,y,(function(){switch(L){case"null":A.texImage2D(n,o,u,j,P,c,T,x,b);break;case"typed-array":A.texImage2D(n,o,u,j,P,c,T,x,b,g);break;case"buffer":Object(d.a)(A),A.bindBuffer(35052,b.handle||b),A.texImage2D(n,o,u,j,P,c,T,x,g),A.bindBuffer(35052,null);break;case"browser-object":Object(d.d)(A)?A.texImage2D(n,o,u,j,P,c,T,x,b):A.texImage2D(n,o,u,T,x,b);break;case"compressed":A.compressedTexImage2D(n,o,u,j,P,c,b);break;default:Object(m.a)(!1,"Unknown image data type")}})),b&&b.byteLength)this._trackAllocatedMemory(b.byteLength,"Texture");else{var I=l.a[this.dataFormat]||4,D=l.c[this.type]||1;this._trackAllocatedMemory(this.width*this.height*I*D,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(t){var e=this,n=t.target,i=void 0===n?this.target:n,r=t.pixels,a=void 0===r?null:r,o=t.data,s=void 0===o?null:o,u=t.x,h=void 0===u?0:u,l=t.y,g=void 0===l?0:l,v=t.width,y=void 0===v?this.width:v,_=t.height,b=void 0===_?this.height:_,w=t.level,x=void 0===w?0:w,O=t.format,j=void 0===O?this.format:O,k=t.type,P=void 0===k?this.type:k,C=t.dataFormat,T=void 0===C?this.dataFormat:C,M=t.compressed,E=void 0!==M&&M,S=t.offset,A=void 0===S?0:S,L=(void 0===t.border&&this.border,t.parameters),R=void 0===L?{}:L,I=this._deduceParameters({format:j,type:P,dataFormat:T,compressed:E,data:s,width:y,height:b});if(P=I.type,T=I.dataFormat,E=I.compressed,y=I.width,b=I.height,Object(m.a)(0===this.depth,"texSubImage not supported for 3D textures"),s||(s=a),s&&s.data){var D=s;s=D.data,y=D.shape[0],b=D.shape[1]}s instanceof c.a&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Object(f.a)(this.gl,R,(function(){E?e.gl.compressedTexSubImage2D(i,x,h,g,y,b,j,s):null===s?e.gl.texSubImage2D(i,x,h,g,y,b,T,P,null):ArrayBuffer.isView(s)?e.gl.texSubImage2D(i,x,h,g,y,b,T,P,s,A):s instanceof p.b?(Object(d.a)(e.gl),e.gl.bindBuffer(35052,s),e.gl.texSubImage2D(i,x,h,g,y,b,T,P,A),e.gl.bindBuffer(35052,null)):Object(d.d)(e.gl)?e.gl.texSubImage2D(i,x,h,g,y,b,T,P,s):e.gl.texSubImage2D(i,x,h,g,T,P,s)})),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],v.a.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}},{key:"_getDataType",value:function(t){var e=t.data,n=t.compressed;return void 0!==n&&n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof c.a?{data:e.handle,dataType:"buffer"}:e instanceof p.b?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(t){var e=t.format,n=t.data,i=t.width,r=t.height,a=t.dataFormat,o=t.type,s=t.compressed,u=l.b[e];a=a||u&&u.dataFormat,o=o||u&&u.types[0],s=s||u&&u.compressed;var h=this._deduceImageSize(n,i,r);return{dataFormat:a,type:o,compressed:s,width:i=h.width,height:r=h.height,format:e,data:n}}},{key:"_deduceImageSize",value:function(t,e,n){var i;return i="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement?{width:t.width,height:t.height}:"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},Object(m.a)(i,"Could not deduced texture size"),Object(m.a)(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),Object(m.a)(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}},{key:"_setParameter",value:function(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Object(m.a)(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!(Object(d.d)(this.gl)||!this.width||!this.height||Object(g.b)(this.width)&&Object(g.b)(this.height))}},{key:"_updateForNPOT",value:function(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(t,e){if(this._isNPOT())switch(t){case 10241:-1===y.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}]),e}(h.a)},lCa4:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("kGlb"),s=n("U/rz"),u=n("+yMZ"),h=n("EJpo"),c=n("DJG6");function l(t,e,n,i){return f.apply(this,arguments)}function f(){return(f=Object(a.a)(r.a.mark((function t(e,n,i,a){var u,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Array.isArray(n)||Object(o.a)(n)||(a=i,i=n,n=null),u=Object(c.a)(n,a,null),i=Object(s.a)(i,u),l=Object(h.a)({url:a},i),t.abrupt("return",d(u,e,i,l));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(t,e,n,i){if(t.parseInBatches){var r=Object(u.c)(e);return t.parseInBatches(r,n,i,t)}throw new Error("parseWithLoaderInBatchesSync not available")}},lQOs:function(t,e,n){"use strict";n("ODXe");var i=n("rePB"),r=n("rMhL"),a=n("P0Fk"),o=n("uzDn"),s=7936,u=7937,h=7938,c=35724,l={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},f={};Object.keys(l).forEach((function(t){f[t]=t}));var d={};function p(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=l[e];if(Object(o.a)(i,e),!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(e in d)return d[e];var r=i[0],a=n.behavior||"enable",s="#extension GL_".concat(r," : ").concat(a,"\nvoid main(void) {}"),u=t.createShader(35633);t.shaderSource(u,s),t.compileShader(u);var h=t.getShaderParameter(u,35713);return t.deleteShader(u),d[e]=h,h}function g(t,e){return(e=Array.isArray(e)?e:[e]).every((function(e){return function(t,e){var n=l[e];Object(o.a)(n,e);var i=function(t){return Boolean(t&&2===t._version)}(t)&&n[1]||n[0],r="string"==typeof i?Boolean(t.getExtension(i)):i;return Object(o.a)(!1===r||!0===r),r}(t,e)}))}function v(t){switch(function(t){var e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||s),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||u);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i),vendor:n,renderer:i,version:t.getParameter(h),shadingLanguageVersion:t.getParameter(c)}}(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}var m,y,_,b=n("rpxL");n.d(e,"b",(function(){return P})),n.d(e,"a",(function(){return C}));var w="\n\n".concat(b.a,"\n\n"),x=(m={},Object(i.a)(m,r.b,"vertex"),Object(i.a)(m,r.a,"fragment"),m),O=(y={},Object(i.a)(y,r.b,{}),Object(i.a)(y,r.a,{}),y),j=(_={},Object(i.a)(_,r.b,{}),Object(i.a)(_,r.a,{}),_),k="precision highp float;\n\n";function P(t,e){var n=e.hook,i=e.injection,r=e.order,a=void 0===r?0:r,s=n.slice(0,2),u=j[s];u[t]=u[t]||{},Object(o.a)(!u[t][n],"Module injection already created"),u[t][n]={injection:i,order:a}}function C(t,e){var n=e.vs,i=e.fs,o=Object(a.c)(e.modules||[]);return{gl:t,vs:T(t,Object.assign({},e,{source:n,type:r.b,modules:o})),fs:T(t,Object.assign({},e,{source:i,type:r.a,modules:o})),getUniforms:function(t){return function(e){var n={},i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value.getUniforms(e,n);Object.assign(n,u)}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}(o),modules:function(t){var e={},n=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value,h=Object(a.a)(u);e[u]=h}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return e}(o)}}function T(t,e){var n,a,s=e.id,u=e.source,h=e.type,c=e.modules,l=e.defines,d=void 0===l?{}:l,m=e.hookFunctions,y=void 0===m?O:m,_=e.moduleInjections,P=void 0===_?j:_,C=e.inject,T=void 0===C?{}:C,M=e.prologue,E=void 0===M||M,S=e.log;Object(o.a)("string"==typeof u,"shader source must be a string"),y!==O&&(n={},Object(i.a)(n,r.b,Object.assign({},O[r.b],y[r.b])),Object(i.a)(n,r.a,Object.assign({},O[r.a],y[r.a])),y=n),P!==j&&(a={},Object(i.a)(a,r.b,Object.assign({},j[r.b],P[r.b])),Object(i.a)(a,r.a,Object.assign({},j[r.a],P[r.a])),P=a);var A=h===r.b,L=u.split("\n"),R=100,I="",D=u;0===L[0].indexOf("#version ")?(R=300,I=L[0],D=L.slice(1).join("\n")):I="#version ".concat(R);var F={};c.forEach((function(t){Object.assign(F,t.getDefines())})),Object.assign(F,d);var z=E?"".concat(I,"\n").concat(function(t){var e=t.id,n=t.type;return e&&"string"==typeof e&&-1===t.source.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(x[n],"\n\n"):""}({id:s,source:u,type:h}),"\n").concat(function(t){return"\n#define SHADER_TYPE_".concat(x[t.type].toUpperCase(),"\n")}({type:h}),"\n").concat(v(t),"\n").concat(function(t,e,n){var i="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return g(t,f.GLSL_FRAG_DEPTH)&&(i+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),g(t,f.GLSL_DERIVATIVES)&&p(t,f.GLSL_DERIVATIVES)&&(i+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),g(t,f.GLSL_FRAG_DATA)&&p(t,f.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),g(t,f.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),i}(t),"\n").concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(var i in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;var r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}return 0===e&&(n+="\n"),n}(F),"\n").concat(A?"":k,"\n"):"".concat(I,"\n"),B=!1,N={},U={};for(var V in T){var G="string"==typeof T[V]?{injection:T[V],order:0}:T[V];V.match(/^(v|f)s:/)?"#"===V[3]?U[V]=[G]:N[V]=[G]:U[V]=[G]}var H=!0,Z=!1,W=void 0;try{for(var X,q=c[Symbol.iterator]();!(H=(X=q.next()).done);H=!0){var Y=X.value;switch(Y.name){case"inject":B=!0;break;default:if(S&&Y.checkDeprecations(D,S),z+=Y.getModuleSource(h,R),P[h][Y.name]){var J=P[h][Y.name];for(var K in J)K.match(/^(v|f)s:#/)?(U[K]=U[K]||[],U[K].push(J[K])):(N[K]=N[K]||[],N[K].push(J[K]))}}}}catch(t){Z=!0,W=t}finally{try{H||null==q.return||q.return()}finally{if(Z)throw W}}return z+=w,z+=function(t,e){var n="";for(var i in t){var r=t[i];if(n+="void ".concat(r.signature," {\n"),r.header&&(n+="  ".concat(r.header)),e[i]){var a=e[i];a.sort((function(t,e){return t.order-e.order}));var o=!0,s=!1,u=void 0;try{for(var h,c=a[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;n+="  ".concat(l.injection,"\n")}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}r.footer&&(n+="  ".concat(r.footer)),n+="}\n"}return n}(y[h],N),z+=D,Object(b.c)(z,h,U,B)}},ls82:function(t,e){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",h="object"==typeof t,c=e.regeneratorRuntime;if(c)h&&(t.exports=c);else{(c=e.regeneratorRuntime=h?t.exports:{}).wrap=b;var l="suspendedStart",f="suspendedYield",d="executing",p="completed",g={},v={};v[o]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(S([])));y&&y!==i&&r.call(y,o)&&(v=y);var _=j.prototype=x.prototype=Object.create(v);O.prototype=_.constructor=j,j.constructor=O,j[u]=O.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===O||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,j):(t.__proto__=j,u in t||(t[u]="GeneratorFunction")),t.prototype=Object.create(_),t},c.awrap=function(t){return{__await:t}},k(P.prototype),P.prototype[s]=function(){return this},c.AsyncIterator=P,c.async=function(t,e,n,i){var r=new P(b(t,e,n,i));return c.isGeneratorFunction(e)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},k(_),_[u]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},c.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},c.values=S,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(M),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,r){return s.type="throw",s.arg=t,e.next=i,r&&(e.method="next",e.arg=n),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),h=r.call(o,"finallyLoc");if(u&&h){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),M(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;M(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:S(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=n),g}}}function b(t,e,n,i){var r=e&&e.prototype instanceof x?e:x,a=Object.create(r.prototype),o=new E(i||[]);return a._invoke=function(t,e,n){var i=l;return function(r,a){if(i===d)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw a;return A()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===l)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var u=w(t,e,n);if("normal"===u.type){if(i=n.done?p:f,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=p,n.method="throw",n.arg=u.arg)}}}(t,n,o),a}function w(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function x(){}function O(){}function j(){}function k(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function P(t){var e;this._invoke=function(n,i){function a(){return new Promise((function(e,a){!function e(n,i,a,o){var s=w(t[n],t,i);if("throw"!==s.type){var u=s.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?Promise.resolve(h.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(n,i,e,a)}))}return e=e?e.then(a,a):a()}}function C(t,e){var i=t.iterator[e.method];if(i===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,C(t,e),"throw"===e.method))return g;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var r=w(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,g;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,g):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=n,e.done=!0,e};return a.next=a}}return{next:A}}function A(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},mC81:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("1OyB"),r=n("vuIU"),a=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t);var r=n.id,a=void 0===r?"pass":r;this.id=a,this.gl=e,this.props={},Object.assign(this.props,n)}return Object(r.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}},{key:"cleanup",value:function(){}}]),t}()},maJC:function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}))},md7G:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("U8pU"),r=n("JX7q");function a(t,e){return!e||"object"!==Object(i.a)(e)&&"function"!=typeof e?Object(r.a)(t):e}},mybv:function(t,e,n){"use strict";var i=n("U8pU"),r=n("1OyB"),a=n("vuIU"),o=n("rMPx"),s=n("VMBB"),u=n("LDVv"),h=n("nICr"),c=n("e/LK"),l=n("Jh/b"),f=n("Zk56"),d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(a.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){for(var t in this.controllers){var e=this.controllers[t];e&&e.updateTransition()}}},{key:"getViewports",value:function(t){return t?this._viewports.filter((function(e){return e.containsPixel(t)})):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach((function(e){t[e.id]=e})),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find((function(e){return e.id===t})):t}},{key:"getViewState",value:function(t){var e=this.getView(t),n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"unproject",value:function(t,e){for(var n=this.getViewports(),i={x:t[0],y:t[1]},r=n.length-1;r>=0;--r){var a=n[r];if(a.containsPixel(i)){var o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){Object(s.a)(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=Object(f.b)(t,{filter:Boolean}).map((function(t){return t instanceof c.a?new h.a({viewportInstance:t}):t})),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!Object(u.a)(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):l.a.warn("setting null viewState")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t){return new(0,t.type)(Object.assign({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},t))}},{key:"_updateController",value:function(t,e,n,i){if(t.controller){var r=Object.assign({},t.controller,e,{id:t.id,x:n.x,y:n.y,width:n.width,height:n.height});return i?i.setProps(r):i=this._createController(r),i}return null}},{key:"_rebuildViewports",value:function(){var t=this.width,e=this.height,n=this.views,i=this.controllers;this._viewports=[],this.controllers={};for(var r=n.length;r--;){var a=n[r],o=this.getViewState(a),s=a.makeViewport({width:t,height:e,viewState:o});this.controllers[a.id]=this._updateController(a,o,s,i[a.id]),this._viewports.unshift(s)}for(var u in i)i[u]&&!this.controllers[u]&&i[u].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach((function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)}))}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some((function(n,i){return!t[i].equals(e[i])}))}}]),t}(),p=n("08OO"),g=n("8rZH"),v=new g.a,m=function(){function t(){Object(r.a)(this,t),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}return Object(a.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&Object(u.a)(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){return this._internalEffects}},{key:"finalize",value:function(){this.cleanup()}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t,this._createInternalEffects()}},{key:"cleanup",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.effects[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.cleanup()}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}var a=!0,o=!1,s=void 0;try{for(var u,h=this._internalEffects[Symbol.iterator]();!(a=(u=h.next()).done);a=!0)u.value.cleanup()}catch(t){o=!0,s=t}finally{try{a||null==h.return||h.return()}finally{if(o)throw s}}this.effects.length=0,this._internalEffects.length=0}},{key:"_createInternalEffects",value:function(){this._internalEffects=this.effects.slice(),this.effects.some((function(t){return t instanceof g.a}))||this._internalEffects.push(v)}}]),t}(),y=n("uCGa"),_=n("h9Q3"),b=n("11Ib"),w=n("yDDC"),x=n("p7wt"),O=n("iwLF"),j={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function k(t){var e=t.pickedColors,n=t.layers,i=t.deviceX,r=t.deviceY,a=t.deviceRadius,o=t.deviceRect;if(e){for(var s=o.x,u=o.y,h=o.width,c=o.height,f=a*a,d=-1,p=0,g=0;g<c;g++){var v=g+u-r,m=v*v;if(m>f)p+=4*h;else for(var y=0;y<h;y++){if(e[p+3]-1>=0){var _=y+s-i,b=_*_+m;b<=f&&(f=b,d=p)}p+=4}}if(d>=0){var w=e[d+3]-1,x=e.slice(d,d+4),O=n[w];if(O)return{pickedColor:x,pickedLayer:O,pickedObjectIndex:O.decodePickingColor(x)};l.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return j}function P(t){var e=t.pickInfo,n=t.lastPickedInfo,i=t.mode,r=t.layers,a=t.viewports,o=t.x,s=t.y,u=t.deviceX,h=t.deviceY,c=t.pixelRatio,l=e.pickedColor,f=e.pickedLayer,d=e.pickedObjectIndex,p=f?[f]:[];if("hover"===i){var g=n.index,v=n.layerId,m=f&&f.props.id;if(m!==v||d!==g){if(m!==v){var y=r.find((function(t){return t.props.id===v}));y&&p.unshift(y)}n.layerId=m,n.index=d,n.info=null}}var _=function(t){return t.viewports[0]}({viewports:a}),b=_&&_.unproject([o,s]),w={color:null,layer:null,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:b,lngLat:b,devicePixel:[u,h],pixelRatio:c},x=new Map;return x.set(null,w),p.forEach((function(t){var e=Object.assign({},w);if(t===f&&(e.color=l,e.index=d,e.picked=!0),e=C({layer:t,info:e,mode:i}),t===f&&"hover"===i&&(n.info=e),e&&x.set(e.layer.id,e),"hover"===i){var r=t.props.autoHighlight&&f===t?l:null;t.setModuleParameters({pickingSelectedColor:r}),t.setNeedsRedraw()}})),x}function C(t){for(var e=t.layer,n=t.info,i=t.mode;e&&n;){var r=n.layer||e;n.layer=e,n=e.pickLayer({info:n,mode:i,sourceLayer:r}),e=e.parent}return n}var T,M=function(){function t(e){Object(r.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new O.a(e),this.layerFilter=null,this.pickingEvent=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return Object(a.a)(t,[{key:"setProps",value:function(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),this.pickLayersPass.setProps({layerFilter:this.layerFilter})}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,i=t.mode,r=t.radius,a=void 0===r?0:r,o=t.layers,s=t.viewports,u=t.activateViewport,h=t.depth,c=void 0===h?1:h,l=t.event,f=void 0===l?null:l;this.pickingEvent=f;var d=this.pickClosestObject({x:e,y:n,radius:a,layers:o,mode:i,depth:c,viewports:s,onViewportActive:u});return this.pickingEvent=null,d}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,i=t.width,r=t.height,a=t.layers,o=t.viewports,s=t.activateViewport;return this.pickVisibleObjects({x:e,y:n,width:i,height:r,layers:a,mode:"pickObjects",viewports:o,onViewportActive:s})}},{key:"getLastPickedObject",value:function(t){var e=t.x,n=t.y,i=t.layers,r=t.viewports,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?i.find((function(t){return t.id===o})):null,u=r[0]&&r[0].unproject([e,n]),h={x:e,y:n,coordinate:u,lngLat:u,layer:s};return s?Object.assign({},a,h):Object.assign(h,{color:null,object:null,index:-1})}},{key:"updatePickingBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new b.a(t)),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"pickClosestObject",value:function(t){var e=t.layers,n=t.viewports,i=t.x,r=t.y,a=t.radius,o=t.depth,s=void 0===o?1:o,u=t.mode,h=t.onViewportActive;this.updatePickingBuffer();for(var c,l=Object(w.b)(this.gl),f=Object(w.a)(this.gl,[i,r],!0),d=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],p=Math.round(a*l),g=this.pickingFBO,v=g.width,m=g.height,y=this.getPickingRect({deviceX:d[0],deviceY:d[1],deviceRadius:p,deviceWidth:v,deviceHeight:m}),_=[],b={},x=0;x<s;x++){var O=k({pickedColors:y&&this.drawAndSamplePickingBuffer({layers:e,viewports:n,onViewportActive:h,deviceRect:y,redrawReason:u}),layers:e,deviceX:d[0],deviceY:d[1],deviceRadius:p,deviceRect:y});if(O.pickedColor&&x+1<s){var j=O.pickedColor[3]-1;b[j]=!0,e[j].clearPickingColor(O.pickedColor)}c=P({pickInfo:O,lastPickedInfo:this.lastPickedInfo,mode:u,layers:e,viewports:n,x:i,y:r,deviceX:d[0],deviceY:d[1],pixelRatio:l});var C=this.callLayerPickingCallbacks(c,u);if(C&&C.forEach((function(t){return _.push(t)})),!O.pickedColor)break}for(var T in b)e[T].restorePickingColors();return{result:_,emptyInfo:c&&c.get(null)}}},{key:"pickVisibleObjects",value:function(t){var e=t.layers,n=t.viewports,i=t.x,r=t.y,a=t.width,o=t.height,s=t.mode,u=t.onViewportActive;this.updatePickingBuffer();var h=Object(w.b)(this.gl),c=Object(w.a)(this.gl,[i,r],!0),f=c.x,d=c.y+c.height,p=Object(w.a)(this.gl,[i+a,r+o],!0),g=p.x+p.width,v=p.y,m={x:f,y:v,width:g-f,height:d-v},y=function(t){var e=t.pickedColors,n=t.layers,i=new Map;if(e)for(var r=0;r<e.length;r+=4){var a=e[r+3]-1;if(a>=0){var o=e.slice(r,r+4),s=o.join(",");if(!i.has(s)){var u=n[a];u?i.set(s,{pickedColor:o,pickedLayer:u,pickedObjectIndex:u.decodePickingColor(o)}):l.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}({pickedColors:this.drawAndSamplePickingBuffer({layers:e,viewports:n,onViewportActive:u,deviceRect:m,redrawReason:s}),layers:e}),_=new Map;return y.forEach((function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,width:a,height:o,pixelRatio:h};e=C({layer:t.pickedLayer,info:e,mode:s}),_.has(e.object)||_.set(e.object,e)})),Array.from(_.values())}},{key:"drawAndSamplePickingBuffer",value:function(t){var e=t.layers,n=t.viewports,i=t.onViewportActive,r=t.deviceRect,a=t.redrawReason;if(Object(s.a)(r),Object(s.a)(Number.isFinite(r.width)&&r.width>0,"`width` must be > 0"),Object(s.a)(Number.isFinite(r.height)&&r.height>0,"`height` must be > 0"),e.filter((function(t){return t.isPickable()})).length<1)return null;var o=this.pickingFBO;this.pickLayersPass.render({layers:e,viewports:n,onViewportActive:i,pickingFBO:o,deviceRect:r,redrawReason:a,effectProps:{lightSources:{}}});var u=r.x,h=r.y,c=r.width,l=r.height,f=new Uint8Array(c*l*4);return Object(x.b)(o,{sourceX:u,sourceY:h,sourceWidth:c,sourceHeight:l,target:f}),f}},{key:"getPickingRect",value:function(t){var e=t.deviceX,n=t.deviceY,i=t.deviceRadius,r=t.deviceWidth,a=t.deviceHeight,o=Math.max(0,e-i),s=Math.max(0,n-i),u=Math.min(r,e+i+1)-o,h=Math.min(a,n+i+1)-s;return u<=0||h<=0?null:{x:o,y:s,width:u,height:h}}},{key:"callLayerPickingCallbacks",value:function(t,e){var n=[],i=this.pickingEvent;return t.forEach((function(t){if(t.layer){var r=!1;switch(e){case"hover":r=t.layer.onHover(t,i);break;case"query":break;default:throw new Error("unknown pick type")}r||n.push(t)}})),n}}]),t}(),E={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"},S=function(){function t(e){Object(r.a)(this,t);var n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,E),n.appendChild(this.el))}return Object(a.a)(t,[{key:"setTooltip",value:function(t,e,n){var i=this.el;if("string"==typeof t)i.innerText=t;else{if(!t)return void(i.style.display="none");"text"in t&&(i.innerText=t.text),"html"in t&&(i.innerHTML=t.html),"className"in t&&(i.className=t.className),Object.assign(i.style,t.style)}i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)")}},{key:"remove",value:function(){this.el&&this.el.remove()}}]),t}(),A=n("swnp"),L=n("o0o1"),R=n.n(L),I=n("HaE+"),D=n("vpQ4"),F=n("U//q"),z=n("FWU8"),B="Failed to create WebGL context in Node.js, headless gl not available",N="Failed to create WebGL context in Node.js, headless gl returned null",U=n("IIwk"),V=U.a&&"undefined"!=typeof document,G=V&&"complete"===document.readyState;var H=n("CxzY"),Z=n("5+o2"),W=n("iTDY");var X={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function q(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e=Object.assign({},X,e),i=n.width,r=n.height;function a(t){if(e.throwOnError)throw new Error(t);return null}return(t=U.a?function(t,e){var n=e.onError,i=void 0===n?function(t){return null}:n,r=function(t){return i("WebGL context: ".concat(t.statusMessage||"error"))};t.addEventListener("webglcontextcreationerror",r,!1);var a=e.webgl1,o=void 0===a||a,s=e.webgl2,u=void 0===s||s,h=null;return u&&(h=(h=h||t.getContext("webgl2",e))||t.getContext("experimental-webgl2",e)),o&&(h=(h=h||t.getContext("webgl",e))||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),h||i("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context"))}(function(t){var e,n=t.canvas,i=t.width,r=t.height,a=t.onError,o=void 0===a?function(){}:a;return"string"==typeof n?(G||o("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)):e=n||function(t){var e=t.width,n=void 0===e?800:e,i=t.height,r=void 0===i?600:i,a=t.id,o=void 0===a?"gl-canvas":a,s=t.insert,u=void 0===s||s,h=document.createElement("canvas");if(h.id=o,h.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",h.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",u){var c=document.body;c.insertBefore(h,c.firstChild)}return h}({id:"lumagl-canvas",width:i,height:r,onError:o}),e}({canvas:e.canvas,width:i,height:r,onError:a}),e):function(t){var e=t.width,n=t.height,i=t.webgl1,r=t.webgl2,a=t.onError;return r&&!i?a("headless-gl does not support WebGL2"):z.c?Object(z.c)(e,n,t)||a(N):a(B)}(Object(D.a)({},e,{width:i,height:r,onError:a})))?(function(t){var e=function(t){return Boolean(t&&2===t._version)}(t)?"WebGL2":"WebGL1",n=function(t){var e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";Z.a.info(1,"".concat(e).concat(r," context ").concat(i))()}(t=Y(t,e)),t):null}function Y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t._instrumented)return t;t._version=t._version||function(t){return void 0!==z.a&&t instanceof z.a?2:1}(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var n=e=Object.assign({},X,e),i=n.manageState,r=n.debug;return i&&Object(F.a)(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Z.a.log.apply(Z.a,[1].concat(e))()}}),U.a&&r&&(W.a.makeDebugContext?(t=W.a.makeDebugContext(t,e),Z.a.priority=Math.max(Z.a.priority,1)):Z.a.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}var J=n("rta6"),K=n("RfdS");function Q(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var $=n("SUVH"),tt=n("t+rZ"),et=0,nt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.onCreateContext,i=void 0===n?function(t){return q(t)}:n,a=e.onAddHTML,o=void 0===a?null:a,s=e.onInitialize,u=void 0===s?function(){}:s,h=e.onRender,c=void 0===h?function(){}:h,l=e.onFinalize,f=void 0===l?function(){}:l,d=e.gl,p=void 0===d?null:d,g=e.glOptions,v=void 0===g?{}:g,m=e.debug,y=void 0!==m&&m,_=e.createFramebuffer,b=void 0!==_&&_,w=e.autoResizeViewport,x=void 0===w||w,O=e.autoResizeDrawingBuffer,j=void 0===O||O,k=e.stats,P=void 0===k?J.a.get("animation-loop-".concat(et++)):k,C=e.useDevicePixels,T=void 0===C||C;"useDevicePixelRatio"in e&&(Z.a.deprecated("useDevicePixelRatio","useDevicePixels")(),T=e.useDevicePixelRatio),this.props={onCreateContext:i,onAddHTML:o,onInitialize:u,onRender:c,onFinalize:f,gl:p,glOptions:v,debug:y,createFramebuffer:b},this.gl=p,this.needsRedraw=null,this.timeline=null,this.stats=P,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:j,useDevicePixels:T}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return Object(a.a)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(t){return Object(H.a)("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}},{key:"setProps",value:function(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._running?this:(this._running=!0,(T||(T=V?new Promise((function(t,e){if(V&&"complete"===document.readyState)return G=!0,void t(document);window.onload=function(){G=!0,t(document)}})):Promise.resolve({})),T).then((function(){return!t._running||t._initialized?null:(t._createWebGLContext(e),t._createFramebuffer(),t._startEventHandling(),t._initializeCallbackData(),t._updateCallbackData(),t._resizeCanvasDrawingBuffer(),t._resizeViewport(),t._gpuTimeQuery=K.a.isSupported(t.gl,["timers"])?new K.a(t.gl):null,t._initialized=!0,t.onInitialize(t.animationProps))})).then((function(e){t._running&&(t._addCallbackData(e||{}),!1!==e&&t._startLoop())})),this)}},{key:"redraw",value:function(){return this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),Q(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(t){return this.timeline=t,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var t=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((function(e){t._resolveNextFrame=e}))),this._nextFramePromise}},{key:"toDataURL",value:function(){var t=Object(I.a)(R.a.mark((function t(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setNeedsRedraw("toDataURL"),t.next=3,this.waitForRender();case 3:return t.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onCreateContext",value:function(){var t;return(t=this.props).onCreateContext.apply(t,arguments)}},{key:"onInitialize",value:function(){var t;return(t=this.props).onInitialize.apply(t,arguments)}},{key:"onRender",value:function(){var t;return(t=this.props).onRender.apply(t,arguments)}},{key:"onFinalize",value:function(){var t;return(t=this.props).onFinalize.apply(t,arguments)}},{key:"getHTMLControlValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=document.getElementById(t);return n?Number(n.value):e}},{key:"setViewParameters",value:function(){return Z.a.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var t=this;Q(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame((function e(){t._running&&(t.redraw(),t._animationFrameId=t._requestAnimationFrame(e))}))}},{key:"_setDisplay",value:function(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}},{key:"_requestAnimationFrame",value:function(t){this.display&&this.display.requestAnimationFrame(t)||function(t){"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}(t)}},{key:"_renderFrame",value:function(){var t;this.display?(t=this.display)._renderFrame.apply(t,arguments):this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var t=this._getSizeAndAspect(),e=t.width,n=t.height,i=t.aspect;e===this.animationProps.width&&n===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(t){"object"===Object(i.a)(t)&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}},{key:"_createWebGLContext",value:function(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Y(this.props.gl,t):this.onCreateContext(t),!Object($.c)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(tt.b)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";var e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);var n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}},{key:"_getSizeAndAspect",value:function(){var t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight,n=1,i=this.gl.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas)!function(t,e,n){var i="width"in n?n.width:t.canvas.clientWidth||t.canvas.width||1,r="height"in n?n.height:t.canvas.clientHeight||t.canvas.height||1;t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var a=t.luma.canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==r||a.devicePixelRatio!==e){var o=e,s=Math.floor(i*o),u=Math.floor(r*o);t.canvas.width=s,t.canvas.height=u,t.drawingBufferWidth===s&&t.drawingBufferHeight===u||(Z.a.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}(t,Object(w.c)(e.useDevicePixels),e);else{var n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}}(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new b.a(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var t=this.gl.canvas;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}},{key:"_onMouseleave",value:function(t){this.animationProps._mousePosition=null}}]),t}(),it=n("Wiem"),rt=n("kSne"),at=n("JOTL"),ot=n("ODXe"),st=n("yLV6"),ut=n.n(st),ht={mousedown:1,mousemove:2,mouseup:4};!function(t){var e=t.prototype.handler;t.prototype.handler=function(t){var n=this.store;t.button>0&&(function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(n,(function(e){return e.pointerId===t.pointerId}))||n.push(t)),e.call(this,t)}}(ut.a.PointerEventInput),function(t){t.prototype.handler=function(t){var e=ht[t.type];1&e&&t.button>=0&&(this.pressed=!0),2&e&&0===t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}(ut.a.MouseInput);var ct=ut.a.Manager,lt=ut.a,ft=lt?[[lt.Rotate,{enable:!1}],[lt.Pinch,{enable:!1}],[lt.Swipe,{enable:!1}],[lt.Pan,{threshold:0,enable:!1}],[lt.Press,{enable:!1}],[lt.Tap,{event:"doubletap",taps:2,enable:!1}],[lt.Tap,{event:"anytap",enable:!1}],[lt.Tap,{enable:!1}]]:null,dt={rotate:["pinch"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},pt={doubletap:["tap"]},gt={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},vt={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},mt={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},yt=n("Vame"),_t=-1!==yt.b.indexOf("firefox"),bt=["wheel","mousewheel","DOMMouseScroll"],wt=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},a),this.events=bt.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent,!!yt.a&&{passive:!1})}))}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;yt.c.WheelEvent&&(_t&&t.deltaMode===yt.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=yt.c.devicePixelRatio),t.deltaMode===yt.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var n={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,n)}}},{key:"_onWheel",value:function(t,e,n){this.callback({type:"wheel",center:n,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),xt=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],Ot=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},a),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=xt.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent)}))}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),jt=["keydown","keyup"],kt=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},a),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=jt.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent)}))}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),Pt=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(a.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),Ct={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},Tt=function(){function t(e){Object(r.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(a.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.handlers,a=this.handlersByElement;a.has(n)||a.set(n,[]);var o={type:t,handler:e,srcElement:n,once:i};r.push(o),a.get(n).push(o)}},{key:"remove",value:function(t,e){for(var n=this.handlers,i=this.handlersByElement,r=n.length-1;r>=0;r--){var a=n[r];if(a.type===t&&a.handler===e){n.splice(r,1);var o=i.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&i.delete(a.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),n=t.srcEvent.target;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var n=this.handlersByElement.get(e);if(n){for(var i=!1,r=function(){t.handled=!0},a=function(){t.handled=!0,i=!0},o=[],s=0;s<n.length;s++){var u=n[s],h=u.type,c=u.handler,l=u.once;if(c(Object.assign({},t,{type:h,stopPropagation:r,stopImmediatePropagation:a})),l&&o.push(n[s]),i)break}for(var f=0;f<o.length;f++){var d=o[f];h=d.type,c=d.handler,this.remove(h,c)}}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=Ct[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,i=n.buttons,r=n.button,a=n.which,o=!1,s=!1,u=!1;return 4===e||2===e&&!Number.isFinite(i)?(o=1===a,s=2===a,u=3===a):2===e?(o=Boolean(1&i),s=Boolean(4&i),u=Boolean(2&i)):1===e&&(o=0===r,s=1===r,u=2===r),{leftButton:o,middleButton:s,rightButton:u}}(t),function(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var i=t.center||{x:n.clientX,y:n.clientY},r=e.getBoundingClientRect(),a=r.width/e.offsetWidth,o=r.height/e.offsetHeight;return{center:i,offsetCenter:{x:(i.x-r.left-e.clientLeft)/a,y:(i.y-r.top-e.clientTop)/o}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),Mt={events:null,recognizers:null,recognizerOptions:{},Manager:ct,touchAction:"none"},Et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,t),this.options=Object.assign({},Mt,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var i=n.events;i&&this.on(i)}return Object(a.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var n=this.options,i=n.Manager;for(var r in this.manager=new i(t,{touchAction:n.touchAction,recognizers:n.recognizers||ft}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(dt).forEach((function(t){var n=e.manager.get(t);n&&dt[t].forEach((function(t){n.recognizeWith(t)}))})),n.recognizerOptions){var a=this.manager.get(r);if(a){var o=n.recognizerOptions[r];delete o.enable,a.set(o)}}this.wheelInput=new wt(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Ot(t,this._onOtherEvent,{enable:!1}),this.keyInput=new kt(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new Pt(t,this._onOtherEvent,{enable:!1});var s=!0,u=!1,h=void 0;try{for(var c,l=this.events[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){var f=Object(ot.a)(c.value,2),d=f[0],p=f[1];p.isEmpty()||(this._toggleRecognizer(p.recognizerName,!0),this.manager.on(d,p.handleEvent))}}catch(t){u=!0,h=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw h}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,n){this._addEventHandler(t,e,n,!1)}},{key:"once",value:function(t,e,n){this._addEventHandler(t,e,n,!0)}},{key:"off",value:function(t,e){this._removeEventHandler(t,e)}},{key:"_toggleRecognizer",value:function(t,e){var n=this.manager;if(n){var i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});var r=pt[t];r&&!this.options.recognizers&&r.forEach((function(r){var a=n.get(r);e?(a.requireFailure(t),i.dropRequireFailure(r)):a.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,n,i){if("string"==typeof t){var r=this.manager,a=this.events,o=mt[t]||t,s=a.get(o);s||(s=new Tt(this),a.set(o,s),s.recognizerName=vt[o]||o,r&&r.on(o,s.handleEvent)),this._toggleRecognizer(s.recognizerName,!0),s.add(t,e,n,i)}else for(var u in n=e,t)this._addEventHandler(u,t[u],n,i)}},{key:"_removeEventHandler",value:function(t,e){if("string"==typeof t){var n=this.events,i=mt[t]||t,r=n.get(i);if(r&&(r.remove(t,e),r.isEmpty())){var a=r.recognizerName,o=!1,s=!0,u=!1,h=void 0;try{for(var c,l=n.values()[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){var f=c.value;if(f.recognizerName===a&&!f.isEmpty()){o=!0;break}}}catch(t){u=!0,h=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw h}}o||this._toggleRecognizer(a,!1)}}else for(var d in t)this._removeEventHandler(d,t[d])}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,n=gt[e.type];n&&this.manager.emit(n,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}(),St=n("V3d6");function At(){}n.d(e,"a",(function(){return Rt}));var Lt={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",_animate:!1,onWebGLInitialized:At,onResize:At,onViewStateChange:At,onBeforeRender:At,onAfterRender:At,onLoad:At,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},Rt=function(){function t(e){Object(r.a)(this,t),e=Object.assign({},Lt,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),void 0!==("undefined"==typeof window?"undefined":Object(i.a)(window))&&-1!==((window.navigator||{}).userAgent||"").indexOf("Trident/")&&l.a.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new at.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),this.animationLoop.start()}return Object(a.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.effectManager&&(this.effectManager.finalize(),this.effectManager=null),this.deckRenderer&&(this.deckRenderer.finalize(),this.deckRenderer=null),this.eventManager&&this.eventManager.destroy(),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&l.a.removed("onLayerHover","onHover")(),"onLayerClick"in t&&l.a.removed("onLayerClick","onClick")(),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{views:this._getViews(this.props),width:this.width,height:this.height}),n=this._getViewState(t);n&&(e.viewState=n),this.viewManager&&this.viewManager.setProps(e),this.layerManager&&this.layerManager.setProps(e),this.effectManager&&this.effectManager.setProps(e),this.animationLoop&&this.animationLoop.setProps(e),this.deckRenderer&&this.deckRenderer.setProps(e),this.deckPicker&&this.deckPicker.setProps(e),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e||n||i||r||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObject Time").timeStart();var s=this.layerManager.getLayers({layerIds:o}),u=this.layerManager.activateViewport,h=this.deckPicker.pickObject({x:e,y:n,radius:r,layers:s,viewports:this.getViewports({x:e,y:n}),activateViewport:u,mode:"query",depth:1}).result;return this.stats.get("pickObject Time").timeEnd(),h.length?h[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a,s=t.depth,u=void 0===s?10:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickMultipleObjects Time").timeStart();var h=this.layerManager.getLayers({layerIds:o}),c=this.layerManager.activateViewport,l=this.deckPicker.pickObject({x:e,y:n,radius:r,layers:h,viewports:this.getViewports({x:e,y:n}),activateViewport:c,mode:"query",depth:u}).result;return this.stats.get("pickMultipleObjects Time").timeEnd(),l}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,i=t.width,r=void 0===i?1:i,a=t.height,o=void 0===a?1:a,s=t.layerIds,u=void 0===s?null:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObjects Time").timeStart();var h=this.layerManager.getLayers({layerIds:u}),c=this.layerManager.activateViewport,l=this.deckPicker.pickObjects({x:e,y:n,width:r,height:o,layers:h,viewports:this.getViewports({x:e,y:n,width:r,height:o}),activateViewport:c});return this.stats.get("pickObjects Time").timeEnd(),l}},{key:"_createCanvas",value:function(t){var e=t.canvas;"string"==typeof e&&(e=document.getElementById(e),Object(s.a)(e)),e||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var n=t.id,i=t.style;return e.id=n,Object.assign(e.style,i),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,n=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,n=t.clientHeight||t.height;return(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,n=t.width,i=t.height,r=t.gl,a=t.glOptions,o=t.debug,s=t.useDevicePixels,u=t.autoResizeDrawingBuffer;return new nt({width:n,height:i,useDevicePixels:s,autoResizeDrawingBuffer:u,gl:r,onCreateContext:function(t){return q(Object.assign({},a,t,{canvas:e.canvas,debug:o}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return t.viewState||this.viewState}},{key:"_getViews",value:function(t){var e=t.views||[new p.a({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&t.controller&&(e[0].props.controller=t.controller),e}},{key:"_onPointerMove",value:function(t){var e=this._pickRequest;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;var n=t.offsetCenter;if(!n)return;e.x=n.x,e.y=n.y,e.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.callback=this.props.onHover,e.event=t,e.mode="hover"}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.mode){var e=this.deckPicker.pickObject(Object.assign({layers:this.layerManager.getLayers(),viewports:this.getViewports(t),activateViewport:this.layerManager.activateViewport,depth:1},t)),n=e.result,i=e.emptyInfo,r=(t.callback||this.props.getTooltip)&&(n.find((function(t){return t.index>=0}))||i);if(this.props.getTooltip){var a=this.props.getTooltip(r);this.tooltip.setTooltip(a,r.x,r.y)}t.callback&&t.callback(r,t.event),t.mode=null}}},{key:"_updateCursor",value:function(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_setGLContext",value:function(t){if(!this.layerManager){this.canvas||(this.canvas=t.canvas,Object(F.a)(t,{enable:!0,copyState:!0})),this.tooltip=new S(this.canvas),Object(it.a)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);var e=new rt.a;for(var n in e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Et(t.canvas,{touchAction:this.props.touchAction,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),St.b)this.eventManager.on(n,this._onEvent);this.viewManager=new d({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),Object(s.a)(this.viewManager);var i=this.viewManager.getViewports()[0];this.layerManager=new o.a(t,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new m,this.deckRenderer=new _.a(t),this.deckPicker=new M(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var n=this.layerManager.context.gl;Object(it.a)(n,this.props.parameters),this.props.onBeforeRender({gl:n});var i=this.layerManager.getLayers(),r=this.layerManager.activateViewport;this.deckRenderer.renderLayers(Object.assign({layers:i,viewports:this.viewManager.getViewports(),activateViewport:r,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:n})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),l.a.table(3,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState[t.viewId]=e,this.viewManager.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,n=void 0!==e&&e;n!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=n)}},{key:"_onEvent",value:function(t){var e=St.b[t.type],n=t.offsetCenter;if(e&&n){var i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),a=r.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],u=!1;o&&(u=o.call(a,r,t)),!u&&s&&s(r,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y,radius:this.props.pickingRadius})}},{key:"_getFrameStats",value:function(){var t=this.stats;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();var e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var t=this.metrics,e=this.stats;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();var n=J.a.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}]),t}();Rt.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(y.a)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,debug:t.bool,drawPickingColors:t.bool,_animate:t.bool}},Rt.defaultProps=Lt,Rt.VERSION=A.a.VERSION},"n+fv":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"g",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return u})),n.d(e,"d",(function(){return h})),n.d(e,"c",(function(){return c})),n.d(e,"o",(function(){return l})),n.d(e,"n",(function(){return f})),n.d(e,"p",(function(){return d})),n.d(e,"j",(function(){return p})),n.d(e,"k",(function(){return g})),n.d(e,"l",(function(){return v})),n.d(e,"a",(function(){return m})),n.d(e,"m",(function(){return y})),n.d(e,"f",(function(){return _}));var i=n("yU0y");function r(){var t=new i.a(3);return i.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function a(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function o(t,e,n){var r=new i.a(3);return r[0]=t,r[1]=e,r[2]=n,r}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function u(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function h(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function c(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=r*u-a*s,t[1]=a*o-i*u,t[2]=i*s-r*o,t}function l(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,t}function f(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t}function d(t,e,n){var i=n[0],r=n[1],a=n[2],o=n[3],s=e[0],u=e[1],h=e[2],c=r*h-a*u,l=a*s-i*h,f=i*u-r*s,d=r*f-a*l,p=a*c-i*f,g=i*l-r*c,v=2*o;return c*=v,l*=v,f*=v,d*=2,p*=2,g*=2,t[0]=s+c+d,t[1]=u+l+p,t[2]=h+f+g,t}function p(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function g(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function v(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function m(t,e){var n=o(t[0],t[1],t[2]),i=o(e[0],e[1],e[2]);u(n,n),u(i,i);var r=h(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}var y=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},_=a;r()},n4Ve:function(t,e,n){"use strict";var i,r=n("1OyB"),a=n("md7G"),o=n("foSv"),s=n("JX7q"),u=n("vuIU"),h=n("Ji7U"),c=n("L8KH"),l=n("rePB"),f="EXT_color_buffer_float",d=(i={},Object(l.a)(i,33189,{bpp:2}),Object(l.a)(i,33190,{gl2:!0,bpp:3}),Object(l.a)(i,36012,{gl2:!0,bpp:4}),Object(l.a)(i,36168,{bpp:1}),Object(l.a)(i,34041,{bpp:4}),Object(l.a)(i,35056,{gl2:!0,bpp:4}),Object(l.a)(i,36013,{gl2:!0,bpp:5}),Object(l.a)(i,32854,{bpp:2}),Object(l.a)(i,36194,{bpp:2}),Object(l.a)(i,32855,{bpp:2}),Object(l.a)(i,33321,{gl2:!0,bpp:1}),Object(l.a)(i,33330,{gl2:!0,bpp:1}),Object(l.a)(i,33329,{gl2:!0,bpp:1}),Object(l.a)(i,33332,{gl2:!0,bpp:2}),Object(l.a)(i,33331,{gl2:!0,bpp:2}),Object(l.a)(i,33334,{gl2:!0,bpp:4}),Object(l.a)(i,33333,{gl2:!0,bpp:4}),Object(l.a)(i,33323,{gl2:!0,bpp:2}),Object(l.a)(i,33336,{gl2:!0,bpp:2}),Object(l.a)(i,33335,{gl2:!0,bpp:2}),Object(l.a)(i,33338,{gl2:!0,bpp:4}),Object(l.a)(i,33337,{gl2:!0,bpp:4}),Object(l.a)(i,33340,{gl2:!0,bpp:8}),Object(l.a)(i,33339,{gl2:!0,bpp:8}),Object(l.a)(i,32849,{gl2:!0,bpp:3}),Object(l.a)(i,32856,{gl2:!0,bpp:4}),Object(l.a)(i,32857,{gl2:!0,bpp:4}),Object(l.a)(i,36220,{gl2:!0,bpp:4}),Object(l.a)(i,36238,{gl2:!0,bpp:4}),Object(l.a)(i,36975,{gl2:!0,bpp:4}),Object(l.a)(i,36214,{gl2:!0,bpp:8}),Object(l.a)(i,36232,{gl2:!0,bpp:8}),Object(l.a)(i,36226,{gl2:!0,bpp:16}),Object(l.a)(i,36208,{gl2:!0,bpp:16}),Object(l.a)(i,33325,{gl2:f,bpp:2}),Object(l.a)(i,33327,{gl2:f,bpp:4}),Object(l.a)(i,34842,{gl2:f,bpp:8}),Object(l.a)(i,33326,{gl2:f,bpp:4}),Object(l.a)(i,33328,{gl2:f,bpp:8}),Object(l.a)(i,34836,{gl2:f,bpp:16}),Object(l.a)(i,35898,{gl2:f,bpp:4}),i),p=n("SUVH"),g=n("CxzY");n.d(e,"a",(function(){return v}));var v=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(r.a)(this,e),(n=Object(a.a)(this,Object(o.a)(e).call(this,t,i))).initialize(i),Object.seal(Object(s.a)(n)),n}return Object(h.a)(e,t),Object(u.a)(e,null,[{key:"isSupported",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).format;return!e||function(t,e,n){var i=n[e];if(!i)return!1;var r=Object(p.d)(t)&&i.gl2||i.gl1;return"string"==typeof r?t.getExtension(r):r}(t,e,d)}},{key:"getSamplesForFormat",value:function(t,e){var n=e.format;return t.getInternalformatParameter(36161,n,32937)}}]),Object(u.a)(e,[{key:"initialize",value:function(t){var e=t.format,n=t.width,i=void 0===n?1:n,r=t.height,a=void 0===r?1:r,o=t.samples,s=void 0===o?0:o;return Object(g.a)(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&Object(p.d)(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,i,a):this.gl.renderbufferStorage(36161,e,i,a),this.format=e,this.width=i,this.height=a,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*d[this.format].bpp),this}},{key:"resize",value:function(t){var e=t.width,n=t.height;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(t){this.gl.bindRenderbuffer(36161,t)}},{key:"_syncHandle",value:function(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}]),e}(c.a)},n6ox:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("1OyB"),r=n("vuIU");function a(){}var o={onStart:a,onUpdate:a,onInterrupt:a,onEnd:a},s=function(){function t(e){Object(i.a)(this,t),this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}return Object(r.a)(t,[{key:"start",value:function(t){this.cancel(),this.settings=Object.assign({},o,t),this._inProgress=!0;var e=this.timeline,n=this.settings;this._handle=e.addChannel({delay:e.getTime(),duration:n.duration}),n.onStart(this)}},{key:"end",value:function(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}},{key:"cancel",value:function(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}},{key:"update",value:function(){return!!this._inProgress&&(this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0)}},{key:"_onUpdate",value:function(){}},{key:"inProgress",get:function(){return this._inProgress}}]),t}()},nICr:function(t,e,n){"use strict";var i=n("U8pU"),r=n("1OyB"),a=n("vuIU"),o=n("e/LK"),s=/([0-9]+\.?[0-9]*)(%|px)/;function u(t){switch(Object(i.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(s);if(e&&e.length>=3){var n="%"===e[2],r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function h(t,e){return t.relative?Math.round(t.position*e):t.position}var c=n("LDVv"),l=n("VMBB");n.d(e,"a",(function(){return f}));var f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.id,i=void 0===n?null:n,a=e.x,s=void 0===a?0:a,u=e.y,h=void 0===u?0:u,c=e.width,f=void 0===c?"100%":c,d=e.height,p=void 0===d?"100%":d,g=e.projectionMatrix,v=void 0===g?null:g,m=e.fovy,y=void 0===m?50:m,_=e.near,b=void 0===_?.1:_,w=e.far,x=void 0===w?1e3:w,O=e.modelMatrix,j=void 0===O?null:O,k=e.viewportInstance,P=void 0===k?null:k,C=e.type,T=void 0===C?o.a:C;Object(l.a)(!P||P instanceof o.a),this.viewportInstance=P,this.id=i||this.constructor.displayName||"view",this.type=T,this.props=Object.assign({},e,{id:this.id,projectionMatrix:v,fovy:y,near:b,far:x,modelMatrix:j}),this._parseDimensions({x:s,y:h,width:f,height:p}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(a.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):Object(c.a)(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,n=t.height,i=t.viewState;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);var r=this.getDimensions({width:e,height:n}),a=Object.assign({viewState:i},i,this.props,r);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(i.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(i.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var n in this.props.viewState)"id"!==n&&(e[n]=this.props.viewState[n]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,n=t.height;return{x:h(this._x,e),y:h(this._y,n),width:h(this._width,e),height:h(this._height,n)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,n=t.y,i=t.width,r=t.height;this._x=u(e),this._y=u(n),this._width=u(i),this._height=u(r)}}]),t}()},nIko:function(t,e,n){"use strict";var i=n("P0Fk"),r=n("1kz3"),a=n("pE0Q"),o=n("QPTa"),s="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",u={name:"gouraud-lighting",dependencies:[o.a],vs:s,defines:{LIGHTING_VERTEX:1},getUniforms:l},h={name:"phong-lighting",dependencies:[o.a],fs:s,defines:{LIGHTING_FRAGMENT:1},getUniforms:l},c={};function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;if(!("material"in t))return{};var e=t.material;return e?function(t){var e={};return e.lighting_uAmbient=t.ambient,e.lighting_uDiffuse=t.diffuse,e.lighting_uShininess=t.shininess,e.lighting_uSpecularColor=t.specularColor.map((function(t){return t/255})),e}(e):{lighting_uEnabled:!1}}var f={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1},d={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n\n  if (selected) {\n    vec4 highLightColor = picking_uHighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,e={};if(void 0!==t.pickingSelectedColor)if(null===t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{var n=[t.pickingSelectedColor[0],t.pickingSelectedColor[1],t.pickingSelectedColor[2]];e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}return void 0!==t.pickingHighlightColor&&(e.picking_uHighlightColor=t.pickingHighlightColor),void 0!==t.pickingThreshold&&(e.picking_uThreshold=t.pickingThreshold),void 0!==t.pickingActive&&(e.picking_uActive=t.pickingActive?1:0),e}},p=n("hJkN"),g={name:"project32",dependencies:[p.a],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, commonPosition);\n}\n"};n.d(e,"b",(function(){return _})),n.d(e,"a",(function(){return b}));var v=[{name:"geometry",vs:"\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n} geometry;\n",fs:"\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n"},p.a],m=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],y={picking:[{hook:"fs:DECKGL_FILTER_COLOR",order:99,injection:"\n    // use highlight color if this fragment belongs to the selected object.\n    color = picking_filterHighlightColor(color);\n\n    // use picking color if rendering to picking FBO.\n    color = picking_filterPickingColor(color);\n  "}]};function _(){Object(i.b)([a.a,p.a,g,u,h,d])}function b(t){var e=r.a.getDefaultProgramManager(t),n=!0,i=!1,a=void 0;try{for(var o,s=v[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;e.addDefaultModule(u)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}var h=!0,c=!1,l=void 0;try{for(var f,d=m[Symbol.iterator]();!(h=(f=d.next()).done);h=!0){var p=f.value;e.addShaderHook(p)}}catch(t){c=!0,l=t}finally{try{h||null==d.return||d.return()}finally{if(c)throw l}}for(var g in y){var _=!0,b=!1,w=void 0;try{for(var x,O=y[g][Symbol.iterator]();!(_=(x=O.next()).done);_=!0){var j=x.value;e.addModuleInjection(g,j)}}catch(t){b=!0,w=t}finally{try{_||null==O.return||O.return()}finally{if(b)throw w}}}return e}},nwRP:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var i=n("VcEp"),r=n.n(i),a=n("ftUl"),o=n("4TbO"),s=n("4oKg"),u=n("5a1V"),h=function(){function t(e){Object(o.a)(this,t),this._fileOrBlob=e,this.bodyUsed=!1}return Object(s.a)(t,[{key:"url",value:function(){return this._fileOrBlob.name||""}},{key:"arrayBuffer",value:function(){var t=Object(a.a)(r.a.mark((function t(){var e,n,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),n=e.reader,i=e.promise,n.readAsArrayBuffer(this._fileOrBlob),t.abrupt("return",i);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"text",value:function(){var t=Object(a.a)(r.a.mark((function t(){var e,n,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),n=e.reader,i=e.promise,n.readAsText(this._fileOrBlob),t.abrupt("return",i);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"json",value:function(){var t=Object(a.a)(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.text();case 2:return e=t.sent,t.abrupt("return",JSON.parse(e));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"_getFileReader",value:function(){var t;Object(u.a)(!this.bodyUsed),this.bodyUsed=!0;var e=new Promise((function(e,n){try{(t=new FileReader).onerror=function(t){return n(new Error(t))},t.onabort=function(){return n(new Error("Read aborted."))},t.onload=function(){return e(t.result)}}catch(t){n(t)}}));return{reader:t,promise:e}}},{key:"headers",get:function(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}},{key:"ok",get:function(){return!0}},{key:"status",get:function(){return 200}}]),t}();function c(t,e){return Promise.resolve(new h(t,e))}},nwSC:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("ODXe"),o=n("rePB"),s=n("md7G"),u=n("JX7q"),h=n("foSv"),c=n("ReuC"),l=n("Ji7U"),f=n("sc/6"),d=n("VMBB"),p=n("rpwb"),g=n("Zk56"),v=[],m=[[0,1/0]],y=n("Jh/b"),_=n("Wxfb"),b=n("b0ih"),w=n("F8bt"),x=n("L9Dj");function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var j={isExternalBuffer:!1,lastExternalBuffer:null,allocatedValue:null,needsUpdate:!0,needsRedraw:!1,updateRanges:m},k=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e);var a=r.type,c=5130===a;n=Object(s.a)(this,Object(h.a)(e).call(this,t,c?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(n,!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},r,{type:5126}):r));var l=r.transition,f=void 0!==l&&l,d=r.noAlloc,p=void 0!==d&&d,g=r.update,v=void 0===g?null:g,m=r.accessor,y=void 0===m?null:m,b=r.transform,w=void 0===b?null:b,x=r.bufferLayout,k=void 0===x?null:x,P=r.defaultValue,C=void 0===P?[0,0,0,0]:P;C=Array.isArray(C)?C:[C],n.defaultType=a||n.type||5126,n.shaderAttributes={},n.hasShaderAttributes=!1,n.doublePrecision=c,c&&!1===r.fp64&&(n.defaultType=5126);var T=r.shaderAttributes||c&&Object(o.a)({},n.id,{});if(T){var M=Object.keys(T);for(var E in T=c?function(t,e){var n={};for(var i in e){var r=e[i],a="offset"in r?r.offset:t.offset,o="stride"in r?r.stride:4*t.size;n["".concat(i,"32")]=Object.assign({},r,{offset:a,stride:o}),n["".concat(i,"64")]=Object.assign({},r,{offset:2*a,stride:2*o}),n["".concat(i,"64xyLow")]=Object.assign({},r,{offset:2*a+o,stride:2*o})}return n}(Object(u.a)(n),T):T){var S=T[E];n.shaderAttributes[E]=new _.a(n.gl,Object.assign({size:n.size,normalized:n.normalized,integer:n.integer,offset:n.offset,stride:n.stride,divisor:n.divisor},S,{id:E,buffer:n.getBuffer()})),n.hasShaderAttributes=M}}return Object.assign(n.userData,j,r,{transition:f,noAlloc:p,update:v||y&&n._standardAccessor,accessor:y,transform:w,defaultValue:C,bufferLayout:k}),Object.seal(n.userData),n._validateAttributeUpdaters(),n}return Object(l.a)(e,t),Object(r.a)(e,[{key:"delete",value:function(){Object(c.a)(Object(h.a)(e.prototype),"delete",this).call(this),b.a.release(this.userData.allocatedValue)}},{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=void 0!==t&&t,n=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,n}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat("function"!=typeof t&&t||[])}},{key:"getAccessor",value:function(){return this.userData.accessor}},{key:"getShaderAttributes",value:function(){var t={};if(this.doublePrecision){var e=this.value instanceof Float64Array,n=!0,i=!1,r=void 0;try{for(var a,o=this.hasShaderAttributes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t[s]=this.shaderAttributes["".concat(s,e?"64":"32")];var u="".concat(s,"64xyLow");t[u]=e?this.shaderAttributes[u]:new Float32Array(this.size)}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}else this.hasShaderAttributes?Object.assign(t,this.shaderAttributes):t[this.id]=this;return t}},{key:"supportsTransition",value:function(){return Boolean(this.userData.transition)}},{key:"getTransitionSetting",value:function(t){var e=this.userData.accessor,n=this.userData.transition;if(!this.supportsTransition())return null;var i=Array.isArray(e)?t[e.find((function(e){return t[e]}))]:t[e];return Object(x.e)(i,n)}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.userData.needsUpdate=this.userData.needsUpdate||t,e){var n=e.startRow,i=void 0===n?0:n,r=e.endRow,a=void 0===r?1/0:r;this.userData.updateRanges=function(t,e){if(t===m)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;for(var n=[],i=t.length,r=0,a=0;a<i;a++){var o=t[a];o[1]<e[0]?(n.push(o),r=a+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}(this.userData.updateRanges,[i,a])}else this.userData.updateRanges=m}},{key:"clearNeedsUpdate",value:function(){this.userData.needsUpdate=!1,this.userData.updateRanges=v}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"allocate",value:function(t){var e=this.userData;if(e.isExternalBuffer||e.noAlloc)return!1;if(e.update){Object(d.a)(Number.isFinite(t));var n=Math.max(t,1),i=P(this.defaultType),r=e.allocatedValue,a=e.updateRanges!==m;return this.constant=!1,this.value=b.a.allocate(r,n,{size:this.size,type:i,padding:this.elementOffset,copy:a}),this.buffer&&this.buffer.byteLength<this.value.byteLength&&(this.buffer.reallocate(this.value.byteLength),a&&r&&this.buffer.subData(r)),e.allocatedValue=this.value,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,n=t.bufferLayout,i=t.data,r=t.props,o=t.context;if(!this.needsUpdate())return!1;var s=this.userData,u=s.update,h=s.updateRanges,c=s.noAlloc,l=!0;if(u){var f=!0,d=!1,p=void 0;try{for(var g,v=h[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var m=Object(a.a)(g.value,2),y=m[0],_=m[1];u.call(o,this,{data:i,startRow:y,endRow:_,props:r,numInstances:e,bufferLayout:n})}}catch(t){d=!0,p=t}finally{try{f||null==v.return||v.return()}finally{if(d)throw p}}var b=this.doublePrecision&&this.value instanceof Float64Array;if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength){var x=this.value;this.update({value:b?Object(w.e)(x,this):x,constant:this.constant}),this.value=x}else{var O=!0,j=!1,k=void 0;try{for(var P,C=h[Symbol.iterator]();!(O=(P=C.next()).done);O=!0){var T=Object(a.a)(P.value,2),M=(y=T[0],_=T[1],Number.isFinite(y)?this.getVertexOffset(y):0),E=Number.isFinite(_)?this.getVertexOffset(_):c||!Number.isFinite(e)?this.value.length:e*this.size;this.buffer.subData({data:b?Object(w.e)(this.value,{size:this.size,startIndex:M,endIndex:E}):this.value.subarray(M,E),offset:M*this.value.BYTES_PER_ELEMENT})}}catch(t){j=!0,k=t}finally{try{O||null==C.return||C.return()}finally{if(j)throw k}}}this._checkAttributeArray()}else l=!1;return this._updateShaderAttributes(),this.clearNeedsUpdate(),s.needsRedraw=!0,l}},{key:"update",value:function(t){Object(c.a)(Object(h.a)(e.prototype),"update",this).call(this,t),this._updateShaderAttributes()}},{key:"setConstantValue",value:function(t){var e=this.userData;if(void 0===t||"function"==typeof t)return e.isExternalBuffer=!1,!1;t=this._normalizeValue(t);var n=!this.constant||!this._areValuesEqual(t,this.value);return n&&this.update({constant:!0,value:t}),e.needsRedraw=e.needsUpdate||n,this.clearNeedsUpdate(),e.isExternalBuffer=!0,!0}},{key:"setExternalBuffer",value:function(t){var e,n=this.userData;return t?(this.clearNeedsUpdate(),n.lastExternalBuffer===t||(n.isExternalBuffer=!0,n.lastExternalBuffer=t,e=ArrayBuffer.isView(t)?{constant:!1,value:t}:t instanceof f.a?{constant:!1,buffer:t}:Object.assign({constant:!1},t),this._checkExternalBuffer(e),this.doublePrecision&&e.value instanceof Float64Array&&(e.originalValue=e.value,e.value=Object(w.e)(e.value,this)),this.update(e),n.needsRedraw=!0,e.originalValue&&(this.value=e.originalValue),!0)):(n.isExternalBuffer=!1,n.lastExternalBuffer=null,!1)}},{key:"_checkExternalBuffer",value:function(t){var e=t.value;if(!t.constant&&e){var n=P(this.defaultType),i=!1;if(this.doublePrecision?i=e.BYTES_PER_ELEMENT<4:this.hasShaderAttributes&&(i=e.BYTES_PER_ELEMENT!==n.BYTES_PER_ELEMENT&&Object.values(this.shaderAttributes).some((function(t){return t.offset||t.stride}))),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.normalized||"normalized"in t||y.a.warn("Attribute ".concat(this.id," is normalized"))()}}},{key:"getVertexOffset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.bufferLayout,n=this.elementOffset;if(e){var i=0,r=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;if(i>=t)break;n+=h*this.size,i++}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}return n+t*this.size}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.userData.defaultValue;if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return e[n]=Number.isFinite(t)?t:i[0],e;switch(this.size){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0]}return e}},{key:"_areValuesEqual",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}},{key:"_standardAccessor",value:function(t,e){var n=e.data,i=e.startRow,r=e.endRow,a=e.props,o=(e.numInstances,e.bufferLayout),s=t.userData,u=s.accessor,h=s.transform,c=t.value,l=t.size,f="function"==typeof u?u:a[u];Object(d.a)("function"==typeof f,'accessor "'.concat(u,'" is not a function'));var v=t.getVertexOffset(i,o),m=Object(p.a)(n,i,r),y=m.iterable,_=m.objectInfo,b=!0,w=!1,x=void 0;try{for(var O,j=y[Symbol.iterator]();!(b=(O=j.next()).done);b=!0){var k=O.value;_.index++;var P=f(k,_);if(h&&(P=h.call(this,P)),o){t._normalizeValue(P,_.target);var C=o[_.index];Object(g.a)({target:t.value,source:_.target,start:v,count:C}),v+=C*l}else t._normalizeValue(P,c,v),v+=l}}catch(t){w=!0,x=t}finally{try{b||null==j.return||j.return()}finally{if(w)throw x}}t.constant=!1,t.bufferLayout=o}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!t.noAlloc&&"function"!=typeof t.update)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}},{key:"_updateShaderAttributes",value:function(){var t=this.shaderAttributes;for(var e in t)t[e].update({buffer:this.getBuffer(),value:this.value,constant:this.constant})}},{key:"bufferLayout",get:function(){return this.userData.bufferLayout},set:function(t){this.userData.bufferLayout=t}}]),e}(_.a);function P(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce type from array")}}var C=n("y2Uh"),T=n("SUVH"),M=n("bphH"),E=n("CxzY"),S=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}return Object(r.a)(t,[{key:"setupResources",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.bindings[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;this._setupTransformFeedback(o,t)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"updateModelProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.varyings;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}},{key:"getDrawOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.bindings[this.currentIndex],n=e.sourceBuffers,i=e.transformFeedback;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}},{key:"swap",value:function(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t)}},{key:"getBuffer",value:function(t){var e=this.bindings[this.currentIndex].feedbackBuffers,n=t?e[t]:null;return n?n instanceof f.a?n:n.buffer:null}},{key:"getData",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).varyingName,e=this.getBuffer(t);return e?e.getData():null}},{key:"delete",value:function(){for(var t in this.resources)this.resources[t].delete()}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Object(E.a)(Object(T.d)(this.gl))}},{key:"_getFeedbackBuffers",value:function(t){var e=t.sourceBuffers,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var i in this.feedbackMap)n[this.feedbackMap[i]]=i;for(var r in Object.assign(n,t.feedbackBuffers),n){var a=n[r];if("string"==typeof a&&e[a]){var o=e[a],s=o.byteLength,u=o.usage,h=o.accessor;n[r]=this._createNewBuffer(r,{byteLength:s,usage:u,accessor:h})}}return n}},{key:"_setupBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.sourceBuffers,n=void 0===e?null:e;Object.assign(this.feedbackMap,t.feedbackMap);var i=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}},{key:"_setupTransformFeedback",value:function(t,e){var n=e.model.program;t.transformFeedback=new M.a(this.gl,{program:n,buffers:t.feedbackBuffers})}},{key:"_updateBindings",value:function(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){var e=this._swapBuffers(this.bindings[this.currentIndex]),n=e.sourceBuffers,i=e.feedbackBuffers,r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}},{key:"_updateBinding",value:function(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}},{key:"_swapBuffers",value:function(t){if(!this.feedbackMap)return null;var e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(var i in this.feedbackMap){var r=this.feedbackMap[i];e[i]=t.feedbackBuffers[r],n[r]=t.sourceBuffers[i],Object(E.a)(n[r]instanceof f.a)}return{sourceBuffers:e,feedbackBuffers:n}}},{key:"_createNewBuffer",value:function(t,e){var n=new f.a(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}(),A=n("p7wt"),L=n("f5Sf"),R=n("11Ib"),I=n("MdWm");function D(t){var e=100,n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){var i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}var F,z=n("rpxL"),B={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},N="transform_uSampler_",U="transform_uSize_",V="transform_position";function G(t){var e=t.vs,n=t.sourceTextureMap,i=t.targetTextureVarying,r=t.targetTexture,a=Object.keys(n).length,o=null,s={},u=e,h={};if(a>0||i){var c=u.split("\n"),l=c.slice();if(c.forEach((function(t,e,r){if(a>0){var u=function(t,e){var n={},i=function(t){return Object(C.b)(t,["attribute","in"])}(t);if(!i)return null;var r=i.type,a=i.name;if(a&&e[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=function(t){var e="".concat(N).concat(t),n="".concat(U).concat(t);return{samplerName:e,sizeName:n,uniformDeclerations:"  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";")}}(a),u=s.samplerName,h=s.sizeName,c=s.uniformDeclerations,l=Object(C.d)(r),f="  ".concat(r," ").concat(a," = transform_getInput(").concat(u,", ").concat(h,").").concat(l,";\n");return n[u]=a,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}(t,n);if(u){var c=u.updatedLine,f=u.inject;l[e]=c,h=Object(z.b)([h,f]),Object.assign(s,u.samplerTextureMap),a--}}i&&!o&&(o=function(t,e){var n=Object(C.b)(t,["varying","out"]);return n&&n.name===e?n.type:null}(t,i))})),i){Object(E.a)(r);var f="".concat(U).concat(i),d={"vs:#decl":"uniform vec2 ".concat(f,";\n"),"vs:#main-start":"     vec2 ".concat(V," = transform_getPos(").concat(f,");\n     gl_Position = vec4(").concat(V,", 0, 1.);\n")};h=Object(z.b)([h,d])}u=l.join("\n")}return{vs:u,targetTextureType:o,inject:h,samplerTextureMap:s}}var H=(F={},Object(o.a)(F,10241,9728),Object(o.a)(F,10240,9728),Object(o.a)(F,10242,33071),Object(o.a)(F,10243,33071),F),Z=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),this.gl=e,this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}return Object(r.a)(t,[{key:"updateModelProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._processVertexShader(t);return Object.assign({},t,e)}},{key:"getDrawOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.bindings[this.currentIndex],n=e.sourceTextures,i=e.framebuffer,r=e.targetTexture,a=Object.assign({},t.attributes),o=Object.assign({},t.uniforms),s=Object.assign({},t.parameters),u=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){for(var h in a.transform_elementID=this.elementIDBuffer,this.samplerTextureMap){var c=this.samplerTextureMap[h];o[h]=n[c]}this._setSourceTextureParameters();var l=function(t){var e,n,i=t.sourceTextureMap,r=t.targetTextureVarying,a=t.targetTexture,o={};for(var s in r&&(e=a.width,n=a.height,o["".concat(U).concat(r)]=[e,n]),i){var u=i[s];e=u.width,n=u.height,o["".concat(U).concat(s)]=[e,n]}return o}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(o,l)}return this.hasTargetTexture&&(u=!1,s.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:o,discard:u,parameters:s}}},{key:"swap",value:function(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupTextures(t)}},{key:"getTargetTexture",value:function(){return this.bindings[this.currentIndex].targetTexture}},{key:"getData",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).packed,e=void 0!==t&&t,n=this.bindings[this.currentIndex].framebuffer,i=Object(A.b)(n);if(!e)return i;for(var r=i.constructor,a=Object(C.c)(this.targetTextureType),o=new r(i.length*a/4),s=0,u=0;u<i.length;u+=4)for(var h=0;h<a;h++)o[s++]=i[u+h];return o}},{key:"getFramebuffer",value:function(){return this.bindings[this.currentIndex].framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t._targetTextureVarying,n=t._swapTexture;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}},{key:"_createTargetTexture",value:function(t){var e=t.sourceTextures,n=t.textureOrReference;if(n instanceof L.a)return n;var i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}},{key:"_setupTextures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t._sourceTextures,n=void 0===e?{}:e,i=t._targetTexture,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceTextures:n,targetTexture:r}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}},{key:"_updateElementIDBuffer",value:function(t){if(!("number"!=typeof t||this.elementCount>=t)){var e=new Float32Array(t);e.forEach((function(t,e,n){n[e]=e})),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new f.a(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}}},{key:"_updateBindings",value:function(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){var e=this._swapTextures(this.bindings[this.currentIndex]),n=e.sourceTextures,i=e.targetTexture,r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}},{key:"_updateBinding",value:function(t,e){var n=e.sourceTextures,i=e.targetTexture;if(t||(t={sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),i){t.targetTexture=i;var r=i.width,a=i.height,s=t.framebuffer;s?(s.update({attachments:Object(o.a)({},36064,i),resizeAttachments:!1}),s.resize({width:r,height:a})):t.framebuffer=new R.a(this.gl,{id:"".concat(this.id||"transform","-framebuffer"),width:r,height:a,attachments:Object(o.a)({},36064,i)})}return t}},{key:"_setSourceTextureParameters",value:function(){var t=this.currentIndex,e=this.bindings[t].sourceTextures;for(var n in e)e[n].setParameters(H)}},{key:"_swapTextures",value:function(t){if(!this._swapTexture)return null;var e=Object.assign({},t.sourceTextures);return e[this._swapTexture]=t.targetTexture,{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}},{key:"_createNewTexture",value:function(t){var e,n=Object(I.a)(t,{parameters:(e={},Object(o.a)(e,10241,9728),Object(o.a)(e,10240,9728),Object(o.a)(e,10242,33071),Object(o.a)(e,10243,33071),e),pixelStore:Object(o.a)({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.bindings[this.currentIndex],n=e.sourceTextures,i=e.targetTexture,r=G({vs:t.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),a=r.vs,o=r.uniforms,s=r.targetTextureType,u=r.inject,h=r.samplerTextureMap,c=Object(z.b)([t.inject||{},u]);return this.targetTextureType=s,this.samplerTextureMap=h,{vs:a,fs:t._fs||Object(C.a)({version:D(a),input:this.targetTextureVarying,inputType:s,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[B].concat(t.modules||[]):t.modules,uniforms:o,inject:c}}}]),t}(),W=n("VdrS"),X=n("S2EH"),q=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}return Object(r.a)(t,null,[{key:"isSupported",value:function(t){return Object(T.d)(t)}}]),Object(r.a)(t,[{key:"delete",value:function(){var t=this.model,e=this.bufferTransform,n=this.textureTransform;t&&t.delete(),e&&e.delete(),n&&n.delete()}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRenderTarget,n=void 0===e||e,i=this._updateDrawOptions(t);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}},{key:"swap",value:function(){var t=!1,e=[this.bufferTransform,this.textureTransform].filter(Boolean),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t=t||s.swap()}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}Object(E.a)(t,"Nothing to swap")}},{key:"getBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[this.bufferTransform,this.textureTransform].filter(Boolean),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.getData(t);if(s)return s}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.elementCount&&this.model.setVertexCount(t.elementCount);var e=[this.bufferTransform,this.textureTransform].filter(Boolean),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)a.value.update(t)}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.gl;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new X.a(e,Object.assign({},t,{fs:t.fs||Object(C.a)({version:D(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(t){var e=Object.assign({},t),n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)e=o.value.updateModelProps(e)}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return e}},{key:"_buildResourceTransforms",value:function(t,e){(function(t){return!(Object(W.a)(t.sourceBuffers)&&Object(W.a)(t.feedbackBuffers)&&!(t.varyings&&t.varyings.length>0))})(e)&&(this.bufferTransform=new S(t,e)),function(t){return!(Object(W.a)(t._sourceTextures)&&!t._targetTexture&&!t._targetTextureVarying)}(e)&&(this.textureTransform=new Z(t,e)),Object(E.a)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(t){var e=Object.assign({},t),n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;e=Object.assign(e,u.getDrawOptions(e))}}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return e}}]),t}(),Y=n("n6ox");function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(n,!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Q=function(){function t(e){var n=e.gl,r=e.attribute,a=e.timeline;Object(i.a)(this,t),this.gl=n,this.type="interpolation",this.transition=new Y.a(a),this.attribute=r,this.attributeInTransition=new k(n,r.userData),this.currentBufferLayout=r.bufferLayout,this.currentLength=0,this.transform=function(t,e){var n=Object(x.c)(e.size);return new q(t,{vs:$,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(n,r);var o={byteLength:0,usage:35050};this.buffers=[new f.a(n,o),new f.a(n,o)]}return Object(r.a)(t,[{key:"start",value:function(t,e){if(t.duration<=0)this.transition.cancel();else{var n=this.gl,i=this.buffers,r=this.attribute;Object(x.a)(i);var a={numInstances:e,attribute:r,fromLength:this.currentLength,fromBufferLayout:this.currentBufferLayout,getData:t.enter},o=!0,s=!1,u=void 0;try{for(var h,c=i[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;Object(x.f)(K({buffer:l},a))}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}this.currentBufferLayout=r.bufferLayout,this.currentLength=Object(x.b)(r,e),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:Object(x.d)(n,r)},feedbackBuffers:{vCurrent:i[1]}})}}},{key:"update",value:function(){var t=this.transition.update();if(t){var e=this.transition,n=e.time,i=e.settings,r=i.duration,a=(0,i.easing)(n/r);this.transform.run({uniforms:{time:a}})}return t}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}},{key:"inProgress",get:function(){return this.transition.inProgress}}]),t}(),$="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";function tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tt(n,!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nt={interpolation:Q,spring:function(){function t(e){var n=e.gl,r=e.attribute,a=e.timeline;Object(i.a)(this,t),this.gl=n,this.type="spring",this.transition=new Y.a(a),this.attribute=r,this.attributeInTransition=new k(n,r.userData),this.currentBufferLayout=r.bufferLayout,this.currentLength=0,this.texture=function(t){return new L.a(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(n),this.framebuffer=function(t,e){return new R.a(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:Object(o.a)({},36064,e)})}(n,this.texture),this.transform=function(t,e,n){var i=Object(x.c)(e.size);return new q(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(n,r,this.framebuffer);var s={byteLength:0,usage:35050};this.buffers=[new f.a(n,s),new f.a(n,s),new f.a(n,s)]}return Object(r.a)(t,[{key:"start",value:function(t,e){var n=this.gl,i=this.buffers,r=this.attribute,a={numInstances:e,attribute:r,fromLength:this.currentLength,fromBufferLayout:this.currentBufferLayout,getData:t.enter},o=!0,s=!1,u=void 0;try{for(var h,c=i[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;Object(x.f)(et({buffer:l},a))}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}this.currentBufferLayout=r.bufferLayout,this.currentLength=Object(x.b)(r,e),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:Object(x.d)(n,r)}})}},{key:"update",value:function(){var t=this.buffers,e=this.transform,n=this.framebuffer,i=this.transition;return!!i.update()&&(e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:i.settings.stiffness,damping:i.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Object(x.a)(t),this.attributeInTransition.update({buffer:t[1]}),Object(A.b)(n)[0]>0||i.end(),!0)}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}},{key:"inProgress",get:function(){return this.transition.inProgress}}]),t}()},it=function(){function t(e,n){var r=n.id,a=n.timeline;Object(i.a)(this,t),this.id=r,this.gl=e,this.timeline=a,this.transitions={},this.needsRedraw=!1,this.numInstances=1,q.isSupported(e)?this.isSupported=!0:e&&y.a.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(r.a)(t,[{key:"finalize",value:function(){for(var t in this.transitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,n=t.transitions,i=void 0===n?{}:n,r=t.numInstances;if(this.numInstances=r||1,this.isSupported){for(var a in e){var o=e[a],s=o.getTransitionSetting(i);s&&this._updateAttribute(a,o,s)}for(var u in this.transitions){var h=e[u];h&&h.getTransitionSetting(i)||this._removeTransition(u)}}}},{key:"hasAttribute",value:function(t){var e=this.transitions[t];return e&&e.inProgress}},{key:"getAttributes",value:function(){var t={};for(var e in this.transitions){var n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}},{key:"run",value:function(){if(!this.isSupported||0===this.numInstances)return!1;for(var t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);var e=this.needsRedraw;return this.needsRedraw=!1,e}},{key:"_removeTransition",value:function(t){this.transitions[t].cancel(),delete this.transitions[t]}},{key:"_updateAttribute",value:function(t,e,n){var i=this.transitions[t],r=!i||i.type!==n.type;if(r){i&&this._removeTransition(t);var a=nt[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(y.a.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}]),t}();function rt(){}n.d(e,"a",(function(){return ot}));var at={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,n=t.message;y.a.log(e,n)()},onUpdateStart:function(t){t.level,t.numInstances,at.savedMessages=[],at.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;at.savedMessages&&at.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,n=t.id,i=t.numInstances,r=Math.round(new Date-at.timeStart),a="".concat(r,"ms");y.a.group(e,"Updated attributes for ".concat(i," instances in ").concat(n," in ").concat(a),{collapsed:!0})();var o=!0,s=!1,u=void 0;try{for(var h,c=at.savedMessages[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;y.a.log(e,l)()}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}y.a.groupEnd(e,"Updated attributes for ".concat(i," instances in ").concat(n," in ").concat(a))(),at.savedMessages=null}},ot=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.id,a=void 0===r?"attribute-manager":r,o=n.stats,s=n.timeline;Object(i.a)(this,t),this.id=a,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=o,this.attributeTransitionManager=new it(e,{id:"".concat(a,"-transitions"),timeline:s}),Object.seal(this)}return Object(r.a)(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,n=t.onUpdateStart,i=t.onUpdate,r=t.onUpdateEnd;void 0!==e&&(at.onLog=e||rt),void 0!==n&&(at.onUpdateStart=n||rt),void 0!==i&&(at.onUpdate=i||rt),void 0!==r&&(at.onUpdateEnd=r||rt)}}]),Object(r.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0],this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}},{key:"invalidate",value:function(t,e){var n=this._invalidateTrigger(t,e);at.onLog({level:3,message:"invalidated attributes ".concat(n," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(t){for(var e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);at.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.numInstances,i=t.bufferLayout,r=t.transitions,a=t.props,o=void 0===a?{}:a,s=t.buffers,u=void 0===s?{}:s,h=t.context,c=void 0===h?{}:h,l=!1;for(var f in at.onUpdateStart({level:2,id:this.id,numInstances:n}),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var d=this.attributes[f];d.setExternalBuffer(u[f]||e.attributes&&e.attributes[f])||d.setConstantValue(o[d.getAccessor()])||d.needsUpdate()&&(l=!0,this._updateAttribute({attribute:d,numInstances:n,bufferLayout:i,data:e,props:o,context:c})),this.needsRedraw|=d.needsRedraw()}l&&at.onUpdateEnd({level:2,id:this.id,numInstances:n}),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}},{key:"updateTransition",value:function(){var t=this.attributeTransitionManager.run();return this.needsRedraw=this.needsRedraw||t,t}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,n=this.attributeTransitionManager,i=Object.assign({},n.getAttributes());for(var r in e){var a=e[r];a.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=a)}return i}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&y.a.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var i={};for(var r in t){var a=t[r],o=this._createAttribute(r,a,n);i[r]=o}Object.assign(this.attributes,i),this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,n){var i={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||n.instanced?1:e.divisor};return new k(this.gl,Object.assign({},e,i))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},n=function(n){t.attributes[n].getUpdateTriggers().forEach((function(t){e[t]||(e[t]=[]),e[t].push(n)}))};for(var i in this.attributes)n(i);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t,e){var n=this.attributes,i=this.updateTriggers[t];if(i)i.forEach((function(t){var i=n[t];i&&i.setNeedsUpdate(i.id,e)}));else{var r="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");r+="Valid triggers: ".concat(Object.keys(n).join(", ")),y.a.warn(r,i)()}return i}},{key:"_updateAttribute",value:function(t){var e=t.attribute,n=t.numInstances;e.allocate(n)&&at.onUpdate({level:3,message:"".concat(e.id," allocated ").concat(n),id:this.id});var i=Date.now();if(e.updateBuffer(t)){this.needsRedraw=!0;var r=Math.round(Date.now()-i);at.onUpdate({level:3,message:"".concat(e.id," updated ").concat(n," in ").concat(r,"ms")})}}}]),t}()},nzaO:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s}));var i=n("qjXE");function r(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function a(t,e,n){if(i.b.debug&&!function(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|n," some fields set to invalid numbers'"));return t}var o={};function s(t,e){o[t]||(o[t]=!0)}},o0o1:function(t,e,n){t.exports=n("u938")},oejM:function(t,e,n){"use strict";n.d(e,"c",(function(){return b})),n.d(e,"a",(function(){return w})),n.d(e,"b",(function(){return x}));var i,r=n("ODXe"),a=n("rePB"),o=n("CxzY"),s=5120,u=5121,h=5122,c=5123,l=0,f=1,d=2,p=3,g=4,v=5,m=6,y=5126,_=(i={},Object(a.a)(i,y,[y,1,"float"]),Object(a.a)(i,35664,[y,2,"vec2"]),Object(a.a)(i,35665,[y,3,"vec3"]),Object(a.a)(i,35666,[y,4,"vec4"]),Object(a.a)(i,5124,[5124,1,"int"]),Object(a.a)(i,35667,[5124,2,"ivec2"]),Object(a.a)(i,35668,[5124,3,"ivec3"]),Object(a.a)(i,35669,[5124,4,"ivec4"]),Object(a.a)(i,5125,[5125,1,"uint"]),Object(a.a)(i,36294,[5125,2,"uvec2"]),Object(a.a)(i,36295,[5125,3,"uvec3"]),Object(a.a)(i,36296,[5125,4,"uvec4"]),Object(a.a)(i,35670,[y,1,"bool"]),Object(a.a)(i,35671,[y,2,"bvec2"]),Object(a.a)(i,35672,[y,3,"bvec3"]),Object(a.a)(i,35673,[y,4,"bvec4"]),Object(a.a)(i,35674,[y,8,"mat2"]),Object(a.a)(i,35685,[y,8,"mat2x3"]),Object(a.a)(i,35686,[y,8,"mat2x4"]),Object(a.a)(i,35675,[y,12,"mat3"]),Object(a.a)(i,35687,[y,12,"mat3x2"]),Object(a.a)(i,35688,[y,12,"mat3x4"]),Object(a.a)(i,35676,[y,16,"mat4"]),Object(a.a)(i,35689,[y,16,"mat4x2"]),Object(a.a)(i,35690,[y,16,"mat4x3"]),i);function b(t){switch(t){case l:return l;case f:case p:case d:return f;case g:case v:case m:return g;default:return Object(o.a)(!1),0}}function w(t){var e=_[t];if(!e)return null;var n=Object(r.a)(e,2);return{type:n[0],components:n[1]}}function x(t,e){switch(t){case s:case u:case h:case c:t=y}for(var n in _){var i=Object(r.a)(_[n],3),a=i[0],o=i[1],l=i[2];if(a===t&&o===e)return{glType:n,name:l}}return null}},p7wt:function(t,e,n){"use strict";var i=n("sc/6"),r=n("11Ib"),a=(n("l6PP"),n("hP3k")),o=n("SUVH"),s=n("B9+J"),u=n("CxzY");function h(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Object(u.a)(!1),0}}var c=n("MdWm");function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.sourceX,i=void 0===n?0:n,r=e.sourceY,a=void 0===r?0:r,o=e.sourceFormat,c=void 0===o?6408:o,l=e.sourceAttachment,f=void 0===l?36064:l,d=e.target,g=void 0===d?null:d,v=e.sourceWidth,m=e.sourceHeight,y=e.sourceType,_=p(t),b=_.framebuffer,w=_.deleteFramebuffer;Object(u.a)(b);var x=b.gl,O=b.handle,j=b.attachments;v=v||b.width,m=m||b.height,36064===f&&null===O&&(f=1028),Object(u.a)(j[f]),g=function(t,e,n,i,r){return t||(e=e||5121,new(Object(s.c)(e,{clamped:!1}))(i*r*h(n)))}(g,y=y||j[f].type,c,v,m),y=y||Object(s.b)(g);var k=x.bindFramebuffer(36160,O);return x.readPixels(i,a,v,m,c,y,g),x.bindFramebuffer(36160,k||null),w&&b.delete(),g}function f(t,e){var n=e.sourceX,r=void 0===n?0:n,s=e.sourceY,c=void 0===s?0:s,l=e.sourceFormat,f=void 0===l?6408:l,d=e.target,g=void 0===d?null:d,v=e.targetByteOffset,m=void 0===v?0:v,y=e.sourceWidth,_=e.sourceHeight,b=e.sourceType,w=p(t),x=w.framebuffer,O=w.deleteFramebuffer;Object(u.a)(x);var j=x.gl;if(y=y||x.width,_=_||x.height,Object(o.a)(j),b=b||(g?g.type:5121),!g){var k=h(f),P=function(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Object(u.a)(!1),0}}(b),C=m+y*_*k*P;g=new i.a(j,{byteLength:C,accessor:{type:b,size:k}})}return g.bind({target:35051}),Object(a.a)(j,{framebuffer:x},(function(){j.readPixels(r,c,y,_,f,b,m)})),g.unbind({target:35051}),O&&x.delete(),g}function d(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.sourceAttachment,i=void 0===n?36064:n,r=e.targetMaxHeight,a=void 0===r?Number.MAX_SAFE_INTEGER:r,o=l(t,{sourceAttachment:i}),u=t.width,h=t.height;h>a;){var c=Object(s.d)({data:o,width:u,height:h});o=c.data,u=c.width,h=c.height}Object(s.a)({data:o,width:u,height:h});var f=document.createElement("canvas");f.width=u,f.height=h;var d=f.getContext("2d"),p=d.createImageData(u,h);return p.data.set(o),d.putImageData(p,0,0),f.toDataURL()}function p(t){return t instanceof r.a?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Object(c.b)(t),deleteFramebuffer:!0}}n("5+o2"),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return f})),n.d(e,"a",(function(){return d}))},pCSj:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return o}));var i=n("kGlb"),r=[];function a(t){t=Array.isArray(t)?t:[t];var e=!0,n=!1,a=void 0;try{for(var o,s=function(){var t=o.value,e=Object(i.b)(t);r.find((function(t){return e===t}))||r.unshift(e)},u=t[Symbol.iterator]();!(e=(o=u.next()).done);e=!0)s()}catch(t){n=!0,a=t}finally{try{e||null==u.return||u.return()}finally{if(n)throw a}}}function o(){return r}},pE0Q:function(t,e,n){"use strict";e.a={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null}},pRFE:function(t,e,n){"use strict";n.d(e,"a",(function(){return g})),n.d(e,"b",(function(){return v}));var i=n("ODXe"),r=n("hP3k"),a=n("SUVH"),o=n("CxzY"),s=256,u=1024,h=16384,c=6144,l=6145,f=6146,d=34041,p="clear: bad arguments";function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,i=void 0===n?null:n,a=e.color,c=void 0===a?null:a,l=e.depth,f=void 0===l?null:l,d=e.stencil,g=void 0===d?null:d,v={};i&&(v.framebuffer=i);var m=0;c&&(m|=h,!0!==c&&(v.clearColor=c)),f&&(m|=s,!0!==f&&(v.clearDepth=f)),g&&(m|=u,!0!==f&&(v.clearStencil=f)),Object(o.a)(0!==m,p),Object(r.a)(t,v,(function(){t.clear(m)}))}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,s=void 0===n?null:n,u=e.buffer,h=void 0===u?c:u,g=e.drawBuffer,v=void 0===g?0:g,m=e.value,y=void 0===m?[0,0,0,0]:m;Object(a.a)(t),Object(r.a)(t,{framebuffer:s},(function(){switch(h){case c:switch(y.constructor){case Int32Array:t.clearBufferiv(h,v,y);break;case Uint32Array:t.clearBufferuiv(h,v,y);break;case Float32Array:default:t.clearBufferfv(h,v,y)}break;case l:t.clearBufferfv(l,0,[y]);break;case f:t.clearBufferiv(f,0,[y]);break;case d:var e=Object(i.a)(y,2),n=e[0],r=e[1];t.clearBufferfi(d,0,n,r);break;default:Object(o.a)(!1,p)}}))}},puIE:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0}},qjXE:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return s})),n.d(e,"f",(function(){return u})),n.d(e,"j",(function(){return c})),n.d(e,"i",(function(){return l})),n.d(e,"h",(function(){return f})),n.d(e,"c",(function(){return d})),n.d(e,"a",(function(){return p})),n.d(e,"g",(function(){return g})),n.d(e,"d",(function(){return v}));var i=n("U8pU"),r=(n("RHh3"),n("KQm4"),n("vu3J"),1/Math.PI*180),a=1/180*Math.PI,o={};function s(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===e?o.precision||4:e;return t=function(t){return Math.round(t/o.EPSILON)*o.EPSILON}(t),"".concat(parseFloat(t.toPrecision(n)))}function u(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function h(t,e,n){if(u(t)){n=n||function(t){return t.clone?t.clone():new Array(t.length)}(t);for(var i=0;i<n.length&&i<t.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function c(t){return f(t)}function l(t){return d(t)}function f(t,e){return h(t,(function(t){return t*a}),e)}function d(t,e){return h(t,(function(t){return t*r}),e)}function p(t,e,n){return h(t,(function(t){return Math.max(e,Math.min(n,t))}))}function g(t,e,n){return u(t)?t.map((function(t,i){return g(t,e[i],n)})):n*e+(1-n)*t}function v(t,e,n){var r=o.EPSILON;n&&(o.EPSILON=n);try{if(t===e)return!0;if(u(t)&&u(e)){if(t.length!==e.length)return!1;for(var a=0;a<t.length;++a)if(!v(t[a],e[a]))return!1;return!0}return t&&"object"===Object(i.a)(t)&&t.equals?t.equals(e):e&&"object"===Object(i.a)(e)&&e.equals?e.equals(t):Math.abs(t-e)<=o.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{o.EPSILON=r}}o.EPSILON=1e-12,o.debug=!1,o.precision=4,o.printTypes=!1,o.printDegrees=!1,o.printRowMajor=!0},rMPx:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var i=n("1OyB"),r=n("vuIU"),a=n("VMBB"),o=n("kSne"),s=n("kLp3"),u=n.n(s),h=n("K7jV"),c=n("I3n7"),l=n("Jh/b"),f=n("Zk56"),d=n("JOTL"),p=n("e/LK"),g=n("nIko"),v=n("A/p5"),m=Object.seal({layerManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),y=function(t){return t instanceof h.a?"".concat(t):t?"invalid":"null"},_=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.deck,a=n.stats,s=n.viewport,u=void 0===s?null:s,h=n.timeline,c=void 0===h?null:h;Object(i.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},m,{layerManager:this,deck:r,gl:e,programManager:e&&Object(g.a)(e),stats:a||new d.a({id:"deck.gl"}),viewport:u||new p.a({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new o.a}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),Object(v.e)(this._initSeer),Object(v.c)(this._editSeer)}return Object(r.a)(t,[{key:"finalize",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.layers[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;this._finalizeLayer(a)}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}u.a.removeListener(this._initSeer),u.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._checkIfNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter((function(t){return e.find((function(e){return 0===t.id.indexOf(e)}))})):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&this.setLayers(t.layers)}},{key:"setLayers",value:function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&t===this.lastRenderedLayers)return l.a.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=Object(f.b)(t,{filter:Boolean});var e=!0,n=!1,i=void 0;try{for(var r,a=t[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.context=this.context}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}var o=this._updateLayers({oldLayers:this.layers,newLayers:t}),s=o.error,u=o.generatedLayers;if(this.layers=u,s)throw s;return this}},{key:"updateLayers",value:function(){var t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this.lastRenderedLayers,!0))}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n=!0,i=!1,r=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.getNeedsRedraw(t);e=e||s}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return e}},{key:"activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){l.a.log(4,"Viewport changed",t)(),this.context.viewport=t;var n=!0,i=!1,r=void 0;try{for(var o,s=this.layers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;u.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(u)}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}}return Object(a.a)(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,n=t.newLayers,i={},r=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;i[h.id]?l.a.warn("Multiple old layers with same id ".concat(y(h)))():i[h.id]=h}}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}var c=[],f=this._updateSublayersRecursively({newLayers:n,oldLayerMap:i,generatedLayers:c}),d=this._finalizeOldLayers(i);return this._needsUpdate=c.some((function(t){return t.hasUniformTransition()})),{error:f||d,generatedLayers:c}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,n=t.oldLayerMap,i=t.generatedLayers,r=null,a=!0,o=!1,s=void 0;try{for(var u,h=e[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var c=u.value;c.context=this.context;var f=n[c.id];null===f&&l.a.warn("Multiple new layers with same id ".concat(y(c)))(),n[c.id]=null;var d=null;try{if(this._debug&&f!==c&&c.validateProps(),f){this._transferLayerState(f,c);var p=this._updateLayer(c);r=r||p,Object(v.g)(c)}else{var g=this._initializeLayer(c);r=r||g,Object(v.b)(c)}i.push(c),d=c.isComposite&&c.getSubLayers()}catch(g){l.a.warn("error during matching of ".concat(y(c)),g)(),r=r||g}if(d){var m=this._updateSublayersRecursively({newLayers:d,oldLayerMap:n,generatedLayers:i});r=r||m}}}catch(g){o=!0,s=g}finally{try{a||null==h.return||h.return()}finally{if(o)throw s}}return r}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var n in t){var i=t[n];i&&(e=e||this._finalizeLayer(i))}return e}},{key:"_initializeLayer",value:function(t){l.a.log(2,"initializing ".concat(y(t)))();var e=null;try{t._initialize(),t.lifecycle=c.a.INITIALIZED}catch(n){l.a.warn("error while initializing ".concat(y(t),"\n"),n)(),e=e||n}t.internalState.layer=t;var n=!0,i=!1,r=void 0;try{for(var a,o=t.getModels()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)a.value.userData.layer=t}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=c.a.MATCHED,e!==t?(l.a.log(4,"matched ".concat(y(e)),t,"->",e)(),t.lifecycle=c.a.AWAITING_GC):l.a.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){l.a.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(n){l.a.warn("error during update of ".concat(y(t)),n)(),e=n}return e}},{key:"_finalizeLayer",value:function(t){Object(a.a)(t.lifecycle!==c.a.AWAITING_FINALIZATION),t.lifecycle=c.a.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(y(t)));try{t._finalize()}catch(n){l.a.warn("error during finalization of ".concat(y(t)),n)(),e=n}return t.lifecycle=c.a.FINALIZED,l.a.log(2,"finalizing ".concat(y(t)))(),e}},{key:"_initSeer",value:function(){this.layers.forEach((function(t){Object(v.b)(t),Object(v.g)(t)}))}},{key:"_editSeer",value:function(t){"edit"===t.type&&"props"===t.valuePath[0]&&(Object(v.f)(t.itemKey,t.valuePath.slice(1),t.value),this.updateLayers())}}]),t}()},rMhL:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));var i="vs",r="fs"},rSc4:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var i=n("1OyB"),r=n("vuIU"),a=n("vqa/"),o=n("/gfa"),s=n("VMBB"),u={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},h=function(){function t(e){Object(i.a)(this,t);var n=e.width,r=e.height,o=e.position,h=void 0===o?u.position:o;Object(s.a)(Number.isFinite(n),"`width` must be supplied"),Object(s.a)(Number.isFinite(r),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new a.a(h)}))}return Object(r.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new o.a({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new o.a({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}()},rePB:function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}))},rnmN:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}));var i=n("CxzY");function r(t,e){if("string"!=typeof e)return e;var n=Number(e);if(!isNaN(n))return n;var r=t[e=e.replace(/^.*\./,"")];return Object(i.a)(void 0!==r,"Accessing undefined constant GL.".concat(e)),r}function a(t,e){for(var n in e=Number(e),t)if(t[n]===e)return"GL.".concat(n);return String(e)}},rpwb:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var i=[],r=[];function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,a=i,o={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?a=t:t.length>0&&(r.length=t.length,a=r):a=i,(e>0||Number.isFinite(n))&&(a=(Array.isArray(a)?a:Array.from(a)).slice(e,n),o.index=e-1),{iterable:a,objectInfo:o}}function o(t){return t&&t[Symbol.asyncIterator]}},rpxL:function(t,e,n){"use strict";var i,r=n("rePB"),a=n("rMhL"),o=n("uzDn");n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return d}));var s=(i={},Object(r.a)(i,a.b,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),Object(r.a)(i,a.a,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),i),u="__LUMA_INJECT_DECLARATIONS__",h=/void main\s*\([^)]*\)\s*\{\n?/,c=/}\n?[^{}]*$/,l=[];function f(t,e,n,i){var r=e===a.b,o=function(e){var i=n[e];i.sort((function(t,e){return t.order-e.order})),l.length=i.length;for(var a=0,o=i.length;a<o;++a)l[a]=i[a].injection;var s="".concat(l.join("\n"),"\n");switch(e){case"vs:#decl":r&&(t=t.replace(u,s));break;case"vs:#main-start":r&&(t=t.replace(h,(function(t){return t+s})));break;case"vs:#main-end":r&&(t=t.replace(c,(function(t){return s+t})));break;case"fs:#decl":r||(t=t.replace(u,s));break;case"fs:#main-start":r||(t=t.replace(h,(function(t){return t+s})));break;case"fs:#main-end":r||(t=t.replace(c,(function(t){return s+t})));break;default:t=t.replace(e,(function(t){return t+s}))}};for(var f in n)o(f);return t=t.replace(u,""),i&&(t=t.replace(/\}\s*$/,(function(t){return t+s[e]}))),t}function d(t){var e={};return Object(o.a)(Array.isArray(t)&&t.length>1),t.forEach((function(t){for(var n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]})),e}},rta6:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("IIwk"),o=n("iTDY"),s=n("5+o2"),u=n("JOTL");n("eUbh"),n.d(e,"a",(function(){return h}));var h=new(function(){function t(){Object(i.a)(this,t),this.stats=new Map}return Object(r.a)(t,[{key:"get",value:function(t){return this.stats.has(t)||this.stats.set(t,new u.a({id:t})),this.stats.get(t)}}]),t}());if(o.a.luma&&"7.3.0"!==o.a.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(o.a.luma.VERSION," vs ").concat("7.3.0"));o.a.luma||(a.a&&s.a.log(1,"luma.gl ".concat("7.3.0"," - ").concat("set luma.log.priority=1 (or higher) to trace rendering"))(),o.a.luma=o.a.luma||{VERSION:"7.3.0",version:"7.3.0",log:s.a,stats:h,globals:{modules:{},nodeIO:{}}}),o.a.luma},s4An:function(t,e,n){"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.d(e,"a",(function(){return i}))},sY1B:function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var i=n("ODXe"),r=n("1OyB"),a=n("md7G"),o=n("foSv"),s=n("vuIU"),u=n("Ji7U"),h=n("nzaO"),c=n("ho2+"),l=n("3jj3"),f=n("ZaHm"),d=n("ZxFD"),p=n("n+fv"),g=n("bl9R"),v=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),m=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),y=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),_={},b=function(t){function e(t){var n;return Object(r.a)(this,e),n=Object(a.a)(this,Object(o.a)(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"INDICES",get:function(){return y}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return _.IDENTITY=_.IDENTITY||Object.freeze(new e(v)),_.IDENTITY}},{key:"ZERO",get:function(){return _.ZERO=_.ZERO||Object.freeze(new e(m)),_.ZERO}}]),Object(s.a)(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,i,r,a,o,s,u,h,c,l,f,d,p,g){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=h,this[10]=c,this[11]=l,this[12]=f,this[13]=d,this[14]=p,this[15]=g,this.check()}},{key:"setRowMajor",value:function(t,e,n,i,r,a,o,s,u,h,c,l,f,d,p,g){return this[0]=t,this[1]=r,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=h,this[7]=d,this[8]=n,this[9]=o,this[10]=c,this[11]=p,this[12]=i,this[13]=s,this[14]=l,this[15]=g,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(v)}},{key:"fromQuaternion",value:function(t){return f.c(this,t),this.check()}},{key:"frustum",value:function(t){var n=t.left,i=t.right,r=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?e._computeInfinitePerspectiveOffCenter(this,n,i,r,a,o):f.d(this,n,i,r,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var i=t;t=i.eye,e=i.center,n=i.up}return e=e||[0,0,0],n=n||[0,1,0],f.g(this,t,e,n),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,i=t.bottom,r=t.top,a=t.near,o=void 0===a?.1:a,s=t.far,u=void 0===s?500:s;return f.i(this,e,n,i,r,o,u),this.check()}},{key:"orthographic",value:function(t){var n=t.fovy,i=void 0===n?45*Math.PI/180:n,r=t.aspect,a=void 0===r?1:r,o=t.focalDistance,s=void 0===o?1:o,u=t.near,h=void 0===u?.1:u,c=t.far,l=void 0===c?500:c;if(i>2*Math.PI)throw Error("radians");var f=i/2,d=s*Math.tan(f),p=d*a;return(new e).ortho({left:-p,right:p,bottom:-d,top:d,near:h,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=t.fov,i=void 0===n?45*Math.PI/180:n,r=t.aspect,a=void 0===r?1:r,o=t.near,s=void 0===o?.1:o,u=t.far,h=void 0===u?500:u;if((e=e||i)>2*Math.PI)throw Error("radians");return f.j(this,e,a,s,h),this.check()}},{key:"determinant",value:function(){return f.a(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),i=1/n[0],r=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),i=1/n[0],r=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*a,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*a,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*a,t}},{key:"transpose",value:function(){return f.q(this,this),this.check()}},{key:"invert",value:function(){return f.f(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return f.h(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return f.h(this,this,t),this.check()}},{key:"rotateX",value:function(t){return f.l(this,this,t),this.check()}},{key:"rotateY",value:function(t){return f.m(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return f.n(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],a=e[2];return this.rotateX(n).rotateY(r).rotateZ(a)}},{key:"rotateAxis",value:function(t,e){return f.k(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?f.o(this,this,t):f.o(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return f.p(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(e=g.n(e||[-0,-0,-0,-0],t,this),Object(h.b)(e,4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=d.j(e||[-0,-0],t,this);break;case 3:e=p.o(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(h.b)(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=Object(l.a)(e||[-0,-0],t,this);break;case 3:e=Object(l.c)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(h.b)(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return Object(h.c)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Object(h.c)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Object(h.c)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,i,r,a){var o=2*a/(n-e),s=2*a/(r-i),u=(n+e)/(n-e),h=(r+i)/(r-i),c=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=c,t[15]=0,t}}]),e}(c.a)},"sc/6":function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("JX7q"),u=n("Ji7U"),h=n("L8KH"),c=n("T2Hy"),l=n("SUVH"),f=n("B9+J"),d=n("LE90"),p=n("CxzY"),g=n("5+o2"),v={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},m={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:v},y={removedProps:v},_=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(a.a)(this,Object(o.a)(e).call(this,t,r))).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),n.target=r.target||(n.gl.webgl2?36662:34962),n.initialize(r),Object.seal(Object(s.a)(n)),n}return Object(u.a)(e,t),Object(r.a)(e,[{key:"getElementCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/c.a.getBytesPerElement(t))}},{key:"getVertexCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/c.a.getBytesPerVertex(t))}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Object(d.a)("Buffer",t,m),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data):this._setByteLength(t.byteLength||0),this}},{key:"setProps",value:function(t){return"accessor"in(t=Object(d.a)("Buffer",t,y))&&this.setAccessor(t.accessor),this}},{key:"setAccessor",value:function(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new c.a(t),this}},{key:"reallocate",value:function(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}},{key:"setData",value:function(t){return this.initialize(t)}},{key:"subData",value:function(t){ArrayBuffer.isView(t)&&(t={data:t});var e=t,n=e.data,i=e.offset,r=void 0===i?0:i,a=e.srcOffset,o=void 0===a?0:a,s=t.byteLength||t.length;Object(p.a)(n);var u=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(u,this.handle),0!==o||void 0!==s?(Object(l.a)(this.gl),this.gl.bufferSubData(this.target,r,n,o,s)):this.gl.bufferSubData(u,r,n),this.gl.bindBuffer(u,null),this.debugData=null,this._inferType(n),this}},{key:"copyData",value:function(t){var e=t.sourceBuffer,n=t.readOffset,i=void 0===n?0:n,r=t.writeOffset,a=void 0===r?0:r,o=t.size,s=this.gl;return Object(l.a)(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,i,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dstData,n=void 0===e?null:e,i=t.srcByteOffset,r=void 0===i?0:i,a=t.dstOffset,o=void 0===a?0:a,s=t.length,u=void 0===s?0:s;Object(l.a)(this.gl);var h,c,d=Object(f.c)(this.accessor.type||5126,{clamped:!1}),g=this._getAvailableElementCount(r),v=o;n?h=(c=n.length)-v:c=v+(h=Math.min(g,u||g));var m=Math.min(g,h);return u=u||m,Object(p.a)(u<=m),n=n||new d(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,n,o,u),this.gl.bindBuffer(36662,null),n}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,i=t.index,r=void 0===i?this.accessor&&this.accessor.index:i,a=t.offset,o=void 0===a?0:a,s=t.size;return 35345===n||35982===n?void 0!==s?this.gl.bindBufferRange(n,r,this.handle,o,s):(Object(p.a)(0===o),this.gl.bindBufferBase(n,r,this.handle)):this.gl.bindBuffer(n,this.handle),this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,i=t.index,r=void 0===i?this.accessor&&this.accessor.index:i;return 35345===n||35982===n?this.gl.bindBufferBase(n,r,null):this.gl.bindBuffer(n,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Object(p.a)(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();var n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,e),this.gl.bindBuffer(n,null),this.usage=e,this.debugData=t.slice(0,10),this.bytesUsed=t.byteLength,this._trackAllocatedMemory(t.byteLength);var i=Object(f.b)(t);return Object(p.a)(i),this.setAccessor(new c.a(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Object(p.a)(t>=0),this._trackDeallocatedMemory();var n=t;0===t&&(n=new Float32Array(0));var i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(t){var e=t/Object(f.c)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}},{key:"_inferType",value:function(t){this.accessor.type||this.setAccessor(new c.a(this.accessor,{type:Object(f.b)(t)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(t){this.gl.bindBuffer(this.target,this.handle);var e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}},{key:"setByteLength",value:function(t){return g.a.deprecated("setByteLength","reallocate")(),this.reallocate(t)}},{key:"updateAccessor",value:function(t){return g.a.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new c.a(this.accessor,t),this}},{key:"type",get:function(){return g.a.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return g.a.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}}]),e}(h.a)},sgaE:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("5+o2");function r(t,e,n,r){var a="See luma.gl ".concat(n," Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide"),o=Object.getPrototypeOf(t);r.forEach((function(t){o.methodName||(o[t]=function(){throw i.a.removed("Calling removed method ".concat(e,".").concat(t,": "),a)(),new Error(t)})}))}},swnp:function(t,e,n){"use strict";var i=n("pCSj"),r=n("+hU6"),a=(r.a&&r.d,"undefined"!=typeof Image&&r.c,r.e,{extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],loadAndParse:r.c}),o=n("TZTB"),s=n("Jh/b"),u={name:"JSON",extensions:["json","geojson"],testText:function(t){var e=t[0],n=t[t.length-1];return"{"===e&&"}"===n||"["===e&&"]"===n},parseTextSync:JSON.parse},h=n("nIko");if(o.a.deck&&"7.3.1"!==o.a.deck.VERSION)throw new Error("deck.gl - multiple versions detected: ".concat(o.a.deck.VERSION," vs ").concat("7.3.1"));o.a.deck||(s.a.log(0,"deck.gl ".concat("7.3.1"," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),o.a.deck=o.a.deck||{VERSION:"7.3.1",version:"7.3.1",log:s.a},Object(i.b)([u,a]),Object(h.b)()),e.a=o.a.deck},sxJW:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n("1OyB"),r=n("vuIU"),a=n("zheZ"),o=n("Jh/b"),s=n("VMBB"),u={transitionDuration:0},h=["wheel"],c=["panstart","panmove","panend"],l=["pinchstart","pinchmove","pinchend"],f=["doubletap"],d=["keydown"],p=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),Object(s.a)(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new a.b(e,n),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}return Object(r.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,n=e.x,i=e.y,r=t.offsetCenter;return[r.x-n,r.y-i]}},{key:"isPointInBounds",value:function(t,e){var n=this.controllerStateProps,i=n.width,r=n.height;if(e&&e.handled)return!1;var a=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=r;return a&&e&&e.stopPropagation(),a}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&o.a.removed("onViewportChange")(),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,n=void 0===e||e,i=t.dragPan,r=void 0===i||i,a=t.dragRotate,s=void 0===a||a,u=t.doubleClickZoom,p=void 0===u||u,g=t.touchZoom,v=void 0===g||g,m=t.touchRotate,y=void 0!==m&&m,_=t.keyboard,b=void 0===_||_,w=Boolean(this.onViewStateChange);this.toggleEvents(h,w&&n),this.toggleEvents(c,w&&(r||s)),this.toggleEvents(l,w&&(v||y)),this.toggleEvents(f,w&&p),this.toggleEvents(d,w&&b),this.scrollZoom=n,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=p,this.touchZoom=v,this.touchRotate=y,this.keyboard=b}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach((function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))}))}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.assign({},t.getViewportProps(),e);if(this.controllerState!==t){var r=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:n,oldViewState:r})}Object.assign(this._state,t.getInteractiveState(),n),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,u,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){if(!this.isDragging())return!1;var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,u,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,i=this.controllerState.getViewportProps(),r=e/i.width,a=n/i.height,o=this.controllerState.rotate({deltaScaleX:r,deltaScaleY:a});return this.updateViewport(o,u,{isDragging:!0,isRotating:!0}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=t.delta,i=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==i&&(i=1/i);var r=this.controllerState.zoom({pos:e,scale:i});return this.updateViewport(r,u,{isZooming:!0,isPanning:!0}),!0}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,u,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;var e=this.controllerState;if(this.touchZoom){var n=t.scale,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){var r=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(r-a)/180})}return this.updateViewport(e,u,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps(),{isZooming:!0,isPanning:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),i=this.controllerState,r={};switch(t.srcEvent.keyCode){case 189:e=n?i.zoomOut().zoomOut():i.zoomOut(),r.isZooming=!0;break;case 187:e=n?i.zoomIn().zoomIn():i.zoomIn(),r.isZooming=!0;break;case 37:n?(e=i.rotateLeft(),r.isRotating=!0):(e=i.moveLeft(),r.isPanning=!0);break;case 39:n?(e=i.rotateRight(),r.isRotating=!0):(e=i.moveRight(),r.isPanning=!0);break;case 38:n?(e=i.rotateUp(),r.isRotating=!0):(e=i.moveUp(),r.isPanning=!0);break;case 40:n?(e=i.rotateDown(),r.isRotating=!0):(e=i.moveDown(),r.isPanning=!0);break;default:return!1}return this.updateViewport(e,this._getTransitionProps(),r),!0}},{key:"_getTransitionProps",value:function(){return u}}]),t}()},"t+rZ":function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));var i=n("LhmN");function r(t,e){var n={};for(var r in e){var a=Number(r),o=i.d[r];o&&("string"==typeof o?n[o]=!0:o(t,e[r],a))}var s=t.state&&t.state.cache;if(s){var u=Object.assign({},s,e);for(var h in n)(0,i.a[h])(t,u)}}function a(t,e){var n=i.c[e];return n?n(t,Number(e)):t.getParameter(Number(e))}function o(t,e){e=e||i.b;var n=Array.isArray(e)?e:Object.keys(e),r={},o=!0,s=!1,u=void 0;try{for(var h,c=n[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var l=h.value;r[l]=a(t,l)}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return r}function s(t){r(t,Object.assign({},i.b,{}))}n("1eIE"),n("c+tY")},tMmZ:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i,r=n("rePB"),a=n("11Ib"),o=n("f5Sf"),s={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"},u=null;e.b=(i={},Object(r.a)(i,s.WEBGL2,[!1,!0]),Object(r.a)(i,s.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),Object(r.a)(i,s.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),Object(r.a)(i,s.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),Object(r.a)(i,s.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),Object(r.a)(i,s.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),Object(r.a)(i,s.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),Object(r.a)(i,s.FLOAT_BLEND,["EXT_float_blend"]),Object(r.a)(i,s.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),Object(r.a)(i,s.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),Object(r.a)(i,s.TEXTURE_FLOAT,["OES_texture_float",!0]),Object(r.a)(i,s.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),Object(r.a)(i,s.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),Object(r.a)(i,s.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),Object(r.a)(i,s.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),Object(r.a)(i,s.COLOR_ATTACHMENT_RGBA32F,[function(t){if(null!==u)return u;var e=new o.a(t,{format:6408,type:5126,dataFormat:6408}),n=new a.a(t,{id:"test-framebuffer",check:!1,attachments:Object(r.a)({},36064,e)}),i=n.getStatus();return e.delete(),n.delete(),u=36053===i},"EXT_color_buffer_float"]),Object(r.a)(i,s.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),Object(r.a)(i,s.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),Object(r.a)(i,s.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),Object(r.a)(i,s.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),Object(r.a)(i,s.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),Object(r.a)(i,s.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),i)},u938:function(t,e,n){var i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,a=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,t.exports=n("ls82"),r)i.regeneratorRuntime=a;else try{delete i.regeneratorRuntime}catch(t){i.regeneratorRuntime=void 0}},uCGa:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("1OyB"),r=n("vuIU"),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,r=void 0===n?"effect":n;this.id=r,this.props={},Object.assign(this.props,e)}return Object(r.a)(t,[{key:"prepare",value:function(){}},{key:"getParameters",value:function(){}},{key:"cleanup",value:function(){}}]),t}()},uYBD:function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return h})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return f}));var i,r,a,o=n("rePB"),s=n("SUVH"),u=(i={},Object(o.a)(i,6407,{dataFormat:6407,types:[5121,33635]}),Object(o.a)(i,6408,{dataFormat:6408,types:[5121,32819,32820]}),Object(o.a)(i,6406,{dataFormat:6406,types:[5121]}),Object(o.a)(i,6409,{dataFormat:6409,types:[5121]}),Object(o.a)(i,6410,{dataFormat:6410,types:[5121]}),Object(o.a)(i,33326,{dataFormat:6403,types:[5126],gl2:!0}),Object(o.a)(i,33328,{dataFormat:33319,types:[5126],gl2:!0}),Object(o.a)(i,34837,{dataFormat:6407,types:[5126],gl2:!0}),Object(o.a)(i,34836,{dataFormat:6408,types:[5126],gl2:!0}),i),h=(r={},Object(o.a)(r,6403,1),Object(o.a)(r,36244,1),Object(o.a)(r,33319,2),Object(o.a)(r,33320,2),Object(o.a)(r,6407,3),Object(o.a)(r,36248,3),Object(o.a)(r,6408,4),Object(o.a)(r,36249,4),Object(o.a)(r,6402,1),Object(o.a)(r,34041,1),Object(o.a)(r,6406,1),Object(o.a)(r,6409,1),Object(o.a)(r,6410,2),r),c=(a={},Object(o.a)(a,5126,4),Object(o.a)(a,5125,4),Object(o.a)(a,5124,4),Object(o.a)(a,5123,2),Object(o.a)(a,5122,2),Object(o.a)(a,5131,2),Object(o.a)(a,5120,1),Object(o.a)(a,5121,1),a);function l(t,e){var n=u[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;var i=Object(s.d)(t)&&n.gl2||n.gl1;return"string"==typeof i?t.getExtension(i):i}function f(t,e){var n=u[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}},uzDn:function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}n.d(e,"a",(function(){return i}))},vpQ4:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("rePB");function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Object(i.a)(t,e,n[e])}))}return t}},"vqa/":function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("5JRv"),h=n("qjXE"),c=n("nzaO"),l=n("n+fv"),f=n("3jj3"),d=[0,0,0],p=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(i.a)(this,e),t=Object(a.a)(this,Object(o.a)(e).call(this,-0,-0,-0)),1===arguments.length&&Object(h.f)(n)?t.copy(n):(h.b.debug&&(Object(c.a)(n),Object(c.a)(r),Object(c.a)(s)),t[0]=n,t[1]=r,t[2]=s),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return h.b.debug&&(Object(c.a)(t.x),Object(c.a)(t.y),Object(c.a)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return l.a(this,t)}},{key:"cross",value:function(t){return l.c(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return l.j(this,this,i,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return l.k(this,this,i,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return l.l(this,this,i,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return l.o(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(f.c)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return l.n(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return Object(f.b)(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return l.p(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(c.a)(t)}}]),e}(u.a)},vu3J:function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}n.d(e,"a",(function(){return i}))},vuIU:function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.d(e,"a",(function(){return r}))},"w+ko":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("ODXe"),r=n("1A8y"),a=n("54ZI");function o(t){var e=t.width,n=t.height,o=t.bounds,s=t.minExtent,u=void 0===s?0:s,h=t.maxZoom,c=void 0===h?24:h,l=t.padding,f=void 0===l?0:l,d=t.offset,p=void 0===d?[0,0]:d,g=Object(i.a)(o,2),v=Object(i.a)(g[0],2),m=v[0],y=v[1],_=Object(i.a)(g[1],2),b=_[0],w=_[1];Number.isFinite(f)?f={top:f,bottom:f,left:f,right:f}:Object(a.a)(Number.isFinite(f.top)&&Number.isFinite(f.bottom)&&Number.isFinite(f.left)&&Number.isFinite(f.right));var x=new r.a({width:e,height:n,longitude:0,latitude:0,zoom:0}),O=x.project([m,w]),j=x.project([b,y]),k=[Math.max(Math.abs(j[0]-O[0]),u),Math.max(Math.abs(j[1]-O[1]),u)],P=[e-f.left-f.right-2*Math.abs(p[0]),n-f.top-f.bottom-2*Math.abs(p[1])];Object(a.a)(P[0]>0&&P[1]>0);var C=P[0]/k[0],T=P[1]/k[1],M=(f.right-f.left)/2/C,E=(f.bottom-f.top)/2/T,S=[(j[0]+O[0])/2+M,(j[1]+O[1])/2+E],A=x.unproject(S),L=x.zoom+Math.log2(Math.abs(Math.min(C,T)));return{longitude:A[0],latitude:A[1],zoom:Math.min(L,c)}}},wldP:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("1OyB"),r=n("vuIU"),a=n("qjXE"),o=n("VMBB"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var n=e,r=n.compare,a=n.extract,o=n.required;this._propsToCompare=r,this._propsToExtract=a,this._requiredProps=o}return Object(r.a)(t,[{key:"arePropsEqual",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,s=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(!(u in t&&u in e&&Object(a.d)(t[u],e[u])))return!1}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!0}},{key:"initializeProps",value:function(t,e){var n;if(this._propsToExtract){var i={},r={},a=!0,o=!1,s=void 0;try{for(var u,h=this._propsToExtract[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var c=u.value;i[c]=t[c],r[c]=e[c]}}catch(t){o=!0,s=t}finally{try{a||null==h.return||h.return()}finally{if(o)throw s}}n={start:i,end:r}}else n={start:t,end:e};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}},{key:"interpolateProps",value:function(t,e,n){Object(o.a)(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach((function(e){var n=t[e];Object(o.a)(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))}))}}]),t}()},y2Uh:function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return h})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return l}));var i=n("ODXe"),r=n("uzDn"),a="void main() {gl_FragColor = vec4(0);}",o="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",s="#version 300 es\n".concat(o);function u(t,e){e=Array.isArray(e)?e:[e];var n=t.replace(/^\s+/,"").split(/\s+/),r=Object(i.a)(n,3),a=r[0],o=r[1],s=r[2];return e.includes(a)&&o&&s?{qualifier:a,type:o,name:s.split(";")[0]}:null}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,n=void 0===e?100:e,i=t.input,u=t.inputType,h=t.output;if(!i)return 300===n?s:n>300?"#version ".concat(n,"\n").concat(o):a;var c=function(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Object(r.a)(!1),null}}(i,u);return n>=300?"#version ".concat(n," ").concat(300===n?"es":"","\nin ").concat(u," ").concat(i,";\nout vec4 ").concat(h,";\nvoid main() {\n  ").concat(h," = ").concat(c,";\n}"):"varying ".concat(u," ").concat(i,";\nvoid main() {\n  gl_FragColor = ").concat(c,";\n}")}function c(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Object(r.a)(!1),null}}function l(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Object(r.a)(!1),null}}},y7xQ:function(t,e,n){"use strict";function i(t){for(var e in t)return!1;return!0}function r(t){return Boolean(t&&2===t._version)}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}))},yDDC:function(t,e,n){"use strict";function i(t){return t.canvas?t.drawingBufferWidth/(t.canvas.clientWidth||t.canvas.width||1):1}function r(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(t,e,n,i,r){var a,u=o(t[0],e,n),h=s(t[1],e,i,r),c=o(t[0]+1,e,n),l=c===n-1?c:c-1;return c=s(t[1]+1,e,i,r),r?(a=h,h=c=0===c?c:c+1):a=c===i-1?c:c-1,{x:u,y:h,width:Math.max(l-u+1,1),height:Math.max(a-h+1,1)}}(e,i(t),t.drawingBufferWidth,t.drawingBufferHeight,n)}function a(t){var e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function o(t,e,n){return Math.min(Math.round(t*e),n-1)}function s(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return a}))},yLV6:function(t,e,n){var i;!function(r,a,o,s){"use strict";var u,h=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),l="function",f=Math.round,d=Math.abs,p=Date.now;function g(t,e,n){return setTimeout(x(t,n),e)}function v(t,e,n){return!!Array.isArray(t)&&(m(t,n[e],n),!0)}function m(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function y(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,i,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==s&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var _=y((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===s)&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),b=y((function(t,e){return _(t,e,!0)}),"merge","Use `assign`.");function w(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&u(i,n)}function x(t,e){return function(){return t.apply(e,arguments)}}function O(t,e){return typeof t==l?t.apply(e&&e[0]||s,e):t}function j(t,e){return t===s?e:t}function k(t,e,n){m(M(e),(function(e){t.addEventListener(e,n,!1)}))}function P(t,e,n){m(M(e),(function(e){t.removeEventListener(e,n,!1)}))}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function T(t,e){return t.indexOf(e)>-1}function M(t){return t.trim().split(/\s+/g)}function E(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function S(t){return Array.prototype.slice.call(t,0)}function A(t,e,n){for(var i=[],r=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];E(r,o)<0&&i.push(t[a]),r[a]=o,a++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function L(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),a=0;a<h.length;){if((i=(n=h[a])?n+r:e)in t)return i;a++}return s}var R=1;function I(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var D="ontouchstart"in r,F=L(r,"PointerEvent")!==s,z=D&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=25,N=1,U=4,V=8,G=1,H=2,Z=4,W=8,X=16,q=H|Z,Y=W|X,J=q|Y,K=["x","y"],Q=["clientX","clientY"];function $(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){O(t.options.enable,[t])&&n.handler(e)},this.init()}function tt(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,a=e&N&&i-r==0,o=e&(U|V)&&i-r==0;n.isFirst=!!a,n.isFinal=!!o,a&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=et(e)),r>1&&!n.firstMultiple?n.firstMultiple=et(e):1===r&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,u=o?o.center:a.center,h=e.center=nt(i);e.timeStamp=p(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=ot(u,h),e.distance=at(u,h),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==N&&a.eventType!==U||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=rt(e.deltaX,e.deltaY);var c=it(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=d(c.x)>d(c.y)?c.x:c.y,e.scale=o?function(t,e){return at(e[0],e[1],Q)/at(t[0],t[1],Q)}(o.pointers,i):1,e.rotation=o?function(t,e){return ot(e[1],e[0],Q)+ot(t[1],t[0],Q)}(o.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,a,o=t.lastInterval||e,u=e.timeStamp-o.timeStamp;if(e.eventType!=V&&(u>B||o.velocity===s)){var h=e.deltaX-o.deltaX,c=e.deltaY-o.deltaY,l=it(u,h,c);i=l.x,r=l.y,n=d(l.x)>d(l.y)?l.x:l.y,a=rt(h,c),t.lastInterval=e}else n=o.velocity,i=o.velocityX,r=o.velocityY,a=o.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=a}(n,e);var l=t.element;C(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function et(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:f(t.pointers[n].clientX),clientY:f(t.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:e,center:nt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function nt(t){var e=t.length;if(1===e)return{x:f(t[0].clientX),y:f(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:f(n/e),y:f(i/e)}}function it(t,e,n){return{x:e/t||0,y:n/t||0}}function rt(t,e){return t===e?G:d(t)>=d(e)?t<0?H:Z:e<0?W:X}function at(t,e,n){n||(n=K);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function ot(t,e,n){n||(n=K);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}$.prototype={handler:function(){},init:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(I(this.element),this.evWin,this.domHandler)}};var st={mousedown:N,mousemove:2,mouseup:U},ut="mousedown",ht="mousemove mouseup";function ct(){this.evEl=ut,this.evWin=ht,this.pressed=!1,$.apply(this,arguments)}w(ct,$,{handler:function(t){var e=st[t.type];e&N&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=U),this.pressed&&(e&U&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var lt={pointerdown:N,pointermove:2,pointerup:U,pointercancel:V,pointerout:V},ft={2:"touch",3:"pen",4:"mouse",5:"kinect"},dt="pointerdown",pt="pointermove pointerup pointercancel";function gt(){this.evEl=dt,this.evWin=pt,$.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(dt="MSPointerDown",pt="MSPointerMove MSPointerUp MSPointerCancel"),w(gt,$,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=lt[i],a=ft[t.pointerType]||t.pointerType,o="touch"==a,s=E(e,t.pointerId,"pointerId");r&N&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):r&(U|V)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),n&&e.splice(s,1))}});var vt={touchstart:N,touchmove:2,touchend:U,touchcancel:V},mt="touchstart",yt="touchstart touchmove touchend touchcancel";function _t(){this.evTarget=mt,this.evWin=yt,this.started=!1,$.apply(this,arguments)}w(_t,$,{handler:function(t){var e=vt[t.type];if(e===N&&(this.started=!0),this.started){var n=function(t,e){var n=S(t.touches),i=S(t.changedTouches);return e&(U|V)&&(n=A(n.concat(i),"identifier",!0)),[n,i]}.call(this,t,e);e&(U|V)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var bt={touchstart:N,touchmove:2,touchend:U,touchcancel:V},wt="touchstart touchmove touchend touchcancel";function xt(){this.evTarget=wt,this.targetIds={},$.apply(this,arguments)}w(xt,$,{handler:function(t){var e=bt[t.type],n=function(t,e){var n=S(t.touches),i=this.targetIds;if(e&(2|N)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,a,o=S(t.changedTouches),s=[],u=this.target;if(a=n.filter((function(t){return C(t.target,u)})),e===N)for(r=0;r<a.length;)i[a[r].identifier]=!0,r++;for(r=0;r<o.length;)i[o[r].identifier]&&s.push(o[r]),e&(U|V)&&delete i[o[r].identifier],r++;return s.length?[A(a.concat(s),"identifier",!0),s]:void 0}.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});var Ot=2500;function jt(){$.apply(this,arguments);var t=x(this.handler,this);this.touch=new xt(this.manager,t),this.mouse=new ct(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function kt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),Ot)}}w(jt,$,{handler:function(t,e,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(t,e){t&N?(this.primaryTouch=e.changedPointers[0].identifier,kt.call(this,e)):t&(U|V)&&kt.call(this,e)}).call(this,e,n);else if(r&&function(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],a=Math.abs(e-r.x),o=Math.abs(n-r.y);if(a<=25&&o<=25)return!0}return!1}.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Pt=L(c.style,"touchAction"),Ct=Pt!==s,Tt="manipulation",Mt="none",Et="pan-x",St="pan-y",At=function(){if(!Ct)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||r.CSS.supports("touch-action",n)})),t}();function Lt(t,e){this.manager=t,this.set(e)}Lt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Ct&&this.manager.element.style&&At[t]&&(this.manager.element.style[Pt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return m(this.manager.recognizers,(function(e){O(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(T(t,Mt))return Mt;var e=T(t,Et),n=T(t,St);return e&&n?Mt:e||n?e?Et:St:T(t,Tt)?Tt:"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=T(i,Mt)&&!At[Mt],a=T(i,St)&&!At[St],o=T(i,Et)&&!At[Et];if(r){var s=1===t.pointers.length,u=t.distance<2,h=t.deltaTime<250;if(s&&u&&h)return}if(!o||!a)return r||a&&n&q||o&&n&Y?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Rt=1,It=2,Dt=4,Ft=8,zt=Ft,Bt=16;function Nt(t){this.options=u({},this.defaults,t||{}),this.id=R++,this.manager=null,this.options.enable=j(this.options.enable,!0),this.state=Rt,this.simultaneous={},this.requireFail=[]}function Ut(t){return t&Bt?"cancel":t&Ft?"end":t&Dt?"move":t&It?"start":""}function Vt(t){return t==X?"down":t==W?"up":t==H?"left":t==Z?"right":""}function Gt(t,e){var n=e.manager;return n?n.get(t):t}function Ht(){Nt.apply(this,arguments)}function Zt(){Ht.apply(this,arguments),this.pX=null,this.pY=null}function Wt(){Ht.apply(this,arguments)}function Xt(){Nt.apply(this,arguments),this._timer=null,this._input=null}function qt(){Ht.apply(this,arguments)}function Yt(){Ht.apply(this,arguments)}function Jt(){Nt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Kt(t,e){return(e=e||{}).recognizers=j(e.recognizers,Kt.defaults.preset),new Qt(t,e)}function Qt(t,e){this.options=u({},Kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){return new(t.options.inputClass||(F?gt:z?xt:D?jt:ct))(t,tt)}(this),this.touchAction=new Lt(this,this.options.touchAction),$t(this,!0),m(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function $t(t,e){var n,i=t.element;i.style&&(m(t.options.cssProps,(function(r,a){n=L(i.style,a),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Nt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Gt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)?this:(t=Gt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return-1===E(e,t=Gt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=Gt(t,this);var e=E(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<Ft&&i(e.options.event+Ut(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=Ft&&i(e.options.event+Ut(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Rt)))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!O(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(zt|Bt|32)&&(this.state=Rt),this.state=this.process(e),this.state&(It|Dt|Ft|Bt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},w(Ht,Nt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(It|Dt),r=this.attrTest(t);return i&&(n&V||!r)?e|Bt:i||r?n&U?e|Ft:e&It?e|Dt:It:32}}),w(Zt,Ht,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&q&&e.push(St),t&Y&&e.push(Et),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,a=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&q?(r=0===a?G:a<0?H:Z,n=a!=this.pX,i=Math.abs(t.deltaX)):(r=0===o?G:o<0?W:X,n=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return Ht.prototype.attrTest.call(this,t)&&(this.state&It||!(this.state&It)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Vt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),w(Wt,Ht,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Mt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&It)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),w(Xt,Nt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(U|V)&&!r)this.reset();else if(t.eventType&N)this.reset(),this._timer=g((function(){this.state=zt,this.tryEmit()}),e.time,this);else if(t.eventType&U)return zt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===zt&&(t&&t.eventType&U?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),w(qt,Ht,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Mt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&It)}}),w(Yt,Ht,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:q|Y,pointers:1},getTouchAction:function(){return Zt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(q|Y)?e=t.overallVelocity:n&q?e=t.overallVelocityX:n&Y&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&t.eventType&U},emit:function(t){var e=Vt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),w(Jt,Nt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Tt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&N&&0===this.count)return this.failTimeout();if(i&&r&&n){if(t.eventType!=U)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||at(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=g((function(){this.state=zt,this.tryEmit()}),e.interval,this),It):zt}return 32},failTimeout:function(){return this._timer=g((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==zt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Kt.VERSION="2.0.7",Kt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[qt,{enable:!1}],[Wt,{enable:!1},["rotate"]],[Yt,{direction:q}],[Zt,{direction:q},["swipe"]],[Jt],[Jt,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Qt.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&zt)&&(r=e.curRecognizer=null);for(var a=0;a<i.length;)n=i[a],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(It|Dt|Ft)&&(r=e.curRecognizer=n),a++}},get:function(t){if(t instanceof Nt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=E(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return m(M(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==s){var n=this.handlers;return m(M(t),(function(t){e?n[t]&&n[t].splice(E(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=a.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&$t(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(Kt,{INPUT_START:N,INPUT_MOVE:2,INPUT_END:U,INPUT_CANCEL:V,STATE_POSSIBLE:Rt,STATE_BEGAN:It,STATE_CHANGED:Dt,STATE_ENDED:Ft,STATE_RECOGNIZED:zt,STATE_CANCELLED:Bt,STATE_FAILED:32,DIRECTION_NONE:G,DIRECTION_LEFT:H,DIRECTION_RIGHT:Z,DIRECTION_UP:W,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:q,DIRECTION_VERTICAL:Y,DIRECTION_ALL:J,Manager:Qt,Input:$,TouchAction:Lt,TouchInput:xt,MouseInput:ct,PointerEventInput:gt,TouchMouseInput:jt,SingleTouchInput:_t,Recognizer:Nt,AttrRecognizer:Ht,Tap:Jt,Pan:Zt,Swipe:Yt,Pinch:Wt,Rotate:qt,Press:Xt,on:k,off:P,each:m,merge:b,extend:_,assign:u,inherit:w,bindFn:x,prefixed:L}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=Kt,(i=function(){return Kt}.call(e,n,e,t))===s||(t.exports=i)}(window,document)},yU0y:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return a}));var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random;Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},yq7u:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={vs:"#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",fs:"#define SHADER_NAME luma-modular-fragment\n\nprecision highp float;\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",uniforms:{}}},zGfa:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("md7G"),s=n("foSv"),u=n("JX7q"),h=n("Ji7U"),c=n("e/LK"),l=n("B7nP"),f=n("w+ko"),d=n("ZxFD"),p=n("VMBB"),g="Illegal argument to WebMercatorViewport",v=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e);var i=n.latitude,a=void 0===i?0:i,h=n.longitude,c=void 0===h?0:h,f=n.zoom,d=void 0===f?11:f,p=n.pitch,g=void 0===p?0:p,v=n.bearing,m=void 0===v?0:v,y=n.nearZMultiplier,_=void 0===y?.1:y,b=n.farZMultiplier,w=void 0===b?10:b,x=n.orthographic,O=void 0!==x&&x,j=n.width,k=n.height,P=n.altitude,C=void 0===P?1.5:P;j=j||1,k=k||1,C=Math.max(.75,C);var T=Object(l.e)({width:j,height:k,pitch:g,altitude:C,nearZMultiplier:_,farZMultiplier:w}),M=T.fov,E=T.aspect,S=T.focalDistance,A=T.near,L=T.far,R=Object(l.f)({height:k,pitch:g,bearing:m,altitude:C}),I=Object.assign({},n,{width:j,height:k,viewMatrix:R,longitude:c,latitude:a,zoom:d,orthographic:O,fovyRadians:M,aspect:E,orthographicFocalDistance:S,near:A,far:L});return(t=Object(o.a)(this,Object(s.a)(e).call(this,I))).latitude=a,t.longitude=c,t.zoom=d,t.pitch=g,t.bearing=m,t.altitude=C,t.orthographic=O,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Object(u.a)(t)),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Object(u.a)(t)),Object.freeze(Object(u.a)(t)),t}return Object(h.a)(e,t),Object(a.a)(e,[{key:"metersToLngLatDelta",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],a=e[2],o=void 0===a?0:a;Object(p.a)(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o),g);var s=this.distanceScales,u=s.pixelsPerMeter,h=s.degreesPerPixel,c=n*u[0]*h[0],l=r*u[1]*h[1];return 2===t.length?[c,l]:[c,l,o]}},{key:"lngLatDeltaToMeters",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],a=e[2],o=void 0===a?0:a;Object(p.a)(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o),g);var s=this.distanceScales,u=s.pixelsPerDegree,h=s.metersPerPixel,c=n*u[0]*h[0],l=r*u[1]*h[1];return 2===t.length?[c,l]:[c,l,o]}},{key:"addMetersToLngLat",value:function(t,e){return Object(l.a)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,i=Object(l.h)(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=d.a([],r,d.d([],i)),o=d.a([],this.center,a);return this.unprojectFlat(o)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,a=Object(f.a)(Object.assign({width:i,height:r,bounds:t},n));return new e({width:i,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(c.a);v.displayName="WebMercatorViewport"},zheZ:function(t,e,n){"use strict";n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return l}));var i=n("1OyB"),r=n("vuIU"),a=n("RPaY"),o=n("n6ox"),s=n("VMBB"),u=function(){},h={BREAK:1,SNAP_TO_END:2,IGNORE:3},c={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new a.a,transitionInterruption:h.BREAK,onTransitionStart:u,onTransitionInterrupt:u,onTransitionEnd:u},l=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),Object(s.a)(e),this.ControllerState=e,this.props=Object.assign({},c,n),this.propsInTransition=null,this.transition=new o.a(n.timeline),this.onViewStateChange=n.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(r.a)(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,n=this.props;if(t=Object.assign({},c,t),this.props=t,this._shouldIgnoreViewportChange(n,t))return e;if(this._isTransitionEnabled(t)){var i=this.transition.settings,r=i.interruption,a=i.endProps,o=Object.assign({},n,r===h.SNAP_TO_END?a:this.propsInTransition||n);this._triggerTransition(o,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.settings.interruption===h.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){Object(s.a)(this._isTransitionEnabled(e),"Transition is not enabled");var n=new this.ControllerState(t),i=new this.ControllerState(e).shortestPathFrom(n),r=e.transitionInterpolator.initializeProps(t,i);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:r.start,endProps:r.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this.updateTransition()}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(n){e.propsInTransition=null,t(n)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.time,n=t.settings,i=n.interpolator,r=n.startProps,a=n.endProps,o=n.duration,s=(0,n.easing)(e/o),u=i.interpolateProps(r,a,s);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,u)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0},oldViewState:this.props})}}]),t}();l.defaultProps=c}}]);