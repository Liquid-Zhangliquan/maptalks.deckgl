(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"2tSu":function(e,t,n){"use strict";var r=n("1OyB"),i=n("md7G"),o=n("foSv"),a=n("JX7q"),s=n("Ji7U");n.d(t,"a",(function(){return l}));var u={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},l=function(e){function t(e){var n;return Object(r.a)(this,t),n=Object(i.a)(this,Object(o.a)(t).call(this,e)),e=Object.assign({},u,e),Object.assign(Object(a.a)(n),e),n}return Object(s.a)(t,(function e(){Object(r.a)(this,e)})),t}()},"5lV4":function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n("1OyB"),i=n("vuIU"),o=n("md7G"),a=n("foSv"),s=n("ReuC"),u=n("Ji7U"),l=n("K7jV"),c=n("Jh/b"),g=n("Zk56"),f=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(a.a)(t.prototype),"setState",this).call(this,e),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=t.object;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id?Object.assign(t,{object:n.__source.object,index:n.__source.index}):t}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerRow",value:function(e,t,n){return e.__source={parent:this,object:t,index:n},e}},{key:"getSubLayerAccessor",value:function(e){if("function"==typeof e){var t={data:this.props.data,target:[]};return function(n,r){return n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,r)}}return e}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,r=t.pickable,i=t.visible,o=t.parameters,a=t.getPolygonOffset,s=t.highlightedObjectIndex,u=t.autoHighlight,l=t.highlightColor,c=t.coordinateSystem,g=t.coordinateOrigin,f=t.wrapLongitude,p=t.positionFormat,d=t.modelMatrix,h=t.extensions,v=t._subLayerProps,y={opacity:n,pickable:r,visible:i,parameters:o,getPolygonOffset:a,highlightedObjectIndex:s,autoHighlight:u,highlightColor:l,coordinateSystem:c,coordinateOrigin:g,wrapLongitude:f,positionFormat:p,modelMatrix:d,extensions:h};if(e){var m=v&&v[e.id],b=m&&m.updateTriggers;if(m){var S=this.constructor._propTypes;for(var x in m){var j=S[x];j&&"accessor"===j.type&&(m[x]=this.getSubLayerAccessor(m[x]))}}Object.assign(y,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,b)})}var O=!0,w=!1,k=void 0;try{for(var C,P=h[Symbol.iterator]();!(O=(C=P.next()).done);O=!0){var M=C.value,D=M.getSubLayerProps.call(this,M);Object.assign(y,D,{updateTriggers:Object.assign(y.updateTriggers,D.updateTriggers)})}}catch(e){w=!0,k=e}finally{try{O||null==P.return||P.return()}finally{if(w)throw k}}return y}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?c.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(g.b)(e,{filter:Boolean}),this.internalState.subLayers=e,c.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.parent=this}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"isComposite",get:function(){return!0}}]),t}(l.a);f.layerName="CompositeLayer"},DRYM:function(e,t,n){"use strict";function r(){}function i(e,t){var n=new r;if(e instanceof r)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var i,o=-1,a=e.length;if(null==t)for(;++o<a;)n.set(o,e[o]);else for(;++o<a;)n.set(t(i=e[o],o,e),i)}else if(e)for(var s in e)n.set(s,e[s]);return n}n.r(t),r.prototype=i.prototype={constructor:r,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var o=i;function a(){}var s=o.prototype;a.prototype=function(e,t){var n=new a;if(e instanceof a)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:a,has:s.has,add:function(e){return this["$"+(e+="")]=e,this},remove:s.remove,clear:s.clear,values:s.keys,size:s.size,empty:s.empty,each:s.each};var u={value:function(){}};function l(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r)throw new Error("illegal type: "+e);r[e]=[]}return new c(r)}function c(e){this._=e}function g(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function f(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=u,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}c.prototype=l.prototype={constructor:c,on:function(e,t){var n,r=this._,i=function(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}(e+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<a;)if(n=(e=i[o]).type)r[n]=f(r[n],e.name,t);else if(null==t)for(n in r)r[n]=f(r[n],e.name,null);return this}for(;++o<a;)if((n=(e=i[o]).type)&&(n=g(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new c(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};var p=l,d=function(e,t){var n,r,i,a,s=p("beforesend","progress","load","error"),u=o(),l=new XMLHttpRequest,c=null,g=null,f=0;function d(e){var t,r=l.status;if(!r&&function(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}(l)||r>=200&&r<300||304===r){if(i)try{t=i.call(n,l)}catch(e){return void s.call("error",n,e)}else t=l;s.call("load",n,t)}else s.call("error",n,e)}if("undefined"==typeof XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(e)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=l.ontimeout=d:l.onreadystatechange=function(e){l.readyState>3&&d(e)},l.onprogress=function(e){s.call("progress",n,e)},n={header:function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u.get(e):(null==t?u.remove(e):u.set(e,t+""),n)},mimeType:function(e){return arguments.length?(r=null==e?null:e+"",n):r},responseType:function(e){return arguments.length?(a=e,n):a},timeout:function(e){return arguments.length?(f=+e,n):f},user:function(e){return arguments.length<1?c:(c=null==e?null:e+"",n)},password:function(e){return arguments.length<1?g:(g=null==e?null:e+"",n)},response:function(e){return i=e,n},get:function(e,t){return n.send("GET",e,t)},post:function(e,t){return n.send("POST",e,t)},send:function(t,i,o){return l.open(t,e,!0,c,g),null==r||u.has("accept")||u.set("accept",r+",*/*"),l.setRequestHeader&&u.each((function(e,t){l.setRequestHeader(t,e)})),null!=r&&l.overrideMimeType&&l.overrideMimeType(r),null!=a&&(l.responseType=a),f>0&&(l.timeout=f),null==o&&"function"==typeof i&&(o=i,i=null),null!=o&&1===o.length&&(o=function(e){return function(t,n){e(null==t?n:null)}}(o)),null!=o&&n.on("error",o).on("load",(function(e){o(null,e)})),s.call("beforesend",n,l),l.send(null==i?null:i),n},abort:function(){return l.abort(),n},on:function(){var e=s.on.apply(s,arguments);return e===s?n:e}},null!=t){if("function"!=typeof t)throw new Error("invalid callback: "+t);return n.get(t)}return n},h=function(e,t){return function(n,r){var i=d(n).mimeType(e).response(t);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}},v=h("text/html",(function(e){return document.createRange().createContextualFragment(e.responseText)})),y=h("application/json",(function(e){return JSON.parse(e.responseText)})),m=h("text/plain",(function(e){return e.responseText})),b=h("application/xml",(function(e){var t=e.responseXML;if(!t)throw new Error("parse error");return t})),S={},x={},j=34,O=10,w=13;function k(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+"]"})).join(",")+"}")}var C=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,u=o<=0,l=!1;function c(){if(u)return x;if(l)return l=!1,S;var t,r,i=a;if(e.charCodeAt(i)===j){for(;a++<o&&e.charCodeAt(a)!==j||e.charCodeAt(++a)===j;);return(t=a)>=o?u=!0:(r=e.charCodeAt(a++))===O?l=!0:r===w&&(l=!0,e.charCodeAt(a)===O&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if((r=e.charCodeAt(t=a++))===O)l=!0;else if(r===w)l=!0,e.charCodeAt(a)===O&&++a;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,o)}for(e.charCodeAt(o-1)===O&&--o,e.charCodeAt(o-1)===w&&--o;(r=c())!==x;){for(var g=[];r!==S&&r!==x;)g.push(r),r=c();t&&null==(g=t(g,s++))||i.push(g)}return i}function i(t){return t.map(o).join(e)}function o(e){return null==e?"":t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=k(e);return function(r,i){return t(n(r),i,e)}}(e,t):k(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=function(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}(t)),[n.map(o).join(e)].concat(t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))).join("\n")},formatRows:function(e){return e.map(i).join("\n")}}},P=C(","),M=P.parse,D=(P.parseRows,P.format,P.formatRows,C("\t")),_=D.parse,L=(D.parseRows,D.format,D.formatRows,function(e,t){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=d(n).mimeType(e);return o.row=function(e){return arguments.length?o.response(function(e,t){return function(n){return e(n.responseText,t)}}(t,r=e)):r},o.row(r),i?o.get(i):o}}),A=L("text/csv",M),T=L("text/tab-separated-values",_);n.d(t,"request",(function(){return d})),n.d(t,"html",(function(){return v})),n.d(t,"json",(function(){return y})),n.d(t,"text",(function(){return m})),n.d(t,"xml",(function(){return b})),n.d(t,"csv",(function(){return A})),n.d(t,"tsv",(function(){return T}))},KhhE:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("1OyB"),i=n("vuIU"),o=n("md7G"),a=n("foSv"),s=n("Ji7U"),u=n("Tl6c"),l=n("5cL1"),c=n("V3d6"),g=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(a.a)(t).call(this,e))).projectedLight=new u.c(e),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getProjectedLight",value:function(e){var t=e.layer,n=t.context.viewport,r=t.props,i=r.coordinateSystem,o=r.coordinateOrigin,a=Object(l.b)(this.position,{viewport:n,coordinateSystem:i,coordinateOrigin:o,fromCoordinateSystem:n.isGeospatial?c.a.LNGLAT:c.a.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=a,this.projectedLight}}]),t}(u.c)},TOFf:function(e,t,n){"use strict";var r=n("1OyB"),i=n("vuIU"),o=n("md7G"),a=n("foSv"),s=n("Ji7U"),u=n("2tSu"),l=n("Jh/b"),c=n("5lV4"),g=n("ReuC"),f=n("K7jV"),p=n("S2EH"),d=n("rePB"),h=n("VdrS");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var y=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.id,i=void 0===n?Object(h.c)("column-geometry"):n,s=function(e){var t=e.radius,n=e.height,r=void 0===n?1:n,i=e.nradial,o=void 0===i?10:i,a=e.vertices;l.a.assert(!a||a.length>=o);for(var s=o+1,u=3*s,c=2*Math.PI/o,g=new Uint16Array(3*o*2),f=new Float32Array(3*u),p=new Float32Array(3*u),d=0,h=0;h<s;h++)for(var v=h*c,y=a&&a[h%o],m=a&&a[(h+1)%o],b=Math.sin(v),S=Math.cos(v),x=0;x<2;x++)f[d+0]=y?y[0]:S*t,f[d+1]=y?y[1]:b*t,f[d+2]=(.5-x)*r,p[d+0]=y?m[0]-y[0]:S,p[d+1]=y?m[1]-y[1]:b,d+=3;for(var j=0;j<s;j++){var O=Math.floor(j/2)*Math.sign(j%2-.5),w=O*c,k=a&&a[(O+o)%o],C=Math.sin(w),P=Math.cos(w);f[d+0]=k?k[0]:P*t,f[d+1]=k?k[1]:C*t,f[d+2]=r/2,p[d+2]=1,d+=3}for(var M=0,D=0;D<o;D++)g[M++]=2*D+0,g[M++]=2*D+2,g[M++]=2*D+0,g[M++]=2*D+1,g[M++]=2*D+1,g[M++]=2*D+3;return{indices:g,attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:p}}}}(e),u=s.indices,c=s.attributes;return Object(o.a)(this,Object(a.a)(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{id:i,indices:u,attributes:c})))}return Object(s.a)(t,e),t}(n("C7oE").a),m=new u.a,b=[0,0,0,255],S={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:b},getLineColor:{type:"accessor",value:b},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:m,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},x=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getShaders",value:function(){return Object(g.a)(Object(a.a)(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:["project32","gouraud-lighting","picking"]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:b},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:b},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,r=e.oldProps,i=e.changeFlags;Object(g.a)(Object(a.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i});var o=i.extensionsChanged;if(o){var s=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(s)}),this.getAttributeManager().invalidateAll()}(o||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new y({radius:1,height:2,vertices:t,nradial:e}),r=0;if(t)for(var i=0;i<e;i++){var o=t[i];r+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),n}},{key:"_getModel",value:function(e){return new p.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,r=this.getGeometry(t,n);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.lineWidthUnits,o=r.lineWidthScale,a=r.lineWidthMinPixels,s=r.lineWidthMaxPixels,u=r.elevationScale,l=r.extruded,c=r.filled,g=r.stroked,f=r.wireframe,p=r.offset,d=r.coverage,h=r.radius,v=r.angle,y=this.state,m=y.model,b=y.fillVertexCount,S=y.wireframeVertexCount,x=y.edgeDistance,j="pixels"===i?n.distanceScales.metersPerPixel[2]:1;m.setUniforms(Object.assign({},t,{radius:h,angle:v/180*Math.PI,offset:p,extruded:l,coverage:d,elevationScale:u,edgeDistance:x,widthScale:o*j,widthMinPixels:a,widthMaxPixels:s})),l&&f&&(m.setProps({isIndexed:!0}),m.setVertexCount(S).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(m.setProps({isIndexed:!1}),m.setVertexCount(b).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&g&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*b/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(f.a);x.layerName="ColumnLayer",x.defaultProps=S;var j=Math.PI/3,O=[0,j,2*j,3*j,4*j,5*j];function w(e){return e[0]}function k(e){return e[1]}var C=function(){var e,t,n,r=0,i=0,o=1,a=1,s=w,u=k;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(g=+u.call(null,l,r,e))){var l,c,g,f=Math.round(g/=n),p=Math.round(c=c/t-(1&f)/2),d=g-f;if(3*Math.abs(d)>1){var h=c-p,v=p+(c<p?-1:1)/2,y=f+(g<f?-1:1),m=c-v,b=g-y;h*h+d*d>m*m+b*b&&(p=v+(1&f?1:-1)/2,f=y)}var S=p+"-"+f,x=i[S];x?x.push(l):(o.push(x=i[S]=[l]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return o}function c(e){var t=0,n=0;return O.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var g=l*t+(1&u)*t/2;g<o+t/2;g+=t)s.push([g,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(j),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)},P=n("rpwb"),M=n("U8pU"),D=n("ODXe"),_=function(e){return e.length},L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;Object(r.a)(this,e),this.sortedBins=this.getSortedBins(t,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(i.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,n,r){var i=t(n.points);return null!=i&&e.push({i:Number.isFinite(n.index)?n.index:r,value:i,counts:n.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(D.a)(e,2),n=t[0],r=t[1],i=this.sortedBins.length;if(!i)return[0,0];var o=Math.ceil(n/100*(i-1)),a=Math.floor(r/100*(i-1));return[this.sortedBins[o].value,this.sortedBins[a].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(d.a)({},t.i,t))}),{})}}]),e}();function A(e,t,n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}function T(e,t,n){var r=e[1]-e[0];if(r<=0)return l.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var i=r/t.length,o=Math.floor((n-e[0])/i);return t[Math.max(Math.min(o,t.length-1),0)]}function E(e,t,n){function r(r){return n(e,t,r)}return r.domain=function(){return e},r.range=function(){return t},r}function F(e,t){return E(e,t,T)}function U(e,t){return E(e,t,A)}function R(e,t){return e-t}function I(e,t){var n=e.length;if(t<=0||n<2)return e[0];if(t>=1)return e[n-1];var r=(n-1)*t,i=Math.floor(r),o=e[i];return o+(e[i+1]-o)*(r-i)}function V(e,t){for(var n=e.sort(R),r=0,i=Math.max(1,t.length),o=new Array(i-1);++r<i;)o[r-1]=I(n,r/i);return function(e){return function(e,t,n){return t[function(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1;R(e[i],t)>0?r=i:n=i+1}return n}(e,n)]}(o,t,e)}}function z(e,t){var n=new Map,r=[],i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c="".concat(l);n.has(c)||n.set(c,r.push(l))}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return function(e){return function(e,t,n,r){var i="".concat(r),o=t.get(i);return void 0===o&&(o=e.push(r),t.set(i,o)),n[(o-1)%n.length]}(r,n,t,e)}}var B={SUM:1,MEAN:2,MIN:3,MAX:4};function N(e,t){return e+t}function G(e,t){return t>e?t:e}function W(e,t){return t<e?t:e}function q(e,t){switch(B[e.toUpperCase()]||B.SUM){case B.MIN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(W,1/0):null}(e,t)};case B.SUM:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(N,0):null}(e,t)};case B.MEAN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(N,0)/n.length:null}(e,t)};case B.MAX:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(G,-1/0):null}(e,t)};default:return null}}function $(){}var H=["getBins","getDomain","getScaleFunc"],J=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"}},onSet:{props:"onSetColorDomain"}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"},scaleType:{prop:"colorScaleType"}}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"}},onSet:{props:"onSetElevationDomain"}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"},scaleType:{prop:"elevationScaleType"}}},nullValue:-1}],X=function(e){return e.cellSize},K=function(){function e(t){Object(r.a)(this,e),this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||X,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||J)}return Object(i.a)(e,[{key:"updateState",value:function(e,t){var n=e.oldProps,r=e.props,i=e.changeFlags;this.updateGetValueFuncs(n,r,i);var o=this.needsReProjectPoints(n,r,i);return i.dataChanged||o?this.getAggregatedData(r,t):(this.getDimensionChanges(n,r,i)||[]).forEach((function(e){return"function"==typeof e&&e()})),this.state}},{key:"setState",value:function(e){this.state=Object.assign({},this.state,e)}},{key:"setDimensionState",value:function(e,t){this.setState({dimensions:Object.assign({},this.state.dimensions,Object(d.a)({},e,Object.assign({},this.state.dimensions[e],t)))})}},{key:"normalizeResult",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.hexagons?Object.assign({data:e.hexagons},e):e.layerData?Object.assign({data:e.layerData},e):e}},{key:"getAggregatedData",value:function(e,t){var n=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(n)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}},{key:"updateGetValueFuncs",value:function(e,t,n){for(var r in this.dimensionUpdaters){var i=this.dimensionUpdaters[r].getBins.triggers,o=i.value,a=i.weight,s=i.aggregation,u=t[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[r].getBins,e,t,n)&&null===u&&(u=q(t[s.prop],t[a.prop])),u&&this.setDimensionState(r,{getValue:u})}}},{key:"needsReProjectPoints",value:function(e,t,n){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"addDimension",value:function(e){this._addDimension(e)}},{key:"_addDimension",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){var n=t.key;e.dimensionUpdaters[n]=e.getDimensionUpdaters(t),e.state.dimensions[n]={getValue:null,domain:null,sortedBins:null,scaleFunc:$}}))}},{key:"getDimensionUpdaters",value:function(e){var t=e.key,n=e.accessor,r=e.pickingInfo,i=e.getBins,o=e.getDomain,a=e.getScaleFunc,s=e.nullValue;return{key:t,accessor:n,pickingInfo:r,getBins:Object.assign({updater:this.getDimensionSortedBins},i),getDomain:Object.assign({updater:this.getDimensionValueDomain},o),getScaleFunc:Object.assign({updater:this.getDimensionScale},a),attributeAccessor:this.getSubLayerDimensionAttribute(t,s)}}},{key:"needUpdateDimensionStep",value:function(e,t,n,r){return Object.values(e.triggers).some((function(e){return e.updateTrigger?r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged[e.updateTrigger]):t[e.prop]!==n[e.prop]}))}},{key:"getDimensionChanges",value:function(e,t,n){var r=this,i=[],o=function(o){var a=H.find((function(i){return r.needUpdateDimensionStep(r.dimensionUpdaters[o][i],e,t,n)}));a&&i.push(r.dimensionUpdaters[o][a].updater.bind(r,t,r.dimensionUpdaters[o]))};for(var a in this.dimensionUpdaters)o(a);return i.length?i:null}},{key:"getUpdateTriggers",value:function(e){var t=this,n=e.updateTriggers||{},r={},i=function(i){var o=t.dimensionUpdaters[i].accessor;r[o]={},H.forEach((function(a){Object.values(t.dimensionUpdaters[i][a].triggers).forEach((function(t){var i=t.prop,a=t.updateTrigger;if(a){var s=n[a];"object"!==Object(M.a)(s)||Array.isArray(s)?void 0!==s&&(r[o][i]=s):Object.assign(r[o],s)}else r[o][i]=e[i]}))}))};for(var o in this.dimensionUpdaters)i(o);return r}},{key:"getScaleFunctionByScaleType",value:function(e){switch(e){case"quantize":return F;case"linear":return U;case"quantile":return V;case"ordinal":return z;default:return F}}},{key:"getSortedBins",value:function(e){for(var t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}},{key:"getDimensionSortedBins",value:function(e,t){var n=t.key,r=this.state.dimensions[n].getValue,i=new L(this.state.layerData.data||[],r);this.setDimensionState(n,{sortedBins:i}),this.getDimensionValueDomain(e,t)}},{key:"getDimensionValueDomain",value:function(e,t){var n=t.getDomain,r=t.key,i=n.triggers,o=i.lowerPercentile,a=i.upperPercentile,s=n.onSet,u=this.state.dimensions[r].sortedBins.getValueRange([e[o.prop],e[a.prop]]);"object"===Object(M.a)(s)&&"function"==typeof e[s.props]&&e[s.props](u),this.setDimensionState(r,{valueDomain:u}),this.getDimensionScale(e,t)}},{key:"getDimensionScale",value:function(e,t){var n=t.key,r=t.getScaleFunc.triggers,i=r.domain,o=r.range,a=r.scaleType,s=e[o.prop],u=e[i.prop]||this.state.dimensions[n].valueDomain,l=this.getScaleFunctionByScaleType(e[a.prop])(u,s);this.setDimensionState(n,{scaleFunc:l})}},{key:"getSubLayerDimensionAttribute",value:function(e,t){var n=this;return function(r){var i=n.state.dimensions[e],o=i.sortedBins,a=i.scaleFunc,s=o.binMap[r.index]&&o.binMap[r.index].value,u=a.domain();return s>=u[0]&&s<=u[u.length-1]?a(s):t}}},{key:"getSubLayerAccessors",value:function(e){var t={};for(var n in this.dimensionUpdaters)t[this.dimensionUpdaters[n].accessor]=this.getSubLayerDimensionAttribute(e,n);return t}},{key:"getPickingInfo",value:function(e){var t=e.info,n=null;if(t.picked&&t.index>-1){var r=this.state.layerData.data[t.index],i={};for(var o in this.dimensionUpdaters){var a=this.dimensionUpdaters[o].pickingInfo,s=this.state.dimensions[o].sortedBins,u=s.binMap[r.index]&&s.binMap[r.index].value;i[a]=u}n=Object.assign(i,r)}return Object.assign(t,{picked:Boolean(n),object:n})}},{key:"getAccessor",value:function(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:$}}],[{key:"defaultDimensions",value:function(){return J}}]),e}();function Y(){}n.d(t,"a",(function(){return Q}));var Z={colorDomain:null,colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Y,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Y,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var n=e.data,r=e.radius,i=e.getPosition,o=function(e,t){return e*t.getDistanceScales().pixelsPerMeter[0]}(r,t),a=[],s=Object(P.a)(n),u=s.iterable,c=s.objectInfo,g=!0,f=!1,p=void 0;try{for(var d,h=u[Symbol.iterator]();!(g=(d=h.next()).done);g=!0){var v=d.value;c.index++;var y=i(v,c);Number.isFinite(y[0])&&Number.isFinite(y[1])?a.push(Object.assign({screenCoord:t.projectFlat(y)},v)):l.a.warn("HexagonLayer: invalid position")()}}catch(e){f=!0,p=e}finally{try{g||null==h.return||h.return()}finally{if(f)throw p}}return{hexagons:C().radius(o).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(a).map((function(e,n){return{position:t.unprojectFlat([e.x,e.y]),points:e,index:n}}))}},getPosition:{type:"accessor",value:function(e){return e.position}},material:new u.a},Q=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"initializeState",value:function(){var e=new K({getAggregator:function(e){return e.hexagonAggregator},getCellSize:function(e){return e.radius}});this.state={cpuAggregator:e,aggregatorState:e.state}}},{key:"updateState",value:function(e){var t=e.oldProps,n=e.props,r=e.changeFlags,i=this.state.cpuAggregator,o=i.state.layerData;if(this.setState({aggregatorState:i.updateState({oldProps:t,props:n,changeFlags:r},this.context.viewport)}),o!==i.state.layerData){var a=i.state.layerData.hexagonVertices;this.updateRadiusAngle(a)}}},{key:"updateRadiusAngle",value:function(e){var t=this.props.radius,n=90;if(Array.isArray(e)){e.length<6&&l.a.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var r=e[0],i=e[3],o=this.context.viewport.getDistanceScales().pixelsPerMeter,a=this.projectFlat(r),s=this.projectFlat(i),u=a[0]-s[0],c=a[1]-s[1],g=Math.sqrt(u*u+c*c);n=Math.acos(u/g)*-Math.sign(c)/Math.PI*180+90,t=g/2/o[0]}this.setState({angle:n,radius:t})}},{key:"getPickingInfo",value:function(e){var t=e.info;return this.state.cpuAggregator.getPickingInfo({info:t})}},{key:"_onGetSublayerColor",value:function(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}},{key:"_onGetSublayerElevation",value:function(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.extruded,r=e.coverage,i=e.material,o=e.transitions,a=this.state,s=a.angle,u=a.radius,l=a.cpuAggregator,c=this.getSubLayerClass("hexagon-cell",x),g=this._getSublayerUpdateTriggers();return new c({radius:u,diskResolution:6,elevationScale:t,angle:s,extruded:n,coverage:r,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:g}),{data:l.state.layerData.data})}}]),t}(c.a);Q.layerName="HexagonLayer",Q.defaultProps=Z}}]);